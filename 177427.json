{"path":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","commits":[{"id":"7b01e327764dff0c4e657a87afb8a11306045b76","date":1320242486,"type":0,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"/dev/null","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happend right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit, shouldn't need any fudge given \n    // other actions already taken\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(100, 6 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"fd046f471d3f4fb6cdda913c27847ccd68b3f25c","date":1320269452,"type":3,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happend right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(100, 6 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happend right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit, shouldn't need any fudge given \n    // other actions already taken\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(100, 6 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"2c007e7c4cf8c55bc2a5884e315123afaaeec87f","date":1327520966,"type":3,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(200, 12 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happend right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(100, 6 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a3c68e20c73359a10cf3eb4a35c9fa7ab1f3c30d","date":1327523564,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(200, 12 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happend right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(100, 6 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0d22ac6a4146774c1bc8400160fc0b6150294e92","date":1327528604,"type":3,"author":"Uwe Schindler","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(200, 12 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happend right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(100, 6 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f2c15ea9d558357ea4409f97062083aeb87a445a","date":1362861676,"type":3,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(200, 12 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"bcf9886c8ff537aafde14de48ebf744f5673f08b","date":1439041198,"type":3,"author":"Ramkumar Aiyengar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occured too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occured too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.currentTimeMillis();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n    \n    assertTrue(\"soft529 occured too fast: \" + \n               add529 + \" + \" + softCommitWaitMillis + \" !<= \" + soft529,\n               add529 + softCommitWaitMillis <= soft529);\n    assertTrue(\"hard529 occured too fast: \" + \n               add529 + \" + \" + hardCommitWaitMillis + \" !<= \" + hard529,\n               add529 + hardCommitWaitMillis <= hard529);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529 - add529 - softCommitWaitMillis));\n    assertTrue(\"searcher529 wasn't soon enough after soft529: \" +\n               searcher529 + \" !< \" + soft529 + \" + \" + slowTestFudge + \" (fudge)\",\n               searcher529 < soft529 + slowTestFudge );\n\n    assertTrue(\"hard529 was before searcher529: \" + \n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2), \n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0158ced21948b6626f733c1c42c1e18d94449789","date":1462994341,"type":3,"author":"Bartosz Krasiński","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occured too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occured too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d470c8182e92b264680e34081b75e70a9f2b3c89","date":1463985353,"type":3,"author":"Noble Paul","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occured too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occured too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4cce5816ef15a48a0bc11e5d400497ee4301dd3b","date":1476991456,"type":3,"author":"Kevin Risden","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occured too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occured too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitley shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"b3c48bc1cdb1117f7dfeadd43a9f81693eeb9bf2","date":1483008045,"type":3,"author":"markrmiller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f03e4bed5023ec3ef93a771b8888cae991cf448d","date":1483469262,"type":3,"author":"Kevin Risden","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6a043e93ce5cee80458f8468ac6db8f024055773","date":1486677634,"type":3,"author":"markrmiller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    int startingHardCommits = hardTracker.getCommitCount();\n    int startingSoftCommits = softTracker.getCommitCount();\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    // simplify whats going on by only having soft auto commits trigger new searchers\n    hardTracker.setOpenSearcher(false);\n\n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 500, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    \n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    \n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(5000, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount() - startingHardCommits);\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount() - startingSoftCommits);\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount() - startingSoftCommits);\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    // clear commits\n    monitor.hard.clear();\n    monitor.soft.clear();\n\n    // wait a bit, w/o other action we shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(1000, MILLISECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n    monitor.searcher.clear();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    \n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(softCommitWaitMillis * 3, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount());\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount());\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount());\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    monitor.assertSaneOffers();\n\n    // wait a bit, w/o other action we definitely shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(2, SECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"3c903df062ce7ba11d48e3e2da5293b14e516bc0","date":1487549972,"type":3,"author":"markrmiller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    // wait out any leaked commits\n    monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    monitor.hard.poll(hardCommitWaitMillis * 2, MILLISECONDS);\n    \n    int startingHardCommits = hardTracker.getCommitCount();\n    int startingSoftCommits = softTracker.getCommitCount();\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    // simplify whats going on by only having soft auto commits trigger new searchers\n    hardTracker.setOpenSearcher(false);\n\n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    \n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    \n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(5000, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount() - startingHardCommits);\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount() - startingSoftCommits);\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount() - startingSoftCommits);\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    // clear commits\n    monitor.hard.clear();\n    monitor.soft.clear();\n\n    // wait a bit, w/o other action we shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(1000, MILLISECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n    monitor.searcher.clear();\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    int startingHardCommits = hardTracker.getCommitCount();\n    int startingSoftCommits = softTracker.getCommitCount();\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    // simplify whats going on by only having soft auto commits trigger new searchers\n    hardTracker.setOpenSearcher(false);\n\n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 500, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    \n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    \n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(5000, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount() - startingHardCommits);\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount() - startingSoftCommits);\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount() - startingSoftCommits);\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    // clear commits\n    monitor.hard.clear();\n    monitor.soft.clear();\n\n    // wait a bit, w/o other action we shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(1000, MILLISECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n    monitor.searcher.clear();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"25aea5e95fe9399f6ca9758178fa3a003159ff4d","date":1507651705,"type":3,"author":"Chris Hostetter","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","pathOld":"solr/core/src/test/org/apache/solr/update/SoftAutoCommitTest#testSoftAndHardCommitMaxTimeMixedAdds().mjava","sourceNew":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n   doTestSoftAndHardCommitMaxTimeMixedAdds(CommitWithinType.NONE);\n  }\n\n","sourceOld":"  public void testSoftAndHardCommitMaxTimeMixedAdds() throws Exception {\n    final int softCommitWaitMillis = 500;\n    final int hardCommitWaitMillis = 1200;\n\n    CommitTracker hardTracker = updater.commitTracker;\n    CommitTracker softTracker = updater.softCommitTracker;\n    \n    // wait out any leaked commits\n    monitor.soft.poll(softCommitWaitMillis * 2, MILLISECONDS);\n    monitor.hard.poll(hardCommitWaitMillis * 2, MILLISECONDS);\n    \n    int startingHardCommits = hardTracker.getCommitCount();\n    int startingSoftCommits = softTracker.getCommitCount();\n    \n    softTracker.setTimeUpperBound(softCommitWaitMillis);\n    softTracker.setDocsUpperBound(-1);\n    hardTracker.setTimeUpperBound(hardCommitWaitMillis);\n    hardTracker.setDocsUpperBound(-1);\n    // simplify whats going on by only having soft auto commits trigger new searchers\n    hardTracker.setOpenSearcher(false);\n\n    // Add a single document\n    long add529 = System.nanoTime();\n    assertU(adoc(\"id\", \"529\", \"subject\", \"the doc we care about in this test\"));\n\n    monitor.assertSaneOffers();\n\n    // Wait for the soft commit with some fudge\n    Long soft529 = monitor.soft.poll(softCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"soft529 wasn't fast enough\", soft529);\n    monitor.assertSaneOffers();\n\n    \n    // wait for the hard commit\n    Long hard529 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertNotNull(\"hard529 wasn't fast enough\", hard529);\n    \n    // check for the searcher, should have happened right after soft commit\n    Long searcher529 = monitor.searcher.poll(5000, MILLISECONDS);\n    assertNotNull(\"searcher529 wasn't fast enough\", searcher529);\n    monitor.assertSaneOffers();\n\n    // toss in another doc, shouldn't affect first hard commit time we poll\n    assertU(adoc(\"id\", \"530\", \"subject\", \"just for noise/activity\"));\n\n\n    monitor.assertSaneOffers();\n\n    final long soft529Ms = TimeUnit.MILLISECONDS.convert(soft529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"soft529 occurred too fast, in \" +\n            soft529Ms + \"ms, less than soft commit interval \" + softCommitWaitMillis,\n        soft529Ms >= softCommitWaitMillis);\n    final long hard529Ms = TimeUnit.MILLISECONDS.convert(hard529 - add529, TimeUnit.NANOSECONDS);\n    assertTrue(\"hard529 occurred too fast, in \" +\n            hard529Ms + \"ms, less than hard commit interval \" + hardCommitWaitMillis,\n        hard529Ms >= hardCommitWaitMillis);\n\n    // however slow the machine was to do the soft commit compared to expected,\n    // assume newSearcher had some magnitude of that much overhead as well \n    long slowTestFudge = Math.max(300, 12 * (soft529Ms - softCommitWaitMillis));\n    final long softCommitToSearcherOpenMs = TimeUnit.MILLISECONDS.convert(searcher529 - soft529, TimeUnit.NANOSECONDS);\n    assertTrue(\"searcher529 wasn't soon enough after soft529: Took \" +\n            softCommitToSearcherOpenMs + \"ms, >= acceptable \" + slowTestFudge + \"ms (fudge)\",\n        softCommitToSearcherOpenMs < slowTestFudge);\n\n    assertTrue(\"hard529 was before searcher529: \" +\n               searcher529 + \" !<= \" + hard529,\n               searcher529 <= hard529);\n\n    monitor.assertSaneOffers();\n\n    // there may have been (or will be) a second hard commit for 530\n    Long hard530 = monitor.hard.poll(hardCommitWaitMillis * 5, MILLISECONDS);\n    assertEquals(\"Tracker reports too many hard commits\",\n                 (null == hard530 ? 1 : 2),\n                 hardTracker.getCommitCount() - startingHardCommits);\n\n    // there may have been a second soft commit for 530, \n    // but if so it must have already happend\n    Long soft530 = monitor.soft.poll(0, MILLISECONDS);\n    if (null != soft530) {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   2, softTracker.getCommitCount() - startingSoftCommits);\n      if (null != hard530) {\n        assertTrue(\"soft530 after hard530: \" +\n                   soft530 + \" !<= \" + hard530,\n                   soft530 <= hard530);\n      } else {\n        assertTrue(\"soft530 after hard529 but no hard530: \" +\n                   soft530 + \" !<= \" + hard529,\n                   soft530 <= hard529);\n      }\n    } else {\n      assertEquals(\"Tracker reports too many soft commits\",\n                   1, softTracker.getCommitCount() - startingSoftCommits);\n    }\n      \n    if (null != soft530 || null != hard530) {\n      assertNotNull(\"at least one extra commit for 530, but no searcher\",\n                    monitor.searcher.poll(0, MILLISECONDS));\n    }\n\n    // clear commits\n    monitor.hard.clear();\n    monitor.soft.clear();\n\n    // wait a bit, w/o other action we shouldn't see any \n    // new hard/soft commits \n    assertNull(\"Got a hard commit we weren't expecting\",\n               monitor.hard.poll(1000, MILLISECONDS));\n    assertNull(\"Got a soft commit we weren't expecting\",\n               monitor.soft.poll(0, MILLISECONDS));\n\n    monitor.assertSaneOffers();\n    monitor.searcher.clear();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a3c68e20c73359a10cf3eb4a35c9fa7ab1f3c30d":["fd046f471d3f4fb6cdda913c27847ccd68b3f25c","2c007e7c4cf8c55bc2a5884e315123afaaeec87f"],"25aea5e95fe9399f6ca9758178fa3a003159ff4d":["3c903df062ce7ba11d48e3e2da5293b14e516bc0"],"4cce5816ef15a48a0bc11e5d400497ee4301dd3b":["bcf9886c8ff537aafde14de48ebf744f5673f08b","d470c8182e92b264680e34081b75e70a9f2b3c89"],"d470c8182e92b264680e34081b75e70a9f2b3c89":["bcf9886c8ff537aafde14de48ebf744f5673f08b","0158ced21948b6626f733c1c42c1e18d94449789"],"f03e4bed5023ec3ef93a771b8888cae991cf448d":["4cce5816ef15a48a0bc11e5d400497ee4301dd3b","b3c48bc1cdb1117f7dfeadd43a9f81693eeb9bf2"],"6a043e93ce5cee80458f8468ac6db8f024055773":["b3c48bc1cdb1117f7dfeadd43a9f81693eeb9bf2"],"0d22ac6a4146774c1bc8400160fc0b6150294e92":["fd046f471d3f4fb6cdda913c27847ccd68b3f25c","2c007e7c4cf8c55bc2a5884e315123afaaeec87f"],"7b01e327764dff0c4e657a87afb8a11306045b76":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"3c903df062ce7ba11d48e3e2da5293b14e516bc0":["6a043e93ce5cee80458f8468ac6db8f024055773"],"fd046f471d3f4fb6cdda913c27847ccd68b3f25c":["7b01e327764dff0c4e657a87afb8a11306045b76"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"2c007e7c4cf8c55bc2a5884e315123afaaeec87f":["fd046f471d3f4fb6cdda913c27847ccd68b3f25c"],"b3c48bc1cdb1117f7dfeadd43a9f81693eeb9bf2":["d470c8182e92b264680e34081b75e70a9f2b3c89"],"bcf9886c8ff537aafde14de48ebf744f5673f08b":["f2c15ea9d558357ea4409f97062083aeb87a445a"],"f2c15ea9d558357ea4409f97062083aeb87a445a":["2c007e7c4cf8c55bc2a5884e315123afaaeec87f"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["25aea5e95fe9399f6ca9758178fa3a003159ff4d"],"0158ced21948b6626f733c1c42c1e18d94449789":["bcf9886c8ff537aafde14de48ebf744f5673f08b"]},"commit2Childs":{"a3c68e20c73359a10cf3eb4a35c9fa7ab1f3c30d":[],"25aea5e95fe9399f6ca9758178fa3a003159ff4d":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"4cce5816ef15a48a0bc11e5d400497ee4301dd3b":["f03e4bed5023ec3ef93a771b8888cae991cf448d"],"d470c8182e92b264680e34081b75e70a9f2b3c89":["4cce5816ef15a48a0bc11e5d400497ee4301dd3b","b3c48bc1cdb1117f7dfeadd43a9f81693eeb9bf2"],"f03e4bed5023ec3ef93a771b8888cae991cf448d":[],"6a043e93ce5cee80458f8468ac6db8f024055773":["3c903df062ce7ba11d48e3e2da5293b14e516bc0"],"0d22ac6a4146774c1bc8400160fc0b6150294e92":[],"7b01e327764dff0c4e657a87afb8a11306045b76":["fd046f471d3f4fb6cdda913c27847ccd68b3f25c"],"fd046f471d3f4fb6cdda913c27847ccd68b3f25c":["a3c68e20c73359a10cf3eb4a35c9fa7ab1f3c30d","0d22ac6a4146774c1bc8400160fc0b6150294e92","2c007e7c4cf8c55bc2a5884e315123afaaeec87f"],"3c903df062ce7ba11d48e3e2da5293b14e516bc0":["25aea5e95fe9399f6ca9758178fa3a003159ff4d"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["7b01e327764dff0c4e657a87afb8a11306045b76"],"2c007e7c4cf8c55bc2a5884e315123afaaeec87f":["a3c68e20c73359a10cf3eb4a35c9fa7ab1f3c30d","0d22ac6a4146774c1bc8400160fc0b6150294e92","f2c15ea9d558357ea4409f97062083aeb87a445a"],"bcf9886c8ff537aafde14de48ebf744f5673f08b":["4cce5816ef15a48a0bc11e5d400497ee4301dd3b","d470c8182e92b264680e34081b75e70a9f2b3c89","0158ced21948b6626f733c1c42c1e18d94449789"],"b3c48bc1cdb1117f7dfeadd43a9f81693eeb9bf2":["f03e4bed5023ec3ef93a771b8888cae991cf448d","6a043e93ce5cee80458f8468ac6db8f024055773"],"f2c15ea9d558357ea4409f97062083aeb87a445a":["bcf9886c8ff537aafde14de48ebf744f5673f08b"],"0158ced21948b6626f733c1c42c1e18d94449789":["d470c8182e92b264680e34081b75e70a9f2b3c89"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["a3c68e20c73359a10cf3eb4a35c9fa7ab1f3c30d","f03e4bed5023ec3ef93a771b8888cae991cf448d","0d22ac6a4146774c1bc8400160fc0b6150294e92","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}