{"path":"lucene/core/src/test/org/apache/lucene/util/automaton/TestAutomaton#verifyTopoSort(Automaton).mjava","commits":[{"id":"13b60e3f947fc4f9e2fd81e1929a6809327ff537","date":1435953804,"type":0,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/util/automaton/TestAutomaton#verifyTopoSort(Automaton).mjava","pathOld":"/dev/null","sourceNew":"  /** Runs topo sort, verifies transitions then only \"go forwards\", and\n   *  builds and returns new automaton with those remapped toposorted states. */\n  private Automaton verifyTopoSort(Automaton a) {\n    int[] sorted = Operations.topoSortStates(a);\n    // This can be < if we removed dead states:\n    assertTrue(sorted.length <= a.getNumStates());\n    Automaton a2 = new Automaton();\n    int[] stateMap = new int[a.getNumStates()];\n    Arrays.fill(stateMap, -1);\n    Transition transition = new Transition();\n    for(int state : sorted) {\n      int newState = a2.createState();\n      a2.setAccept(newState, a.isAccept(state));\n\n      // Each state should only appear once in the sort:\n      assertEquals(-1, stateMap[state]);\n      stateMap[state] = newState;\n    }\n\n    // 2nd pass: add new transitions\n    for(int state : sorted) {\n      int count = a.initTransition(state, transition);\n      for(int i=0;i<count;i++) {\n        a.getNextTransition(transition);\n        assert stateMap[transition.dest] > stateMap[state];\n        a2.addTransition(stateMap[state], stateMap[transition.dest], transition.min, transition.max);\n      }\n    }\n\n    a2.finishState();\n    return a2;\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"13b60e3f947fc4f9e2fd81e1929a6809327ff537":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["13b60e3f947fc4f9e2fd81e1929a6809327ff537"]},"commit2Childs":{"13b60e3f947fc4f9e2fd81e1929a6809327ff537":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["13b60e3f947fc4f9e2fd81e1929a6809327ff537"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}