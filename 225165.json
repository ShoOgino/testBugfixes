{"path":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#testCardinality().mjava","commits":[{"id":"4a4e2c829188fb99886a64558664d79c9ac0fdf1","date":1431021538,"type":0,"author":"Chris M. Hostetter","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#testCardinality().mjava","pathOld":"/dev/null","sourceNew":"  /** @see #testHllOptions */\n  public void testCardinality() throws Exception {\n    SolrCore core = h.getCore();\n    // insure we have the same hasher a_l would use\n    HashFunction hasher = HllOptions.parseHllOptions\n      (params(\"cardinality\",\"true\"), core.getLatestSchema().getField(\"a_l\")).getHasher();\n\n    String[] baseParams = new String[] { \"q\",\"*:*\", \"stats\",\"true\", \"indent\",\"true\", \"rows\",\"0\" };\n    assertQ(\"empty cardinalities\"\n            , req(params(\"stats.field\",\"{!key=a cardinality=true}a_l\",\n                         \"stats.field\",\"{!key=pa cardinality=true}prehashed_a_l\",\n                         \"stats.field\",\"{!key=b cardinality=true}b_l\", \n                         \"stats.field\",\"{!key=c cardinality=true}c_l\"), \n                  baseParams)\n            , cardinalityXpath(\"a\", 0)\n            , cardinalityXpath(\"pa\", 0)\n            , cardinalityXpath(\"b\", 0)\n            , cardinalityXpath(\"c\", 0)\n            );\n\n    int id = 0;\n    // add trivial docs to test basic cardinality\n    for (int i = 0; i < 100; i++) {\n      // add the same values multiple times (diff docs)\n      for (int j =0; j < 5; j++) {\n        ++id;\n        assertU(adoc(\"id\", \"\"+id, \n                     \"a_l\", \"\"+i, \"prehashed_a_l\", \"\"+hasher.hashLong((long)i).asLong(),\n                     \"b_l\", \"\"+(i % 7), \"c_l\", \"\"+id));\n      }\n    }\n    assertU(commit());\n\n    assertQ(\"various cardinalities\"\n            , req(params(\"stats.field\",\"{!key=a cardinality=true}a_l\",\n                         \"stats.field\",\"{!key=pa hllPreHashed=true cardinality=true}prehashed_a_l\",\n                         \"stats.field\",\"{!key=b cardinality=true}b_l\", \n                         \"stats.field\",\"{!key=c cardinality=true}c_l\"), \n                  baseParams)\n            , cardinalityXpath(\"a\", 100)\n            , cardinalityXpath(\"pa\", 100)\n            , cardinalityXpath(\"b\", 7)\n            , cardinalityXpath(\"c\", 500)\n            );\n    \n    // various ways of explicitly saying \"don't bother to compute cardinality\"\n    for (SolrParams p : new SolrParams[] {\n        params(\"stats.field\",\"{!key=a min=true cardinality=false}a_l\"),\n        params(\"stats.field\",\"{!key=a min=true cardinality=$doit}a_l\", \"doit\", \"false\"),\n        params(\"stats.field\",\"{!key=a min=true cardinality=$doit}a_l\"), // missing doit param\n        // other tunning options shouldn't change things\n        params(\"stats.field\",\"{!key=a min=true hllPreHashed=true cardinality=false}a_l\"),\n        params(\"stats.field\",\"{!key=a min=true hllRegwidth=4 cardinality=$doit}a_l\", \"doit\", \"false\"),\n        params(\"stats.field\",\"{!key=a min=true hllLog2m=18 cardinality=$doit}a_l\"), // missing doit param\n      }) {\n      assertQ(\"min w/cardinality explicitly disabled\", req(p, baseParams),\n              \"count(//lst[@name='stats_fields']/lst[@name='a']/double[@name='min'])=1\",\n              \"count(//lst[@name='stats_fields']/lst[@name='a']/long[@name='cardinality'])=0\");\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"4a4e2c829188fb99886a64558664d79c9ac0fdf1":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["4a4e2c829188fb99886a64558664d79c9ac0fdf1"]},"commit2Childs":{"4a4e2c829188fb99886a64558664d79c9ac0fdf1":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["4a4e2c829188fb99886a64558664d79c9ac0fdf1"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}