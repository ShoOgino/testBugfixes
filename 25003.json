{"path":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","commits":[{"id":"a6446ce810056afd1a06b7a7239ec3cb3b65e31e","date":1393220603,"type":0,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"/dev/null","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    handle.put(\"QTime\", SKIPVAL);\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":["072f211dfa8387028bb978d128c35bf9a450bbbf"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"13f445c5bd6f19fd57d5a3ca0a35244c96f45aa8","date":1393532551,"type":0,"author":"Robert Muir","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"/dev/null","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    handle.put(\"QTime\", SKIPVAL);\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"5ba39ba201a572fd944ed71d888de0cd4f2957af","date":1404307334,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    handle.put(\"QTime\", SKIPVAL);\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n  }\n\n","sourceOld":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    handle.put(\"QTime\", SKIPVAL);\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"072f211dfa8387028bb978d128c35bf9a450bbbf","date":1406041363,"type":3,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n  }\n\n","sourceOld":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    handle.put(\"QTime\", SKIPVAL);\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n  }\n\n","bugFix":["a6446ce810056afd1a06b7a7239ec3cb3b65e31e"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"659bd5da21bf2e51b42e1ad49c7107ad4ff1803f","date":1412786163,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n  }\n\n","sourceOld":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"55980207f1977bd1463465de1659b821347e2fa8","date":1413336386,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n  }\n\n","sourceOld":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"63050a64dea4ad92b4c30bd6b7008232038e5818","date":1417473851,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    handle.clear();\n    handle.put(\"timestamp\", SKIPVAL);\n    handle.put(\"_version_\", SKIPVAL);\n    // we don't to compare maxScore because most distributed requests return it anyway (just because they have score already)\n    handle.put(\"maxScore\", SKIPVAL);\n    query(\"q\", \"{!func}id\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n  }\n\n","sourceOld":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0fd29060ef78d73cb2d3f2ba2b318785363e3a4e","date":1417529075,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","sourceNew":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    // see SOLR-6795, distrib.singlePass=true would return score even when not asked for\n    handle.clear();\n    handle.put(\"timestamp\", SKIPVAL);\n    handle.put(\"_version_\", SKIPVAL);\n    // we don't to compare maxScore because most distributed requests return it anyway (just because they have score already)\n    handle.put(\"maxScore\", SKIPVAL);\n    query(\"q\", \"{!func}id\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n\n    // fix for a bug where not all fields are returned if using multiple fl parameters, see SOLR-6796\n    query(\"q\",\"*:*\", \"fl\", \"id\", \"fl\",\"dynamic\",\"sort\",\"payload desc\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n  }\n\n","sourceOld":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    handle.clear();\n    handle.put(\"timestamp\", SKIPVAL);\n    handle.put(\"_version_\", SKIPVAL);\n    // we don't to compare maxScore because most distributed requests return it anyway (just because they have score already)\n    handle.put(\"maxScore\", SKIPVAL);\n    query(\"q\", \"{!func}id\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"abb23fcc2461782ab204e61213240feb77d355aa","date":1422029612,"type":5,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#test().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/DistributedQueryComponentOptimizationTest#doTest().mjava","sourceNew":"  @Test\n  @ShardsFixed(num = 3)\n  public void test() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    // see SOLR-6795, distrib.singlePass=true would return score even when not asked for\n    handle.clear();\n    handle.put(\"timestamp\", SKIPVAL);\n    handle.put(\"_version_\", SKIPVAL);\n    // we don't to compare maxScore because most distributed requests return it anyway (just because they have score already)\n    handle.put(\"maxScore\", SKIPVAL);\n    query(\"q\", \"{!func}id\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n\n    // fix for a bug where not all fields are returned if using multiple fl parameters, see SOLR-6796\n    query(\"q\",\"*:*\", \"fl\", \"id\", \"fl\",\"dynamic\",\"sort\",\"payload desc\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n  }\n\n","sourceOld":"  @Override\n  public void doTest() throws Exception {\n    del(\"*:*\");\n\n    index(id, \"1\", \"text\", \"a\", \"test_sS\", \"21\", \"payload\", ByteBuffer.wrap(new byte[] { 0x12, 0x62, 0x15 }),                     //  2\n          // quick check to prove \"*\" dynamicField hasn't been broken by somebody mucking with schema\n          \"asdfasdf_field_should_match_catchall_dynamic_field_adsfasdf\", \"value\");\n    index(id, \"2\", \"text\", \"b\", \"test_sS\", \"22\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x16 }));                    //  5\n    index(id, \"3\", \"text\", \"a\", \"test_sS\", \"23\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x32, 0x58 }));                    //  8\n    index(id, \"4\", \"text\", \"b\", \"test_sS\", \"24\", \"payload\", ByteBuffer.wrap(new byte[] { 0x25, 0x21, 0x15 }));                    //  4\n    index(id, \"5\", \"text\", \"a\", \"test_sS\", \"25\", \"payload\", ByteBuffer.wrap(new byte[] { 0x35, 0x35, 0x10, 0x00 }));              //  9\n    index(id, \"6\", \"text\", \"c\", \"test_sS\", \"26\", \"payload\", ByteBuffer.wrap(new byte[] { 0x1a, 0x2b, 0x3c, 0x00, 0x00, 0x03 }));  //  3\n    index(id, \"7\", \"text\", \"c\", \"test_sS\", \"27\", \"payload\", ByteBuffer.wrap(new byte[] { 0x00, 0x3c, 0x73 }));                    //  1\n    index(id, \"8\", \"text\", \"c\", \"test_sS\", \"28\", \"payload\", ByteBuffer.wrap(new byte[] { 0x59, 0x2d, 0x4d }));                    // 11\n    index(id, \"9\", \"text\", \"a\", \"test_sS\", \"29\", \"payload\", ByteBuffer.wrap(new byte[] { 0x39, 0x79, 0x7a }));                    // 10\n    index(id, \"10\", \"text\", \"b\", \"test_sS\", \"30\", \"payload\", ByteBuffer.wrap(new byte[] { 0x31, 0x39, 0x7c }));                   //  6\n    index(id, \"11\", \"text\", \"d\", \"test_sS\", \"31\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0xff, (byte)0xaf, (byte)0x9c })); // 13\n    index(id, \"12\", \"text\", \"d\", \"test_sS\", \"32\", \"payload\", ByteBuffer.wrap(new byte[] { 0x34, (byte)0xdd, 0x4d }));             //  7\n    index(id, \"13\", \"text\", \"d\", \"test_sS\", \"33\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));             // 12\n    commit();\n\n    QueryResponse rsp;\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n    // works with just fl=id as well\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 11, 13, 8, 9, 5, 3, 12, 10, 2, 4, 6, 1, 7);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n\n    rsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(rsp.getResults(), id, 7, 1, 6, 4, 2, 10, 12, 3, 5, 9, 8, 13, 11);\n    assertFieldValues(rsp.getResults(), \"test_sS\", \"27\", \"21\", \"26\", \"24\", \"22\", \"30\", \"32\", \"23\", \"25\", \"29\", \"28\", \"33\", \"31\");\n\n    QueryResponse nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"id,test_sS,score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    nonDistribRsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\");\n    rsp = query(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n    compareResponses(rsp, nonDistribRsp); // make sure distrib and distrib.singlePass return the same thing\n\n    // verify that the optimization actually works\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"id,score\", \"sort\", \"payload desc\", \"rows\", \"20\"); // id,score only is optimized by default\n    verifySinglePass(\"q\", \"*:*\", \"fl\", \"score\", \"sort\", \"payload asc\", \"rows\", \"20\", \"distrib.singlePass\", \"true\");\n\n    // SOLR-6545, wild card field list\n    index(id, \"19\", \"text\", \"d\", \"cat_a_sS\", \"1\" ,\"dynamic\", \"2\", \"payload\", ByteBuffer.wrap(new byte[] { (byte)0x80, 0x11, 0x33 }));\n    commit();\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    nonDistribRsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\");\n    rsp = query(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    assertFieldValues(nonDistribRsp.getResults(), \"id\", 19);\n    assertFieldValues(rsp.getResults(), \"id\", 19);\n\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,*a_sS\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n    verifySinglePass(\"q\", \"id:19\", \"fl\", \"id,dynamic,cat*\", \"sort\", \"payload asc\", \"distrib.singlePass\", \"true\");\n\n    // see SOLR-6795, distrib.singlePass=true would return score even when not asked for\n    handle.clear();\n    handle.put(\"timestamp\", SKIPVAL);\n    handle.put(\"_version_\", SKIPVAL);\n    // we don't to compare maxScore because most distributed requests return it anyway (just because they have score already)\n    handle.put(\"maxScore\", SKIPVAL);\n    query(\"q\", \"{!func}id\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n\n    // fix for a bug where not all fields are returned if using multiple fl parameters, see SOLR-6796\n    query(\"q\",\"*:*\", \"fl\", \"id\", \"fl\",\"dynamic\",\"sort\",\"payload desc\", ShardParams.DISTRIB_SINGLE_PASS, \"true\");\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"659bd5da21bf2e51b42e1ad49c7107ad4ff1803f":["072f211dfa8387028bb978d128c35bf9a450bbbf"],"072f211dfa8387028bb978d128c35bf9a450bbbf":["5ba39ba201a572fd944ed71d888de0cd4f2957af"],"55980207f1977bd1463465de1659b821347e2fa8":["072f211dfa8387028bb978d128c35bf9a450bbbf","659bd5da21bf2e51b42e1ad49c7107ad4ff1803f"],"63050a64dea4ad92b4c30bd6b7008232038e5818":["659bd5da21bf2e51b42e1ad49c7107ad4ff1803f"],"abb23fcc2461782ab204e61213240feb77d355aa":["0fd29060ef78d73cb2d3f2ba2b318785363e3a4e"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"0fd29060ef78d73cb2d3f2ba2b318785363e3a4e":["63050a64dea4ad92b4c30bd6b7008232038e5818"],"5ba39ba201a572fd944ed71d888de0cd4f2957af":["a6446ce810056afd1a06b7a7239ec3cb3b65e31e"],"13f445c5bd6f19fd57d5a3ca0a35244c96f45aa8":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","a6446ce810056afd1a06b7a7239ec3cb3b65e31e"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["abb23fcc2461782ab204e61213240feb77d355aa"],"a6446ce810056afd1a06b7a7239ec3cb3b65e31e":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"]},"commit2Childs":{"659bd5da21bf2e51b42e1ad49c7107ad4ff1803f":["55980207f1977bd1463465de1659b821347e2fa8","63050a64dea4ad92b4c30bd6b7008232038e5818"],"072f211dfa8387028bb978d128c35bf9a450bbbf":["659bd5da21bf2e51b42e1ad49c7107ad4ff1803f","55980207f1977bd1463465de1659b821347e2fa8"],"55980207f1977bd1463465de1659b821347e2fa8":[],"63050a64dea4ad92b4c30bd6b7008232038e5818":["0fd29060ef78d73cb2d3f2ba2b318785363e3a4e"],"abb23fcc2461782ab204e61213240feb77d355aa":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["13f445c5bd6f19fd57d5a3ca0a35244c96f45aa8","a6446ce810056afd1a06b7a7239ec3cb3b65e31e"],"5ba39ba201a572fd944ed71d888de0cd4f2957af":["072f211dfa8387028bb978d128c35bf9a450bbbf"],"0fd29060ef78d73cb2d3f2ba2b318785363e3a4e":["abb23fcc2461782ab204e61213240feb77d355aa"],"13f445c5bd6f19fd57d5a3ca0a35244c96f45aa8":[],"a6446ce810056afd1a06b7a7239ec3cb3b65e31e":["5ba39ba201a572fd944ed71d888de0cd4f2957af","13f445c5bd6f19fd57d5a3ca0a35244c96f45aa8"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["55980207f1977bd1463465de1659b821347e2fa8","13f445c5bd6f19fd57d5a3ca0a35244c96f45aa8","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}