{"path":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","commits":[{"id":"3a119bbc8703c10faa329ec201c654b3a35a1e3e","date":1328644745,"type":1,"author":"Steven Rowe","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"438e995b4e32916f631722aab36254146830fefb","date":1328903827,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"4ab307b807959fbf308c7385f91da694c37de847","date":1338890281,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"4093b270ba337f9c25a4c0e6cb2ae2c07f697376","date":1347897716,"type":3,"author":"Erick Erickson","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"8111284b52c6e449b5aa97e0b7c90ce866018db5","date":1375027816,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["8eaedf240fab95c428d5f496a274256d2053ad37"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"8989a9672fc1bb2d9a549a4f9005a7d0b0d728ee","date":1376366778,"type":3,"author":"Han Jiang","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"634f330c54fd3f9f491d52036dc3f40b4f4d8934","date":1394635157,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"f4abec28b874149a7223e32cc7a01704c27790de","date":1410644789,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    Path path = Paths.get(indexPath);\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(path);\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, path);\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"8eaedf240fab95c428d5f496a274256d2053ad37","date":1412122376,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and exorcise corrupt segments from an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-exorcise</code>: actually write a new segments_N file, removing any problematic segments. *LOSES DATA*\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -exorcise\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-exorcise</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -exorcise, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -exorcise were\n                       specified.  With -exorcise, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doExorcise = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-exorcise\".equals(arg)) {\n        doExorcise = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -exorcise: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when exorcising, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -exorcise option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -exorcise *LOSES DATA*. This should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -exorcise, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -exorcise were\\n\" +\n                         \"specified.  With -exorcise, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doExorcise) {\n      System.out.println(\"ERROR: cannot specify both -exorcise and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    Path path = Paths.get(indexPath);\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(path);\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, path);\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doExorcise) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -exorcise were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. YOU WILL LOSE DATA. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.exorciseIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    Path path = Paths.get(indexPath);\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(path);\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, path);\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":["60ba444201d2570214b6fcf1d15600dc1a01f548","768c48159710aa63efa67c049db149c35c4f423a","7b91922b55d15444d554721b352861d028eb8278","a64db7380e46c730a4ff0f00ebd7b29219312c14","326b3b177da8135f97e1832c22fbae8dab7c9400","7391c1f4ab1a6817de8a262f5c1b3de3cf190785","31f025ae60076ae95274433f3fe8e6ace2857a87","8111284b52c6e449b5aa97e0b7c90ce866018db5"],"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"f7523916a1350712e1ae710affd4e88ccd7c431d","date":1412161942,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and exorcise corrupt segments from an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-exorcise</code>: actually write a new segments_N file, removing any problematic segments. *LOSES DATA*\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -exorcise\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-exorcise</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -exorcise, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -exorcise were\n                       specified.  With -exorcise, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n    int exitCode = doMain(args);\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and exorcise corrupt segments from an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-exorcise</code>: actually write a new segments_N file, removing any problematic segments. *LOSES DATA*\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -exorcise\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-exorcise</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -exorcise, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -exorcise were\n                       specified.  With -exorcise, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doExorcise = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-exorcise\".equals(arg)) {\n        doExorcise = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -exorcise: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when exorcising, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -exorcise option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -exorcise *LOSES DATA*. This should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -exorcise, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -exorcise were\\n\" +\n                         \"specified.  With -exorcise, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doExorcise) {\n      System.out.println(\"ERROR: cannot specify both -exorcise and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    Path path = Paths.get(indexPath);\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(path);\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, path);\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doExorcise) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -exorcise were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. YOU WILL LOSE DATA. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.exorciseIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":["634f330c54fd3f9f491d52036dc3f40b4f4d8934","5b38e3f2849cb8d8626cd5368aa64de4fed9edde","4ab307b807959fbf308c7385f91da694c37de847","7391c1f4ab1a6817de8a262f5c1b3de3cf190785","31f025ae60076ae95274433f3fe8e6ace2857a87","f4abec28b874149a7223e32cc7a01704c27790de","bf757952ed13ac1d3bec8adf69bcfde39031cdb5","ba7fd1181f778e9954547e8e6a47587ebf08e3fb","8eaedf240fab95c428d5f496a274256d2053ad37","4093b270ba337f9c25a4c0e6cb2ae2c07f697376","60ba444201d2570214b6fcf1d15600dc1a01f548","768c48159710aa63efa67c049db149c35c4f423a","a64db7380e46c730a4ff0f00ebd7b29219312c14","326b3b177da8135f97e1832c22fbae8dab7c9400","cba44a7c8f0e3eb449bcdbd53960b7705c0bf902","438e995b4e32916f631722aab36254146830fefb","a9ac13b5f0ce5ef1b2ce168367d993a79594b23a"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d9a47902d6207303f5ed3e7aaca62ca33433af66","date":1412435312,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and exorcise corrupt segments from an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-exorcise</code>: actually write a new segments_N file, removing any problematic segments. *LOSES DATA*\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -exorcise\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-exorcise</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -exorcise, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -exorcise were\n                       specified.  With -exorcise, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n    int exitCode = doMain(args);\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    Path path = Paths.get(indexPath);\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(path);\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, path);\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getSegmentsFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["8111284b52c6e449b5aa97e0b7c90ce866018db5"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"f7523916a1350712e1ae710affd4e88ccd7c431d":["8eaedf240fab95c428d5f496a274256d2053ad37"],"8eaedf240fab95c428d5f496a274256d2053ad37":["f4abec28b874149a7223e32cc7a01704c27790de"],"d9a47902d6207303f5ed3e7aaca62ca33433af66":["f4abec28b874149a7223e32cc7a01704c27790de","f7523916a1350712e1ae710affd4e88ccd7c431d"],"f4abec28b874149a7223e32cc7a01704c27790de":["634f330c54fd3f9f491d52036dc3f40b4f4d8934"],"8111284b52c6e449b5aa97e0b7c90ce866018db5":["4093b270ba337f9c25a4c0e6cb2ae2c07f697376"],"4ab307b807959fbf308c7385f91da694c37de847":["438e995b4e32916f631722aab36254146830fefb"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"8989a9672fc1bb2d9a549a4f9005a7d0b0d728ee":["4093b270ba337f9c25a4c0e6cb2ae2c07f697376"],"438e995b4e32916f631722aab36254146830fefb":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"4093b270ba337f9c25a4c0e6cb2ae2c07f697376":["4ab307b807959fbf308c7385f91da694c37de847"]},"commit2Childs":{"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["f4abec28b874149a7223e32cc7a01704c27790de"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["438e995b4e32916f631722aab36254146830fefb"],"f7523916a1350712e1ae710affd4e88ccd7c431d":["d9a47902d6207303f5ed3e7aaca62ca33433af66","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"8eaedf240fab95c428d5f496a274256d2053ad37":["f7523916a1350712e1ae710affd4e88ccd7c431d"],"d9a47902d6207303f5ed3e7aaca62ca33433af66":[],"f4abec28b874149a7223e32cc7a01704c27790de":["8eaedf240fab95c428d5f496a274256d2053ad37","d9a47902d6207303f5ed3e7aaca62ca33433af66"],"8111284b52c6e449b5aa97e0b7c90ce866018db5":["634f330c54fd3f9f491d52036dc3f40b4f4d8934"],"4ab307b807959fbf308c7385f91da694c37de847":["4093b270ba337f9c25a4c0e6cb2ae2c07f697376"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"8989a9672fc1bb2d9a549a4f9005a7d0b0d728ee":[],"438e995b4e32916f631722aab36254146830fefb":["4ab307b807959fbf308c7385f91da694c37de847"],"4093b270ba337f9c25a4c0e6cb2ae2c07f697376":["8111284b52c6e449b5aa97e0b7c90ce866018db5","8989a9672fc1bb2d9a549a4f9005a7d0b0d728ee"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["d9a47902d6207303f5ed3e7aaca62ca33433af66","8989a9672fc1bb2d9a549a4f9005a7d0b0d728ee","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}