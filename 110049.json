{"path":"solr/core/src/java/org/apache/solr/handler/admin/ShowFileRequestHandler#getAdminFileFromZooKeeper(SolrQueryRequest,SolrQueryResponse,SolrZkClient).mjava","commits":[{"id":"94df854a0d36420ddbf7a4a21330bd00c2354017","date":1384538000,"type":0,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/ShowFileRequestHandler#getAdminFileFromZooKeeper(SolrQueryRequest,SolrQueryResponse,SolrZkClient).mjava","pathOld":"/dev/null","sourceNew":"  private String getAdminFileFromZooKeeper(SolrQueryRequest req, SolrQueryResponse rsp, SolrZkClient zkClient)\n      throws KeeperException, InterruptedException {\n    String adminFile = null;\n    SolrCore core = req.getCore();\n\n    final ZkSolrResourceLoader loader = (ZkSolrResourceLoader) core\n        .getResourceLoader();\n    String confPath = loader.getCollectionZkPath();\n\n    String fname = req.getParams().get(\"file\", null);\n    if (fname == null) {\n      adminFile = confPath;\n    } else {\n      fname = fname.replace('\\\\', '/'); // normalize slashes\n      if (isHiddenFile(rsp, fname)) {\n        return null;\n      }\n      if (fname.startsWith(\"/\")) { // Only files relative to conf are valid\n        fname = fname.substring(1);\n      }\n      adminFile = confPath + \"/\" + fname;\n    }\n\n    // Make sure the file exists, is readable and is not a hidden file\n    if (!zkClient.exists(adminFile, true)) {\n      log.error(\"Can not find: \" + adminFile);\n      rsp.setException(new SolrException(ErrorCode.NOT_FOUND, \"Can not find: \"\n          + adminFile));\n      return null;\n    }\n\n    return adminFile;\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"11bf766bfc5fc48f7099fd6d555b16d5ad4478f9","date":1384729182,"type":3,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/ShowFileRequestHandler#getAdminFileFromZooKeeper(SolrQueryRequest,SolrQueryResponse,SolrZkClient).mjava","pathOld":"solr/core/src/java/org/apache/solr/handler/admin/ShowFileRequestHandler#getAdminFileFromZooKeeper(SolrQueryRequest,SolrQueryResponse,SolrZkClient).mjava","sourceNew":"  private String getAdminFileFromZooKeeper(SolrQueryRequest req, SolrQueryResponse rsp, SolrZkClient zkClient)\n      throws KeeperException, InterruptedException {\n    String adminFile = null;\n    SolrCore core = req.getCore();\n\n    final ZkSolrResourceLoader loader = (ZkSolrResourceLoader) core\n        .getResourceLoader();\n    String confPath = loader.getCollectionZkPath();\n\n    String fname = req.getParams().get(\"file\", null);\n    if (fname == null) {\n      adminFile = confPath;\n    } else {\n      fname = fname.replace('\\\\', '/'); // normalize slashes\n      if (isHiddenFile(req, rsp, fname, true)) {\n        return null;\n      }\n      if (fname.startsWith(\"/\")) { // Only files relative to conf are valid\n        fname = fname.substring(1);\n      }\n      adminFile = confPath + \"/\" + fname;\n    }\n\n    // Make sure the file exists, is readable and is not a hidden file\n    if (!zkClient.exists(adminFile, true)) {\n      log.error(\"Can not find: \" + adminFile);\n      rsp.setException(new SolrException(ErrorCode.NOT_FOUND, \"Can not find: \"\n          + adminFile));\n      return null;\n    }\n\n    return adminFile;\n  }\n\n","sourceOld":"  private String getAdminFileFromZooKeeper(SolrQueryRequest req, SolrQueryResponse rsp, SolrZkClient zkClient)\n      throws KeeperException, InterruptedException {\n    String adminFile = null;\n    SolrCore core = req.getCore();\n\n    final ZkSolrResourceLoader loader = (ZkSolrResourceLoader) core\n        .getResourceLoader();\n    String confPath = loader.getCollectionZkPath();\n\n    String fname = req.getParams().get(\"file\", null);\n    if (fname == null) {\n      adminFile = confPath;\n    } else {\n      fname = fname.replace('\\\\', '/'); // normalize slashes\n      if (isHiddenFile(rsp, fname)) {\n        return null;\n      }\n      if (fname.startsWith(\"/\")) { // Only files relative to conf are valid\n        fname = fname.substring(1);\n      }\n      adminFile = confPath + \"/\" + fname;\n    }\n\n    // Make sure the file exists, is readable and is not a hidden file\n    if (!zkClient.exists(adminFile, true)) {\n      log.error(\"Can not find: \" + adminFile);\n      rsp.setException(new SolrException(ErrorCode.NOT_FOUND, \"Can not find: \"\n          + adminFile));\n      return null;\n    }\n\n    return adminFile;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"7455ee5c847b2ee7e44656e4218141f62dacb572","date":1386032125,"type":5,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/ShowFileRequestHandler#getAdminFileFromZooKeeper(SolrQueryRequest,SolrQueryResponse,SolrZkClient,Set[String]).mjava","pathOld":"solr/core/src/java/org/apache/solr/handler/admin/ShowFileRequestHandler#getAdminFileFromZooKeeper(SolrQueryRequest,SolrQueryResponse,SolrZkClient).mjava","sourceNew":"  public static String getAdminFileFromZooKeeper(SolrQueryRequest req, SolrQueryResponse rsp, SolrZkClient zkClient,\n                                                 Set<String> hiddenFiles)\n      throws KeeperException, InterruptedException {\n    String adminFile = null;\n    SolrCore core = req.getCore();\n\n    final ZkSolrResourceLoader loader = (ZkSolrResourceLoader) core\n        .getResourceLoader();\n    String confPath = loader.getCollectionZkPath();\n\n    String fname = req.getParams().get(\"file\", null);\n    if (fname == null) {\n      adminFile = confPath;\n    } else {\n      fname = fname.replace('\\\\', '/'); // normalize slashes\n      if (isHiddenFile(req, rsp, fname, true, hiddenFiles)) {\n        return null;\n      }\n      if (fname.startsWith(\"/\")) { // Only files relative to conf are valid\n        fname = fname.substring(1);\n      }\n      adminFile = confPath + \"/\" + fname;\n    }\n\n    // Make sure the file exists, is readable and is not a hidden file\n    if (!zkClient.exists(adminFile, true)) {\n      log.error(\"Can not find: \" + adminFile);\n      rsp.setException(new SolrException(SolrException.ErrorCode.NOT_FOUND, \"Can not find: \"\n          + adminFile));\n      return null;\n    }\n\n    return adminFile;\n  }\n\n","sourceOld":"  private String getAdminFileFromZooKeeper(SolrQueryRequest req, SolrQueryResponse rsp, SolrZkClient zkClient)\n      throws KeeperException, InterruptedException {\n    String adminFile = null;\n    SolrCore core = req.getCore();\n\n    final ZkSolrResourceLoader loader = (ZkSolrResourceLoader) core\n        .getResourceLoader();\n    String confPath = loader.getCollectionZkPath();\n\n    String fname = req.getParams().get(\"file\", null);\n    if (fname == null) {\n      adminFile = confPath;\n    } else {\n      fname = fname.replace('\\\\', '/'); // normalize slashes\n      if (isHiddenFile(req, rsp, fname, true)) {\n        return null;\n      }\n      if (fname.startsWith(\"/\")) { // Only files relative to conf are valid\n        fname = fname.substring(1);\n      }\n      adminFile = confPath + \"/\" + fname;\n    }\n\n    // Make sure the file exists, is readable and is not a hidden file\n    if (!zkClient.exists(adminFile, true)) {\n      log.error(\"Can not find: \" + adminFile);\n      rsp.setException(new SolrException(ErrorCode.NOT_FOUND, \"Can not find: \"\n          + adminFile));\n      return null;\n    }\n\n    return adminFile;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"11bf766bfc5fc48f7099fd6d555b16d5ad4478f9":["94df854a0d36420ddbf7a4a21330bd00c2354017"],"94df854a0d36420ddbf7a4a21330bd00c2354017":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"7455ee5c847b2ee7e44656e4218141f62dacb572":["11bf766bfc5fc48f7099fd6d555b16d5ad4478f9"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["7455ee5c847b2ee7e44656e4218141f62dacb572"]},"commit2Childs":{"11bf766bfc5fc48f7099fd6d555b16d5ad4478f9":["7455ee5c847b2ee7e44656e4218141f62dacb572"],"94df854a0d36420ddbf7a4a21330bd00c2354017":["11bf766bfc5fc48f7099fd6d555b16d5ad4478f9"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["94df854a0d36420ddbf7a4a21330bd00c2354017"],"7455ee5c847b2ee7e44656e4218141f62dacb572":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}