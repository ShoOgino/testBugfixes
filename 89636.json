{"path":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testRandomDocsWithDoubleValues().mjava","commits":[{"id":"12a6ecf587e83c0ee8d10b6f612d4f29b3c1fed1","date":1481713492,"type":0,"author":"Shai Erera","isMerge":false,"pathNew":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testRandomDocsWithDoubleValues().mjava","pathOld":"/dev/null","sourceNew":"  public void testRandomDocsWithDoubleValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      double[] docValues = new double[numDocs];\n      double nextVal = 1.0;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          doc.add(new DoubleDocValuesField(field, nextVal));\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n          docValues[i] = nextVal;\n          ++nextVal;\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = 0;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        DoubleDocValuesStats stats = new DoubleDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        int expCount = (int) Arrays.stream(docValues).filter(v -> v > 0).count();\n        assertEquals(expCount, stats.count());\n        assertEquals(getZeroValues(docValues).count() - reader.numDeletedDocs(), stats.missing());\n        if (stats.count() > 0) {\n          assertEquals(getPositiveValues(docValues).max().getAsDouble(), stats.max().doubleValue(), 0.00001);\n          assertEquals(getPositiveValues(docValues).min().getAsDouble(), stats.min().doubleValue(), 0.00001);\n          assertEquals(getPositiveValues(docValues).average().getAsDouble(), stats.mean(), 0.00001);\n        }\n      }\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"05e797f1e66d5397a0e587dbec4b7c278fb776bf","date":1481805728,"type":5,"author":"Shai Erera","isMerge":false,"pathNew":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithDoubleValues().mjava","pathOld":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testRandomDocsWithDoubleValues().mjava","sourceNew":"  public void testDocsWithDoubleValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      double[] docValues = new double[numDocs];\n      double nextVal = 1.0;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          doc.add(new DoubleDocValuesField(field, nextVal));\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n          docValues[i] = nextVal;\n          ++nextVal;\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = 0;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        DoubleDocValuesStats stats = new DoubleDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        int expCount = (int) Arrays.stream(docValues).filter(v -> v > 0).count();\n        assertEquals(expCount, stats.count());\n        assertEquals(getZeroValues(docValues).count() - reader.numDeletedDocs(), stats.missing());\n        if (stats.count() > 0) {\n          DoubleSummaryStatistics sumStats = getPositiveValues(docValues).summaryStatistics();\n          assertEquals(sumStats.getMax(), stats.max().doubleValue(), 0.00001);\n          assertEquals(sumStats.getMin(), stats.min().doubleValue(), 0.00001);\n          assertEquals(sumStats.getAverage(), stats.mean(), 0.00001);\n          assertEquals(sumStats.getSum(), stats.sum(), 0.00001);\n          double variance = computeVariance(docValues, stats.mean, stats.count());\n          assertEquals(variance, stats.variance(), 0.00001);\n          assertEquals(Math.sqrt(variance), stats.stdev(), 0.00001);\n        }\n      }\n    }\n  }\n\n","sourceOld":"  public void testRandomDocsWithDoubleValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      double[] docValues = new double[numDocs];\n      double nextVal = 1.0;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          doc.add(new DoubleDocValuesField(field, nextVal));\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n          docValues[i] = nextVal;\n          ++nextVal;\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = 0;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        DoubleDocValuesStats stats = new DoubleDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        int expCount = (int) Arrays.stream(docValues).filter(v -> v > 0).count();\n        assertEquals(expCount, stats.count());\n        assertEquals(getZeroValues(docValues).count() - reader.numDeletedDocs(), stats.missing());\n        if (stats.count() > 0) {\n          assertEquals(getPositiveValues(docValues).max().getAsDouble(), stats.max().doubleValue(), 0.00001);\n          assertEquals(getPositiveValues(docValues).min().getAsDouble(), stats.min().doubleValue(), 0.00001);\n          assertEquals(getPositiveValues(docValues).average().getAsDouble(), stats.mean(), 0.00001);\n        }\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"12a6ecf587e83c0ee8d10b6f612d4f29b3c1fed1":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"05e797f1e66d5397a0e587dbec4b7c278fb776bf":["12a6ecf587e83c0ee8d10b6f612d4f29b3c1fed1"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["05e797f1e66d5397a0e587dbec4b7c278fb776bf"]},"commit2Childs":{"12a6ecf587e83c0ee8d10b6f612d4f29b3c1fed1":["05e797f1e66d5397a0e587dbec4b7c278fb776bf"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["12a6ecf587e83c0ee8d10b6f612d4f29b3c1fed1"],"05e797f1e66d5397a0e587dbec4b7c278fb776bf":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}