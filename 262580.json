{"path":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","commits":[{"id":"3a119bbc8703c10faa329ec201c654b3a35a1e3e","date":1328644745,"type":1,"author":"Steven Rowe","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random, indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newField(\"body\", \"blueberry pie\", TextField.TYPE_STORED));\n    doc2.add(newField(\"body\", \"blueberry strudel\", TextField.TYPE_STORED));\n    doc3.add(newField(\"body\", \"blueberry pizza\", TextField.TYPE_STORED));\n    doc4.add(newField(\"body\", \"blueberry chewing gum\", TextField.TYPE_STORED));\n    doc5.add(newField(\"body\", \"piccadilly circus\", TextField.TYPE_STORED));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<Term>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random, indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newField(\"body\", \"blueberry pie\", TextField.TYPE_STORED));\n    doc2.add(newField(\"body\", \"blueberry strudel\", TextField.TYPE_STORED));\n    doc3.add(newField(\"body\", \"blueberry pizza\", TextField.TYPE_STORED));\n    doc4.add(newField(\"body\", \"blueberry chewing gum\", TextField.TYPE_STORED));\n    doc5.add(newField(\"body\", \"piccadilly circus\", TextField.TYPE_STORED));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<Term>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"629c38c4ae4e303d0617e05fbfe508140b32f0a3","date":1334500904,"type":3,"author":"Dawid Weiss","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newField(\"body\", \"blueberry pie\", TextField.TYPE_STORED));\n    doc2.add(newField(\"body\", \"blueberry strudel\", TextField.TYPE_STORED));\n    doc3.add(newField(\"body\", \"blueberry pizza\", TextField.TYPE_STORED));\n    doc4.add(newField(\"body\", \"blueberry chewing gum\", TextField.TYPE_STORED));\n    doc5.add(newField(\"body\", \"piccadilly circus\", TextField.TYPE_STORED));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<Term>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random, indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newField(\"body\", \"blueberry pie\", TextField.TYPE_STORED));\n    doc2.add(newField(\"body\", \"blueberry strudel\", TextField.TYPE_STORED));\n    doc3.add(newField(\"body\", \"blueberry pizza\", TextField.TYPE_STORED));\n    doc4.add(newField(\"body\", \"blueberry chewing gum\", TextField.TYPE_STORED));\n    doc5.add(newField(\"body\", \"piccadilly circus\", TextField.TYPE_STORED));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<Term>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"04f07771a2a7dd3a395700665ed839c3dae2def2","date":1339350139,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<Term>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newField(\"body\", \"blueberry pie\", TextField.TYPE_STORED));\n    doc2.add(newField(\"body\", \"blueberry strudel\", TextField.TYPE_STORED));\n    doc3.add(newField(\"body\", \"blueberry pizza\", TextField.TYPE_STORED));\n    doc4.add(newField(\"body\", \"blueberry chewing gum\", TextField.TYPE_STORED));\n    doc5.add(newField(\"body\", \"piccadilly circus\", TextField.TYPE_STORED));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<Term>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":["1509f151d7692d84fae414b2b799ac06ba60fcb4"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"634f330c54fd3f9f491d52036dc3f40b4f4d8934","date":1394635157,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<Term>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ae14298f4eec6d5faee6a149f88ba57d14a6f21a","date":1396971290,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.shutdown();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d0ef034a4f10871667ae75181537775ddcf8ade4","date":1407610475,"type":3,"author":"Ryan Ernst","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.shutdown();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f8ec642b0195d666cf3b5a6a6c2a80bdd3b756bc","date":1424799790,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, null, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, null, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0a773283ef5eab2e9c7136eeb66574a4b7a2dc82","date":1428522487,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator(null);\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"92b4a131f1796dd57cc6698aae3d589d32a29deb","date":1457087316,"type":3,"author":"Luc Vanlerberghe","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"cf1a614098b46c9c22afebd7b898ae4d1d2fc273","date":1457088850,"type":3,"author":"Noble Paul","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery query1 = new MultiPhraseQuery();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery query2 = new MultiPhraseQuery();\n    query1.add(new Term(\"body\", \"blueberry\"));\n    query2.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1.add(termsWithPrefix.toArray(new Term[0]));\n    query2.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1, 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2, 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e588e8c82e32e29ef3837c0b06a2ad34f3c51a2b","date":1497408244,"type":3,"author":"David Smiley","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getTerms(reader, \"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"2a3ed3f77cdd034e789d00d1ca8bb7054c9fb8e9","date":1498028748,"type":3,"author":"Shalin Shekhar Mangar","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getTerms(reader, \"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"28288370235ed02234a64753cdbf0c6ec096304a","date":1498726817,"type":3,"author":"Karl Wright","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getTerms(reader, \"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getFields(reader).terms(\"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"04e775de416dd2d8067b10db1c8af975a1d5017e","date":1539906554,"type":3,"author":"David Smiley","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/search/TestPhrasePrefixQuery#testPhrasePrefix().mjava","sourceNew":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiTerms.getTerms(reader, \"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","sourceOld":"  /**\n     *\n     */\n  public void testPhrasePrefix() throws IOException {\n    Directory indexStore = newDirectory();\n    RandomIndexWriter writer = new RandomIndexWriter(random(), indexStore);\n    Document doc1 = new Document();\n    Document doc2 = new Document();\n    Document doc3 = new Document();\n    Document doc4 = new Document();\n    Document doc5 = new Document();\n    doc1.add(newTextField(\"body\", \"blueberry pie\", Field.Store.YES));\n    doc2.add(newTextField(\"body\", \"blueberry strudel\", Field.Store.YES));\n    doc3.add(newTextField(\"body\", \"blueberry pizza\", Field.Store.YES));\n    doc4.add(newTextField(\"body\", \"blueberry chewing gum\", Field.Store.YES));\n    doc5.add(newTextField(\"body\", \"piccadilly circus\", Field.Store.YES));\n    writer.addDocument(doc1);\n    writer.addDocument(doc2);\n    writer.addDocument(doc3);\n    writer.addDocument(doc4);\n    writer.addDocument(doc5);\n    IndexReader reader = writer.getReader();\n    writer.close();\n    \n    IndexSearcher searcher = newSearcher(reader);\n    \n    // PhrasePrefixQuery query1 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query1builder = new MultiPhraseQuery.Builder();\n    // PhrasePrefixQuery query2 = new PhrasePrefixQuery();\n    MultiPhraseQuery.Builder query2builder = new MultiPhraseQuery.Builder();\n    query1builder.add(new Term(\"body\", \"blueberry\"));\n    query2builder.add(new Term(\"body\", \"strawberry\"));\n    \n    LinkedList<Term> termsWithPrefix = new LinkedList<>();\n    \n    // this TermEnum gives \"piccadilly\", \"pie\" and \"pizza\".\n    String prefix = \"pi\";\n    TermsEnum te = MultiFields.getTerms(reader, \"body\").iterator();\n    te.seekCeil(new BytesRef(prefix));\n    do {\n      String s = te.term().utf8ToString();\n      if (s.startsWith(prefix)) {\n        termsWithPrefix.add(new Term(\"body\", s));\n      } else {\n        break;\n      }\n    } while (te.next() != null);\n    \n    query1builder.add(termsWithPrefix.toArray(new Term[0]));\n    query2builder.add(termsWithPrefix.toArray(new Term[0]));\n    \n    ScoreDoc[] result;\n    result = searcher.search(query1builder.build(), 1000).scoreDocs;\n    assertEquals(2, result.length);\n    \n    result = searcher.search(query2builder.build(), 1000).scoreDocs;\n    assertEquals(0, result.length);\n    reader.close();\n    indexStore.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"0a773283ef5eab2e9c7136eeb66574a4b7a2dc82":["f8ec642b0195d666cf3b5a6a6c2a80bdd3b756bc"],"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["04f07771a2a7dd3a395700665ed839c3dae2def2"],"e588e8c82e32e29ef3837c0b06a2ad34f3c51a2b":["cf1a614098b46c9c22afebd7b898ae4d1d2fc273"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"28288370235ed02234a64753cdbf0c6ec096304a":["cf1a614098b46c9c22afebd7b898ae4d1d2fc273","e588e8c82e32e29ef3837c0b06a2ad34f3c51a2b"],"04f07771a2a7dd3a395700665ed839c3dae2def2":["629c38c4ae4e303d0617e05fbfe508140b32f0a3"],"92b4a131f1796dd57cc6698aae3d589d32a29deb":["0a773283ef5eab2e9c7136eeb66574a4b7a2dc82"],"f8ec642b0195d666cf3b5a6a6c2a80bdd3b756bc":["d0ef034a4f10871667ae75181537775ddcf8ade4"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"d0ef034a4f10871667ae75181537775ddcf8ade4":["ae14298f4eec6d5faee6a149f88ba57d14a6f21a"],"04e775de416dd2d8067b10db1c8af975a1d5017e":["28288370235ed02234a64753cdbf0c6ec096304a"],"ae14298f4eec6d5faee6a149f88ba57d14a6f21a":["634f330c54fd3f9f491d52036dc3f40b4f4d8934"],"629c38c4ae4e303d0617e05fbfe508140b32f0a3":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"cf1a614098b46c9c22afebd7b898ae4d1d2fc273":["0a773283ef5eab2e9c7136eeb66574a4b7a2dc82","92b4a131f1796dd57cc6698aae3d589d32a29deb"],"2a3ed3f77cdd034e789d00d1ca8bb7054c9fb8e9":["cf1a614098b46c9c22afebd7b898ae4d1d2fc273","e588e8c82e32e29ef3837c0b06a2ad34f3c51a2b"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["04e775de416dd2d8067b10db1c8af975a1d5017e"]},"commit2Childs":{"0a773283ef5eab2e9c7136eeb66574a4b7a2dc82":["92b4a131f1796dd57cc6698aae3d589d32a29deb","cf1a614098b46c9c22afebd7b898ae4d1d2fc273"],"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["ae14298f4eec6d5faee6a149f88ba57d14a6f21a"],"e588e8c82e32e29ef3837c0b06a2ad34f3c51a2b":["28288370235ed02234a64753cdbf0c6ec096304a","2a3ed3f77cdd034e789d00d1ca8bb7054c9fb8e9"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["629c38c4ae4e303d0617e05fbfe508140b32f0a3"],"28288370235ed02234a64753cdbf0c6ec096304a":["04e775de416dd2d8067b10db1c8af975a1d5017e"],"04f07771a2a7dd3a395700665ed839c3dae2def2":["634f330c54fd3f9f491d52036dc3f40b4f4d8934"],"92b4a131f1796dd57cc6698aae3d589d32a29deb":["cf1a614098b46c9c22afebd7b898ae4d1d2fc273"],"f8ec642b0195d666cf3b5a6a6c2a80bdd3b756bc":["0a773283ef5eab2e9c7136eeb66574a4b7a2dc82"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"d0ef034a4f10871667ae75181537775ddcf8ade4":["f8ec642b0195d666cf3b5a6a6c2a80bdd3b756bc"],"ae14298f4eec6d5faee6a149f88ba57d14a6f21a":["d0ef034a4f10871667ae75181537775ddcf8ade4"],"04e775de416dd2d8067b10db1c8af975a1d5017e":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cf1a614098b46c9c22afebd7b898ae4d1d2fc273":["e588e8c82e32e29ef3837c0b06a2ad34f3c51a2b","28288370235ed02234a64753cdbf0c6ec096304a","2a3ed3f77cdd034e789d00d1ca8bb7054c9fb8e9"],"629c38c4ae4e303d0617e05fbfe508140b32f0a3":["04f07771a2a7dd3a395700665ed839c3dae2def2"],"2a3ed3f77cdd034e789d00d1ca8bb7054c9fb8e9":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["2a3ed3f77cdd034e789d00d1ca8bb7054c9fb8e9","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}