{"path":"solr/core/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","commits":[{"id":"c903c3d15906a3da96b8c0c2fb704491005fdbdb","date":1453508227,"type":1,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","pathOld":"solr/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","sourceNew":"  public TopDocs optimize(BooleanQuery original,\n                          IndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","sourceOld":"  public TopDocs optimize(BooleanQuery original,\n                          IndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a258fbb26824fd104ed795e5d9033d2d040049ee","date":1453508252,"type":1,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","pathOld":"solr/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","sourceNew":"  public TopDocs optimize(BooleanQuery original,\n                          IndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","sourceOld":"  public TopDocs optimize(BooleanQuery original,\n                          IndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"c26f00b574427b55127e869b935845554afde1fa","date":1310252513,"type":1,"author":"Steven Rowe","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","pathOld":"solr/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","sourceNew":"  public TopDocs optimize(BooleanQuery original,\n                          IndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","sourceOld":"  public TopDocs optimize(BooleanQuery original,\n                          IndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f4c236b7b2d1cb61683f5ba02d09249fdb42a7fd","date":1320399315,"type":5,"author":"Robert Muir","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,SolrIndexSearcher,int,Query[],Filter[]).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/LuceneQueryOptimizer#optimize(BooleanQuery,IndexSearcher,int,Query[],Filter[]).mjava","sourceNew":"  public TopDocs optimize(BooleanQuery original,\n                          SolrIndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","sourceOld":"  public TopDocs optimize(BooleanQuery original,\n                          IndexSearcher searcher,\n                          int numHits,\n                          Query[] queryOut,\n                          Filter[] filterOut\n                          )\n    throws IOException {\n\n    BooleanQuery query = new BooleanQuery();\n    BooleanQuery filterQuery = null;\n\n    for (BooleanClause c : original.clauses()) {\n\n/***\nSystem.out.println(\"required=\"+c.required);\nSystem.out.println(\"boost=\"+c.query.getBoost());\nSystem.out.println(\"isTermQuery=\"+(c.query instanceof TermQuery));\nif (c.query instanceof TermQuery) {\n System.out.println(\"term=\"+((TermQuery)c.query).getTerm());\n System.out.println(\"docFreq=\"+searcher.docFreq(((TermQuery)c.query).getTerm()));\n}\n***/\n      Query q = c.getQuery();\n      if (c.isRequired()                              // required\n          && q.getBoost() == 0.0f           // boost is zero\n          && q instanceof TermQuery         // TermQuery\n          && (searcher.docFreq(((TermQuery)q).getTerm())\n              / (float)searcher.maxDoc()) >= threshold) { // check threshold\n        if (filterQuery == null)\n          filterQuery = new BooleanQuery();\n        filterQuery.add(q, BooleanClause.Occur.MUST);    // filter it\n//System.out.println(\"WooHoo... qualified to be hoisted to a filter!\");\n      } else {\n        query.add(c);                             // query it\n      }\n    }\n\n    Filter filter = null;\n    if (filterQuery != null) {\n      synchronized (cache) {                      // check cache\n        filter = (Filter)cache.get(filterQuery);\n      }\n      if (filter == null) {                       // miss\n        filter = new CachingWrapperFilter(new QueryWrapperFilter(filterQuery)); // construct new entry\n        synchronized (cache) {\n          cache.put(filterQuery, filter);         // cache it\n        }\n      }        \n    }\n\n    // YCS: added code to pass out optimized query and filter\n    // so they can be used with Hits\n    if (queryOut != null && filterOut != null) {\n      queryOut[0] = query; filterOut[0] = filter;\n      return null;\n    } else {\n      return searcher.search(query, filter, numHits);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"c903c3d15906a3da96b8c0c2fb704491005fdbdb":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"c26f00b574427b55127e869b935845554afde1fa":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","c903c3d15906a3da96b8c0c2fb704491005fdbdb"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"a258fbb26824fd104ed795e5d9033d2d040049ee":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"f4c236b7b2d1cb61683f5ba02d09249fdb42a7fd":["c26f00b574427b55127e869b935845554afde1fa"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["f4c236b7b2d1cb61683f5ba02d09249fdb42a7fd"]},"commit2Childs":{"c903c3d15906a3da96b8c0c2fb704491005fdbdb":["c26f00b574427b55127e869b935845554afde1fa"],"c26f00b574427b55127e869b935845554afde1fa":["f4c236b7b2d1cb61683f5ba02d09249fdb42a7fd"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["c903c3d15906a3da96b8c0c2fb704491005fdbdb","c26f00b574427b55127e869b935845554afde1fa","a258fbb26824fd104ed795e5d9033d2d040049ee"],"a258fbb26824fd104ed795e5d9033d2d040049ee":[],"f4c236b7b2d1cb61683f5ba02d09249fdb42a7fd":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["a258fbb26824fd104ed795e5d9033d2d040049ee","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}