{"path":"solr/core/src/test/org/apache/solr/cloud/overseer/ZkCollectionPropsCachingTest#testReadWriteCached().mjava","commits":[{"id":"ad04daa4b07fab11f19bb17a8b556b0dde898d7f","date":1560262372,"type":0,"author":"Gus Heck","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/cloud/overseer/ZkCollectionPropsCachingTest#testReadWriteCached().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testReadWriteCached() throws InterruptedException, IOException {\n    ZkStateReader zkStateReader = cluster.getSolrClient().getZkStateReader();\n\n    CollectionProperties collectionProps = new CollectionProperties(zkClient());\n\n    collectionProps.setCollectionProperty(collectionName, \"property1\", \"value1\");\n    checkValue(\"property1\", \"value1\"); //Should be no cache, so the change should take effect immediately\n\n    zkStateReader.getCollectionProperties(collectionName,9000);\n    zkStateReader.getZkClient().close();\n    assertFalse(zkStateReader.isClosed());\n    checkValue(\"property1\", \"value1\"); //Should be cached, so the change should not try to hit zk\n\n    Thread.sleep(10000); // test the timeout feature\n    try {\n      checkValue(\"property1\", \"value1\"); //Should not be cached anymore\n      fail(\"cache should have expired, prev line should throw an exception trying to access zookeeper after closed\");\n    } catch (Exception e) {\n      // expected, because we killed the client in zkStateReader.\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"ad04daa4b07fab11f19bb17a8b556b0dde898d7f":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["ad04daa4b07fab11f19bb17a8b556b0dde898d7f"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["ad04daa4b07fab11f19bb17a8b556b0dde898d7f"],"ad04daa4b07fab11f19bb17a8b556b0dde898d7f":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}