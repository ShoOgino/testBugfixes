{"path":"solr/core/src/java/org/apache/solr/metrics/SolrCoreMetricManager#afterCoreRename().mjava","commits":[{"id":"e80876f1ee57780ad756fa083e88c95d7c1d0c0b","date":1595653703,"type":1,"author":"David Smiley","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/metrics/SolrCoreMetricManager#afterCoreRename().mjava","pathOld":"solr/core/src/java/org/apache/solr/metrics/SolrCoreMetricManager#afterCoreSetName().mjava","sourceNew":"  /**\n   * Make sure that metrics already collected that correspond to the old core name\n   * are carried over and will be used under the new core name.\n   * This method also reloads reporters so that they use the new core name.\n   */\n  public void afterCoreRename() {\n    assert core.getCoreDescriptor().getCloudDescriptor() == null;\n    String oldRegistryName = solrMetricsContext.getRegistryName();\n    String oldLeaderRegistryName = leaderRegistryName;\n    String newRegistryName = createRegistryName(cloudMode, collectionName, shardName, replicaName, core.getName());\n    leaderRegistryName = createLeaderRegistryName(cloudMode, collectionName, shardName);\n    if (oldRegistryName.equals(newRegistryName)) {\n      return;\n    }\n    // close old reporters\n    metricManager.closeReporters(oldRegistryName, solrMetricsContext.getTag());\n    if (oldLeaderRegistryName != null) {\n      metricManager.closeReporters(oldLeaderRegistryName, solrMetricsContext.getTag());\n    }\n    solrMetricsContext = new SolrMetricsContext(metricManager, newRegistryName, solrMetricsContext.getTag());\n    // load reporters again, using the new core name\n    loadReporters();\n  }\n\n","sourceOld":"  /**\n   * Make sure that metrics already collected that correspond to the old core name\n   * are carried over and will be used under the new core name.\n   * This method also reloads reporters so that they use the new core name.\n   */\n  public void afterCoreSetName() {\n    String oldRegistryName = solrMetricsContext.getRegistryName();\n    String oldLeaderRegistryName = leaderRegistryName;\n    initCloudMode();\n    String newRegistryName = createRegistryName(cloudMode, collectionName, shardName, replicaName, core.getName());\n    leaderRegistryName = createLeaderRegistryName(cloudMode, collectionName, shardName);\n    if (oldRegistryName.equals(newRegistryName)) {\n      return;\n    }\n    // close old reporters\n    metricManager.closeReporters(oldRegistryName, solrMetricsContext.getTag());\n    if (oldLeaderRegistryName != null) {\n      metricManager.closeReporters(oldLeaderRegistryName, solrMetricsContext.getTag());\n    }\n    solrMetricsContext = new SolrMetricsContext(metricManager, newRegistryName, solrMetricsContext.getTag());\n    // load reporters again, using the new core name\n    loadReporters();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"e80876f1ee57780ad756fa083e88c95d7c1d0c0b":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["e80876f1ee57780ad756fa083e88c95d7c1d0c0b"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["e80876f1ee57780ad756fa083e88c95d7c1d0c0b"],"e80876f1ee57780ad756fa083e88c95d7c1d0c0b":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}