{"path":"lucene/codecs/src/java/org/apache/lucene/codecs/memory/DirectPostingsFormat.HighFreqPostingsEnum#advance(int).mjava","commits":[{"id":"51f5280f31484820499077f41fcdfe92d527d9dc","date":1423229122,"type":1,"author":"Alan Woodward","isMerge":false,"pathNew":"lucene/codecs/src/java/org/apache/lucene/codecs/memory/DirectPostingsFormat.HighFreqPostingsEnum#advance(int).mjava","pathOld":"lucene/codecs/src/java/org/apache/lucene/codecs/memory/DirectPostingsFormat.HighFreqDocsAndPositionsEnum#advance(int).mjava","sourceNew":"    @Override\n    public int advance(int target) {\n\n      /*\n      upto++;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      }\n      final int index = Arrays.binarySearch(docIDs, upto, docIDs.length, target);\n      if (index < 0) {\n        upto = -index - 1;\n      } else {\n        upto = index;\n      }\n      if (liveDocs != null) {\n        while (upto < docIDs.length) {\n          if (liveDocs.get(docIDs[upto])) {\n            break;\n          }\n          upto++;\n        }\n      }\n      posUpto = hasOffsets ? -3 : -1;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      } else {\n        return docID();\n      }\n      */\n\n      //System.out.println(\"  advance target=\" + target + \" cur=\" + docID() + \" upto=\" + upto + \" of \" + docIDs.length);\n      // if (DEBUG) {\n      //   System.out.println(\"advance target=\" + target + \" len=\" + docIDs.length);\n      // }\n      upto++;\n      if (upto == docIDs.length) {\n        return docID = NO_MORE_DOCS;\n      }\n\n      // First \"grow\" outwards, since most advances are to\n      // nearby docs:\n      int inc = 10;\n      int nextUpto = upto+10;\n      int low;\n      int high;\n      while (true) {\n        //System.out.println(\"  grow nextUpto=\" + nextUpto + \" inc=\" + inc);\n        if (nextUpto >= docIDs.length) {\n          low = nextUpto-inc;\n          high = docIDs.length-1;\n          break;\n        }\n        //System.out.println(\"    docID=\" + docIDs[nextUpto]);\n\n        if (target <= docIDs[nextUpto]) {\n          low = nextUpto-inc;\n          high = nextUpto;\n          break;\n        }\n        inc *= 2;\n        nextUpto += inc;\n      }\n\n      // Now do normal binary search\n      //System.out.println(\"    after fwd: low=\" + low + \" high=\" + high);\n\n      while (true) {\n\n        if (low > high) {\n          // Not exactly found\n          //System.out.println(\"    break: no match\");\n          upto = low;\n          break;\n        }\n\n        int mid = (low + high) >>> 1;\n        int cmp = docIDs[mid] - target;\n        //System.out.println(\"    bsearch low=\" + low + \" high=\" + high+ \": docIDs[\" + mid + \"]=\" + docIDs[mid]);\n\n        if (cmp < 0) {\n          low = mid + 1;\n        } else if (cmp > 0) {\n          high = mid - 1;\n        } else {\n          // Found target\n          upto = mid;\n          //System.out.println(\"    break: match\");\n          break;\n        }\n      }\n\n      //System.out.println(\"    end upto=\" + upto + \" docID=\" + (upto >= docIDs.length ? NO_MORE_DOCS : docIDs[upto]));\n\n      if (liveDocs != null) {\n        while (upto < docIDs.length) {\n          if (liveDocs.get(docIDs[upto])) {\n            break;\n          }\n          upto++;\n        }\n      }\n      if (upto == docIDs.length) {\n        //System.out.println(\"    return END\");\n        return docID = NO_MORE_DOCS;\n      } else {\n        //System.out.println(\"    return docID=\" + docIDs[upto] + \" upto=\" + upto);\n        posUpto = -posJump;\n        curPositions = positions[upto];\n        return docID = docIDs[upto];\n      }\n    }\n\n","sourceOld":"    @Override\n    public int advance(int target) {\n\n      /*\n      upto++;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      }\n      final int index = Arrays.binarySearch(docIDs, upto, docIDs.length, target);\n      if (index < 0) {\n        upto = -index - 1;\n      } else {\n        upto = index;\n      }\n      if (liveDocs != null) {\n        while (upto < docIDs.length) {\n          if (liveDocs.get(docIDs[upto])) {\n            break;\n          }\n          upto++;\n        }\n      }\n      posUpto = hasOffsets ? -3 : -1;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      } else {\n        return docID();\n      }\n      */\n\n      //System.out.println(\"  advance target=\" + target + \" cur=\" + docID() + \" upto=\" + upto + \" of \" + docIDs.length);\n      // if (DEBUG) {\n      //   System.out.println(\"advance target=\" + target + \" len=\" + docIDs.length);\n      // }\n      upto++;\n      if (upto == docIDs.length) {\n        return docID = NO_MORE_DOCS;\n      }\n\n      // First \"grow\" outwards, since most advances are to\n      // nearby docs:\n      int inc = 10;\n      int nextUpto = upto+10;\n      int low;\n      int high;\n      while (true) {\n        //System.out.println(\"  grow nextUpto=\" + nextUpto + \" inc=\" + inc);\n        if (nextUpto >= docIDs.length) {\n          low = nextUpto-inc;\n          high = docIDs.length-1;\n          break;\n        }\n        //System.out.println(\"    docID=\" + docIDs[nextUpto]);\n\n        if (target <= docIDs[nextUpto]) {\n          low = nextUpto-inc;\n          high = nextUpto;\n          break;\n        }\n        inc *= 2;\n        nextUpto += inc;\n      }\n\n      // Now do normal binary search\n      //System.out.println(\"    after fwd: low=\" + low + \" high=\" + high);\n\n      while (true) {\n\n        if (low > high) {\n          // Not exactly found\n          //System.out.println(\"    break: no match\");\n          upto = low;\n          break;\n        }\n\n        int mid = (low + high) >>> 1;\n        int cmp = docIDs[mid] - target;\n        //System.out.println(\"    bsearch low=\" + low + \" high=\" + high+ \": docIDs[\" + mid + \"]=\" + docIDs[mid]);\n\n        if (cmp < 0) {\n          low = mid + 1;\n        } else if (cmp > 0) {\n          high = mid - 1;\n        } else {\n          // Found target\n          upto = mid;\n          //System.out.println(\"    break: match\");\n          break;\n        }\n      }\n\n      //System.out.println(\"    end upto=\" + upto + \" docID=\" + (upto >= docIDs.length ? NO_MORE_DOCS : docIDs[upto]));\n\n      if (liveDocs != null) {\n        while (upto < docIDs.length) {\n          if (liveDocs.get(docIDs[upto])) {\n            break;\n          }\n          upto++;\n        }\n      }\n      if (upto == docIDs.length) {\n        //System.out.println(\"    return END\");\n        return docID = NO_MORE_DOCS;\n      } else {\n        //System.out.println(\"    return docID=\" + docIDs[upto] + \" upto=\" + upto);\n        posUpto = -posJump;\n        curPositions = positions[upto];\n        return docID = docIDs[upto];\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0f4464508ee83288c8c4585b533f9faaa93aa314","date":1435240759,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/codecs/src/java/org/apache/lucene/codecs/memory/DirectPostingsFormat.HighFreqPostingsEnum#advance(int).mjava","pathOld":"lucene/codecs/src/java/org/apache/lucene/codecs/memory/DirectPostingsFormat.HighFreqPostingsEnum#advance(int).mjava","sourceNew":"    @Override\n    public int advance(int target) {\n\n      /*\n      upto++;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      }\n      final int index = Arrays.binarySearch(docIDs, upto, docIDs.length, target);\n      if (index < 0) {\n        upto = -index - 1;\n      } else {\n        upto = index;\n      }\n      if (liveDocs != null) {\n        while (upto < docIDs.length) {\n          if (liveDocs.get(docIDs[upto])) {\n            break;\n          }\n          upto++;\n        }\n      }\n      posUpto = hasOffsets ? -3 : -1;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      } else {\n        return docID();\n      }\n      */\n\n      //System.out.println(\"  advance target=\" + target + \" cur=\" + docID() + \" upto=\" + upto + \" of \" + docIDs.length);\n      // if (DEBUG) {\n      //   System.out.println(\"advance target=\" + target + \" len=\" + docIDs.length);\n      // }\n      upto++;\n      if (upto == docIDs.length) {\n        return docID = NO_MORE_DOCS;\n      }\n\n      // First \"grow\" outwards, since most advances are to\n      // nearby docs:\n      int inc = 10;\n      int nextUpto = upto+10;\n      int low;\n      int high;\n      while (true) {\n        //System.out.println(\"  grow nextUpto=\" + nextUpto + \" inc=\" + inc);\n        if (nextUpto >= docIDs.length) {\n          low = nextUpto-inc;\n          high = docIDs.length-1;\n          break;\n        }\n        //System.out.println(\"    docID=\" + docIDs[nextUpto]);\n\n        if (target <= docIDs[nextUpto]) {\n          low = nextUpto-inc;\n          high = nextUpto;\n          break;\n        }\n        inc *= 2;\n        nextUpto += inc;\n      }\n\n      // Now do normal binary search\n      //System.out.println(\"    after fwd: low=\" + low + \" high=\" + high);\n\n      while (true) {\n\n        if (low > high) {\n          // Not exactly found\n          //System.out.println(\"    break: no match\");\n          upto = low;\n          break;\n        }\n\n        int mid = (low + high) >>> 1;\n        int cmp = docIDs[mid] - target;\n        //System.out.println(\"    bsearch low=\" + low + \" high=\" + high+ \": docIDs[\" + mid + \"]=\" + docIDs[mid]);\n\n        if (cmp < 0) {\n          low = mid + 1;\n        } else if (cmp > 0) {\n          high = mid - 1;\n        } else {\n          // Found target\n          upto = mid;\n          //System.out.println(\"    break: match\");\n          break;\n        }\n      }\n\n      //System.out.println(\"    end upto=\" + upto + \" docID=\" + (upto >= docIDs.length ? NO_MORE_DOCS : docIDs[upto]));\n\n      if (upto == docIDs.length) {\n        //System.out.println(\"    return END\");\n        return docID = NO_MORE_DOCS;\n      } else {\n        //System.out.println(\"    return docID=\" + docIDs[upto] + \" upto=\" + upto);\n        posUpto = -posJump;\n        curPositions = positions[upto];\n        return docID = docIDs[upto];\n      }\n    }\n\n","sourceOld":"    @Override\n    public int advance(int target) {\n\n      /*\n      upto++;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      }\n      final int index = Arrays.binarySearch(docIDs, upto, docIDs.length, target);\n      if (index < 0) {\n        upto = -index - 1;\n      } else {\n        upto = index;\n      }\n      if (liveDocs != null) {\n        while (upto < docIDs.length) {\n          if (liveDocs.get(docIDs[upto])) {\n            break;\n          }\n          upto++;\n        }\n      }\n      posUpto = hasOffsets ? -3 : -1;\n      if (upto == docIDs.length) {\n        return NO_MORE_DOCS;\n      } else {\n        return docID();\n      }\n      */\n\n      //System.out.println(\"  advance target=\" + target + \" cur=\" + docID() + \" upto=\" + upto + \" of \" + docIDs.length);\n      // if (DEBUG) {\n      //   System.out.println(\"advance target=\" + target + \" len=\" + docIDs.length);\n      // }\n      upto++;\n      if (upto == docIDs.length) {\n        return docID = NO_MORE_DOCS;\n      }\n\n      // First \"grow\" outwards, since most advances are to\n      // nearby docs:\n      int inc = 10;\n      int nextUpto = upto+10;\n      int low;\n      int high;\n      while (true) {\n        //System.out.println(\"  grow nextUpto=\" + nextUpto + \" inc=\" + inc);\n        if (nextUpto >= docIDs.length) {\n          low = nextUpto-inc;\n          high = docIDs.length-1;\n          break;\n        }\n        //System.out.println(\"    docID=\" + docIDs[nextUpto]);\n\n        if (target <= docIDs[nextUpto]) {\n          low = nextUpto-inc;\n          high = nextUpto;\n          break;\n        }\n        inc *= 2;\n        nextUpto += inc;\n      }\n\n      // Now do normal binary search\n      //System.out.println(\"    after fwd: low=\" + low + \" high=\" + high);\n\n      while (true) {\n\n        if (low > high) {\n          // Not exactly found\n          //System.out.println(\"    break: no match\");\n          upto = low;\n          break;\n        }\n\n        int mid = (low + high) >>> 1;\n        int cmp = docIDs[mid] - target;\n        //System.out.println(\"    bsearch low=\" + low + \" high=\" + high+ \": docIDs[\" + mid + \"]=\" + docIDs[mid]);\n\n        if (cmp < 0) {\n          low = mid + 1;\n        } else if (cmp > 0) {\n          high = mid - 1;\n        } else {\n          // Found target\n          upto = mid;\n          //System.out.println(\"    break: match\");\n          break;\n        }\n      }\n\n      //System.out.println(\"    end upto=\" + upto + \" docID=\" + (upto >= docIDs.length ? NO_MORE_DOCS : docIDs[upto]));\n\n      if (liveDocs != null) {\n        while (upto < docIDs.length) {\n          if (liveDocs.get(docIDs[upto])) {\n            break;\n          }\n          upto++;\n        }\n      }\n      if (upto == docIDs.length) {\n        //System.out.println(\"    return END\");\n        return docID = NO_MORE_DOCS;\n      } else {\n        //System.out.println(\"    return docID=\" + docIDs[upto] + \" upto=\" + upto);\n        posUpto = -posJump;\n        curPositions = positions[upto];\n        return docID = docIDs[upto];\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"0f4464508ee83288c8c4585b533f9faaa93aa314":["51f5280f31484820499077f41fcdfe92d527d9dc"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"51f5280f31484820499077f41fcdfe92d527d9dc":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["0f4464508ee83288c8c4585b533f9faaa93aa314"]},"commit2Childs":{"0f4464508ee83288c8c4585b533f9faaa93aa314":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["51f5280f31484820499077f41fcdfe92d527d9dc"],"51f5280f31484820499077f41fcdfe92d527d9dc":["0f4464508ee83288c8c4585b533f9faaa93aa314"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}