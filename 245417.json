{"path":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacetsWithNestedObjects#testChildLevelFilterExclusions().mjava","commits":[{"id":"5f7c69c29432074b666568db5e84001acd540dee","date":1520745905,"type":0,"author":"Mikhail Khludnev","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacetsWithNestedObjects#testChildLevelFilterExclusions().mjava","pathOld":"/dev/null","sourceNew":"  /**\n   * Child level facet exclusions\n   */\n  @Test\n  public void testChildLevelFilterExclusions() throws Exception {\n    final Client client = Client.localClient();\n    ModifiableSolrParams p = params(\"rows\",\"10\");\n    client.testJQ(params(p, \"q\", \"{!parent filters=$child.fq which=type_s:book v=$childquery}\"\n        , \"childquery\", \"comment_t:*\"\n        , \"child.fq\", \"{!tag=author}author_s:yonik\"\n        , \"child.fq\", \"{!tag=stars}stars_i:(5 3)\"\n        , \"fl\", \"id\", \"fl\" , \"title_t\"\n        , \"json.facet\", \"{\" +\n            \"  comments_for_author: {\" +\n            \"    type:query,\" +\n            //note: author filter is excluded\n            \"    q:\\\"{!filters param=$child.fq excludeTags=author v=$childquery}\\\",\" +\n            \"    domain: { blockChildren : \\\"type_s:book\\\", excludeTags:author },\" +\n            \"    facet:{\" +\n            \"      authors:{\" +\n            \"        type:terms,\" +\n            \"        field:author_s,\" +\n            \"        facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }}}},\" +\n            \"  comments_for_stars: {\" +\n            \"    type:query,\" +\n            //note: stars_i filter is excluded\n            \"    q:\\\"{!filters param=$child.fq excludeTags=stars v=$childquery}\\\",\" +\n            \"    domain: { blockChildren : \\\"type_s:book\\\" },\" +\n            \"    facet:{\" +\n            \"      stars:{\" +\n            \"        type:terms,\" +\n            \"        field:stars_i,\" +\n            \"        facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }}}}}\" )\n\n        , \"response=={numFound:2,start:0,docs:[\" +\n            \"      {id:book1,\" +\n            \"        title_t:\\\"The Way of Kings\\\"},\" +\n            \"      {id:book2,\" +\n            \"        title_t:\\\"Snow Crash\\\"}]}\"\n        , \"facets=={ count:2,\" +\n            \"comments_for_author:{\" +\n            \"  count:3,\" +\n            \"  authors:{\" +\n            \"    buckets:[ {val:yonik,  count:2, in_books:2},\" +\n            \"              {val:dan,    count:1, in_books:1} ]}},\" +\n            \"comments_for_stars:{\" +\n            \"  count:2,\" +\n            \"  stars:{\" +\n            \"    buckets:[ {val:5, count:2, in_books:2} ]}}}\"\n    );\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"640ded7811e1b7d29236a5e2934ec3cd266a8199","date":1588973147,"type":3,"author":"Tomas Fernandez Lobbe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacetsWithNestedObjects#testChildLevelFilterExclusions().mjava","pathOld":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacetsWithNestedObjects#testChildLevelFilterExclusions().mjava","sourceNew":"  /**\n   * Child level facet exclusions\n   */\n  @Test\n  public void testChildLevelFilterExclusions() throws Exception {\n    final Client client = Client.localClient();\n    ModifiableSolrParams p = params(\"rows\",\"10\");\n    client.testJQ(params(p, \"q\", \"{!parent filters=$child.fq which=type_s:book v=$childquery}\"\n        , \"childquery\", \"comment_t:*\"\n        , \"child.fq\", \"{!tag=author}author_s:yonik\"\n        , \"child.fq\", \"{!tag=stars}stars_i:(5 3)\"\n        , \"fl\", \"id\", \"fl\" , \"title_t\"\n        , \"json.facet\", \"{\" +\n            \"  comments_for_author: {\" +\n            \"    type:query,\" +\n            //note: author filter is excluded\n            \"    q:\\\"{!filters param=$child.fq excludeTags=author v=$childquery}\\\",\" +\n            \"    domain: { blockChildren : \\\"type_s:book\\\", excludeTags:author },\" +\n            \"    facet:{\" +\n            \"      authors:{\" +\n            \"        type:terms,\" +\n            \"        field:author_s,\" +\n            \"        facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }}}},\" +\n            \"  comments_for_stars: {\" +\n            \"    type:query,\" +\n            //note: stars_i filter is excluded\n            \"    q:\\\"{!filters param=$child.fq excludeTags=stars v=$childquery}\\\",\" +\n            \"    domain: { blockChildren : \\\"type_s:book\\\" },\" +\n            \"    facet:{\" +\n            \"      stars:{\" +\n            \"        type:terms,\" +\n            \"        field:stars_i,\" +\n            \"        facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }}}}}\" )\n\n        , \"response=={numFound:2,start:0,'numFoundExact':true,docs:[\" +\n            \"      {id:book1,\" +\n            \"        title_t:\\\"The Way of Kings\\\"},\" +\n            \"      {id:book2,\" +\n            \"        title_t:\\\"Snow Crash\\\"}]}\"\n        , \"facets=={ count:2,\" +\n            \"comments_for_author:{\" +\n            \"  count:3,\" +\n            \"  authors:{\" +\n            \"    buckets:[ {val:yonik,  count:2, in_books:2},\" +\n            \"              {val:dan,    count:1, in_books:1} ]}},\" +\n            \"comments_for_stars:{\" +\n            \"  count:2,\" +\n            \"  stars:{\" +\n            \"    buckets:[ {val:5, count:2, in_books:2} ]}}}\"\n    );\n  }\n\n","sourceOld":"  /**\n   * Child level facet exclusions\n   */\n  @Test\n  public void testChildLevelFilterExclusions() throws Exception {\n    final Client client = Client.localClient();\n    ModifiableSolrParams p = params(\"rows\",\"10\");\n    client.testJQ(params(p, \"q\", \"{!parent filters=$child.fq which=type_s:book v=$childquery}\"\n        , \"childquery\", \"comment_t:*\"\n        , \"child.fq\", \"{!tag=author}author_s:yonik\"\n        , \"child.fq\", \"{!tag=stars}stars_i:(5 3)\"\n        , \"fl\", \"id\", \"fl\" , \"title_t\"\n        , \"json.facet\", \"{\" +\n            \"  comments_for_author: {\" +\n            \"    type:query,\" +\n            //note: author filter is excluded\n            \"    q:\\\"{!filters param=$child.fq excludeTags=author v=$childquery}\\\",\" +\n            \"    domain: { blockChildren : \\\"type_s:book\\\", excludeTags:author },\" +\n            \"    facet:{\" +\n            \"      authors:{\" +\n            \"        type:terms,\" +\n            \"        field:author_s,\" +\n            \"        facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }}}},\" +\n            \"  comments_for_stars: {\" +\n            \"    type:query,\" +\n            //note: stars_i filter is excluded\n            \"    q:\\\"{!filters param=$child.fq excludeTags=stars v=$childquery}\\\",\" +\n            \"    domain: { blockChildren : \\\"type_s:book\\\" },\" +\n            \"    facet:{\" +\n            \"      stars:{\" +\n            \"        type:terms,\" +\n            \"        field:stars_i,\" +\n            \"        facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }}}}}\" )\n\n        , \"response=={numFound:2,start:0,docs:[\" +\n            \"      {id:book1,\" +\n            \"        title_t:\\\"The Way of Kings\\\"},\" +\n            \"      {id:book2,\" +\n            \"        title_t:\\\"Snow Crash\\\"}]}\"\n        , \"facets=={ count:2,\" +\n            \"comments_for_author:{\" +\n            \"  count:3,\" +\n            \"  authors:{\" +\n            \"    buckets:[ {val:yonik,  count:2, in_books:2},\" +\n            \"              {val:dan,    count:1, in_books:1} ]}},\" +\n            \"comments_for_stars:{\" +\n            \"  count:2,\" +\n            \"  stars:{\" +\n            \"    buckets:[ {val:5, count:2, in_books:2} ]}}}\"\n    );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"640ded7811e1b7d29236a5e2934ec3cd266a8199":["5f7c69c29432074b666568db5e84001acd540dee"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"5f7c69c29432074b666568db5e84001acd540dee":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["640ded7811e1b7d29236a5e2934ec3cd266a8199"]},"commit2Childs":{"640ded7811e1b7d29236a5e2934ec3cd266a8199":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["5f7c69c29432074b666568db5e84001acd540dee"],"5f7c69c29432074b666568db5e84001acd540dee":["640ded7811e1b7d29236a5e2934ec3cd266a8199"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}