{"path":"contrib/db/src/test/org/apache/lucene/store/db/DbStoreTest#testArrays().mjava","commits":[{"id":"7b2b5b310b2a013b9dbcea87b9e51860112a89c4","date":1115064360,"type":0,"author":"Andreas Vajda","isMerge":false,"pathNew":"contrib/db/src/test/org/apache/lucene/store/db/DbStoreTest#testArrays().mjava","pathOld":"/dev/null","sourceNew":"    public void testArrays()\n        throws Exception\n    {\n        final int count = 250;\n        final int LENGTH_MASK = 0xffff;\n\n        Random gen = new Random(1251971);\n        int totalLength = 0;\n        int duration;\n        Date end;\n    \n        Date veryStart = new Date();\n        Date start = new Date();\n        Transaction txn = null;\n        Directory store = null;\n\n        System.out.println(\"Writing files as one byte array\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                int length = gen.nextInt() & LENGTH_MASK;\n                IndexOutput file = store.createOutput(name);\n                byte[] data = new byte[length];\n\n                totalLength += length;\n                gen.nextBytes(data);\n                file.writeBytes(data, length);\n      \n                file.close();\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        duration = (int) (end.getTime() - start.getTime());\n        System.out.print(duration);\n        System.out.print(\" total milliseconds to create, \");\n        System.out.print(totalLength / duration);\n        System.out.println(\" kb/s\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            gen = new Random(1251971);\n            start = new Date();\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                int length = gen.nextInt() & LENGTH_MASK;\n                IndexInput file = store.openInput(name);\n                \n                if (file.length() != length)\n                    throw new Exception(\"length incorrect\");\n\n                byte[] data = new byte[length];\n                byte[] read = new byte[length];\n                gen.nextBytes(data);\n                file.readBytes(read, 0, length);\n\n                if (!Arrays.equals(data, read))\n                    throw new Exception(\"contents incorrect\");\n\n                file.close();\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        duration = (int) (end.getTime() - start.getTime());\n        System.out.print(duration);\n        System.out.print(\" total milliseconds to read, \");\n        System.out.print(totalLength / duration);\n        System.out.println(\" kb/s\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            gen = new Random(1251971);\n            start = new Date();\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                store.deleteFile(name);\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        System.out.print(end.getTime() - start.getTime());\n        System.out.println(\" total milliseconds to delete\");\n\n        System.out.print(end.getTime() - veryStart.getTime());\n        System.out.println(\" total milliseconds\");\n    }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"87fc6f159522f12e67225691468cbf3d11be8590","date":1136423057,"type":5,"author":"Andreas Vajda","isMerge":false,"pathNew":"contrib/db/bdb/src/test/org/apache/lucene/store/db/DbStoreTest#testArrays().mjava","pathOld":"contrib/db/src/test/org/apache/lucene/store/db/DbStoreTest#testArrays().mjava","sourceNew":"    public void testArrays()\n        throws Exception\n    {\n        final int count = 250;\n        final int LENGTH_MASK = 0xffff;\n\n        Random gen = new Random(1251971);\n        int totalLength = 0;\n        int duration;\n        Date end;\n    \n        Date veryStart = new Date();\n        Date start = new Date();\n        Transaction txn = null;\n        Directory store = null;\n\n        System.out.println(\"Writing files as one byte array\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                int length = gen.nextInt() & LENGTH_MASK;\n                IndexOutput file = store.createOutput(name);\n                byte[] data = new byte[length];\n\n                totalLength += length;\n                gen.nextBytes(data);\n                file.writeBytes(data, length);\n      \n                file.close();\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        duration = (int) (end.getTime() - start.getTime());\n        System.out.print(duration);\n        System.out.print(\" total milliseconds to create, \");\n        System.out.print(totalLength / duration);\n        System.out.println(\" kb/s\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            gen = new Random(1251971);\n            start = new Date();\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                int length = gen.nextInt() & LENGTH_MASK;\n                IndexInput file = store.openInput(name);\n                \n                if (file.length() != length)\n                    throw new Exception(\"length incorrect\");\n\n                byte[] data = new byte[length];\n                byte[] read = new byte[length];\n                gen.nextBytes(data);\n                file.readBytes(read, 0, length);\n\n                if (!Arrays.equals(data, read))\n                    throw new Exception(\"contents incorrect\");\n\n                file.close();\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        duration = (int) (end.getTime() - start.getTime());\n        System.out.print(duration);\n        System.out.print(\" total milliseconds to read, \");\n        System.out.print(totalLength / duration);\n        System.out.println(\" kb/s\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            gen = new Random(1251971);\n            start = new Date();\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                store.deleteFile(name);\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        System.out.print(end.getTime() - start.getTime());\n        System.out.println(\" total milliseconds to delete\");\n\n        System.out.print(end.getTime() - veryStart.getTime());\n        System.out.println(\" total milliseconds\");\n    }\n\n","sourceOld":"    public void testArrays()\n        throws Exception\n    {\n        final int count = 250;\n        final int LENGTH_MASK = 0xffff;\n\n        Random gen = new Random(1251971);\n        int totalLength = 0;\n        int duration;\n        Date end;\n    \n        Date veryStart = new Date();\n        Date start = new Date();\n        Transaction txn = null;\n        Directory store = null;\n\n        System.out.println(\"Writing files as one byte array\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                int length = gen.nextInt() & LENGTH_MASK;\n                IndexOutput file = store.createOutput(name);\n                byte[] data = new byte[length];\n\n                totalLength += length;\n                gen.nextBytes(data);\n                file.writeBytes(data, length);\n      \n                file.close();\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        duration = (int) (end.getTime() - start.getTime());\n        System.out.print(duration);\n        System.out.print(\" total milliseconds to create, \");\n        System.out.print(totalLength / duration);\n        System.out.println(\" kb/s\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            gen = new Random(1251971);\n            start = new Date();\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                int length = gen.nextInt() & LENGTH_MASK;\n                IndexInput file = store.openInput(name);\n                \n                if (file.length() != length)\n                    throw new Exception(\"length incorrect\");\n\n                byte[] data = new byte[length];\n                byte[] read = new byte[length];\n                gen.nextBytes(data);\n                file.readBytes(read, 0, length);\n\n                if (!Arrays.equals(data, read))\n                    throw new Exception(\"contents incorrect\");\n\n                file.close();\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        duration = (int) (end.getTime() - start.getTime());\n        System.out.print(duration);\n        System.out.print(\" total milliseconds to read, \");\n        System.out.print(totalLength / duration);\n        System.out.println(\" kb/s\");\n\n        try {\n            txn = env.beginTransaction(null, null);\n            store = new DbDirectory(txn, index, blocks);\n\n            gen = new Random(1251971);\n            start = new Date();\n\n            for (int i = 0; i < count; i++) {\n                String name = i + \".dat\";\n                store.deleteFile(name);\n            }\n        } catch (IOException e) {\n            txn.abort();\n            txn = null;\n            throw e;\n        } catch (DatabaseException e) {\n            if (txn != null)\n            {\n                txn.abort();\n                txn = null;\n            }\n            throw e;\n        } finally {\n            if (txn != null)\n                txn.commit();\n\n            store.close();\n        }\n\n        end = new Date();\n\n        System.out.print(end.getTime() - start.getTime());\n        System.out.println(\" total milliseconds to delete\");\n\n        System.out.print(end.getTime() - veryStart.getTime());\n        System.out.println(\" total milliseconds\");\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"7b2b5b310b2a013b9dbcea87b9e51860112a89c4":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"87fc6f159522f12e67225691468cbf3d11be8590":["7b2b5b310b2a013b9dbcea87b9e51860112a89c4"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["87fc6f159522f12e67225691468cbf3d11be8590"]},"commit2Childs":{"7b2b5b310b2a013b9dbcea87b9e51860112a89c4":["87fc6f159522f12e67225691468cbf3d11be8590"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["7b2b5b310b2a013b9dbcea87b9e51860112a89c4"],"87fc6f159522f12e67225691468cbf3d11be8590":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}