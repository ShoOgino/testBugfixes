{"path":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","commits":[{"id":"8ced52befdc8d88d90766aadbaac496f3fd0e4ee","date":1421070034,"type":0,"author":"Joel Bernstein","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"/dev/null","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        if(cmap.containsKey(collapseKey)) {\n          long pointerValue = cmap.lget();\n          int testValue = (int)pointerValue;\n          if(comp.test(currentVal, testValue)) {\n            pointerValue = (pointerValue-testValue)+currentVal;\n            cmap.lset(pointerValue);\n            int pointer = (int)(pointerValue>>32);\n            if(needsScores) {\n              float score = scorer.score();\n              long docScore = (((long)globalDoc)<<32)+Float.floatToIntBits(score);\n              docScores.set(pointer, docScore);\n            } else {\n              docs.set(pointer, globalDoc);\n            }\n          }\n        } else {\n          ++index;\n          //The index provides a pointer into docs or docScore lists.\n          //Combined the pointer with the current value into a long\n          long pointerValue = (((long)index)<<32)+currentVal;\n          cmap.put(collapseKey, pointerValue);\n          if(needsScores) {\n            float score = scorer.score();\n            long docScore = (((long)globalDoc)<<32)+Float.floatToIntBits(score);\n            docScores.add(docScore);\n          } else {\n            docs.add(globalDoc);\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0a9c4a5022409b649909f75244642a57739b3598","date":1422812185,"type":3,"author":"Joel Bernstein","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        if(cmap.containsKey(collapseKey)) {\n          int pointer = cmap.lget();\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        if(cmap.containsKey(collapseKey)) {\n          long pointerValue = cmap.lget();\n          int testValue = (int)pointerValue;\n          if(comp.test(currentVal, testValue)) {\n            pointerValue = (pointerValue-testValue)+currentVal;\n            cmap.lset(pointerValue);\n            int pointer = (int)(pointerValue>>32);\n            if(needsScores) {\n              float score = scorer.score();\n              long docScore = (((long)globalDoc)<<32)+Float.floatToIntBits(score);\n              docScores.set(pointer, docScore);\n            } else {\n              docs.set(pointer, globalDoc);\n            }\n          }\n        } else {\n          ++index;\n          //The index provides a pointer into docs or docScore lists.\n          //Combined the pointer with the current value into a long\n          long pointerValue = (((long)index)<<32)+currentVal;\n          cmap.put(collapseKey, pointerValue);\n          if(needsScores) {\n            float score = scorer.score();\n            long docScore = (((long)globalDoc)<<32)+Float.floatToIntBits(score);\n            docScores.add(docScore);\n          } else {\n            docs.add(globalDoc);\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"1fcee2c3acd9aa64a73a3b441b3f6cb492af0b87","date":1440409984,"type":3,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        if(cmap.containsKey(collapseKey)) {\n          int pointer = cmap.lget();\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6652c74b2358a0b13223817a6a793bf1c9d0749d","date":1474465301,"type":3,"author":"Mike McCandless","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int valuesDocID = minMaxVals.docID();\n      if (valuesDocID < contextDoc) {\n        valuesDocID = minMaxVals.advance(contextDoc);\n      }\n\n      int currentVal;\n      if (valuesDocID == contextDoc) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"17e5da53e4e5bd659e22add9bba1cfa222e7e30d","date":1475435902,"type":3,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int valuesDocID = minMaxVals.docID();\n      if (valuesDocID < contextDoc) {\n        valuesDocID = minMaxVals.advance(contextDoc);\n      }\n\n      int currentVal;\n      if (valuesDocID == contextDoc) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4cce5816ef15a48a0bc11e5d400497ee4301dd3b","date":1476991456,"type":3,"author":"Kevin Risden","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int valuesDocID = minMaxVals.docID();\n      if (valuesDocID < contextDoc) {\n        valuesDocID = minMaxVals.advance(contextDoc);\n      }\n\n      int currentVal;\n      if (valuesDocID == contextDoc) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal = (int) minMaxVals.get(contextDoc);\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6c62352c33f77624124d1cbf58a1291da78141f7","date":1518514846,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal;\n      if (minMaxVals.advanceExact(contextDoc)) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int valuesDocID = minMaxVals.docID();\n      if (valuesDocID < contextDoc) {\n        valuesDocID = minMaxVals.advance(contextDoc);\n      }\n\n      int currentVal;\n      if (valuesDocID == contextDoc) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"bfcdec9fcf0409223f35c5ec3bc14094314941b4","date":1518533599,"type":3,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal;\n      if (minMaxVals.advanceExact(contextDoc)) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int valuesDocID = minMaxVals.docID();\n      if (valuesDocID < contextDoc) {\n        valuesDocID = minMaxVals.advance(contextDoc);\n      }\n\n      int currentVal;\n      if (valuesDocID == contextDoc) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"3575e61fd7df2bbcce8b977a23d3d67aa423ce62","date":1586507050,"type":3,"author":"Cao Manh Dat","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal;\n      if (minMaxVals.advanceExact(contextDoc)) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues.get(pointer))) {\n            testValues.put(pointer, currentVal);\n            docs.put(pointer, globalDoc);\n            if(needsScores) {\n              scores.put(pointer, scorer.score());\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          testValues.put(index, currentVal);\n          docs.put(index, globalDoc);\n          if(needsScores) {\n            scores.put(index, scorer.score());\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal;\n      if (minMaxVals.advanceExact(contextDoc)) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues[pointer])) {\n            testValues[pointer]= currentVal;\n            docs[pointer] = globalDoc;\n            if(needsScores) {\n              scores[pointer] = scorer.score();\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          if(index == testValues.length) {\n            testValues = ArrayUtil.grow(testValues);\n            docs = ArrayUtil.grow(docs);\n            if(needsScores) {\n              scores = ArrayUtil.grow(scores);\n            }\n          }\n\n          testValues[index] = currentVal;\n          docs[index] = (globalDoc);\n\n          if(needsScores) {\n            scores[index] = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a813b523bf76aa0a68013d636b6eb53cedb142a4","date":1601387389,"type":3,"author":"Guna Sekhar Dora Kovvuru","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","pathOld":"solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.IntIntStrategy#collapse(int,int,int).mjava","sourceNew":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal;\n      if (minMaxVals.advanceExact(contextDoc)) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues.get(pointer))) {\n            testValues.put(pointer, currentVal);\n            docs.put(pointer, globalDoc);\n            if(needsScores) {\n              scores.put(pointer, scorer.score());\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          testValues.put(index, currentVal);\n          docs.put(index, globalDoc);\n          if(needsScores) {\n            scores.put(index, scorer.score());\n          }\n        }\n      } else if(this.nullPolicy == NullPolicy.COLLAPSE.getCode()) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == NullPolicy.EXPAND.getCode()) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","sourceOld":"    public void collapse(int collapseKey, int contextDoc, int globalDoc) throws IOException {\n\n      // Check to see if we have documents boosted by the QueryElevationComponent\n      if(boosts && mergeBoost.boost(globalDoc)) {\n        boostDocs.add(globalDoc);\n        boostKeys.add(collapseKey);\n        return;\n      }\n\n      int currentVal;\n      if (minMaxVals.advanceExact(contextDoc)) {\n        currentVal = (int) minMaxVals.longValue();\n      } else {\n        currentVal = 0;\n      }\n\n      if(collapseKey != nullValue) {\n        final int idx;\n        if((idx = cmap.indexOf(collapseKey)) >= 0) {\n          int pointer = cmap.indexGet(idx);\n          if(comp.test(currentVal, testValues.get(pointer))) {\n            testValues.put(pointer, currentVal);\n            docs.put(pointer, globalDoc);\n            if(needsScores) {\n              scores.put(pointer, scorer.score());\n            }\n          }\n        } else {\n          ++index;\n          cmap.put(collapseKey, index);\n          testValues.put(index, currentVal);\n          docs.put(index, globalDoc);\n          if(needsScores) {\n            scores.put(index, scorer.score());\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_COLLAPSE) {\n        if(comp.test(currentVal, nullCompVal)) {\n          nullCompVal = currentVal;\n          nullDoc = globalDoc;\n          if(needsScores) {\n            nullScore = scorer.score();\n          }\n        }\n      } else if(this.nullPolicy == CollapsingPostFilter.NULL_POLICY_EXPAND) {\n        this.collapsedSet.set(globalDoc);\n        if(needsScores) {\n          nullScores.add(scorer.score());\n        }\n      }\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a813b523bf76aa0a68013d636b6eb53cedb142a4":["3575e61fd7df2bbcce8b977a23d3d67aa423ce62"],"8ced52befdc8d88d90766aadbaac496f3fd0e4ee":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"6c62352c33f77624124d1cbf58a1291da78141f7":["17e5da53e4e5bd659e22add9bba1cfa222e7e30d"],"3575e61fd7df2bbcce8b977a23d3d67aa423ce62":["bfcdec9fcf0409223f35c5ec3bc14094314941b4"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"17e5da53e4e5bd659e22add9bba1cfa222e7e30d":["1fcee2c3acd9aa64a73a3b441b3f6cb492af0b87","6652c74b2358a0b13223817a6a793bf1c9d0749d"],"6652c74b2358a0b13223817a6a793bf1c9d0749d":["1fcee2c3acd9aa64a73a3b441b3f6cb492af0b87"],"0a9c4a5022409b649909f75244642a57739b3598":["8ced52befdc8d88d90766aadbaac496f3fd0e4ee"],"bfcdec9fcf0409223f35c5ec3bc14094314941b4":["17e5da53e4e5bd659e22add9bba1cfa222e7e30d","6c62352c33f77624124d1cbf58a1291da78141f7"],"1fcee2c3acd9aa64a73a3b441b3f6cb492af0b87":["0a9c4a5022409b649909f75244642a57739b3598"],"4cce5816ef15a48a0bc11e5d400497ee4301dd3b":["1fcee2c3acd9aa64a73a3b441b3f6cb492af0b87","17e5da53e4e5bd659e22add9bba1cfa222e7e30d"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["a813b523bf76aa0a68013d636b6eb53cedb142a4"]},"commit2Childs":{"a813b523bf76aa0a68013d636b6eb53cedb142a4":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"8ced52befdc8d88d90766aadbaac496f3fd0e4ee":["0a9c4a5022409b649909f75244642a57739b3598"],"6c62352c33f77624124d1cbf58a1291da78141f7":["bfcdec9fcf0409223f35c5ec3bc14094314941b4"],"3575e61fd7df2bbcce8b977a23d3d67aa423ce62":["a813b523bf76aa0a68013d636b6eb53cedb142a4"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["8ced52befdc8d88d90766aadbaac496f3fd0e4ee"],"17e5da53e4e5bd659e22add9bba1cfa222e7e30d":["6c62352c33f77624124d1cbf58a1291da78141f7","bfcdec9fcf0409223f35c5ec3bc14094314941b4","4cce5816ef15a48a0bc11e5d400497ee4301dd3b"],"6652c74b2358a0b13223817a6a793bf1c9d0749d":["17e5da53e4e5bd659e22add9bba1cfa222e7e30d"],"0a9c4a5022409b649909f75244642a57739b3598":["1fcee2c3acd9aa64a73a3b441b3f6cb492af0b87"],"bfcdec9fcf0409223f35c5ec3bc14094314941b4":["3575e61fd7df2bbcce8b977a23d3d67aa423ce62"],"1fcee2c3acd9aa64a73a3b441b3f6cb492af0b87":["17e5da53e4e5bd659e22add9bba1cfa222e7e30d","6652c74b2358a0b13223817a6a793bf1c9d0749d","4cce5816ef15a48a0bc11e5d400497ee4301dd3b"],"4cce5816ef15a48a0bc11e5d400497ee4301dd3b":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["4cce5816ef15a48a0bc11e5d400497ee4301dd3b","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}