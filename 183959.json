{"path":"solr/core/src/java/org/apache/solr/search/SolrDocumentFetcher.RetrieveFieldsOptimizer#calcStoredFieldsForReturn(ReturnFields).mjava","commits":[{"id":"96ecd141e96e7a7a65822d7fada5ddc585b21149","date":1534786652,"type":0,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/SolrDocumentFetcher.RetrieveFieldsOptimizer#calcStoredFieldsForReturn(ReturnFields).mjava","pathOld":"/dev/null","sourceNew":"    private Set<String> calcStoredFieldsForReturn(ReturnFields returnFields) {\n      final Set<String> storedFields = new HashSet<>();\n      Set<String> fnames = returnFields.getLuceneFieldNames();\n      if (returnFields.wantsAllFields()) {\n        return null;\n      } else if (returnFields.hasPatternMatching()) {\n        for (String s : getAllStored()) {\n          if (returnFields.wantsField(s)) {\n            storedFields.add(s);\n          }\n        }\n      } else if (fnames != null) {\n        storedFields.addAll(fnames);\n        storedFields.removeIf((String name) -> {\n          SchemaField schemaField = searcher.getSchema().getFieldOrNull(name);\n          if (schemaField == null) return false; // Get it from the stored fields if, for some reasonm, we can't get the schema.\n          if (schemaField.stored() && schemaField.multiValued()) return false; // must return multivalued fields from stored data if possible.\n          if (schemaField.stored() == false) return true; // if it's not stored, no choice but to return from DV.\n          return false;\n        });\n      }\n      storedFields.remove(SolrReturnFields.SCORE);\n      return storedFields;\n    }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"96ecd141e96e7a7a65822d7fada5ddc585b21149":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["96ecd141e96e7a7a65822d7fada5ddc585b21149"]},"commit2Childs":{"96ecd141e96e7a7a65822d7fada5ddc585b21149":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["96ecd141e96e7a7a65822d7fada5ddc585b21149"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}