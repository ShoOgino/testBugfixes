{"path":"solr/core/src/test/org/apache/solr/handler/admin/ZookeeperStatusHandlerTest#testZkWithPrometheusSolr14752().mjava","commits":[{"id":"e2e572da46604eb6afebc7b0f11d14a26d65b846","date":1598429022,"type":0,"author":"Philipp Trulson","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/admin/ZookeeperStatusHandlerTest#testZkWithPrometheusSolr14752().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testZkWithPrometheusSolr14752() {\n    assumeWorkingMockito();\n    ZookeeperStatusHandler zkStatusHandler = mock(ZookeeperStatusHandler.class);\n    when(zkStatusHandler.getZkRawResponse(\"zoo1:2181\", \"ruok\")).thenReturn(Arrays.asList(\"imok\"));\n    when(zkStatusHandler.getZkRawResponse(\"zoo1:2181\", \"mntr\")).thenReturn(\n        Arrays.asList(\"zk_version\\t3.6.1--104dcb3e3fb464b30c5186d229e00af9f332524b, built on 04/21/2020 15:01 GMT\",\n            \"zk_avg_latency\\t0.24\",\n            \"zk_server_state\\tleader\",\n            \"zk_synced_followers\\t0.0\"));\n    when(zkStatusHandler.getZkRawResponse(\"zoo1:2181\", \"conf\")).thenReturn(\n        Arrays.asList(\"clientPort=2181\"));\n    when(zkStatusHandler.getZkStatus(anyString(), any())).thenCallRealMethod();\n    when(zkStatusHandler.monitorZookeeper(anyString())).thenCallRealMethod();\n    when(zkStatusHandler.validateZkRawResponse(ArgumentMatchers.any(), any(), any())).thenAnswer(Answers.CALLS_REAL_METHODS);\n\n    // Verifying that parsing the status strings with floating point no longer triggers a NumberFormatException, although floats are still displayed in UI\n    Map<String, Object> mockStatus = zkStatusHandler.getZkStatus(\"zoo1:2181\", ZkDynamicConfig.fromZkConnectString(\"zoo1:2181\"));\n    String expected = \"{\\n\" +\n            \"  \\\"mode\\\":\\\"ensemble\\\",\\n\" +\n            \"  \\\"dynamicReconfig\\\":true,\\n\" +\n            \"  \\\"ensembleSize\\\":1,\\n\" +\n            \"  \\\"details\\\":[{\\n\" +\n            \"      \\\"zk_synced_followers\\\":\\\"0.0\\\",\\n\" +\n            \"      \\\"zk_version\\\":\\\"3.6.1--104dcb3e3fb464b30c5186d229e00af9f332524b, built on 04/21/2020 15:01 GMT\\\",\\n\" +\n            \"      \\\"zk_avg_latency\\\":\\\"0.24\\\",\\n\" +\n            \"      \\\"host\\\":\\\"zoo1:2181\\\",\\n\" +\n            \"      \\\"clientPort\\\":\\\"2181\\\",\\n\" +\n            \"      \\\"ok\\\":true,\\n\" +\n            \"      \\\"zk_server_state\\\":\\\"leader\\\"}],\\n\" +\n            \"  \\\"zkHost\\\":\\\"zoo1:2181\\\",\\n\" +\n            \"  \\\"status\\\":\\\"green\\\"}\";\n    assertEquals(expected, JSONUtil.toJSON(mockStatus));\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"e2e572da46604eb6afebc7b0f11d14a26d65b846":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["e2e572da46604eb6afebc7b0f11d14a26d65b846"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["e2e572da46604eb6afebc7b0f11d14a26d65b846"],"e2e572da46604eb6afebc7b0f11d14a26d65b846":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}