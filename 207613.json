{"path":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","commits":[{"id":"e5167c2af9d2ee6ef81cf6cdd6406dec18df3d92","date":1219939485,"type":1,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","pathOld":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity).mjava","sourceNew":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx ) {\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      if(ctx == null)\n        ctx = new ContextImpl(key, null, dataSrc, 0,\n              Collections.EMPTY_MAP, new HashMap(), null, this);\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","sourceOld":"  DataSource getDataSourceInstance(DataConfig.Entity key) {\n    Properties p = dataSourceProps.get(key.dataSource);\n    if (p == null)\n      p = config.dataSources.get(key.dataSource);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + key.dataSource + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      dataSrc.init(new ContextImpl(key, null, dataSrc, 0,\n              Collections.EMPTY_MAP, new HashMap(), null, this), copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"8d22c66b0638c82521891318fc352042c5b86e03","date":1219993248,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","pathOld":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","sourceNew":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx ) {\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      if(ctx == null)\n        ctx = new ContextImpl(key, null, dataSrc, 0,\n              Collections.EMPTY_MAP, new HashMap(), null, this);\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","sourceOld":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx ) {\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      if(ctx == null)\n        ctx = new ContextImpl(key, null, dataSrc, 0,\n              Collections.EMPTY_MAP, new HashMap(), null, this);\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","bugFix":["4d4f1b2c5601680b01c4bb95a43fe6fb73f03103"],"bugIntro":["3dd73fb6c61a8c05893f26d0a5c8405760e27ab1"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"33c5df47ecbf734182bdfec8f59154a8dbecc2e3","date":1226037101,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","pathOld":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","sourceNew":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    if (\"null\".equals(name)) return new MockDataSource();\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","sourceOld":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx ) {\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      if(ctx == null)\n        ctx = new ContextImpl(key, null, dataSrc, 0,\n              Collections.EMPTY_MAP, new HashMap(), null, this);\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","bugFix":["e5167c2af9d2ee6ef81cf6cdd6406dec18df3d92"],"bugIntro":["3dd73fb6c61a8c05893f26d0a5c8405760e27ab1"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"dd42c8ecc9f8a8e590c5526544a77258089ca23f","date":1229189880,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","pathOld":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","sourceNew":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    if (\"null\".equals(name)) return new MockDataSource();\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      Map<String, Object> map = ctx.getRequestParameters();\n      if (map.containsKey(\"rows\")) {\n        int rows = Integer.parseInt((String) map.get(\"rows\"));\n        if (map.containsKey(\"start\")) {\n          rows += Integer.parseInt((String) map.get(\"start\"));\n        }\n        copyProps.setProperty(\"maxRows\", String.valueOf(rows));\n      }\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","sourceOld":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    if (\"null\".equals(name)) return new MockDataSource();\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"f24d87791042430a77c0e6c1e7a59d5840146f5e","date":1252329554,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","pathOld":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","sourceNew":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    if (\"null\".equals(name)) return new MockDataSource();\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)  \n      throw new DataImportHandlerException(SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        wrapAndThrow(SEVERE, e, \"Invalid type for data source: \" + impl);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      Map<String, Object> map = ctx.getRequestParameters();\n      if (map.containsKey(\"rows\")) {\n        int rows = Integer.parseInt((String) map.get(\"rows\"));\n        if (map.containsKey(\"start\")) {\n          rows += Integer.parseInt((String) map.get(\"start\"));\n        }\n        copyProps.setProperty(\"maxRows\", String.valueOf(rows));\n      }\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      wrapAndThrow(SEVERE, e, \"Failed to initialize DataSource: \" + key.dataSource);\n    }\n    return dataSrc;\n  }\n\n","sourceOld":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    if (\"null\".equals(name)) return new MockDataSource();\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n                \"Invalid type for data source: \" + impl, e);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      Map<String, Object> map = ctx.getRequestParameters();\n      if (map.containsKey(\"rows\")) {\n        int rows = Integer.parseInt((String) map.get(\"rows\"));\n        if (map.containsKey(\"start\")) {\n          rows += Integer.parseInt((String) map.get(\"start\"));\n        }\n        copyProps.setProperty(\"maxRows\", String.valueOf(rows));\n      }\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,\n              \"Failed to initialize DataSource: \" + key.dataSource, e);\n    }\n    return dataSrc;\n  }\n\n","bugFix":null,"bugIntro":["3dd73fb6c61a8c05893f26d0a5c8405760e27ab1"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"3dd73fb6c61a8c05893f26d0a5c8405760e27ab1","date":1260879539,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","pathOld":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","sourceNew":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)  \n      throw new DataImportHandlerException(SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String type = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (type == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(type, getCore()).newInstance();\n      } catch (Exception e) {\n        wrapAndThrow(SEVERE, e, \"Invalid type for data source: \" + type);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      Map<String, Object> map = ctx.getRequestParameters();\n      if (map.containsKey(\"rows\")) {\n        int rows = Integer.parseInt((String) map.get(\"rows\"));\n        if (map.containsKey(\"start\")) {\n          rows += Integer.parseInt((String) map.get(\"start\"));\n        }\n        copyProps.setProperty(\"maxRows\", String.valueOf(rows));\n      }\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      wrapAndThrow(SEVERE, e, \"Failed to initialize DataSource: \" + key.dataSource);\n    }\n    return dataSrc;\n  }\n\n","sourceOld":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    if (\"null\".equals(name)) return new MockDataSource();\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)  \n      throw new DataImportHandlerException(SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String impl = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (impl == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(impl, getCore()).newInstance();\n      } catch (Exception e) {\n        wrapAndThrow(SEVERE, e, \"Invalid type for data source: \" + impl);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      Map<String, Object> map = ctx.getRequestParameters();\n      if (map.containsKey(\"rows\")) {\n        int rows = Integer.parseInt((String) map.get(\"rows\"));\n        if (map.containsKey(\"start\")) {\n          rows += Integer.parseInt((String) map.get(\"start\"));\n        }\n        copyProps.setProperty(\"maxRows\", String.valueOf(rows));\n      }\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      wrapAndThrow(SEVERE, e, \"Failed to initialize DataSource: \" + key.dataSource);\n    }\n    return dataSrc;\n  }\n\n","bugFix":["f24d87791042430a77c0e6c1e7a59d5840146f5e","4d4f1b2c5601680b01c4bb95a43fe6fb73f03103","8d22c66b0638c82521891318fc352042c5b86e03","33c5df47ecbf734182bdfec8f59154a8dbecc2e3"],"bugIntro":["5101aff20e65c9a285c274627ec956eb5409d253","5101aff20e65c9a285c274627ec956eb5409d253"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"ad94625fb8d088209f46650c8097196fec67f00c","date":1453508319,"type":5,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","pathOld":"contrib/dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/DataImporter#getDataSourceInstance(DataConfig.Entity,String,Context).mjava","sourceNew":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)  \n      throw new DataImportHandlerException(SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String type = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (type == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(type, getCore()).newInstance();\n      } catch (Exception e) {\n        wrapAndThrow(SEVERE, e, \"Invalid type for data source: \" + type);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      Map<String, Object> map = ctx.getRequestParameters();\n      if (map.containsKey(\"rows\")) {\n        int rows = Integer.parseInt((String) map.get(\"rows\"));\n        if (map.containsKey(\"start\")) {\n          rows += Integer.parseInt((String) map.get(\"start\"));\n        }\n        copyProps.setProperty(\"maxRows\", String.valueOf(rows));\n      }\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      wrapAndThrow(SEVERE, e, \"Failed to initialize DataSource: \" + key.dataSource);\n    }\n    return dataSrc;\n  }\n\n","sourceOld":"  DataSource getDataSourceInstance(DataConfig.Entity key, String name, Context ctx) {\n    Properties p = dataSourceProps.get(name);\n    if (p == null)\n      p = config.dataSources.get(name);\n    if (p == null)\n      p = dataSourceProps.get(null);// for default data source\n    if (p == null)\n      p = config.dataSources.get(null);\n    if (p == null)  \n      throw new DataImportHandlerException(SEVERE,\n              \"No dataSource :\" + name + \" available for entity :\"\n                      + key.name);\n    String type = p.getProperty(TYPE);\n    DataSource dataSrc = null;\n    if (type == null) {\n      dataSrc = new JdbcDataSource();\n    } else {\n      try {\n        dataSrc = (DataSource) DocBuilder.loadClass(type, getCore()).newInstance();\n      } catch (Exception e) {\n        wrapAndThrow(SEVERE, e, \"Invalid type for data source: \" + type);\n      }\n    }\n    try {\n      Properties copyProps = new Properties();\n      copyProps.putAll(p);\n      Map<String, Object> map = ctx.getRequestParameters();\n      if (map.containsKey(\"rows\")) {\n        int rows = Integer.parseInt((String) map.get(\"rows\"));\n        if (map.containsKey(\"start\")) {\n          rows += Integer.parseInt((String) map.get(\"start\"));\n        }\n        copyProps.setProperty(\"maxRows\", String.valueOf(rows));\n      }\n      dataSrc.init(ctx, copyProps);\n    } catch (Exception e) {\n      wrapAndThrow(SEVERE, e, \"Failed to initialize DataSource: \" + key.dataSource);\n    }\n    return dataSrc;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null}],"commit2Parents":{"e5167c2af9d2ee6ef81cf6cdd6406dec18df3d92":["3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b"],"8d22c66b0638c82521891318fc352042c5b86e03":["e5167c2af9d2ee6ef81cf6cdd6406dec18df3d92"],"3dd73fb6c61a8c05893f26d0a5c8405760e27ab1":["f24d87791042430a77c0e6c1e7a59d5840146f5e"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b":[],"33c5df47ecbf734182bdfec8f59154a8dbecc2e3":["8d22c66b0638c82521891318fc352042c5b86e03"],"f24d87791042430a77c0e6c1e7a59d5840146f5e":["dd42c8ecc9f8a8e590c5526544a77258089ca23f"],"ad94625fb8d088209f46650c8097196fec67f00c":["3dd73fb6c61a8c05893f26d0a5c8405760e27ab1"],"dd42c8ecc9f8a8e590c5526544a77258089ca23f":["33c5df47ecbf734182bdfec8f59154a8dbecc2e3"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"]},"commit2Childs":{"e5167c2af9d2ee6ef81cf6cdd6406dec18df3d92":["8d22c66b0638c82521891318fc352042c5b86e03"],"8d22c66b0638c82521891318fc352042c5b86e03":["33c5df47ecbf734182bdfec8f59154a8dbecc2e3"],"3dd73fb6c61a8c05893f26d0a5c8405760e27ab1":["ad94625fb8d088209f46650c8097196fec67f00c"],"3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b":["e5167c2af9d2ee6ef81cf6cdd6406dec18df3d92"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"33c5df47ecbf734182bdfec8f59154a8dbecc2e3":["dd42c8ecc9f8a8e590c5526544a77258089ca23f"],"f24d87791042430a77c0e6c1e7a59d5840146f5e":["3dd73fb6c61a8c05893f26d0a5c8405760e27ab1"],"dd42c8ecc9f8a8e590c5526544a77258089ca23f":["f24d87791042430a77c0e6c1e7a59d5840146f5e"],"ad94625fb8d088209f46650c8097196fec67f00c":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["ad94625fb8d088209f46650c8097196fec67f00c","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b","a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}