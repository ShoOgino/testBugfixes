{"path":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithMultipleLongValues().mjava","commits":[{"id":"020269a92bfd0bba8d206f4377686cf51f30ea9e","date":1482043182,"type":0,"author":"Shai Erera","isMerge":false,"pathNew":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithMultipleLongValues().mjava","pathOld":"/dev/null","sourceNew":"  public void testDocsWithMultipleLongValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      long[][] docValues = new long[numDocs][];\n      long nextVal = 1;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          int numValues = TestUtil.nextInt(random(), 1, 5);\n          docValues[i] = new long[numValues];\n          for (int j = 0; j < numValues; j++) {\n            doc.add(new SortedNumericDocValuesField(field, nextVal));\n            docValues[i][j] = nextVal;\n            ++nextVal;\n          }\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = null;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        SortedLongDocValuesStats stats = new SortedLongDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        assertEquals(filterValues(docValues, (v) -> v != null).count(), stats.count());\n        assertEquals(filterValues(docValues, (v) -> v == null).count() - reader.numDeletedDocs(), stats.missing());\n        if (stats.count() > 0) {\n          LongSummaryStatistics sumStats = filterAndFlatValues(docValues, (v) -> v != null).summaryStatistics();\n          assertEquals(sumStats.getMax(), stats.max().longValue());\n          assertEquals(sumStats.getMin(), stats.min().longValue());\n          assertEquals(sumStats.getAverage(), stats.mean(), 0.00001);\n          assertEquals(sumStats.getSum(), stats.sum().longValue());\n          assertEquals(sumStats.getCount(), stats.valuesCount());\n          double variance = computeVariance(filterAndFlatValues(docValues, (v) -> v != null), stats.mean, stats.count());\n          assertEquals(variance, stats.variance(), 0.00001);\n          assertEquals(Math.sqrt(variance), stats.stdev(), 0.00001);\n        }\n      }\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ea697fd76efea59fb6884c0a5b34755269f969dd","date":1482090603,"type":3,"author":"Shai Erera","isMerge":false,"pathNew":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithMultipleLongValues().mjava","pathOld":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithMultipleLongValues().mjava","sourceNew":"  public void testDocsWithMultipleLongValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      long[][] docValues = new long[numDocs][];\n      long nextVal = 1;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          int numValues = TestUtil.nextInt(random(), 1, 5);\n          docValues[i] = new long[numValues];\n          for (int j = 0; j < numValues; j++) {\n            doc.add(new SortedNumericDocValuesField(field, nextVal));\n            docValues[i][j] = nextVal;\n            ++nextVal;\n          }\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = null;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        SortedLongDocValuesStats stats = new SortedLongDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        assertEquals(nonNull(docValues).count(), stats.count());\n        assertEquals(isNull(docValues).count() - reader.numDeletedDocs(), stats.missing());\n        if (stats.count() > 0) {\n          LongSummaryStatistics sumStats = filterAndFlatValues(docValues, (v) -> v != null).summaryStatistics();\n          assertEquals(sumStats.getMax(), stats.max().longValue());\n          assertEquals(sumStats.getMin(), stats.min().longValue());\n          assertEquals(sumStats.getAverage(), stats.mean(), 0.00001);\n          assertEquals(sumStats.getSum(), stats.sum().longValue());\n          assertEquals(sumStats.getCount(), stats.valuesCount());\n          double variance = computeVariance(filterAndFlatValues(docValues, (v) -> v != null), stats.mean, stats.count());\n          assertEquals(variance, stats.variance(), 0.00001);\n          assertEquals(Math.sqrt(variance), stats.stdev(), 0.00001);\n        }\n      }\n    }\n  }\n\n","sourceOld":"  public void testDocsWithMultipleLongValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      long[][] docValues = new long[numDocs][];\n      long nextVal = 1;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          int numValues = TestUtil.nextInt(random(), 1, 5);\n          docValues[i] = new long[numValues];\n          for (int j = 0; j < numValues; j++) {\n            doc.add(new SortedNumericDocValuesField(field, nextVal));\n            docValues[i][j] = nextVal;\n            ++nextVal;\n          }\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = null;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        SortedLongDocValuesStats stats = new SortedLongDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        assertEquals(filterValues(docValues, (v) -> v != null).count(), stats.count());\n        assertEquals(filterValues(docValues, (v) -> v == null).count() - reader.numDeletedDocs(), stats.missing());\n        if (stats.count() > 0) {\n          LongSummaryStatistics sumStats = filterAndFlatValues(docValues, (v) -> v != null).summaryStatistics();\n          assertEquals(sumStats.getMax(), stats.max().longValue());\n          assertEquals(sumStats.getMin(), stats.min().longValue());\n          assertEquals(sumStats.getAverage(), stats.mean(), 0.00001);\n          assertEquals(sumStats.getSum(), stats.sum().longValue());\n          assertEquals(sumStats.getCount(), stats.valuesCount());\n          double variance = computeVariance(filterAndFlatValues(docValues, (v) -> v != null), stats.mean, stats.count());\n          assertEquals(variance, stats.variance(), 0.00001);\n          assertEquals(Math.sqrt(variance), stats.stdev(), 0.00001);\n        }\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"db50efc931d15d3f220dd02fb9cda28cecfaf584","date":1482177276,"type":3,"author":"Shai Erera","isMerge":false,"pathNew":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithMultipleLongValues().mjava","pathOld":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithMultipleLongValues().mjava","sourceNew":"  public void testDocsWithMultipleLongValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      long[][] docValues = new long[numDocs][];\n      long nextVal = 1;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          int numValues = TestUtil.nextInt(random(), 1, 5);\n          docValues[i] = new long[numValues];\n          for (int j = 0; j < numValues; j++) {\n            doc.add(new SortedNumericDocValuesField(field, nextVal));\n            docValues[i][j] = nextVal;\n            ++nextVal;\n          }\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = null;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        SortedLongDocValuesStats stats = new SortedLongDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        assertEquals(nonNull(docValues).count(), stats.count());\n        int numDocsWithoutField = (int) isNull(docValues).count();\n        assertEquals(computeExpMissing(numDocsWithoutField, numDocs, reader), stats.missing());\n        if (stats.count() > 0) {\n          LongSummaryStatistics sumStats = filterAndFlatValues(docValues, (v) -> v != null).summaryStatistics();\n          assertEquals(sumStats.getMax(), stats.max().longValue());\n          assertEquals(sumStats.getMin(), stats.min().longValue());\n          assertEquals(sumStats.getAverage(), stats.mean(), 0.00001);\n          assertEquals(sumStats.getSum(), stats.sum().longValue());\n          assertEquals(sumStats.getCount(), stats.valuesCount());\n          double variance = computeVariance(filterAndFlatValues(docValues, (v) -> v != null), stats.mean, stats.count());\n          assertEquals(variance, stats.variance(), 0.00001);\n          assertEquals(Math.sqrt(variance), stats.stdev(), 0.00001);\n        }\n      }\n    }\n  }\n\n","sourceOld":"  public void testDocsWithMultipleLongValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      long[][] docValues = new long[numDocs][];\n      long nextVal = 1;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          int numValues = TestUtil.nextInt(random(), 1, 5);\n          docValues[i] = new long[numValues];\n          for (int j = 0; j < numValues; j++) {\n            doc.add(new SortedNumericDocValuesField(field, nextVal));\n            docValues[i][j] = nextVal;\n            ++nextVal;\n          }\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = null;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        SortedLongDocValuesStats stats = new SortedLongDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        assertEquals(nonNull(docValues).count(), stats.count());\n        assertEquals(isNull(docValues).count() - reader.numDeletedDocs(), stats.missing());\n        if (stats.count() > 0) {\n          LongSummaryStatistics sumStats = filterAndFlatValues(docValues, (v) -> v != null).summaryStatistics();\n          assertEquals(sumStats.getMax(), stats.max().longValue());\n          assertEquals(sumStats.getMin(), stats.min().longValue());\n          assertEquals(sumStats.getAverage(), stats.mean(), 0.00001);\n          assertEquals(sumStats.getSum(), stats.sum().longValue());\n          assertEquals(sumStats.getCount(), stats.valuesCount());\n          double variance = computeVariance(filterAndFlatValues(docValues, (v) -> v != null), stats.mean, stats.count());\n          assertEquals(variance, stats.variance(), 0.00001);\n          assertEquals(Math.sqrt(variance), stats.stdev(), 0.00001);\n        }\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"5acd68c5f07f7ee604c2eeffe801f4a2d7a1a5bf","date":1482251961,"type":0,"author":"Kevin Risden","isMerge":true,"pathNew":"lucene/misc/src/test/org/apache/lucene/search/TestDocValuesStatsCollector#testDocsWithMultipleLongValues().mjava","pathOld":"/dev/null","sourceNew":"  public void testDocsWithMultipleLongValues() throws IOException {\n    try (Directory dir = newDirectory();\n        IndexWriter indexWriter = new IndexWriter(dir, newIndexWriterConfig())) {\n      String field = \"numeric\";\n      int numDocs = TestUtil.nextInt(random(), 1, 100);\n      long[][] docValues = new long[numDocs][];\n      long nextVal = 1;\n      for (int i = 0; i < numDocs; i++) {\n        Document doc = new Document();\n        if (random().nextBoolean()) { // not all documents have a value\n          int numValues = TestUtil.nextInt(random(), 1, 5);\n          docValues[i] = new long[numValues];\n          for (int j = 0; j < numValues; j++) {\n            doc.add(new SortedNumericDocValuesField(field, nextVal));\n            docValues[i][j] = nextVal;\n            ++nextVal;\n          }\n          doc.add(new StringField(\"id\", \"doc\" + i, Store.NO));\n        }\n        indexWriter.addDocument(doc);\n      }\n\n      // 20% of cases delete some docs\n      if (random().nextDouble() < 0.2) {\n        for (int i = 0; i < numDocs; i++) {\n          if (random().nextBoolean()) {\n            indexWriter.deleteDocuments(new Term(\"id\", \"doc\" + i));\n            docValues[i] = null;\n          }\n        }\n      }\n\n      try (DirectoryReader reader = DirectoryReader.open(indexWriter)) {\n        IndexSearcher searcher = new IndexSearcher(reader);\n        SortedLongDocValuesStats stats = new SortedLongDocValuesStats(field);\n        searcher.search(new MatchAllDocsQuery(), new DocValuesStatsCollector(stats));\n\n        assertEquals(nonNull(docValues).count(), stats.count());\n        int numDocsWithoutField = (int) isNull(docValues).count();\n        assertEquals(computeExpMissing(numDocsWithoutField, numDocs, reader), stats.missing());\n        if (stats.count() > 0) {\n          LongSummaryStatistics sumStats = filterAndFlatValues(docValues, (v) -> v != null).summaryStatistics();\n          assertEquals(sumStats.getMax(), stats.max().longValue());\n          assertEquals(sumStats.getMin(), stats.min().longValue());\n          assertEquals(sumStats.getAverage(), stats.mean(), 0.00001);\n          assertEquals(sumStats.getSum(), stats.sum().longValue());\n          assertEquals(sumStats.getCount(), stats.valuesCount());\n          double variance = computeVariance(filterAndFlatValues(docValues, (v) -> v != null), stats.mean, stats.count());\n          assertEquals(variance, stats.variance(), 0.00001);\n          assertEquals(Math.sqrt(variance), stats.stdev(), 0.00001);\n        }\n      }\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"db50efc931d15d3f220dd02fb9cda28cecfaf584":["ea697fd76efea59fb6884c0a5b34755269f969dd"],"ea697fd76efea59fb6884c0a5b34755269f969dd":["020269a92bfd0bba8d206f4377686cf51f30ea9e"],"5acd68c5f07f7ee604c2eeffe801f4a2d7a1a5bf":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","db50efc931d15d3f220dd02fb9cda28cecfaf584"],"020269a92bfd0bba8d206f4377686cf51f30ea9e":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["db50efc931d15d3f220dd02fb9cda28cecfaf584"]},"commit2Childs":{"db50efc931d15d3f220dd02fb9cda28cecfaf584":["5acd68c5f07f7ee604c2eeffe801f4a2d7a1a5bf","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"ea697fd76efea59fb6884c0a5b34755269f969dd":["db50efc931d15d3f220dd02fb9cda28cecfaf584"],"5acd68c5f07f7ee604c2eeffe801f4a2d7a1a5bf":[],"020269a92bfd0bba8d206f4377686cf51f30ea9e":["ea697fd76efea59fb6884c0a5b34755269f969dd"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["5acd68c5f07f7ee604c2eeffe801f4a2d7a1a5bf","020269a92bfd0bba8d206f4377686cf51f30ea9e"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["5acd68c5f07f7ee604c2eeffe801f4a2d7a1a5bf","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}