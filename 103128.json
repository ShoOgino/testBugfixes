{"path":"solr/core/src/java/org/apache/solr/util/plugin/AbstractPluginLoader#load(SolrClassLoader,NodeList).mjava","commits":[{"id":"b2ed9b72e5fa27a7bd4857f222ca815341979d4a","date":1594879524,"type":1,"author":"Noble Paul","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/util/plugin/AbstractPluginLoader#load(SolrClassLoader,NodeList).mjava","pathOld":"solr/core/src/java/org/apache/solr/util/plugin/AbstractPluginLoader#load(SolrResourceLoader,NodeList).mjava","sourceNew":"  /**\n   * Initializes and registers each plugin in the list.\n   * Given a NodeList from XML in the form:\n   * <pre class=\"prettyprint\">\n   * {@code\n   * <plugins>\n   *    <plugin name=\"name1\" class=\"solr.ClassName\" >\n   *      ...\n   *    </plugin>\n   *    <plugin name=\"name2\" class=\"solr.ClassName\" >\n   *      ...\n   *    </plugin>\n   * </plugins>}\n   * </pre>\n   * \n   * This will initialize and register each plugin from the list.  A class will \n   * be generated for each class name and registered to the given name.\n   * \n   * If 'preRegister' is true, each plugin will be registered *before* it is initialized\n   * This may be useful for implementations that need to inspect other registered \n   * plugins at startup.\n   * \n   * One (and only one) plugin may declare itself to be the 'default' plugin using:\n   * <pre class=\"prettyprint\">\n   * {@code\n   *    <plugin name=\"name2\" class=\"solr.ClassName\" default=\"true\">}\n   * </pre>\n   * If a default element is defined, it will be returned from this function.\n   * \n   */\n  public T load(SolrClassLoader loader, NodeList nodes )\n  {\n    List<PluginInitInfo> info = new ArrayList<>();\n    T defaultPlugin = null;\n    \n    if (nodes !=null ) {\n      for (int i=0; i<nodes.getLength(); i++) {\n        Node node = nodes.item(i);\n  \n        String name = null;\n        try {\n          name = DOMUtil.getAttr(node, NAME, requireName ? type : null);\n          String className  = DOMUtil.getAttr(node,\"class\", null);\n          String defaultStr = DOMUtil.getAttr(node,\"default\", null );\n\n          if (Objects.isNull(className) && Objects.isNull(name)) {\n            throw new RuntimeException(type + \": missing mandatory attribute 'class' or 'name'\");\n          }\n\n          T plugin = create(loader, name, className, node);\n          if (log.isDebugEnabled()) {\n            log.debug(\"created {}: {}\", ((name != null) ? name : \"\"), plugin.getClass().getName());\n          }\n          \n          // Either initialize now or wait till everything has been registered\n          if( preRegister ) {\n            info.add( new PluginInitInfo( plugin, node ) );\n          }\n          else {\n            init( plugin, node );\n          }\n          \n          T old = register( name, plugin );\n          if( old != null && !( name == null && !requireName ) ) {\n            throw new SolrException( ErrorCode.SERVER_ERROR, \n                \"Multiple \"+type+\" registered to the same name: \"+name+\" ignoring: \"+old );\n          }\n          \n          if( defaultStr != null && Boolean.parseBoolean( defaultStr ) ) {\n            if( defaultPlugin != null ) {\n              throw new SolrException( ErrorCode.SERVER_ERROR, \n                \"Multiple default \"+type+\" plugins: \"+defaultPlugin + \" AND \" + name );\n            }\n            defaultPlugin = plugin;\n          }\n        }\n        catch (Exception ex) {\n          SolrException e = new SolrException\n            (ErrorCode.SERVER_ERROR,\n             \"Plugin init failure for \" + type + \n             (null != name ? (\" \\\"\" + name + \"\\\"\") : \"\") +\n             \": \" + ex.getMessage(), ex);\n          throw e;\n        }\n      }\n    }\n      \n    // If everything needs to be registered *first*, this will initialize later\n    for( PluginInitInfo pinfo : info ) {\n      try {\n        init( pinfo.plugin, pinfo.node );\n      }\n      catch( Exception ex ) {\n        SolrException e = new SolrException\n          (ErrorCode.SERVER_ERROR, \"Plugin Initializing failure for \" + type, ex);\n        throw e;\n      }\n    }\n    return defaultPlugin;\n  }\n\n","sourceOld":"  /**\n   * Initializes and registers each plugin in the list.\n   * Given a NodeList from XML in the form:\n   * <pre class=\"prettyprint\">\n   * {@code\n   * <plugins>\n   *    <plugin name=\"name1\" class=\"solr.ClassName\" >\n   *      ...\n   *    </plugin>\n   *    <plugin name=\"name2\" class=\"solr.ClassName\" >\n   *      ...\n   *    </plugin>\n   * </plugins>}\n   * </pre>\n   * \n   * This will initialize and register each plugin from the list.  A class will \n   * be generated for each class name and registered to the given name.\n   * \n   * If 'preRegister' is true, each plugin will be registered *before* it is initialized\n   * This may be useful for implementations that need to inspect other registered \n   * plugins at startup.\n   * \n   * One (and only one) plugin may declare itself to be the 'default' plugin using:\n   * <pre class=\"prettyprint\">\n   * {@code\n   *    <plugin name=\"name2\" class=\"solr.ClassName\" default=\"true\">}\n   * </pre>\n   * If a default element is defined, it will be returned from this function.\n   * \n   */\n  public T load( SolrResourceLoader loader, NodeList nodes )\n  {\n    List<PluginInitInfo> info = new ArrayList<>();\n    T defaultPlugin = null;\n    \n    if (nodes !=null ) {\n      for (int i=0; i<nodes.getLength(); i++) {\n        Node node = nodes.item(i);\n  \n        String name = null;\n        try {\n          name = DOMUtil.getAttr(node, NAME, requireName ? type : null);\n          String className  = DOMUtil.getAttr(node,\"class\", null);\n          String defaultStr = DOMUtil.getAttr(node,\"default\", null );\n\n          if (Objects.isNull(className) && Objects.isNull(name)) {\n            throw new RuntimeException(type + \": missing mandatory attribute 'class' or 'name'\");\n          }\n\n          T plugin = create(loader, name, className, node);\n          if (log.isDebugEnabled()) {\n            log.debug(\"created {}: {}\", ((name != null) ? name : \"\"), plugin.getClass().getName());\n          }\n          \n          // Either initialize now or wait till everything has been registered\n          if( preRegister ) {\n            info.add( new PluginInitInfo( plugin, node ) );\n          }\n          else {\n            init( plugin, node );\n          }\n          \n          T old = register( name, plugin );\n          if( old != null && !( name == null && !requireName ) ) {\n            throw new SolrException( ErrorCode.SERVER_ERROR, \n                \"Multiple \"+type+\" registered to the same name: \"+name+\" ignoring: \"+old );\n          }\n          \n          if( defaultStr != null && Boolean.parseBoolean( defaultStr ) ) {\n            if( defaultPlugin != null ) {\n              throw new SolrException( ErrorCode.SERVER_ERROR, \n                \"Multiple default \"+type+\" plugins: \"+defaultPlugin + \" AND \" + name );\n            }\n            defaultPlugin = plugin;\n          }\n        }\n        catch (Exception ex) {\n          SolrException e = new SolrException\n            (ErrorCode.SERVER_ERROR,\n             \"Plugin init failure for \" + type + \n             (null != name ? (\" \\\"\" + name + \"\\\"\") : \"\") +\n             \": \" + ex.getMessage(), ex);\n          throw e;\n        }\n      }\n    }\n      \n    // If everything needs to be registered *first*, this will initialize later\n    for( PluginInitInfo pinfo : info ) {\n      try {\n        init( pinfo.plugin, pinfo.node );\n      }\n      catch( Exception ex ) {\n        SolrException e = new SolrException\n          (ErrorCode.SERVER_ERROR, \"Plugin Initializing failure for \" + type, ex);\n        throw e;\n      }\n    }\n    return defaultPlugin;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"b2ed9b72e5fa27a7bd4857f222ca815341979d4a":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["b2ed9b72e5fa27a7bd4857f222ca815341979d4a"]},"commit2Childs":{"b2ed9b72e5fa27a7bd4857f222ca815341979d4a":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["b2ed9b72e5fa27a7bd4857f222ca815341979d4a"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}