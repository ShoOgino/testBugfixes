{"path":"solr/core/src/test/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/BlockPoolSlice#saveReplicas(BlockListAsLongs).mjava","commits":[{"id":"44ca189138a5b6e1989d12ab992fab60e235ddc7","date":1549051496,"type":0,"author":"markrmiller","isMerge":false,"pathNew":"solr/core/src/test/org/apache/hadoop/hdfs/server/datanode/fsdataset/impl/BlockPoolSlice#saveReplicas(BlockListAsLongs).mjava","pathOld":"/dev/null","sourceNew":"  private void saveReplicas(BlockListAsLongs blocksListToPersist) {\n    if (blocksListToPersist == null ||\n        blocksListToPersist.getNumberOfBlocks()== 0) {\n      return;\n    }\n    final File tmpFile = new File(currentDir, REPLICA_CACHE_FILE + \".tmp\");\n    final File replicaCacheFile = new File(currentDir, REPLICA_CACHE_FILE);\n    if (!fileIoProvider.deleteWithExistsCheck(volume, tmpFile) ||\n        !fileIoProvider.deleteWithExistsCheck(volume, replicaCacheFile)) {\n      return;\n    }\n\n    FileOutputStream out = null;\n    try {\n      out = fileIoProvider.getFileOutputStream(volume, tmpFile);\n      blocksListToPersist.writeTo(out);\n      out.close();\n      // Renaming the tmp file to replicas\n      fileIoProvider.moveFile(volume, tmpFile, replicaCacheFile);\n    } catch (Exception e) {\n      // If write failed, the volume might be bad. Since the cache file is\n      // not critical, log the error, delete both the files (tmp and cache)\n      // and continue.\n      LOG.warn(\"Failed to write replicas to cache \", e);\n      fileIoProvider.deleteWithExistsCheck(volume, replicaCacheFile);\n    } finally {\n      IOUtils.closeStream(out);\n      fileIoProvider.deleteWithExistsCheck(volume, tmpFile);\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"44ca189138a5b6e1989d12ab992fab60e235ddc7":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["44ca189138a5b6e1989d12ab992fab60e235ddc7"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["44ca189138a5b6e1989d12ab992fab60e235ddc7"],"44ca189138a5b6e1989d12ab992fab60e235ddc7":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}