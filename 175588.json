{"path":"lucene/facet/src/java/org/apache/lucene/facet/taxonomy/TaxonomyFacetSumValueSource#sumValues(List[MatchingDocs],boolean,DoubleValuesSource).mjava","commits":[{"id":"9cf250cb8fdff62f4b753866d44e5bf59bfd1616","date":1483789944,"type":1,"author":"Alan Woodward","isMerge":false,"pathNew":"lucene/facet/src/java/org/apache/lucene/facet/taxonomy/TaxonomyFacetSumValueSource#sumValues(List[MatchingDocs],boolean,DoubleValuesSource).mjava","pathOld":"lucene/facet/src/java/org/apache/lucene/facet/taxonomy/TaxonomyFacetSumValueSource#sumValues(List[MatchingDocs],boolean,ValueSource).mjava","sourceNew":"  private void sumValues(List<MatchingDocs> matchingDocs, boolean keepScores, DoubleValuesSource valueSource) throws IOException {\n\n    IntsRef scratch = new IntsRef();\n    for(MatchingDocs hits : matchingDocs) {\n      OrdinalsReader.OrdinalsSegmentReader ords = ordinalsReader.getReader(hits.context);\n      DoubleValues scores = keepScores ? scores(hits) : null;\n      DoubleValues functionValues = valueSource.getValues(hits.context, scores);\n      DocIdSetIterator docs = hits.bits.iterator();\n      \n      int doc;\n      while ((doc = docs.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {\n        ords.get(doc, scratch);\n        if (functionValues.advanceExact(doc)) {\n          float value = (float) functionValues.doubleValue();\n          for (int i = 0; i < scratch.length; i++) {\n            values[scratch.ints[i]] += value;\n          }\n        }\n      }\n    }\n\n    rollup();\n  }\n\n","sourceOld":"  private final void sumValues(List<MatchingDocs> matchingDocs, boolean keepScores, ValueSource valueSource) throws IOException {\n    final FakeScorer scorer = new FakeScorer();\n    Map<String, Scorer> context = new HashMap<>();\n    if (keepScores) {\n      context.put(\"scorer\", scorer);\n    }\n    IntsRef scratch = new IntsRef();\n    for(MatchingDocs hits : matchingDocs) {\n      OrdinalsReader.OrdinalsSegmentReader ords = ordinalsReader.getReader(hits.context);\n      \n      int scoresIdx = 0;\n      float[] scores = hits.scores;\n\n      FunctionValues functionValues = valueSource.getValues(context, hits.context);\n      DocIdSetIterator docs = hits.bits.iterator();\n      \n      int doc;\n      while ((doc = docs.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {\n        ords.get(doc, scratch);\n        if (keepScores) {\n          scorer.doc = doc;\n          scorer.score = scores[scoresIdx++];\n        }\n        float value = (float) functionValues.doubleVal(doc);\n        for(int i=0;i<scratch.length;i++) {\n          values[scratch.ints[i]] += value;\n        }\n      }\n    }\n\n    rollup();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"09ab8ee44ca898536770d0106a7c0ee4be4f0eb7","date":1484239864,"type":1,"author":"Kevin Risden","isMerge":true,"pathNew":"lucene/facet/src/java/org/apache/lucene/facet/taxonomy/TaxonomyFacetSumValueSource#sumValues(List[MatchingDocs],boolean,DoubleValuesSource).mjava","pathOld":"lucene/facet/src/java/org/apache/lucene/facet/taxonomy/TaxonomyFacetSumValueSource#sumValues(List[MatchingDocs],boolean,ValueSource).mjava","sourceNew":"  private void sumValues(List<MatchingDocs> matchingDocs, boolean keepScores, DoubleValuesSource valueSource) throws IOException {\n\n    IntsRef scratch = new IntsRef();\n    for(MatchingDocs hits : matchingDocs) {\n      OrdinalsReader.OrdinalsSegmentReader ords = ordinalsReader.getReader(hits.context);\n      DoubleValues scores = keepScores ? scores(hits) : null;\n      DoubleValues functionValues = valueSource.getValues(hits.context, scores);\n      DocIdSetIterator docs = hits.bits.iterator();\n      \n      int doc;\n      while ((doc = docs.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {\n        ords.get(doc, scratch);\n        if (functionValues.advanceExact(doc)) {\n          float value = (float) functionValues.doubleValue();\n          for (int i = 0; i < scratch.length; i++) {\n            values[scratch.ints[i]] += value;\n          }\n        }\n      }\n    }\n\n    rollup();\n  }\n\n","sourceOld":"  private final void sumValues(List<MatchingDocs> matchingDocs, boolean keepScores, ValueSource valueSource) throws IOException {\n    final FakeScorer scorer = new FakeScorer();\n    Map<String, Scorer> context = new HashMap<>();\n    if (keepScores) {\n      context.put(\"scorer\", scorer);\n    }\n    IntsRef scratch = new IntsRef();\n    for(MatchingDocs hits : matchingDocs) {\n      OrdinalsReader.OrdinalsSegmentReader ords = ordinalsReader.getReader(hits.context);\n      \n      int scoresIdx = 0;\n      float[] scores = hits.scores;\n\n      FunctionValues functionValues = valueSource.getValues(context, hits.context);\n      DocIdSetIterator docs = hits.bits.iterator();\n      \n      int doc;\n      while ((doc = docs.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {\n        ords.get(doc, scratch);\n        if (keepScores) {\n          scorer.doc = doc;\n          scorer.score = scores[scoresIdx++];\n        }\n        float value = (float) functionValues.doubleVal(doc);\n        for(int i=0;i<scratch.length;i++) {\n          values[scratch.ints[i]] += value;\n        }\n      }\n    }\n\n    rollup();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"09ab8ee44ca898536770d0106a7c0ee4be4f0eb7":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","9cf250cb8fdff62f4b753866d44e5bf59bfd1616"],"9cf250cb8fdff62f4b753866d44e5bf59bfd1616":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["9cf250cb8fdff62f4b753866d44e5bf59bfd1616"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["09ab8ee44ca898536770d0106a7c0ee4be4f0eb7","9cf250cb8fdff62f4b753866d44e5bf59bfd1616"],"09ab8ee44ca898536770d0106a7c0ee4be4f0eb7":[],"9cf250cb8fdff62f4b753866d44e5bf59bfd1616":["09ab8ee44ca898536770d0106a7c0ee4be4f0eb7","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["09ab8ee44ca898536770d0106a7c0ee4be4f0eb7","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}