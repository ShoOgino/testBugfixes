{"path":"solr/contrib/solr-mr/src/java/org/apache/solr/hadoop/morphline/MorphlineMapRunner#MorphlineMapRunner(Configuration,DocumentLoader,String).mjava","commits":[{"id":"d6e604e9030fb0cabf0c5a85ae6039921a81419c","date":1386009743,"type":0,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/contrib/solr-mr/src/java/org/apache/solr/hadoop/morphline/MorphlineMapRunner#MorphlineMapRunner(Configuration,DocumentLoader,String).mjava","pathOld":"/dev/null","sourceNew":"  public MorphlineMapRunner(Configuration configuration, DocumentLoader loader, String solrHomeDir) throws IOException {\n    if (LOG.isTraceEnabled()) {\n      LOG.trace(\"CWD is {}\", new File(\".\").getCanonicalPath());\n      TreeMap map = new TreeMap();\n      for (Map.Entry<String,String> entry : configuration) {\n        map.put(entry.getKey(), entry.getValue());\n      }\n      LOG.trace(\"Configuration:\\n{}\", Joiner.on(\"\\n\").join(map.entrySet()));\n    }\n    \n    FaultTolerance faultTolerance = new FaultTolerance(\n        configuration.getBoolean(FaultTolerance.IS_PRODUCTION_MODE, false), \n        configuration.getBoolean(FaultTolerance.IS_IGNORING_RECOVERABLE_EXCEPTIONS, false),\n        configuration.get(FaultTolerance.RECOVERABLE_EXCEPTION_CLASSES, SolrServerException.class.getName())        \n        );\n    \n    morphlineContext = new SolrMorphlineContext.Builder()\n      .setDocumentLoader(loader)\n      .setExceptionHandler(faultTolerance)\n      .setMetricRegistry(new MetricRegistry())\n      .build();\n\n    class MySolrLocator extends SolrLocator { // trick to access protected ctor\n      public MySolrLocator(MorphlineContext ctx) {\n        super(ctx);\n      }\n    }\n\n    SolrLocator locator = new MySolrLocator(morphlineContext);\n    locator.setSolrHomeDir(solrHomeDir);\n    schema = locator.getIndexSchema();\n\n    // rebuild context, now with schema\n    morphlineContext = new SolrMorphlineContext.Builder()\n      .setIndexSchema(schema)\n      .setDocumentLoader(loader)\n      .setExceptionHandler(faultTolerance)\n      .setMetricRegistry(morphlineContext.getMetricRegistry())\n      .build();\n\n    String morphlineFile = configuration.get(MORPHLINE_FILE_PARAM);\n    String morphlineId = configuration.get(MORPHLINE_ID_PARAM);\n    if (morphlineFile == null || morphlineFile.trim().length() == 0) {\n      throw new MorphlineCompilationException(\"Missing parameter: \" + MORPHLINE_FILE_PARAM, null);\n    }\n    Map morphlineVariables = new HashMap();\n    for (Map.Entry<String, String> entry : configuration) {\n      String variablePrefix = MORPHLINE_VARIABLE_PARAM + \".\";\n      if (entry.getKey().startsWith(variablePrefix)) {\n        morphlineVariables.put(entry.getKey().substring(variablePrefix.length()), entry.getValue());\n      }\n    }\n    Config override = ConfigFactory.parseMap(morphlineVariables);\n    morphline = new Compiler().compile(new File(morphlineFile), morphlineId, morphlineContext, null, override);\n    morphlineFileAndId = morphlineFile + \"@\" + morphlineId;\n    \n    disableFileOpen = configuration.getBoolean(DISABLE_FILE_OPEN, false);\n    LOG.debug(\"disableFileOpen: {}\", disableFileOpen);\n        \n    commandLineMorphlineHeaders = new HashMap();\n    for (Map.Entry<String,String> entry : configuration) {     \n      if (entry.getKey().startsWith(MORPHLINE_FIELD_PREFIX)) {\n        commandLineMorphlineHeaders.put(entry.getKey().substring(MORPHLINE_FIELD_PREFIX.length()), entry.getValue());\n      }\n    }\n    LOG.debug(\"Headers, including MIME types, passed by force from the CLI to morphline: {}\", commandLineMorphlineHeaders);\n\n    String metricName = MetricRegistry.name(Utils.getShortClassName(getClass()), Metrics.ELAPSED_TIME);\n    this.elapsedTime = morphlineContext.getMetricRegistry().timer(metricName);\n    Notifications.notifyBeginTransaction(morphline);\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"70f91c8322fbffe3a3a897ef20ea19119cac10cd","date":1386170124,"type":5,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/contrib/map-reduce/src/java/org/apache/solr/hadoop/morphline/MorphlineMapRunner#MorphlineMapRunner(Configuration,DocumentLoader,String).mjava","pathOld":"solr/contrib/solr-mr/src/java/org/apache/solr/hadoop/morphline/MorphlineMapRunner#MorphlineMapRunner(Configuration,DocumentLoader,String).mjava","sourceNew":"  public MorphlineMapRunner(Configuration configuration, DocumentLoader loader, String solrHomeDir) throws IOException {\n    if (LOG.isTraceEnabled()) {\n      LOG.trace(\"CWD is {}\", new File(\".\").getCanonicalPath());\n      TreeMap map = new TreeMap();\n      for (Map.Entry<String,String> entry : configuration) {\n        map.put(entry.getKey(), entry.getValue());\n      }\n      LOG.trace(\"Configuration:\\n{}\", Joiner.on(\"\\n\").join(map.entrySet()));\n    }\n    \n    FaultTolerance faultTolerance = new FaultTolerance(\n        configuration.getBoolean(FaultTolerance.IS_PRODUCTION_MODE, false), \n        configuration.getBoolean(FaultTolerance.IS_IGNORING_RECOVERABLE_EXCEPTIONS, false),\n        configuration.get(FaultTolerance.RECOVERABLE_EXCEPTION_CLASSES, SolrServerException.class.getName())        \n        );\n    \n    morphlineContext = new SolrMorphlineContext.Builder()\n      .setDocumentLoader(loader)\n      .setExceptionHandler(faultTolerance)\n      .setMetricRegistry(new MetricRegistry())\n      .build();\n\n    class MySolrLocator extends SolrLocator { // trick to access protected ctor\n      public MySolrLocator(MorphlineContext ctx) {\n        super(ctx);\n      }\n    }\n\n    SolrLocator locator = new MySolrLocator(morphlineContext);\n    locator.setSolrHomeDir(solrHomeDir);\n    schema = locator.getIndexSchema();\n\n    // rebuild context, now with schema\n    morphlineContext = new SolrMorphlineContext.Builder()\n      .setIndexSchema(schema)\n      .setDocumentLoader(loader)\n      .setExceptionHandler(faultTolerance)\n      .setMetricRegistry(morphlineContext.getMetricRegistry())\n      .build();\n\n    String morphlineFile = configuration.get(MORPHLINE_FILE_PARAM);\n    String morphlineId = configuration.get(MORPHLINE_ID_PARAM);\n    if (morphlineFile == null || morphlineFile.trim().length() == 0) {\n      throw new MorphlineCompilationException(\"Missing parameter: \" + MORPHLINE_FILE_PARAM, null);\n    }\n    Map morphlineVariables = new HashMap();\n    for (Map.Entry<String, String> entry : configuration) {\n      String variablePrefix = MORPHLINE_VARIABLE_PARAM + \".\";\n      if (entry.getKey().startsWith(variablePrefix)) {\n        morphlineVariables.put(entry.getKey().substring(variablePrefix.length()), entry.getValue());\n      }\n    }\n    Config override = ConfigFactory.parseMap(morphlineVariables);\n    morphline = new Compiler().compile(new File(morphlineFile), morphlineId, morphlineContext, null, override);\n    morphlineFileAndId = morphlineFile + \"@\" + morphlineId;\n    \n    disableFileOpen = configuration.getBoolean(DISABLE_FILE_OPEN, false);\n    LOG.debug(\"disableFileOpen: {}\", disableFileOpen);\n        \n    commandLineMorphlineHeaders = new HashMap();\n    for (Map.Entry<String,String> entry : configuration) {     \n      if (entry.getKey().startsWith(MORPHLINE_FIELD_PREFIX)) {\n        commandLineMorphlineHeaders.put(entry.getKey().substring(MORPHLINE_FIELD_PREFIX.length()), entry.getValue());\n      }\n    }\n    LOG.debug(\"Headers, including MIME types, passed by force from the CLI to morphline: {}\", commandLineMorphlineHeaders);\n\n    String metricName = MetricRegistry.name(Utils.getShortClassName(getClass()), Metrics.ELAPSED_TIME);\n    this.elapsedTime = morphlineContext.getMetricRegistry().timer(metricName);\n    Notifications.notifyBeginTransaction(morphline);\n  }\n\n","sourceOld":"  public MorphlineMapRunner(Configuration configuration, DocumentLoader loader, String solrHomeDir) throws IOException {\n    if (LOG.isTraceEnabled()) {\n      LOG.trace(\"CWD is {}\", new File(\".\").getCanonicalPath());\n      TreeMap map = new TreeMap();\n      for (Map.Entry<String,String> entry : configuration) {\n        map.put(entry.getKey(), entry.getValue());\n      }\n      LOG.trace(\"Configuration:\\n{}\", Joiner.on(\"\\n\").join(map.entrySet()));\n    }\n    \n    FaultTolerance faultTolerance = new FaultTolerance(\n        configuration.getBoolean(FaultTolerance.IS_PRODUCTION_MODE, false), \n        configuration.getBoolean(FaultTolerance.IS_IGNORING_RECOVERABLE_EXCEPTIONS, false),\n        configuration.get(FaultTolerance.RECOVERABLE_EXCEPTION_CLASSES, SolrServerException.class.getName())        \n        );\n    \n    morphlineContext = new SolrMorphlineContext.Builder()\n      .setDocumentLoader(loader)\n      .setExceptionHandler(faultTolerance)\n      .setMetricRegistry(new MetricRegistry())\n      .build();\n\n    class MySolrLocator extends SolrLocator { // trick to access protected ctor\n      public MySolrLocator(MorphlineContext ctx) {\n        super(ctx);\n      }\n    }\n\n    SolrLocator locator = new MySolrLocator(morphlineContext);\n    locator.setSolrHomeDir(solrHomeDir);\n    schema = locator.getIndexSchema();\n\n    // rebuild context, now with schema\n    morphlineContext = new SolrMorphlineContext.Builder()\n      .setIndexSchema(schema)\n      .setDocumentLoader(loader)\n      .setExceptionHandler(faultTolerance)\n      .setMetricRegistry(morphlineContext.getMetricRegistry())\n      .build();\n\n    String morphlineFile = configuration.get(MORPHLINE_FILE_PARAM);\n    String morphlineId = configuration.get(MORPHLINE_ID_PARAM);\n    if (morphlineFile == null || morphlineFile.trim().length() == 0) {\n      throw new MorphlineCompilationException(\"Missing parameter: \" + MORPHLINE_FILE_PARAM, null);\n    }\n    Map morphlineVariables = new HashMap();\n    for (Map.Entry<String, String> entry : configuration) {\n      String variablePrefix = MORPHLINE_VARIABLE_PARAM + \".\";\n      if (entry.getKey().startsWith(variablePrefix)) {\n        morphlineVariables.put(entry.getKey().substring(variablePrefix.length()), entry.getValue());\n      }\n    }\n    Config override = ConfigFactory.parseMap(morphlineVariables);\n    morphline = new Compiler().compile(new File(morphlineFile), morphlineId, morphlineContext, null, override);\n    morphlineFileAndId = morphlineFile + \"@\" + morphlineId;\n    \n    disableFileOpen = configuration.getBoolean(DISABLE_FILE_OPEN, false);\n    LOG.debug(\"disableFileOpen: {}\", disableFileOpen);\n        \n    commandLineMorphlineHeaders = new HashMap();\n    for (Map.Entry<String,String> entry : configuration) {     \n      if (entry.getKey().startsWith(MORPHLINE_FIELD_PREFIX)) {\n        commandLineMorphlineHeaders.put(entry.getKey().substring(MORPHLINE_FIELD_PREFIX.length()), entry.getValue());\n      }\n    }\n    LOG.debug(\"Headers, including MIME types, passed by force from the CLI to morphline: {}\", commandLineMorphlineHeaders);\n\n    String metricName = MetricRegistry.name(Utils.getShortClassName(getClass()), Metrics.ELAPSED_TIME);\n    this.elapsedTime = morphlineContext.getMetricRegistry().timer(metricName);\n    Notifications.notifyBeginTransaction(morphline);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"70f91c8322fbffe3a3a897ef20ea19119cac10cd":["d6e604e9030fb0cabf0c5a85ae6039921a81419c"],"d6e604e9030fb0cabf0c5a85ae6039921a81419c":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["70f91c8322fbffe3a3a897ef20ea19119cac10cd"]},"commit2Childs":{"70f91c8322fbffe3a3a897ef20ea19119cac10cd":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"d6e604e9030fb0cabf0c5a85ae6039921a81419c":["70f91c8322fbffe3a3a897ef20ea19119cac10cd"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["d6e604e9030fb0cabf0c5a85ae6039921a81419c"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}