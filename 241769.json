{"path":"solr/core/src/test/org/apache/solr/cloud/TestRebalanceLeaders#concentratePropByRestartingJettys().mjava","commits":[{"id":"73fd358e8ec697393d56617f4d9cedaca74dca14","date":1547954439,"type":0,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/cloud/TestRebalanceLeaders#concentratePropByRestartingJettys().mjava","pathOld":"/dev/null","sourceNew":"  // Intentionally un-balance the property to insure that BALANCESHARDUNIQUE does its job. There was an odd case\n  // where rebalancing didn't work very well if the Solr nodes were stopped and restarted that worked perfectly\n  // when if the nodes were _not_ restarted in the test. So we have to test that too.\n  private void concentratePropByRestartingJettys() throws Exception {\n\n    List<JettySolrRunner> jettys = new ArrayList<>(cluster.getJettySolrRunners());\n    Collections.shuffle(jettys, random());\n    jettys.remove(random().nextInt(jettys.size()));\n    // Now we have a list of jettys, and there is one missing. Stop all of the remaining jettys, then start them again\n    // to concentrate the leaders. It's not necessary that all shards have a leader.\n\n    for (JettySolrRunner jetty : jettys) {\n      cluster.stopJettySolrRunner(jetty);\n      cluster.waitForJettyToStop(jetty);\n    }\n    checkReplicasInactive(jettys);\n\n    for (int idx = 0; idx < jettys.size(); ++idx) {\n      cluster.startJettySolrRunner(jettys.get(idx));\n    }\n    cluster.waitForAllNodes(60);\n    // the nodes are present, but are all replica active?\n    checkAllReplicasActive();\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"c89f1ef80a9432f4eabaeda9a1e135cd72e60836","date":1547972642,"type":0,"author":"Tommaso Teofili","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/cloud/TestRebalanceLeaders#concentratePropByRestartingJettys().mjava","pathOld":"/dev/null","sourceNew":"  // Intentionally un-balance the property to insure that BALANCESHARDUNIQUE does its job. There was an odd case\n  // where rebalancing didn't work very well if the Solr nodes were stopped and restarted that worked perfectly\n  // when if the nodes were _not_ restarted in the test. So we have to test that too.\n  private void concentratePropByRestartingJettys() throws Exception {\n\n    List<JettySolrRunner> jettys = new ArrayList<>(cluster.getJettySolrRunners());\n    Collections.shuffle(jettys, random());\n    jettys.remove(random().nextInt(jettys.size()));\n    // Now we have a list of jettys, and there is one missing. Stop all of the remaining jettys, then start them again\n    // to concentrate the leaders. It's not necessary that all shards have a leader.\n\n    for (JettySolrRunner jetty : jettys) {\n      cluster.stopJettySolrRunner(jetty);\n      cluster.waitForJettyToStop(jetty);\n    }\n    checkReplicasInactive(jettys);\n\n    for (int idx = 0; idx < jettys.size(); ++idx) {\n      cluster.startJettySolrRunner(jettys.get(idx));\n    }\n    cluster.waitForAllNodes(60);\n    // the nodes are present, but are all replica active?\n    checkAllReplicasActive();\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"c89f1ef80a9432f4eabaeda9a1e135cd72e60836":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","73fd358e8ec697393d56617f4d9cedaca74dca14"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"73fd358e8ec697393d56617f4d9cedaca74dca14":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["73fd358e8ec697393d56617f4d9cedaca74dca14"]},"commit2Childs":{"c89f1ef80a9432f4eabaeda9a1e135cd72e60836":[],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["c89f1ef80a9432f4eabaeda9a1e135cd72e60836","73fd358e8ec697393d56617f4d9cedaca74dca14"],"73fd358e8ec697393d56617f4d9cedaca74dca14":["c89f1ef80a9432f4eabaeda9a1e135cd72e60836","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["c89f1ef80a9432f4eabaeda9a1e135cd72e60836","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}