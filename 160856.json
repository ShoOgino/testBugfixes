{"path":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testMultiValuedBucketReHashing().mjava","commits":[{"id":"c5ec3c464e62e57df598ba20e010313bf6d5d7b4","date":1589998565,"type":0,"author":"Chris Hostetter","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testMultiValuedBucketReHashing().mjava","pathOld":"/dev/null","sourceNew":"  public void testMultiValuedBucketReHashing() throws Exception {\n    Client client = Client.localClient();\n    client.deleteByQuery(\"*:*\", null);\n    // we want a domain with a small number of documents, and more facet (point) values then docs so\n    // that we force dvhash to increase the number of slots via resize...\n    // (NOTE: normal resizing won't happen w/o at least 1024 slots, but test static overrides this to '2')\n    client.add(sdoc(\"id\", \"1\",\n                    \"f_sd\", \"qqq\",\n                    \"f_ids\", \"4\", \"f_ids\", \"2\", \"f_ids\", \"999\",\n                    \"x_ids\", \"3\", \"x_ids\", \"5\", \"x_ids\", \"7\",\n                    \"z_ids\", \"42\"), null);\n    client.add(sdoc(\"id\", \"2\",\n                    \"f_sd\", \"nnn\",\n                    \"f_ids\", \"44\", \"f_ids\", \"22\", \"f_ids\", \"999\",\n                    \"x_ids\", \"33\", \"x_ids\", \"55\", \"x_ids\", \"77\",\n                    \"z_ids\", \"666\"), null);\n    client.add(sdoc(\"id\", \"3\",\n                    \"f_sd\", \"ggg\",\n                    \"f_ids\", \"444\", \"f_ids\", \"222\", \"f_ids\", \"999\",\n                    \"x_ids\", \"333\", \"x_ids\", \"555\", \"x_ids\", \"777\",\n                    \"z_ids\", \"1010101\"), null);\n    client.commit();\n\n    // faceting on a multivalued point field sorting on a stat...\n    assertJQ(req(\"rows\", \"0\", \"q\", \"id:[1 TO 2]\", \"json.facet\"\n                 , \"{ f : { type: terms, field: f_ids, limit: 1, sort: 'x desc', \"\n                 + \"        facet: { x : 'sum(x_ids)', z : 'min(z_ids)' } } }\")\n             , \"response/numFound==2\"\n             , \"facets/count==2\"\n             , \"facets/f=={buckets:[{ val:999, count:2, x:180.0, z:42 }]}\"\n             );\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"c5ec3c464e62e57df598ba20e010313bf6d5d7b4":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["c5ec3c464e62e57df598ba20e010313bf6d5d7b4"]},"commit2Childs":{"c5ec3c464e62e57df598ba20e010313bf6d5d7b4":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["c5ec3c464e62e57df598ba20e010313bf6d5d7b4"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}