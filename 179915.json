{"path":"solr/core/src/java/org/apache/solr/filestore/PackageStoreAPI.FSWrite#delete(SolrQueryRequest,SolrQueryResponse).mjava","commits":[{"id":"64ec73f19361ec6354e55c878a349735fa8bc52e","date":1596183798,"type":0,"author":"Marcus","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/filestore/PackageStoreAPI.FSWrite#delete(SolrQueryRequest,SolrQueryResponse).mjava","pathOld":"/dev/null","sourceNew":"    @EndPoint(\n            path = \"/cluster/files/*\",\n            method = SolrRequest.METHOD.DELETE,\n            permission = PermissionNameProvider.Name.FILESTORE_WRITE_PERM)\n    public void delete(SolrQueryRequest req, SolrQueryResponse rsp) {\n      if (!coreContainer.getPackageLoader().getPackageAPI().isEnabled()) {\n        throw new RuntimeException(PackageAPI.ERR_MSG);\n      }\n\n      try {\n        coreContainer.getZkController().getZkClient().create(TMP_ZK_NODE, \"true\".getBytes(UTF_8),\n                CreateMode.EPHEMERAL, true);\n        String path = req.getPathTemplateValues().get(\"*\");\n        validateName(path, true);\n        if(coreContainer.getPackageLoader().getPackageAPI().isJarInuse(path)) {\n          throw new SolrException(SolrException.ErrorCode.BAD_REQUEST, \"jar in use, can't delete\");\n        }\n        PackageStore.FileType type = packageStore.getType(path, true);\n        if(type == PackageStore.FileType.NOFILE) {\n          throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,  \"Path does not exist: \" + path);\n        }\n        packageStore.delete(path);\n      } catch (SolrException e){\n        throw e;\n      } catch (Exception e) {\n        log.error(\"Unknown error\",e);\n        throw new SolrException(SolrException.ErrorCode.SERVER_ERROR, e);\n      }  finally {\n        try {\n          coreContainer.getZkController().getZkClient().delete(TMP_ZK_NODE, -1, true);\n        } catch (Exception e) {\n          log.error(\"Unexpected error  \", e);\n        }\n\n      }\n    }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"64ec73f19361ec6354e55c878a349735fa8bc52e":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["64ec73f19361ec6354e55c878a349735fa8bc52e"]},"commit2Childs":{"64ec73f19361ec6354e55c878a349735fa8bc52e":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["64ec73f19361ec6354e55c878a349735fa8bc52e"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}