{"path":"solr/core/src/test/org/apache/solr/update/SolrIndexSplitterTest#doTestSplitByCores(SolrIndexSplitter.SplitMethod).mjava","commits":[{"id":"20c968c14aace7cf49843bf2c1fafc7fd3845659","date":1533133859,"type":0,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/SolrIndexSplitterTest#doTestSplitByCores(SolrIndexSplitter.SplitMethod).mjava","pathOld":"/dev/null","sourceNew":"  private void doTestSplitByCores(SolrIndexSplitter.SplitMethod splitMethod) throws Exception {\n    // add three docs and 1 delete\n    String id1 = \"dorothy\";\n    assertU(adoc(\"id\", id1));\n    String id2 = \"kansas\";\n    assertU(adoc(\"id\", id2));\n    String id3 = \"wizard\";\n    assertU(adoc(\"id\", id3));\n    assertU(commit());\n    assertJQ(req(\"q\", \"*:*\"), \"/response/numFound==3\");\n    assertU(delI(\"wizard\"));\n    assertU(commit());\n    assertJQ(req(\"q\", \"*:*\"), \"/response/numFound==2\");\n    List<DocRouter.Range> ranges = getRanges(id1, id2);\n\n    SolrCore core1 = null, core2 = null;\n    try {\n\n      core1 = h.getCoreContainer().create(\"split1\",\n          ImmutableMap.of(\"dataDir\", indexDir1.getAbsolutePath(), \"configSet\", \"cloud-minimal\"));\n      core2 = h.getCoreContainer().create(\"split2\",\n          ImmutableMap.of(\"dataDir\", indexDir2.getAbsolutePath(), \"configSet\", \"cloud-minimal\"));\n\n      LocalSolrQueryRequest request = null;\n      try {\n        request = lrf.makeRequest(\"q\", \"dummy\");\n        SolrQueryResponse rsp = new SolrQueryResponse();\n        SplitIndexCommand command = new SplitIndexCommand(request, rsp, null, Lists.newArrayList(core1, core2), ranges,\n            new PlainIdRouter(), null, null, splitMethod);\n        doSplit(command);\n      } finally {\n        if (request != null) request.close();\n      }\n      @SuppressWarnings(\"resource\")\n      final EmbeddedSolrServer server1 = new EmbeddedSolrServer(h.getCoreContainer(), \"split1\");\n      @SuppressWarnings(\"resource\")\n      final EmbeddedSolrServer server2 = new EmbeddedSolrServer(h.getCoreContainer(), \"split2\");\n      server1.commit(true, true);\n      server2.commit(true, true);\n      assertEquals(\"id:dorothy should be present in split index1\", 1, server1.query(new SolrQuery(\"id:dorothy\")).getResults().getNumFound());\n      assertEquals(\"id:kansas should not be present in split index1\", 0, server1.query(new SolrQuery(\"id:kansas\")).getResults().getNumFound());\n      assertEquals(\"id:dorothy should not be present in split index2\", 0, server2.query(new SolrQuery(\"id:dorothy\")).getResults().getNumFound());\n      assertEquals(\"id:kansas should be present in split index2\", 1, server2.query(new SolrQuery(\"id:kansas\")).getResults().getNumFound());\n    } finally {\n      h.getCoreContainer().unload(\"split2\");\n      h.getCoreContainer().unload(\"split1\");\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"20c968c14aace7cf49843bf2c1fafc7fd3845659":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["20c968c14aace7cf49843bf2c1fafc7fd3845659"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["20c968c14aace7cf49843bf2c1fafc7fd3845659"],"20c968c14aace7cf49843bf2c1fafc7fd3845659":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}