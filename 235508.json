{"path":"lucene/luke/src/java/org/apache/lucene/luke/app/desktop/components/dialog/menubar/CreateIndexDialogFactory.ListenerFunctions#createIndex(ActionEvent).mjava","commits":[{"id":"f554f2d9b5456248ab6467b9d4f6015686797a6c","date":1554891357,"type":0,"author":"Tomoko Uchida","isMerge":false,"pathNew":"lucene/luke/src/java/org/apache/lucene/luke/app/desktop/components/dialog/menubar/CreateIndexDialogFactory.ListenerFunctions#createIndex(ActionEvent).mjava","pathOld":"/dev/null","sourceNew":"    void createIndex(ActionEvent e) {\n      Path path = Paths.get(locationTF.getText(), dirnameTF.getText());\n      if (Files.exists(path)) {\n        String message = \"The directory \" + path.toAbsolutePath().toString() + \" already exists.\";\n        JOptionPane.showMessageDialog(dialog, message, \"Empty index path\", JOptionPane.ERROR_MESSAGE);\n      } else {\n        // create new index asynchronously\n        ExecutorService executor = Executors.newFixedThreadPool(1, new NamedThreadFactory(\"create-index-dialog\"));\n\n        SwingWorker<Void, Void> task = new SwingWorker<Void, Void>() {\n\n          @Override\n          protected Void doInBackground() throws Exception {\n            setProgress(0);\n            indicatorLbl.setVisible(true);\n            createBtn.setEnabled(false);\n\n            try {\n              Directory dir = FSDirectory.open(path);\n              IndexTools toolsModel = new IndexToolsFactory().newInstance(dir);\n\n              if (dataDirTF.getText().isEmpty()) {\n                // without sample documents\n                toolsModel.createNewIndex();\n              } else {\n                // with sample documents\n                Path dataPath = Paths.get(dataDirTF.getText());\n                toolsModel.createNewIndex(dataPath.toAbsolutePath().toString());\n              }\n\n              indexHandler.open(path.toAbsolutePath().toString(), null, false, false, false);\n              prefs.addHistory(path.toAbsolutePath().toString());\n\n              dirnameTF.setText(\"\");\n              closeDialog();\n            } catch (Exception ex) {\n              // cleanup\n              try {\n                Files.walkFileTree(path, new SimpleFileVisitor<Path>() {\n                  @Override\n                  public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n                    Files.delete(file);\n                    return FileVisitResult.CONTINUE;\n                  }\n                });\n                Files.deleteIfExists(path);\n              } catch (IOException ex2) {\n              }\n\n              log.error(\"Cannot create index\", ex);\n              String message = \"See Logs tab or log file for more details.\";\n              JOptionPane.showMessageDialog(dialog, message, \"Cannot create index\", JOptionPane.ERROR_MESSAGE);\n            } finally {\n              setProgress(100);\n            }\n            return null;\n          }\n\n          @Override\n          protected void done() {\n            indicatorLbl.setVisible(false);\n            createBtn.setEnabled(true);\n          }\n        };\n\n        executor.submit(task);\n        executor.shutdown();\n      }\n    }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"f554f2d9b5456248ab6467b9d4f6015686797a6c":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["f554f2d9b5456248ab6467b9d4f6015686797a6c"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["f554f2d9b5456248ab6467b9d4f6015686797a6c"],"f554f2d9b5456248ab6467b9d4f6015686797a6c":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}