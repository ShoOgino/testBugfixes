{"path":"solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger#doInc(SolrInputDocument,SolrInputField,Object).mjava","commits":[{"id":"2d3b450958a83a29a16e492fbff9d094a9a571b6","date":1421525067,"type":1,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger#doInc(SolrInputDocument,SolrInputField,Object).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/processor/DistributedUpdateProcessor#doInc(SolrInputDocument,IndexSchema,SolrInputField,Object).mjava","sourceNew":"  protected void doInc(SolrInputDocument toDoc, SolrInputField sif, Object fieldVal) {\n    SolrInputField numericField = toDoc.get(sif.getName());\n    if (numericField == null) {\n      toDoc.setField(sif.getName(),  fieldVal, sif.getBoost());\n    } else {\n      // TODO: fieldtype needs externalToObject?\n      String oldValS = numericField.getFirstValue().toString();\n      SchemaField sf = schema.getField(sif.getName());\n      BytesRefBuilder term = new BytesRefBuilder();\n      sf.getType().readableToIndexed(oldValS, term);\n      Object oldVal = sf.getType().toObject(sf, term.get());\n\n      String fieldValS = fieldVal.toString();\n      Number result;\n      if (oldVal instanceof Long) {\n        result = ((Long) oldVal).longValue() + Long.parseLong(fieldValS);\n      } else if (oldVal instanceof Float) {\n        result = ((Float) oldVal).floatValue() + Float.parseFloat(fieldValS);\n      } else if (oldVal instanceof Double) {\n        result = ((Double) oldVal).doubleValue() + Double.parseDouble(fieldValS);\n      } else {\n        // int, short, byte\n        result = ((Integer) oldVal).intValue() + Integer.parseInt(fieldValS);\n      }\n\n      toDoc.setField(sif.getName(),  result, sif.getBoost());\n    }\n  }\n\n","sourceOld":"  private void doInc(SolrInputDocument oldDoc, IndexSchema schema, SolrInputField sif, Object fieldVal) {\n    SolrInputField numericField = oldDoc.get(sif.getName());\n    if (numericField == null) {\n      oldDoc.setField(sif.getName(),  fieldVal, sif.getBoost());\n    } else {\n      // TODO: fieldtype needs externalToObject?\n      String oldValS = numericField.getFirstValue().toString();\n      SchemaField sf = schema.getField(sif.getName());\n      BytesRefBuilder term = new BytesRefBuilder();\n      sf.getType().readableToIndexed(oldValS, term);\n      Object oldVal = sf.getType().toObject(sf, term.get());\n\n      String fieldValS = fieldVal.toString();\n      Number result;\n      if (oldVal instanceof Long) {\n        result = ((Long) oldVal).longValue() + Long.parseLong(fieldValS);\n      } else if (oldVal instanceof Float) {\n        result = ((Float) oldVal).floatValue() + Float.parseFloat(fieldValS);\n      } else if (oldVal instanceof Double) {\n        result = ((Double) oldVal).doubleValue() + Double.parseDouble(fieldValS);\n      } else {\n        // int, short, byte\n        result = ((Integer) oldVal).intValue() + Integer.parseInt(fieldValS);\n      }\n\n      oldDoc.setField(sif.getName(),  result, sif.getBoost());\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"acd9883560fd89e6448b2b447302fe543040cd4f","date":1488478696,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger#doInc(SolrInputDocument,SolrInputField,Object).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger#doInc(SolrInputDocument,SolrInputField,Object).mjava","sourceNew":"  protected void doInc(SolrInputDocument toDoc, SolrInputField sif, Object fieldVal) {\n    SolrInputField numericField = toDoc.get(sif.getName());\n    if (numericField == null) {\n      toDoc.setField(sif.getName(),  fieldVal);\n    } else {\n      // TODO: fieldtype needs externalToObject?\n      String oldValS = numericField.getFirstValue().toString();\n      SchemaField sf = schema.getField(sif.getName());\n      BytesRefBuilder term = new BytesRefBuilder();\n      sf.getType().readableToIndexed(oldValS, term);\n      Object oldVal = sf.getType().toObject(sf, term.get());\n\n      String fieldValS = fieldVal.toString();\n      Number result;\n      if (oldVal instanceof Long) {\n        result = ((Long) oldVal).longValue() + Long.parseLong(fieldValS);\n      } else if (oldVal instanceof Float) {\n        result = ((Float) oldVal).floatValue() + Float.parseFloat(fieldValS);\n      } else if (oldVal instanceof Double) {\n        result = ((Double) oldVal).doubleValue() + Double.parseDouble(fieldValS);\n      } else {\n        // int, short, byte\n        result = ((Integer) oldVal).intValue() + Integer.parseInt(fieldValS);\n      }\n\n      toDoc.setField(sif.getName(),  result);\n    }\n  }\n\n","sourceOld":"  protected void doInc(SolrInputDocument toDoc, SolrInputField sif, Object fieldVal) {\n    SolrInputField numericField = toDoc.get(sif.getName());\n    if (numericField == null) {\n      toDoc.setField(sif.getName(),  fieldVal, sif.getBoost());\n    } else {\n      // TODO: fieldtype needs externalToObject?\n      String oldValS = numericField.getFirstValue().toString();\n      SchemaField sf = schema.getField(sif.getName());\n      BytesRefBuilder term = new BytesRefBuilder();\n      sf.getType().readableToIndexed(oldValS, term);\n      Object oldVal = sf.getType().toObject(sf, term.get());\n\n      String fieldValS = fieldVal.toString();\n      Number result;\n      if (oldVal instanceof Long) {\n        result = ((Long) oldVal).longValue() + Long.parseLong(fieldValS);\n      } else if (oldVal instanceof Float) {\n        result = ((Float) oldVal).floatValue() + Float.parseFloat(fieldValS);\n      } else if (oldVal instanceof Double) {\n        result = ((Double) oldVal).doubleValue() + Double.parseDouble(fieldValS);\n      } else {\n        // int, short, byte\n        result = ((Integer) oldVal).intValue() + Integer.parseInt(fieldValS);\n      }\n\n      toDoc.setField(sif.getName(),  result, sif.getBoost());\n    }\n  }\n\n","bugFix":null,"bugIntro":["98d250aa216a7b207d8015ed03e2f115f6bcb596"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"98d250aa216a7b207d8015ed03e2f115f6bcb596","date":1489410968,"type":3,"author":"Ishan Chattopadhyaya","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger#doInc(SolrInputDocument,SolrInputField,Object).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger#doInc(SolrInputDocument,SolrInputField,Object).mjava","sourceNew":"  protected void doInc(SolrInputDocument toDoc, SolrInputField sif, Object fieldVal) {\n    SolrInputField numericField = toDoc.get(sif.getName());\n    SchemaField sf = schema.getField(sif.getName());\n    if (numericField != null || sf.getDefaultValue() != null) {\n      // TODO: fieldtype needs externalToObject?\n      String oldValS = (numericField != null) ?\n          numericField.getFirstValue().toString(): sf.getDefaultValue().toString();\n      BytesRefBuilder term = new BytesRefBuilder();\n      sf.getType().readableToIndexed(oldValS, term);\n      Object oldVal = sf.getType().toObject(sf, term.get());\n\n      String fieldValS = fieldVal.toString();\n      Number result;\n      if (oldVal instanceof Long) {\n        result = ((Long) oldVal).longValue() + Long.parseLong(fieldValS);\n      } else if (oldVal instanceof Float) {\n        result = ((Float) oldVal).floatValue() + Float.parseFloat(fieldValS);\n      } else if (oldVal instanceof Double) {\n        result = ((Double) oldVal).doubleValue() + Double.parseDouble(fieldValS);\n      } else {\n        // int, short, byte\n        result = ((Integer) oldVal).intValue() + Integer.parseInt(fieldValS);\n      }\n\n      toDoc.setField(sif.getName(),  result);\n    } else {\n      toDoc.setField(sif.getName(), fieldVal);\n    }\n  }\n\n","sourceOld":"  protected void doInc(SolrInputDocument toDoc, SolrInputField sif, Object fieldVal) {\n    SolrInputField numericField = toDoc.get(sif.getName());\n    if (numericField == null) {\n      toDoc.setField(sif.getName(),  fieldVal);\n    } else {\n      // TODO: fieldtype needs externalToObject?\n      String oldValS = numericField.getFirstValue().toString();\n      SchemaField sf = schema.getField(sif.getName());\n      BytesRefBuilder term = new BytesRefBuilder();\n      sf.getType().readableToIndexed(oldValS, term);\n      Object oldVal = sf.getType().toObject(sf, term.get());\n\n      String fieldValS = fieldVal.toString();\n      Number result;\n      if (oldVal instanceof Long) {\n        result = ((Long) oldVal).longValue() + Long.parseLong(fieldValS);\n      } else if (oldVal instanceof Float) {\n        result = ((Float) oldVal).floatValue() + Float.parseFloat(fieldValS);\n      } else if (oldVal instanceof Double) {\n        result = ((Double) oldVal).doubleValue() + Double.parseDouble(fieldValS);\n      } else {\n        // int, short, byte\n        result = ((Integer) oldVal).intValue() + Integer.parseInt(fieldValS);\n      }\n\n      toDoc.setField(sif.getName(),  result);\n    }\n  }\n\n","bugFix":["acd9883560fd89e6448b2b447302fe543040cd4f","3aa8a7a6dfbdba53bcf332c8a2154c3426a932d7"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"2d3b450958a83a29a16e492fbff9d094a9a571b6":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"98d250aa216a7b207d8015ed03e2f115f6bcb596":["acd9883560fd89e6448b2b447302fe543040cd4f"],"acd9883560fd89e6448b2b447302fe543040cd4f":["2d3b450958a83a29a16e492fbff9d094a9a571b6"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["98d250aa216a7b207d8015ed03e2f115f6bcb596"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["2d3b450958a83a29a16e492fbff9d094a9a571b6"],"2d3b450958a83a29a16e492fbff9d094a9a571b6":["acd9883560fd89e6448b2b447302fe543040cd4f"],"98d250aa216a7b207d8015ed03e2f115f6bcb596":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"acd9883560fd89e6448b2b447302fe543040cd4f":["98d250aa216a7b207d8015ed03e2f115f6bcb596"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}