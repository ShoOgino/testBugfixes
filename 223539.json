{"path":"solr/core/src/test/org/apache/solr/cloud/RollingRestartTest#waitUntilOverseerDesignateIsLeader(SolrZkClient,List[String],int).mjava","commits":[{"id":"7d996c36bf85996da326201b915c87d41449d7f5","date":1403084374,"type":0,"author":"Noble Paul","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/cloud/RollingRestartTest#waitUntilOverseerDesignateIsLeader(SolrZkClient,List[String],int).mjava","pathOld":"/dev/null","sourceNew":"  static boolean waitUntilOverseerDesignateIsLeader(SolrZkClient testZkClient, List<String> overseerDesignates, int timeoutInSeconds) throws KeeperException, InterruptedException {\n    long now = System.nanoTime();\n    long timeout = now + TimeUnit.NANOSECONDS.convert(timeoutInSeconds, TimeUnit.SECONDS);\n    boolean firstTime = true;\n    int stableCheckTimeout = 2000;\n    while (System.nanoTime() < timeout) {\n      String newLeader = OverseerCollectionProcessor.getLeaderNode(testZkClient);\n      if (!overseerDesignates.contains(newLeader)) {\n        Thread.sleep(500);\n      } else {\n        if (firstTime)  {\n          firstTime = false;\n          Thread.sleep(stableCheckTimeout);\n        } else  {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e57c73924f3b8c19defa62e96bfa34a4922d49c2","date":1403106358,"type":0,"author":"Michael McCandless","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/cloud/RollingRestartTest#waitUntilOverseerDesignateIsLeader(SolrZkClient,List[String],int).mjava","pathOld":"/dev/null","sourceNew":"  static boolean waitUntilOverseerDesignateIsLeader(SolrZkClient testZkClient, List<String> overseerDesignates, int timeoutInSeconds) throws KeeperException, InterruptedException {\n    long now = System.nanoTime();\n    long timeout = now + TimeUnit.NANOSECONDS.convert(timeoutInSeconds, TimeUnit.SECONDS);\n    boolean firstTime = true;\n    int stableCheckTimeout = 2000;\n    while (System.nanoTime() < timeout) {\n      String newLeader = OverseerCollectionProcessor.getLeaderNode(testZkClient);\n      if (!overseerDesignates.contains(newLeader)) {\n        Thread.sleep(500);\n      } else {\n        if (firstTime)  {\n          firstTime = false;\n          Thread.sleep(stableCheckTimeout);\n        } else  {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6e48507d567e98bb5eb2343b1a17f7d27435807f","date":1406016099,"type":5,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/cloud/RollingRestartTest#waitUntilOverseerDesignateIsLeader(SolrZkClient,List[String],long).mjava","pathOld":"solr/core/src/test/org/apache/solr/cloud/RollingRestartTest#waitUntilOverseerDesignateIsLeader(SolrZkClient,List[String],int).mjava","sourceNew":"  static boolean waitUntilOverseerDesignateIsLeader(SolrZkClient testZkClient, List<String> overseerDesignates, long timeoutInNanos) throws KeeperException, InterruptedException {\n    long now = System.nanoTime();\n    long maxTimeout = now + timeoutInNanos; // the maximum amount of time we're willing to wait to see the designate as leader\n    long timeout = now + TimeUnit.NANOSECONDS.convert(60, TimeUnit.SECONDS);\n    boolean firstTime = true;\n    int stableCheckTimeout = 2000;\n    String oldleader = null;\n    while (System.nanoTime() < timeout && System.nanoTime() < maxTimeout) {\n      String newLeader = OverseerCollectionProcessor.getLeaderNode(testZkClient);\n      if (newLeader != null && !newLeader.equals(oldleader)) {\n        // the leaders have changed, let's move the timeout further\n        timeout = System.nanoTime() + TimeUnit.NANOSECONDS.convert(60, TimeUnit.SECONDS);\n        log.info(\"oldLeader={} newLeader={} - Advancing timeout to: {}\", oldleader, newLeader, timeout);\n        oldleader = newLeader;\n      }\n      if (!overseerDesignates.contains(newLeader)) {\n        Thread.sleep(500);\n      } else {\n        if (firstTime) {\n          firstTime = false;\n          Thread.sleep(stableCheckTimeout);\n        } else {\n          return true;\n        }\n      }\n    }\n    if (System.nanoTime() < maxTimeout) {\n      log.error(\"Max wait time exceeded\");\n    }\n    return false;\n  }\n\n","sourceOld":"  static boolean waitUntilOverseerDesignateIsLeader(SolrZkClient testZkClient, List<String> overseerDesignates, int timeoutInSeconds) throws KeeperException, InterruptedException {\n    long now = System.nanoTime();\n    long timeout = now + TimeUnit.NANOSECONDS.convert(timeoutInSeconds, TimeUnit.SECONDS);\n    boolean firstTime = true;\n    int stableCheckTimeout = 2000;\n    while (System.nanoTime() < timeout) {\n      String newLeader = OverseerCollectionProcessor.getLeaderNode(testZkClient);\n      if (!overseerDesignates.contains(newLeader)) {\n        Thread.sleep(500);\n      } else {\n        if (firstTime)  {\n          firstTime = false;\n          Thread.sleep(stableCheckTimeout);\n        } else  {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"7d996c36bf85996da326201b915c87d41449d7f5":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"6e48507d567e98bb5eb2343b1a17f7d27435807f":["7d996c36bf85996da326201b915c87d41449d7f5"],"e57c73924f3b8c19defa62e96bfa34a4922d49c2":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","7d996c36bf85996da326201b915c87d41449d7f5"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["6e48507d567e98bb5eb2343b1a17f7d27435807f"]},"commit2Childs":{"7d996c36bf85996da326201b915c87d41449d7f5":["6e48507d567e98bb5eb2343b1a17f7d27435807f","e57c73924f3b8c19defa62e96bfa34a4922d49c2"],"6e48507d567e98bb5eb2343b1a17f7d27435807f":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"e57c73924f3b8c19defa62e96bfa34a4922d49c2":[],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["7d996c36bf85996da326201b915c87d41449d7f5","e57c73924f3b8c19defa62e96bfa34a4922d49c2"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["e57c73924f3b8c19defa62e96bfa34a4922d49c2","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}