{"path":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","commits":[{"id":"4c18a95e9168a30be855f5d5e7d61a863186fdc5","date":1415142581,"type":0,"author":"Chris M. Hostetter","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrServer server = getSolrServer();\n\n    // Empty the database...\n    server.deleteByQuery(\"*:*\");// delete everything!\n    server.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of wether any docs in index\n    if (random().nextBoolean()) {\n      server.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      server.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"60e4efc947592a22b8b79c8b7a18bfb8f1eb89b9","date":1419431639,"type":3,"author":"Steven Rowe","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","sourceNew":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrServer server = getSolrServer();\n\n    // Empty the database...\n    server.deleteByQuery(\"*:*\");// delete everything!\n    server.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      server.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      server.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrServer server = getSolrServer();\n\n    // Empty the database...\n    server.deleteByQuery(\"*:*\");// delete everything!\n    server.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of wether any docs in index\n    if (random().nextBoolean()) {\n      server.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      server.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"bafca15d8e408346a67f4282ad1143b88023893b","date":1420034748,"type":3,"author":"Alan Woodward","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","sourceNew":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrClient client = getSolrClient();\n\n    // Empty the database...\n    client.deleteByQuery(\"*:*\");// delete everything!\n    client.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      client.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      client.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrServer server = getSolrServer();\n\n    // Empty the database...\n    server.deleteByQuery(\"*:*\");// delete everything!\n    server.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      server.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      server.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      server.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d1a307447328c95a00248512b40d7a5ff12ecd6a","date":1564817449,"type":3,"author":"Munendra S N","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","sourceNew":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrClient client = getSolrClient();\n\n    // Empty the database...\n    client.deleteByQuery(\"*:*\");// delete everything!\n    client.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      client.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      client.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n\n    SolrException e = expectThrows(SolrException.class, () -> client.query(query));\n    assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n    assertTrue(e.getMessage().contains(\"is not currently supported\"));\n    assertTrue(e.getMessage().contains(\"boolean\"));\n\n    // asking for multiple stat tags -- see SOLR-6663\n    SolrQuery query2 = new SolrQuery(\"*:*\");\n    query2.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query2.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query2.setFacetMinCount(0);\n    query2.setRows(0);\n\n    e = expectThrows(SolrException.class, () -> client.query(query2));\n    assertEquals(400, e.code());\n    assertTrue(e.getMessage().contains(\"stats\"));\n    assertTrue(e.getMessage().contains(\"comma\"));\n    assertTrue(e.getMessage().contains(\"tag\"));\n\n    // text field\n    SolrQuery query3 = new SolrQuery(\"*:*\");\n    query3.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query3.addGetFieldStatistics(\"{!tag=s1}features\");\n    query3.setFacetMinCount(0);\n    query3.setRows(0);\n    e = expectThrows(SolrException.class, () -> client.query(query3));\n    assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n    assertTrue(e.getMessage().contains(\"is not currently supported\"));\n    assertTrue(e.getMessage().contains(\"text_general\"));\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrClient client = getSolrClient();\n\n    // Empty the database...\n    client.deleteByQuery(\"*:*\");// delete everything!\n    client.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      client.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      client.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f8061ddd97f3352007d927dae445884a6f3d857b","date":1564988276,"type":3,"author":"Atri Sharma","isMerge":true,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","sourceNew":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrClient client = getSolrClient();\n\n    // Empty the database...\n    client.deleteByQuery(\"*:*\");// delete everything!\n    client.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      client.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      client.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n\n    SolrException e = expectThrows(SolrException.class, () -> client.query(query));\n    assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n    assertTrue(e.getMessage().contains(\"is not currently supported\"));\n    assertTrue(e.getMessage().contains(\"boolean\"));\n\n    // asking for multiple stat tags -- see SOLR-6663\n    SolrQuery query2 = new SolrQuery(\"*:*\");\n    query2.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query2.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query2.setFacetMinCount(0);\n    query2.setRows(0);\n\n    e = expectThrows(SolrException.class, () -> client.query(query2));\n    assertEquals(400, e.code());\n    assertTrue(e.getMessage().contains(\"stats\"));\n    assertTrue(e.getMessage().contains(\"comma\"));\n    assertTrue(e.getMessage().contains(\"tag\"));\n\n    // text field\n    SolrQuery query3 = new SolrQuery(\"*:*\");\n    query3.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query3.addGetFieldStatistics(\"{!tag=s1}features\");\n    query3.setFacetMinCount(0);\n    query3.setRows(0);\n    e = expectThrows(SolrException.class, () -> client.query(query3));\n    assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n    assertTrue(e.getMessage().contains(\"is not currently supported\"));\n    assertTrue(e.getMessage().contains(\"text_general\"));\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrClient client = getSolrClient();\n\n    // Empty the database...\n    client.deleteByQuery(\"*:*\");// delete everything!\n    client.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      client.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      client.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d8daa7a1d5d0c033d73962d5ca3bf3f9c9687693","date":1565097295,"type":3,"author":"Jan HÃ¸ydahl","isMerge":true,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacetsStatsNotSupported().mjava","sourceNew":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrClient client = getSolrClient();\n\n    // Empty the database...\n    client.deleteByQuery(\"*:*\");// delete everything!\n    client.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      client.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      client.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n\n    SolrException e = expectThrows(SolrException.class, () -> client.query(query));\n    assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n    assertTrue(e.getMessage().contains(\"is not currently supported\"));\n    assertTrue(e.getMessage().contains(\"boolean\"));\n\n    // asking for multiple stat tags -- see SOLR-6663\n    SolrQuery query2 = new SolrQuery(\"*:*\");\n    query2.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query2.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query2.setFacetMinCount(0);\n    query2.setRows(0);\n\n    e = expectThrows(SolrException.class, () -> client.query(query2));\n    assertEquals(400, e.code());\n    assertTrue(e.getMessage().contains(\"stats\"));\n    assertTrue(e.getMessage().contains(\"comma\"));\n    assertTrue(e.getMessage().contains(\"tag\"));\n\n    // text field\n    SolrQuery query3 = new SolrQuery(\"*:*\");\n    query3.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query3.addGetFieldStatistics(\"{!tag=s1}features\");\n    query3.setFacetMinCount(0);\n    query3.setRows(0);\n    e = expectThrows(SolrException.class, () -> client.query(query3));\n    assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n    assertTrue(e.getMessage().contains(\"is not currently supported\"));\n    assertTrue(e.getMessage().contains(\"text_general\"));\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacetsStatsNotSupported() throws Exception {\n    SolrClient client = getSolrClient();\n\n    // Empty the database...\n    client.deleteByQuery(\"*:*\");// delete everything!\n    client.commit();\n    assertNumFound(\"*:*\", 0); // make sure it got in\n\n    // results of this test should be the same regardless of whether any docs in index\n    if (random().nextBoolean()) {\n      client.add(makeTestDoc(\"id\", 1, \"features\", \"aaa\", \"cat\", \"a\", \"inStock\", true, \"popularity\", 12, \"price\", .017));\n      client.commit();\n    }\n\n    ignoreException(\"is not currently supported\");\n\n    // boolean field\n    SolrQuery query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!key=inStock_val tag=s1}inStock\");\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on boolean is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"boolean\"));\n    }\n\n    // asking for multiple stat tags -- see SOLR-6663\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=tag1,tag2}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=tag1}price\", \"{!tag=tag2}popularity\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(400, e.code());\n      assertTrue(e.getMessage().contains(\"stats\"));\n      assertTrue(e.getMessage().contains(\"comma\"));\n      assertTrue(e.getMessage().contains(\"tag\"));\n    }\n\n    // text field\n    query = new SolrQuery(\"*:*\");\n    query.addFacetPivotField(\"{!stats=s1}features,manu\");\n    query.addGetFieldStatistics(\"{!tag=s1}features\");\n    query.setFacetMinCount(0);\n    query.setRows(0);\n    try {\n      client.query(query);\n      fail(\"SolrException should be thrown on query\");\n    } catch (SolrException e) {\n      assertEquals(\"Pivot facet on string is not currently supported, bad request returned\", 400, e.code());\n      assertTrue(e.getMessage().contains(\"is not currently supported\"));\n      assertTrue(e.getMessage().contains(\"text_general\"));\n    }\n    \n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"4c18a95e9168a30be855f5d5e7d61a863186fdc5":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"bafca15d8e408346a67f4282ad1143b88023893b":["60e4efc947592a22b8b79c8b7a18bfb8f1eb89b9"],"d1a307447328c95a00248512b40d7a5ff12ecd6a":["bafca15d8e408346a67f4282ad1143b88023893b"],"d8daa7a1d5d0c033d73962d5ca3bf3f9c9687693":["bafca15d8e408346a67f4282ad1143b88023893b","d1a307447328c95a00248512b40d7a5ff12ecd6a"],"f8061ddd97f3352007d927dae445884a6f3d857b":["bafca15d8e408346a67f4282ad1143b88023893b","d1a307447328c95a00248512b40d7a5ff12ecd6a"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["d1a307447328c95a00248512b40d7a5ff12ecd6a"],"60e4efc947592a22b8b79c8b7a18bfb8f1eb89b9":["4c18a95e9168a30be855f5d5e7d61a863186fdc5"]},"commit2Childs":{"4c18a95e9168a30be855f5d5e7d61a863186fdc5":["60e4efc947592a22b8b79c8b7a18bfb8f1eb89b9"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["4c18a95e9168a30be855f5d5e7d61a863186fdc5"],"bafca15d8e408346a67f4282ad1143b88023893b":["d1a307447328c95a00248512b40d7a5ff12ecd6a","d8daa7a1d5d0c033d73962d5ca3bf3f9c9687693","f8061ddd97f3352007d927dae445884a6f3d857b"],"d1a307447328c95a00248512b40d7a5ff12ecd6a":["d8daa7a1d5d0c033d73962d5ca3bf3f9c9687693","f8061ddd97f3352007d927dae445884a6f3d857b","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"d8daa7a1d5d0c033d73962d5ca3bf3f9c9687693":[],"f8061ddd97f3352007d927dae445884a6f3d857b":[],"60e4efc947592a22b8b79c8b7a18bfb8f1eb89b9":["bafca15d8e408346a67f4282ad1143b88023893b"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["d8daa7a1d5d0c033d73962d5ca3bf3f9c9687693","f8061ddd97f3352007d927dae445884a6f3d857b","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}