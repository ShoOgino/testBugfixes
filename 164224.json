{"path":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","commits":[{"id":"bfc52860e6d13d034226a760813c59d984c6817a","date":1522229027,"type":1,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else if (state == State.BUFFERING) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String scope) {\n    bufferedOpsGauge = () -> {\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else if (state == State.BUFFERING) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), true, \"state\", scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"43564cbb30b064675027cfb569564e8531096e97","date":1522334265,"type":1,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else if (state == State.BUFFERING) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String scope) {\n    bufferedOpsGauge = () -> {\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else if (state == State.BUFFERING) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), true, \"state\", scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"1455c941cc4ce652efc776fc23471b0e499246f6","date":1528086751,"type":3,"author":"Cao Manh Dat","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (state == State.BUFFERING) {\n        if (bufferTlog == null) return  0;\n        // numRecords counts header as a record\n        return bufferTlog.numRecords() - 1;\n      }\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else if (state == State.BUFFERING) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f592209545c71895260367152601e9200399776d","date":1528238935,"type":3,"author":"Michael Braun","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (state == State.BUFFERING) {\n        if (bufferTlog == null) return  0;\n        // numRecords counts header as a record\n        return bufferTlog.numRecords() - 1;\n      }\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else if (state == State.BUFFERING) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"b70042a8a492f7054d480ccdd2be9796510d4327","date":1528386658,"type":3,"author":"Alessandro Benedetti","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (state == State.BUFFERING) {\n        if (bufferTlog == null) return  0;\n        // numRecords counts header as a record\n        return bufferTlog.numRecords() - 1;\n      }\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else if (state == State.BUFFERING) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"2e9e5eaf280a6aa21423126b8232aa157a9b7366","date":1571772228,"type":5,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricsContext,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/update/UpdateLog#initializeMetrics(SolrMetricManager,String,String,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricsContext parentContext, String scope) {\n    solrMetricsContext = parentContext.getChildContext(this);\n    bufferedOpsGauge = () -> {\n      if (state == State.BUFFERING) {\n        if (bufferTlog == null) return  0;\n        // numRecords counts header as a record\n        return bufferTlog.numRecords() - 1;\n      }\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else {\n        return 0;\n      }\n    };\n\n    solrMetricsContext.gauge(null, bufferedOpsGauge, true, \"ops\", scope, \"buffered\");\n    solrMetricsContext.gauge(null, () -> logs.size(), true, \"logs\", scope, \"replay\", \"remaining\");\n    solrMetricsContext.gauge(null, () -> getTotalLogsSize(), true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = solrMetricsContext.meter(null, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = solrMetricsContext.meter(null, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = solrMetricsContext.meter(null, \"ops\", scope, \"copyOverOldUpdates\");\n    solrMetricsContext.gauge(null, () -> state.getValue(), true, \"state\", scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registry, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registry;\n    bufferedOpsGauge = () -> {\n      if (state == State.BUFFERING) {\n        if (bufferTlog == null) return  0;\n        // numRecords counts header as a record\n        return bufferTlog.numRecords() - 1;\n      }\n      if (tlog == null) {\n        return 0;\n      } else if (state == State.APPLYING_BUFFERED) {\n        // numRecords counts header as a record\n        return tlog.numRecords() - 1 - recoveryInfo.adds - recoveryInfo.deleteByQuery - recoveryInfo.deletes - recoveryInfo.errors;\n      } else {\n        return 0;\n      }\n    };\n\n    manager.registerGauge(null, registry, bufferedOpsGauge, tag, true, \"ops\", scope, \"buffered\");\n    manager.registerGauge(null, registry, () -> logs.size(), tag, true, \"logs\", scope, \"replay\", \"remaining\");\n    manager.registerGauge(null, registry, () -> getTotalLogsSize(), tag, true, \"bytes\", scope, \"replay\", \"remaining\");\n    applyingBufferedOpsMeter = manager.meter(null, registry, \"ops\", scope, \"applyingBuffered\");\n    replayOpsMeter = manager.meter(null, registry, \"ops\", scope, \"replay\");\n    copyOverOldUpdatesMeter = manager.meter(null, registry, \"ops\", scope, \"copyOverOldUpdates\");\n    manager.registerGauge(null, registry, () -> state.getValue(), tag, true, \"state\", scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"bfc52860e6d13d034226a760813c59d984c6817a":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"43564cbb30b064675027cfb569564e8531096e97":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","bfc52860e6d13d034226a760813c59d984c6817a"],"2e9e5eaf280a6aa21423126b8232aa157a9b7366":["1455c941cc4ce652efc776fc23471b0e499246f6"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"b70042a8a492f7054d480ccdd2be9796510d4327":["43564cbb30b064675027cfb569564e8531096e97","1455c941cc4ce652efc776fc23471b0e499246f6"],"f592209545c71895260367152601e9200399776d":["43564cbb30b064675027cfb569564e8531096e97","1455c941cc4ce652efc776fc23471b0e499246f6"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["2e9e5eaf280a6aa21423126b8232aa157a9b7366"],"1455c941cc4ce652efc776fc23471b0e499246f6":["43564cbb30b064675027cfb569564e8531096e97"]},"commit2Childs":{"bfc52860e6d13d034226a760813c59d984c6817a":["43564cbb30b064675027cfb569564e8531096e97"],"43564cbb30b064675027cfb569564e8531096e97":["b70042a8a492f7054d480ccdd2be9796510d4327","f592209545c71895260367152601e9200399776d","1455c941cc4ce652efc776fc23471b0e499246f6"],"2e9e5eaf280a6aa21423126b8232aa157a9b7366":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["bfc52860e6d13d034226a760813c59d984c6817a","43564cbb30b064675027cfb569564e8531096e97"],"b70042a8a492f7054d480ccdd2be9796510d4327":[],"f592209545c71895260367152601e9200399776d":[],"1455c941cc4ce652efc776fc23471b0e499246f6":["2e9e5eaf280a6aa21423126b8232aa157a9b7366","b70042a8a492f7054d480ccdd2be9796510d4327","f592209545c71895260367152601e9200399776d"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["b70042a8a492f7054d480ccdd2be9796510d4327","f592209545c71895260367152601e9200399776d","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}