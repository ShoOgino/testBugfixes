{"path":"solr/core/src/java/org/apache/solr/analytics/request/AnalyticsRequestFactory#parse(IndexSchema,SolrParams).mjava","commits":[{"id":"ff403346522eaa9de75403763e297e83a3ea585c","date":1384904731,"type":0,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/analytics/request/AnalyticsRequestFactory#parse(IndexSchema,SolrParams).mjava","pathOld":"/dev/null","sourceNew":"  public static List<AnalyticsRequest> parse(IndexSchema schema, SolrParams params) {\n    Map<String, AnalyticsRequest> requestMap = new HashMap<String, AnalyticsRequest>();\n    Map<String, Map<String,FieldFacetRequest>> fieldFacetMap = new HashMap<String, Map<String,FieldFacetRequest>>();\n    Map<String, Set<String>> fieldFacetSet = new HashMap<String,Set<String>>();\n    Map<String, Map<String,RangeFacetRequest>> rangeFacetMap = new HashMap<String, Map<String,RangeFacetRequest>>();\n    Map<String, Set<String>> rangeFacetSet = new HashMap<String,Set<String>>();\n    Map<String, Map<String,QueryFacetRequest>> queryFacetMap = new HashMap<String, Map<String,QueryFacetRequest>>();\n    Map<String, Set<String>> queryFacetSet = new HashMap<String,Set<String>>();\n    List<AnalyticsRequest> requestList = new ArrayList<AnalyticsRequest>();\n    \n    Iterator<String> paramsIterator = params.getParameterNamesIterator();\n    while (paramsIterator.hasNext()) {\n      String param = paramsIterator.next();\n      CharSequence paramSequence = param.subSequence(0, param.length());\n      \n      // Check if stat\n      Matcher m = statPattern.matcher(paramSequence);\n      if (m.matches()) {\n        makeExpression(requestMap,m.group(1),m.group(2),params.get(param));\n      } else {\n        // Check if hidden stat\n        m = hiddenStatPattern.matcher(paramSequence);\n        if (m.matches()) {\n          makeHiddenExpression(requestMap,m.group(1),m.group(2),params.get(param));\n        } else {\n          // Check if field facet\n          m = fieldFacetPattern.matcher(paramSequence);\n          if (m.matches()) {\n            makeFieldFacet(schema,fieldFacetMap,fieldFacetSet,m.group(1),params.getParams(param));\n          } else {\n            // Check if field facet parameter\n            m = fieldFacetParamPattern.matcher(paramSequence);\n            if (m.matches()) {\n              setFieldFacetParam(schema,fieldFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n            } else {\n              // Check if range facet\n              m = rangeFacetPattern.matcher(paramSequence);\n              if (m.matches()) {\n                makeRangeFacet(schema,rangeFacetSet,m.group(1),params.getParams(param));\n              }  else {\n                // Check if range facet parameter\n                m = rangeFacetParamPattern.matcher(paramSequence);\n                if (m.matches()) {\n                  setRangeFacetParam(schema,rangeFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                }  else {\n                  // Check if query facet\n                  m = queryFacetPattern.matcher(paramSequence);\n                  if (m.matches()) {\n                    makeQueryFacet(schema,queryFacetSet,m.group(1),params.getParams(param));\n                  }  else {\n                    // Check if query\n                    m = queryFacetParamPattern.matcher(paramSequence);\n                    if (m.matches()) {\n                      setQueryFacetParam(schema,queryFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                    } \n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    for (String reqName : requestMap.keySet()) {\n      AnalyticsRequest ar = requestMap.get(reqName);\n      List<FieldFacetRequest> ffrs = new ArrayList<FieldFacetRequest>();\n      if (fieldFacetSet.get(reqName)!=null) {\n        for (String field : fieldFacetSet.get(reqName)) {\n          ffrs.add(fieldFacetMap.get(reqName).get(field));\n        }\n      }\n      ar.setFieldFacets(ffrs);\n      \n      List<RangeFacetRequest> rfrs = new ArrayList<RangeFacetRequest>();\n      if (rangeFacetSet.get(reqName)!=null) {\n        for (String field : rangeFacetSet.get(reqName)) {\n          RangeFacetRequest rfr = rangeFacetMap.get(reqName).get(field);\n          if (rfr != null) {\n            rfrs.add(rfr);\n          }\n        }\n      }\n      ar.setRangeFacets(rfrs);\n      \n      List<QueryFacetRequest> qfrs = new ArrayList<QueryFacetRequest>();\n      if (queryFacetSet.get(reqName)!=null) {\n        for (String name : queryFacetSet.get(reqName)) {\n          QueryFacetRequest qfr = queryFacetMap.get(reqName).get(name);\n          if (qfr != null) {\n            addQueryFacet(qfrs,qfr);\n          }\n        }\n      }\n      for (QueryFacetRequest qfr : qfrs) {\n        if (qfr.getDependencies().size()>0) {\n          throw new SolrException(ErrorCode.BAD_REQUEST,\"The query facet dependencies \"+qfr.getDependencies().toString()+\" either do not exist or are defined in a dependency looop.\");\n        }\n      }\n      ar.setQueryFacets(qfrs);\n      requestList.add(ar);\n    }\n    return requestList; \n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"74f45af4339b0daf7a95c820ab88c1aea74fbce0","date":1387475327,"type":0,"author":"Michael McCandless","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/analytics/request/AnalyticsRequestFactory#parse(IndexSchema,SolrParams).mjava","pathOld":"/dev/null","sourceNew":"  public static List<AnalyticsRequest> parse(IndexSchema schema, SolrParams params) {\n    Map<String, AnalyticsRequest> requestMap = new HashMap<String, AnalyticsRequest>();\n    Map<String, Map<String,FieldFacetRequest>> fieldFacetMap = new HashMap<String, Map<String,FieldFacetRequest>>();\n    Map<String, Set<String>> fieldFacetSet = new HashMap<String,Set<String>>();\n    Map<String, Map<String,RangeFacetRequest>> rangeFacetMap = new HashMap<String, Map<String,RangeFacetRequest>>();\n    Map<String, Set<String>> rangeFacetSet = new HashMap<String,Set<String>>();\n    Map<String, Map<String,QueryFacetRequest>> queryFacetMap = new HashMap<String, Map<String,QueryFacetRequest>>();\n    Map<String, Set<String>> queryFacetSet = new HashMap<String,Set<String>>();\n    List<AnalyticsRequest> requestList = new ArrayList<AnalyticsRequest>();\n    \n    Iterator<String> paramsIterator = params.getParameterNamesIterator();\n    while (paramsIterator.hasNext()) {\n      String param = paramsIterator.next();\n      CharSequence paramSequence = param.subSequence(0, param.length());\n      \n      // Check if stat\n      Matcher m = statPattern.matcher(paramSequence);\n      if (m.matches()) {\n        makeExpression(requestMap,m.group(1),m.group(2),params.get(param));\n      } else {\n        // Check if hidden stat\n        m = hiddenStatPattern.matcher(paramSequence);\n        if (m.matches()) {\n          makeHiddenExpression(requestMap,m.group(1),m.group(2),params.get(param));\n        } else {\n          // Check if field facet\n          m = fieldFacetPattern.matcher(paramSequence);\n          if (m.matches()) {\n            makeFieldFacet(schema,fieldFacetMap,fieldFacetSet,m.group(1),params.getParams(param));\n          } else {\n            // Check if field facet parameter\n            m = fieldFacetParamPattern.matcher(paramSequence);\n            if (m.matches()) {\n              setFieldFacetParam(schema,fieldFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n            } else {\n              // Check if range facet\n              m = rangeFacetPattern.matcher(paramSequence);\n              if (m.matches()) {\n                makeRangeFacet(schema,rangeFacetSet,m.group(1),params.getParams(param));\n              }  else {\n                // Check if range facet parameter\n                m = rangeFacetParamPattern.matcher(paramSequence);\n                if (m.matches()) {\n                  setRangeFacetParam(schema,rangeFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                }  else {\n                  // Check if query facet\n                  m = queryFacetPattern.matcher(paramSequence);\n                  if (m.matches()) {\n                    makeQueryFacet(schema,queryFacetSet,m.group(1),params.getParams(param));\n                  }  else {\n                    // Check if query\n                    m = queryFacetParamPattern.matcher(paramSequence);\n                    if (m.matches()) {\n                      setQueryFacetParam(schema,queryFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                    } \n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    for (String reqName : requestMap.keySet()) {\n      AnalyticsRequest ar = requestMap.get(reqName);\n      List<FieldFacetRequest> ffrs = new ArrayList<FieldFacetRequest>();\n      if (fieldFacetSet.get(reqName)!=null) {\n        for (String field : fieldFacetSet.get(reqName)) {\n          ffrs.add(fieldFacetMap.get(reqName).get(field));\n        }\n      }\n      ar.setFieldFacets(ffrs);\n      \n      List<RangeFacetRequest> rfrs = new ArrayList<RangeFacetRequest>();\n      if (rangeFacetSet.get(reqName)!=null) {\n        for (String field : rangeFacetSet.get(reqName)) {\n          RangeFacetRequest rfr = rangeFacetMap.get(reqName).get(field);\n          if (rfr != null) {\n            rfrs.add(rfr);\n          }\n        }\n      }\n      ar.setRangeFacets(rfrs);\n      \n      List<QueryFacetRequest> qfrs = new ArrayList<QueryFacetRequest>();\n      if (queryFacetSet.get(reqName)!=null) {\n        for (String name : queryFacetSet.get(reqName)) {\n          QueryFacetRequest qfr = queryFacetMap.get(reqName).get(name);\n          if (qfr != null) {\n            addQueryFacet(qfrs,qfr);\n          }\n        }\n      }\n      for (QueryFacetRequest qfr : qfrs) {\n        if (qfr.getDependencies().size()>0) {\n          throw new SolrException(ErrorCode.BAD_REQUEST,\"The query facet dependencies \"+qfr.getDependencies().toString()+\" either do not exist or are defined in a dependency looop.\");\n        }\n      }\n      ar.setQueryFacets(qfrs);\n      requestList.add(ar);\n    }\n    return requestList; \n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"634f330c54fd3f9f491d52036dc3f40b4f4d8934","date":1394635157,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/analytics/request/AnalyticsRequestFactory#parse(IndexSchema,SolrParams).mjava","pathOld":"solr/core/src/java/org/apache/solr/analytics/request/AnalyticsRequestFactory#parse(IndexSchema,SolrParams).mjava","sourceNew":"  public static List<AnalyticsRequest> parse(IndexSchema schema, SolrParams params) {\n    Map<String, AnalyticsRequest> requestMap = new HashMap<>();\n    Map<String, Map<String,FieldFacetRequest>> fieldFacetMap = new HashMap<>();\n    Map<String, Set<String>> fieldFacetSet = new HashMap<>();\n    Map<String, Map<String,RangeFacetRequest>> rangeFacetMap = new HashMap<>();\n    Map<String, Set<String>> rangeFacetSet = new HashMap<>();\n    Map<String, Map<String,QueryFacetRequest>> queryFacetMap = new HashMap<>();\n    Map<String, Set<String>> queryFacetSet = new HashMap<>();\n    List<AnalyticsRequest> requestList = new ArrayList<>();\n    \n    Iterator<String> paramsIterator = params.getParameterNamesIterator();\n    while (paramsIterator.hasNext()) {\n      String param = paramsIterator.next();\n      CharSequence paramSequence = param.subSequence(0, param.length());\n      \n      // Check if stat\n      Matcher m = statPattern.matcher(paramSequence);\n      if (m.matches()) {\n        makeExpression(requestMap,m.group(1),m.group(2),params.get(param));\n      } else {\n        // Check if hidden stat\n        m = hiddenStatPattern.matcher(paramSequence);\n        if (m.matches()) {\n          makeHiddenExpression(requestMap,m.group(1),m.group(2),params.get(param));\n        } else {\n          // Check if field facet\n          m = fieldFacetPattern.matcher(paramSequence);\n          if (m.matches()) {\n            makeFieldFacet(schema,fieldFacetMap,fieldFacetSet,m.group(1),params.getParams(param));\n          } else {\n            // Check if field facet parameter\n            m = fieldFacetParamPattern.matcher(paramSequence);\n            if (m.matches()) {\n              setFieldFacetParam(schema,fieldFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n            } else {\n              // Check if range facet\n              m = rangeFacetPattern.matcher(paramSequence);\n              if (m.matches()) {\n                makeRangeFacet(schema,rangeFacetSet,m.group(1),params.getParams(param));\n              }  else {\n                // Check if range facet parameter\n                m = rangeFacetParamPattern.matcher(paramSequence);\n                if (m.matches()) {\n                  setRangeFacetParam(schema,rangeFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                }  else {\n                  // Check if query facet\n                  m = queryFacetPattern.matcher(paramSequence);\n                  if (m.matches()) {\n                    makeQueryFacet(schema,queryFacetSet,m.group(1),params.getParams(param));\n                  }  else {\n                    // Check if query\n                    m = queryFacetParamPattern.matcher(paramSequence);\n                    if (m.matches()) {\n                      setQueryFacetParam(schema,queryFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                    } \n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    for (String reqName : requestMap.keySet()) {\n      AnalyticsRequest ar = requestMap.get(reqName);\n      List<FieldFacetRequest> ffrs = new ArrayList<>();\n      if (fieldFacetSet.get(reqName)!=null) {\n        for (String field : fieldFacetSet.get(reqName)) {\n          ffrs.add(fieldFacetMap.get(reqName).get(field));\n        }\n      }\n      ar.setFieldFacets(ffrs);\n      \n      List<RangeFacetRequest> rfrs = new ArrayList<>();\n      if (rangeFacetSet.get(reqName)!=null) {\n        for (String field : rangeFacetSet.get(reqName)) {\n          RangeFacetRequest rfr = rangeFacetMap.get(reqName).get(field);\n          if (rfr != null) {\n            rfrs.add(rfr);\n          }\n        }\n      }\n      ar.setRangeFacets(rfrs);\n      \n      List<QueryFacetRequest> qfrs = new ArrayList<>();\n      if (queryFacetSet.get(reqName)!=null) {\n        for (String name : queryFacetSet.get(reqName)) {\n          QueryFacetRequest qfr = queryFacetMap.get(reqName).get(name);\n          if (qfr != null) {\n            addQueryFacet(qfrs,qfr);\n          }\n        }\n      }\n      for (QueryFacetRequest qfr : qfrs) {\n        if (qfr.getDependencies().size()>0) {\n          throw new SolrException(ErrorCode.BAD_REQUEST,\"The query facet dependencies \"+qfr.getDependencies().toString()+\" either do not exist or are defined in a dependency looop.\");\n        }\n      }\n      ar.setQueryFacets(qfrs);\n      requestList.add(ar);\n    }\n    return requestList; \n  }\n\n","sourceOld":"  public static List<AnalyticsRequest> parse(IndexSchema schema, SolrParams params) {\n    Map<String, AnalyticsRequest> requestMap = new HashMap<String, AnalyticsRequest>();\n    Map<String, Map<String,FieldFacetRequest>> fieldFacetMap = new HashMap<String, Map<String,FieldFacetRequest>>();\n    Map<String, Set<String>> fieldFacetSet = new HashMap<String,Set<String>>();\n    Map<String, Map<String,RangeFacetRequest>> rangeFacetMap = new HashMap<String, Map<String,RangeFacetRequest>>();\n    Map<String, Set<String>> rangeFacetSet = new HashMap<String,Set<String>>();\n    Map<String, Map<String,QueryFacetRequest>> queryFacetMap = new HashMap<String, Map<String,QueryFacetRequest>>();\n    Map<String, Set<String>> queryFacetSet = new HashMap<String,Set<String>>();\n    List<AnalyticsRequest> requestList = new ArrayList<AnalyticsRequest>();\n    \n    Iterator<String> paramsIterator = params.getParameterNamesIterator();\n    while (paramsIterator.hasNext()) {\n      String param = paramsIterator.next();\n      CharSequence paramSequence = param.subSequence(0, param.length());\n      \n      // Check if stat\n      Matcher m = statPattern.matcher(paramSequence);\n      if (m.matches()) {\n        makeExpression(requestMap,m.group(1),m.group(2),params.get(param));\n      } else {\n        // Check if hidden stat\n        m = hiddenStatPattern.matcher(paramSequence);\n        if (m.matches()) {\n          makeHiddenExpression(requestMap,m.group(1),m.group(2),params.get(param));\n        } else {\n          // Check if field facet\n          m = fieldFacetPattern.matcher(paramSequence);\n          if (m.matches()) {\n            makeFieldFacet(schema,fieldFacetMap,fieldFacetSet,m.group(1),params.getParams(param));\n          } else {\n            // Check if field facet parameter\n            m = fieldFacetParamPattern.matcher(paramSequence);\n            if (m.matches()) {\n              setFieldFacetParam(schema,fieldFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n            } else {\n              // Check if range facet\n              m = rangeFacetPattern.matcher(paramSequence);\n              if (m.matches()) {\n                makeRangeFacet(schema,rangeFacetSet,m.group(1),params.getParams(param));\n              }  else {\n                // Check if range facet parameter\n                m = rangeFacetParamPattern.matcher(paramSequence);\n                if (m.matches()) {\n                  setRangeFacetParam(schema,rangeFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                }  else {\n                  // Check if query facet\n                  m = queryFacetPattern.matcher(paramSequence);\n                  if (m.matches()) {\n                    makeQueryFacet(schema,queryFacetSet,m.group(1),params.getParams(param));\n                  }  else {\n                    // Check if query\n                    m = queryFacetParamPattern.matcher(paramSequence);\n                    if (m.matches()) {\n                      setQueryFacetParam(schema,queryFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                    } \n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    for (String reqName : requestMap.keySet()) {\n      AnalyticsRequest ar = requestMap.get(reqName);\n      List<FieldFacetRequest> ffrs = new ArrayList<FieldFacetRequest>();\n      if (fieldFacetSet.get(reqName)!=null) {\n        for (String field : fieldFacetSet.get(reqName)) {\n          ffrs.add(fieldFacetMap.get(reqName).get(field));\n        }\n      }\n      ar.setFieldFacets(ffrs);\n      \n      List<RangeFacetRequest> rfrs = new ArrayList<RangeFacetRequest>();\n      if (rangeFacetSet.get(reqName)!=null) {\n        for (String field : rangeFacetSet.get(reqName)) {\n          RangeFacetRequest rfr = rangeFacetMap.get(reqName).get(field);\n          if (rfr != null) {\n            rfrs.add(rfr);\n          }\n        }\n      }\n      ar.setRangeFacets(rfrs);\n      \n      List<QueryFacetRequest> qfrs = new ArrayList<QueryFacetRequest>();\n      if (queryFacetSet.get(reqName)!=null) {\n        for (String name : queryFacetSet.get(reqName)) {\n          QueryFacetRequest qfr = queryFacetMap.get(reqName).get(name);\n          if (qfr != null) {\n            addQueryFacet(qfrs,qfr);\n          }\n        }\n      }\n      for (QueryFacetRequest qfr : qfrs) {\n        if (qfr.getDependencies().size()>0) {\n          throw new SolrException(ErrorCode.BAD_REQUEST,\"The query facet dependencies \"+qfr.getDependencies().toString()+\" either do not exist or are defined in a dependency looop.\");\n        }\n      }\n      ar.setQueryFacets(qfrs);\n      requestList.add(ar);\n    }\n    return requestList; \n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0f719faa74f7213d4a395510dbc1f1b7cb178484","date":1410881394,"type":5,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/contrib/analytics/src/java/org/apache/solr/analytics/request/AnalyticsRequestFactory#parse(IndexSchema,SolrParams).mjava","pathOld":"solr/core/src/java/org/apache/solr/analytics/request/AnalyticsRequestFactory#parse(IndexSchema,SolrParams).mjava","sourceNew":"  public static List<AnalyticsRequest> parse(IndexSchema schema, SolrParams params) {\n    Map<String, AnalyticsRequest> requestMap = new HashMap<>();\n    Map<String, Map<String,FieldFacetRequest>> fieldFacetMap = new HashMap<>();\n    Map<String, Set<String>> fieldFacetSet = new HashMap<>();\n    Map<String, Map<String,RangeFacetRequest>> rangeFacetMap = new HashMap<>();\n    Map<String, Set<String>> rangeFacetSet = new HashMap<>();\n    Map<String, Map<String,QueryFacetRequest>> queryFacetMap = new HashMap<>();\n    Map<String, Set<String>> queryFacetSet = new HashMap<>();\n    List<AnalyticsRequest> requestList = new ArrayList<>();\n    \n    Iterator<String> paramsIterator = params.getParameterNamesIterator();\n    while (paramsIterator.hasNext()) {\n      String param = paramsIterator.next();\n      CharSequence paramSequence = param.subSequence(0, param.length());\n      \n      // Check if stat\n      Matcher m = statPattern.matcher(paramSequence);\n      if (m.matches()) {\n        makeExpression(requestMap,m.group(1),m.group(2),params.get(param));\n      } else {\n        // Check if hidden stat\n        m = hiddenStatPattern.matcher(paramSequence);\n        if (m.matches()) {\n          makeHiddenExpression(requestMap,m.group(1),m.group(2),params.get(param));\n        } else {\n          // Check if field facet\n          m = fieldFacetPattern.matcher(paramSequence);\n          if (m.matches()) {\n            makeFieldFacet(schema,fieldFacetMap,fieldFacetSet,m.group(1),params.getParams(param));\n          } else {\n            // Check if field facet parameter\n            m = fieldFacetParamPattern.matcher(paramSequence);\n            if (m.matches()) {\n              setFieldFacetParam(schema,fieldFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n            } else {\n              // Check if range facet\n              m = rangeFacetPattern.matcher(paramSequence);\n              if (m.matches()) {\n                makeRangeFacet(schema,rangeFacetSet,m.group(1),params.getParams(param));\n              }  else {\n                // Check if range facet parameter\n                m = rangeFacetParamPattern.matcher(paramSequence);\n                if (m.matches()) {\n                  setRangeFacetParam(schema,rangeFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                }  else {\n                  // Check if query facet\n                  m = queryFacetPattern.matcher(paramSequence);\n                  if (m.matches()) {\n                    makeQueryFacet(schema,queryFacetSet,m.group(1),params.getParams(param));\n                  }  else {\n                    // Check if query\n                    m = queryFacetParamPattern.matcher(paramSequence);\n                    if (m.matches()) {\n                      setQueryFacetParam(schema,queryFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                    } \n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    for (String reqName : requestMap.keySet()) {\n      AnalyticsRequest ar = requestMap.get(reqName);\n      List<FieldFacetRequest> ffrs = new ArrayList<>();\n      if (fieldFacetSet.get(reqName)!=null) {\n        for (String field : fieldFacetSet.get(reqName)) {\n          ffrs.add(fieldFacetMap.get(reqName).get(field));\n        }\n      }\n      ar.setFieldFacets(ffrs);\n      \n      List<RangeFacetRequest> rfrs = new ArrayList<>();\n      if (rangeFacetSet.get(reqName)!=null) {\n        for (String field : rangeFacetSet.get(reqName)) {\n          RangeFacetRequest rfr = rangeFacetMap.get(reqName).get(field);\n          if (rfr != null) {\n            rfrs.add(rfr);\n          }\n        }\n      }\n      ar.setRangeFacets(rfrs);\n      \n      List<QueryFacetRequest> qfrs = new ArrayList<>();\n      if (queryFacetSet.get(reqName)!=null) {\n        for (String name : queryFacetSet.get(reqName)) {\n          QueryFacetRequest qfr = queryFacetMap.get(reqName).get(name);\n          if (qfr != null) {\n            addQueryFacet(qfrs,qfr);\n          }\n        }\n      }\n      for (QueryFacetRequest qfr : qfrs) {\n        if (qfr.getDependencies().size()>0) {\n          throw new SolrException(ErrorCode.BAD_REQUEST,\"The query facet dependencies \"+qfr.getDependencies().toString()+\" either do not exist or are defined in a dependency looop.\");\n        }\n      }\n      ar.setQueryFacets(qfrs);\n      requestList.add(ar);\n    }\n    return requestList; \n  }\n\n","sourceOld":"  public static List<AnalyticsRequest> parse(IndexSchema schema, SolrParams params) {\n    Map<String, AnalyticsRequest> requestMap = new HashMap<>();\n    Map<String, Map<String,FieldFacetRequest>> fieldFacetMap = new HashMap<>();\n    Map<String, Set<String>> fieldFacetSet = new HashMap<>();\n    Map<String, Map<String,RangeFacetRequest>> rangeFacetMap = new HashMap<>();\n    Map<String, Set<String>> rangeFacetSet = new HashMap<>();\n    Map<String, Map<String,QueryFacetRequest>> queryFacetMap = new HashMap<>();\n    Map<String, Set<String>> queryFacetSet = new HashMap<>();\n    List<AnalyticsRequest> requestList = new ArrayList<>();\n    \n    Iterator<String> paramsIterator = params.getParameterNamesIterator();\n    while (paramsIterator.hasNext()) {\n      String param = paramsIterator.next();\n      CharSequence paramSequence = param.subSequence(0, param.length());\n      \n      // Check if stat\n      Matcher m = statPattern.matcher(paramSequence);\n      if (m.matches()) {\n        makeExpression(requestMap,m.group(1),m.group(2),params.get(param));\n      } else {\n        // Check if hidden stat\n        m = hiddenStatPattern.matcher(paramSequence);\n        if (m.matches()) {\n          makeHiddenExpression(requestMap,m.group(1),m.group(2),params.get(param));\n        } else {\n          // Check if field facet\n          m = fieldFacetPattern.matcher(paramSequence);\n          if (m.matches()) {\n            makeFieldFacet(schema,fieldFacetMap,fieldFacetSet,m.group(1),params.getParams(param));\n          } else {\n            // Check if field facet parameter\n            m = fieldFacetParamPattern.matcher(paramSequence);\n            if (m.matches()) {\n              setFieldFacetParam(schema,fieldFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n            } else {\n              // Check if range facet\n              m = rangeFacetPattern.matcher(paramSequence);\n              if (m.matches()) {\n                makeRangeFacet(schema,rangeFacetSet,m.group(1),params.getParams(param));\n              }  else {\n                // Check if range facet parameter\n                m = rangeFacetParamPattern.matcher(paramSequence);\n                if (m.matches()) {\n                  setRangeFacetParam(schema,rangeFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                }  else {\n                  // Check if query facet\n                  m = queryFacetPattern.matcher(paramSequence);\n                  if (m.matches()) {\n                    makeQueryFacet(schema,queryFacetSet,m.group(1),params.getParams(param));\n                  }  else {\n                    // Check if query\n                    m = queryFacetParamPattern.matcher(paramSequence);\n                    if (m.matches()) {\n                      setQueryFacetParam(schema,queryFacetMap,m.group(1),m.group(2),m.group(3),params.getParams(param));\n                    } \n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    for (String reqName : requestMap.keySet()) {\n      AnalyticsRequest ar = requestMap.get(reqName);\n      List<FieldFacetRequest> ffrs = new ArrayList<>();\n      if (fieldFacetSet.get(reqName)!=null) {\n        for (String field : fieldFacetSet.get(reqName)) {\n          ffrs.add(fieldFacetMap.get(reqName).get(field));\n        }\n      }\n      ar.setFieldFacets(ffrs);\n      \n      List<RangeFacetRequest> rfrs = new ArrayList<>();\n      if (rangeFacetSet.get(reqName)!=null) {\n        for (String field : rangeFacetSet.get(reqName)) {\n          RangeFacetRequest rfr = rangeFacetMap.get(reqName).get(field);\n          if (rfr != null) {\n            rfrs.add(rfr);\n          }\n        }\n      }\n      ar.setRangeFacets(rfrs);\n      \n      List<QueryFacetRequest> qfrs = new ArrayList<>();\n      if (queryFacetSet.get(reqName)!=null) {\n        for (String name : queryFacetSet.get(reqName)) {\n          QueryFacetRequest qfr = queryFacetMap.get(reqName).get(name);\n          if (qfr != null) {\n            addQueryFacet(qfrs,qfr);\n          }\n        }\n      }\n      for (QueryFacetRequest qfr : qfrs) {\n        if (qfr.getDependencies().size()>0) {\n          throw new SolrException(ErrorCode.BAD_REQUEST,\"The query facet dependencies \"+qfr.getDependencies().toString()+\" either do not exist or are defined in a dependency looop.\");\n        }\n      }\n      ar.setQueryFacets(qfrs);\n      requestList.add(ar);\n    }\n    return requestList; \n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["ff403346522eaa9de75403763e297e83a3ea585c"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"74f45af4339b0daf7a95c820ab88c1aea74fbce0":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","ff403346522eaa9de75403763e297e83a3ea585c"],"ff403346522eaa9de75403763e297e83a3ea585c":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"0f719faa74f7213d4a395510dbc1f1b7cb178484":["634f330c54fd3f9f491d52036dc3f40b4f4d8934"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["0f719faa74f7213d4a395510dbc1f1b7cb178484"]},"commit2Childs":{"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["0f719faa74f7213d4a395510dbc1f1b7cb178484"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["74f45af4339b0daf7a95c820ab88c1aea74fbce0","ff403346522eaa9de75403763e297e83a3ea585c"],"74f45af4339b0daf7a95c820ab88c1aea74fbce0":[],"ff403346522eaa9de75403763e297e83a3ea585c":["634f330c54fd3f9f491d52036dc3f40b4f4d8934","74f45af4339b0daf7a95c820ab88c1aea74fbce0"],"0f719faa74f7213d4a395510dbc1f1b7cb178484":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["74f45af4339b0daf7a95c820ab88c1aea74fbce0","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}