{"path":"solr/core/src/test/org/apache/solr/update/processor/AtomicUpdatesTest#testAtomicUpdatesOnDateFields().mjava","commits":[{"id":"c8fef7b93de1912f1554371b19f6d4ef5f8c0acd","date":1445009862,"type":0,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/processor/AtomicUpdatesTest#testAtomicUpdatesOnDateFields().mjava","pathOld":"/dev/null","sourceNew":"  public void testAtomicUpdatesOnDateFields() throws Exception {\n    String[] dateFieldNames = {\"simple_tdt1\", \"simple_tdts\", \"simple_tdtdv1\", \"simple_tdtdvs\"};\n\n    SolrInputDocument doc = new SolrInputDocument();\n    doc.setField(\"id\", \"6\");\n    // Even adding a single value here for the multiValue field causes the update later on to fail\n    doc.setField(\"simple_tdt1\", \"1986-01-01T00:00:00Z\"); // single-valued\n    doc.setField(\"simple_tdts\", new String[] {\"1986-01-01T00:00:00Z\"});\n    doc.setField(\"simple_tdtdv\", \"1986-01-01T00:00:00Z\");\n    doc.setField(\"simple_tdtdvs\", new String[] {\"1986-01-01T00:00:00Z\"});\n    // An independent field that we want to update later on\n    doc.setField(\"other_i\", \"42\");\n    assertU(adoc(doc));\n    assertU(commit());\n\n    assertQ(req(\"q\", \"id:6\"), \"boolean(//result/doc/date[@name='simple_tdt1'])\");\n\n\n    for (String dateFieldName : dateFieldNames) {\n      // none (this can fail with Invalid Date String exception)\n      doc = new SolrInputDocument();\n      doc.setField(\"id\", \"6\");\n      doc.setField(\"other_i\", ImmutableMap.of(\"set\", \"43\")); // set the independent field to another value\n      assertU(adoc(doc));\n\n      if (dateFieldName.endsWith(\"s\"))  {\n        // add\n        doc = new SolrInputDocument();\n        doc.setField(\"id\", \"6\");\n        doc.setField(\"other_i\", ImmutableMap.of(\"set\", \"43\")); // set the independent field to another value\n        doc.setField(dateFieldName, ImmutableMap.of(\"add\", \"1987-01-01T00:00:00Z\"));\n        assertU(adoc(doc));\n\n        // remove\n        doc = new SolrInputDocument();\n        doc.setField(\"id\", \"6\");\n        doc.setField(\"other_i\", ImmutableMap.of(\"set\", \"43\")); // set the independent field to another value\n        doc.setField(dateFieldName, ImmutableMap.of(\"remove\", \"1987-01-01T00:00:00Z\"));\n        assertU(adoc(doc));\n      } else {\n        // set\n        doc = new SolrInputDocument();\n        doc.setField(\"id\", \"6\");\n        doc.setField(\"other_i\", ImmutableMap.of(\"set\", \"43\")); // set the independent field to another value\n        doc.setField(dateFieldName, ImmutableMap.of(\"set\", \"1987-01-01T00:00:00Z\"));\n        assertU(adoc(doc));\n\n        // unset\n        doc = new SolrInputDocument();\n        doc.setField(\"id\", \"6\");\n        doc.setField(\"other_i\", ImmutableMap.of(\"set\", \"43\")); // set the independent field to another value\n        doc.setField(dateFieldName, map(\"set\", null));\n        assertU(adoc(doc));\n      }\n\n      assertU(commit());\n      if (dateFieldName.endsWith(\"s\"))  {\n        assertQ(req(\"q\", \"id:6\"), \"//result/doc[count(arr[@name='\" + dateFieldName + \"'])=1]\");\n        assertQ(req(\"q\", \"id:6\"), \"//result/doc/arr[@name='\" + dateFieldName + \"'][count(date)=1]\");\n      } else {\n        assertQ(req(\"q\", \"id:6\"), \"//result/doc[count(date[@name='\" + dateFieldName + \"'])=0]\");\n      }\n    }\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"c8fef7b93de1912f1554371b19f6d4ef5f8c0acd":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["c8fef7b93de1912f1554371b19f6d4ef5f8c0acd"]},"commit2Childs":{"c8fef7b93de1912f1554371b19f6d4ef5f8c0acd":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["c8fef7b93de1912f1554371b19f6d4ef5f8c0acd"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}