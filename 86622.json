{"path":"lucene/core/src/java/org/apache/lucene/util/packed/BulkOperationPacked#encode(int[],int,byte[],int,int).mjava","commits":[{"id":"58d488e3fd72dfc95fa76fcb24f58e90c343323c","date":1346235723,"type":0,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/util/packed/BulkOperationPacked#encode(int[],int,byte[],int,int).mjava","pathOld":"/dev/null","sourceNew":"  @Override\n  public void encode(int[] values, int valuesOffset, byte[] blocks,\n      int blocksOffset, int iterations) {\n    long nextBlock = 0;\n    int bitsLeft = 64;\n    for (int i = 0; i < valueCount * iterations; ++i) {\n      bitsLeft -= bitsPerValue;\n      if (bitsLeft > 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL) << bitsLeft;\n      } else if (bitsLeft == 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL);\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = 0;\n        bitsLeft = 64;\n      } else { // bitsLeft < 0\n        nextBlock |= (values[valuesOffset] & 0xFFFFFFFFL) >>> -bitsLeft;\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = (values[valuesOffset++] & ((1L << -bitsLeft) - 1)) << (64 + bitsLeft);\n        bitsLeft += 64;\n      }\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"05a14b2611ead08655a2b2bdc61632eb31316e57","date":1346366621,"type":0,"author":"Uwe Schindler","isMerge":true,"pathNew":"lucene/core/src/java/org/apache/lucene/util/packed/BulkOperationPacked#encode(int[],int,byte[],int,int).mjava","pathOld":"/dev/null","sourceNew":"  @Override\n  public void encode(int[] values, int valuesOffset, byte[] blocks,\n      int blocksOffset, int iterations) {\n    long nextBlock = 0;\n    int bitsLeft = 64;\n    for (int i = 0; i < valueCount * iterations; ++i) {\n      bitsLeft -= bitsPerValue;\n      if (bitsLeft > 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL) << bitsLeft;\n      } else if (bitsLeft == 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL);\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = 0;\n        bitsLeft = 64;\n      } else { // bitsLeft < 0\n        nextBlock |= (values[valuesOffset] & 0xFFFFFFFFL) >>> -bitsLeft;\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = (values[valuesOffset++] & ((1L << -bitsLeft) - 1)) << (64 + bitsLeft);\n        bitsLeft += 64;\n      }\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e29d4d91327929d477b701d3ef2f5b3457d26ec5","date":1359465689,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/util/packed/BulkOperationPacked#encode(int[],int,byte[],int,int).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/util/packed/BulkOperationPacked#encode(int[],int,byte[],int,int).mjava","sourceNew":"  @Override\n  public void encode(int[] values, int valuesOffset, byte[] blocks,\n      int blocksOffset, int iterations) {\n    int nextBlock = 0;\n    int bitsLeft = 8;\n    for (int i = 0; i < byteValueCount * iterations; ++i) {\n      final int v = values[valuesOffset++];\n      assert PackedInts.bitsRequired(v & 0xFFFFFFFFL) <= bitsPerValue;\n      if (bitsPerValue < bitsLeft) {\n        // just buffer\n        nextBlock |= v << (bitsLeft - bitsPerValue);\n        bitsLeft -= bitsPerValue;\n      } else {\n        // flush as many blocks as possible\n        int bits = bitsPerValue - bitsLeft;\n        blocks[blocksOffset++] = (byte) (nextBlock | (v >>> bits));\n        while (bits >= 8) {\n          bits -= 8;\n          blocks[blocksOffset++] = (byte) (v >>> bits);\n        }\n        // then buffer\n        bitsLeft = 8 - bits;\n        nextBlock = (v & ((1 << bits) - 1)) << bitsLeft;\n      }\n    }\n    assert bitsLeft == 8;\n  }\n\n","sourceOld":"  @Override\n  public void encode(int[] values, int valuesOffset, byte[] blocks,\n      int blocksOffset, int iterations) {\n    long nextBlock = 0;\n    int bitsLeft = 64;\n    for (int i = 0; i < valueCount * iterations; ++i) {\n      bitsLeft -= bitsPerValue;\n      if (bitsLeft > 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL) << bitsLeft;\n      } else if (bitsLeft == 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL);\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = 0;\n        bitsLeft = 64;\n      } else { // bitsLeft < 0\n        nextBlock |= (values[valuesOffset] & 0xFFFFFFFFL) >>> -bitsLeft;\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = (values[valuesOffset++] & ((1L << -bitsLeft) - 1)) << (64 + bitsLeft);\n        bitsLeft += 64;\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"de522d9303bd67c8473a269a1319125d1f3700e0","date":1359477856,"type":3,"author":"Adrien Grand","isMerge":true,"pathNew":"lucene/core/src/java/org/apache/lucene/util/packed/BulkOperationPacked#encode(int[],int,byte[],int,int).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/util/packed/BulkOperationPacked#encode(int[],int,byte[],int,int).mjava","sourceNew":"  @Override\n  public void encode(int[] values, int valuesOffset, byte[] blocks,\n      int blocksOffset, int iterations) {\n    int nextBlock = 0;\n    int bitsLeft = 8;\n    for (int i = 0; i < byteValueCount * iterations; ++i) {\n      final int v = values[valuesOffset++];\n      assert PackedInts.bitsRequired(v & 0xFFFFFFFFL) <= bitsPerValue;\n      if (bitsPerValue < bitsLeft) {\n        // just buffer\n        nextBlock |= v << (bitsLeft - bitsPerValue);\n        bitsLeft -= bitsPerValue;\n      } else {\n        // flush as many blocks as possible\n        int bits = bitsPerValue - bitsLeft;\n        blocks[blocksOffset++] = (byte) (nextBlock | (v >>> bits));\n        while (bits >= 8) {\n          bits -= 8;\n          blocks[blocksOffset++] = (byte) (v >>> bits);\n        }\n        // then buffer\n        bitsLeft = 8 - bits;\n        nextBlock = (v & ((1 << bits) - 1)) << bitsLeft;\n      }\n    }\n    assert bitsLeft == 8;\n  }\n\n","sourceOld":"  @Override\n  public void encode(int[] values, int valuesOffset, byte[] blocks,\n      int blocksOffset, int iterations) {\n    long nextBlock = 0;\n    int bitsLeft = 64;\n    for (int i = 0; i < valueCount * iterations; ++i) {\n      bitsLeft -= bitsPerValue;\n      if (bitsLeft > 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL) << bitsLeft;\n      } else if (bitsLeft == 0) {\n        nextBlock |= (values[valuesOffset++] & 0xFFFFFFFFL);\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = 0;\n        bitsLeft = 64;\n      } else { // bitsLeft < 0\n        nextBlock |= (values[valuesOffset] & 0xFFFFFFFFL) >>> -bitsLeft;\n        blocksOffset = writeLong(nextBlock, blocks, blocksOffset);\n        nextBlock = (values[valuesOffset++] & ((1L << -bitsLeft) - 1)) << (64 + bitsLeft);\n        bitsLeft += 64;\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"e29d4d91327929d477b701d3ef2f5b3457d26ec5":["58d488e3fd72dfc95fa76fcb24f58e90c343323c"],"58d488e3fd72dfc95fa76fcb24f58e90c343323c":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"05a14b2611ead08655a2b2bdc61632eb31316e57":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","58d488e3fd72dfc95fa76fcb24f58e90c343323c"],"de522d9303bd67c8473a269a1319125d1f3700e0":["58d488e3fd72dfc95fa76fcb24f58e90c343323c","e29d4d91327929d477b701d3ef2f5b3457d26ec5"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["e29d4d91327929d477b701d3ef2f5b3457d26ec5"]},"commit2Childs":{"e29d4d91327929d477b701d3ef2f5b3457d26ec5":["de522d9303bd67c8473a269a1319125d1f3700e0","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"58d488e3fd72dfc95fa76fcb24f58e90c343323c":["e29d4d91327929d477b701d3ef2f5b3457d26ec5","05a14b2611ead08655a2b2bdc61632eb31316e57","de522d9303bd67c8473a269a1319125d1f3700e0"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["58d488e3fd72dfc95fa76fcb24f58e90c343323c","05a14b2611ead08655a2b2bdc61632eb31316e57"],"05a14b2611ead08655a2b2bdc61632eb31316e57":[],"de522d9303bd67c8473a269a1319125d1f3700e0":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["05a14b2611ead08655a2b2bdc61632eb31316e57","de522d9303bd67c8473a269a1319125d1f3700e0","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}