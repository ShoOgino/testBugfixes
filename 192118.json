{"path":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","commits":[{"id":"601c6168c1d70f05f7a6a2d8c7ad4ceb218f3541","date":1284416022,"type":0,"author":"Ryan McKinley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\", counts.get(0).getField() );\n    assertEquals( \"true\",    counts.get(0).getValue() );\n    assertEquals(  2,       counts.get(0).getCount() );\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"251ec5b8ebb59d2b5458b97d6b8d7141b7ed8364","date":1287507822,"type":3,"author":"Ryan McKinley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\", counts.get(0).getField() );\n    assertEquals( \"true\",    counts.get(0).getValue() );\n    assertEquals(  2,       counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4ecea1664e8617d82eca3b8055a3c37cb4da8511","date":1287578668,"type":3,"author":"Simon Willnauer","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\", counts.get(0).getField() );\n    assertEquals( \"true\",    counts.get(0).getValue() );\n    assertEquals(  2,       counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a","date":1292920096,"type":0,"author":"Michael Busch","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"5012a22537f445d1736ab72a517c58a173734728","date":1296319851,"type":3,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455","date":1296321009,"type":3,"author":"Ryan McKinley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"29ef99d61cda9641b6250bf9567329a6e65f901d","date":1297244127,"type":3,"author":"Simon Willnauer","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"bde51b089eb7f86171eb3406e38a274743f9b7ac","date":1298336439,"type":3,"author":"Michael Busch","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"AAA\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"BBB\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    // Now make sure they have reasonable stuff\n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // 3 deep \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 1, counts.size() );\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"c903c3d15906a3da96b8c0c2fb704491005fdbdb","date":1453508227,"type":5,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a258fbb26824fd104ed795e5d9033d2d040049ee","date":1453508252,"type":5,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"c26f00b574427b55127e869b935845554afde1fa","date":1310252513,"type":5,"author":"Steven Rowe","isMerge":true,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","pathOld":"solr/src/test/org/apache/solr/client/solrj/SolrExampleTests#testPivotFacet().mjava","sourceNew":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","sourceOld":"  @Test\n  public void testPivotFacet() throws Exception\n  {    \n    SolrServer server = getSolrServer();\n    \n    // Empty the database...\n    server.deleteByQuery( \"*:*\" );// delete everything!\n    server.commit();\n    assertNumFound( \"*:*\", 0 ); // make sure it got in\n    \n    int id = 1;\n    ArrayList<SolrInputDocument> docs = new ArrayList<SolrInputDocument>();\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true  ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"aaa\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"a\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", false ) );\n    docs.add( makeTestDoc( \"id\", id++, \"features\", \"bbb\",  \"cat\", \"b\", \"inStock\", true ) );\n    docs.add( makeTestDoc( \"id\", id++ ) ); // something not matching\n    server.add( docs );\n    server.commit();\n    \n    SolrQuery query = new SolrQuery( \"*:*\" );\n    query.addFacetPivotField(\"features,cat\", \"cat,features\", \"features,cat,inStock\" );\n    query.setFacetMinCount( 0 );\n    query.setRows( 0 );\n    \n    QueryResponse rsp = server.query( query );\n    assertEquals( docs.size(), rsp.getResults().getNumFound() );\n    \n    NamedList<List<PivotField>> pivots = rsp.getFacetPivot();\n    assertEquals( 3, pivots.size() );\n\n//    for(Map.Entry<String, List<PivotField>> entry : pivots ) {\n//      System.out.println( \"PIVOT: \"+entry.getKey() );\n//      for( PivotField p : entry.getValue() ) {\n//        p.write(System.out, 0 );\n//      }\n//      System.out.println();\n//    }\n    \n    //  PIVOT: features,cat\n    //  features=bbb (6)\n    //    cat=b (4)\n    //    cat=a (2)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //    cat=b (2)\n    \n    List<PivotField> pivot = pivots.getVal( 0 );\n    assertEquals( \"features,cat\", pivots.getName( 0 ) );\n    assertEquals( 2, pivot.size() );\n    \n    PivotField ff = pivot.get( 0 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"bbb\", ff.getValue() );\n    assertEquals( 6, ff.getCount() );\n    List<PivotField> counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"cat\", counts.get(0).getField() );\n    assertEquals( \"b\", counts.get(0).getValue() );\n    assertEquals(   4, counts.get(0).getCount() );\n    assertEquals( \"a\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n\n    //  PIVOT: cat,features\n    //  cat=b (6)\n    //    features=bbb (4)\n    //    features=aaa (2)\n    //  cat=a (5)\n    //    features=aaa (3)\n    //    features=bbb (2)\n    \n    ff = pivot.get( 1 );\n    assertEquals( \"features\", ff.getField() );\n    assertEquals( \"aaa\", ff.getValue() );\n    assertEquals( 5, ff.getCount() );\n    counts = ff.getPivot();\n    assertEquals( 2, counts.size() );\n    assertEquals( \"a\", counts.get(0).getValue() );\n    assertEquals(   3, counts.get(0).getCount() );\n    assertEquals( \"b\", counts.get(1).getValue() );\n    assertEquals(   2, counts.get(1).getCount() );\n    \n    // Three deep:\n    //  PIVOT: features,cat,inStock\n    //  features=bbb (6)\n    //    cat=b (4)\n    //      inStock=false (2)\n    //      inStock=true (2)\n    //    cat=a (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    //  features=aaa (5)\n    //    cat=a (3)\n    //      inStock=true (2)\n    //      inStock=false (1)\n    //    cat=b (2)\n    //      inStock=false (1)\n    //      inStock=true (1)\n    \n    pivot = pivots.getVal( 2 );\n    assertEquals( \"features,cat,inStock\", pivots.getName( 2 ) );\n    assertEquals( 2, pivot.size() );\n    PivotField p = pivot.get( 1 ).getPivot().get(0);     // get(1) should be features=AAAA, then get(0) should be cat=a\n    assertEquals( \"cat\", p.getField() );\n    assertEquals( \"a\", p.getValue() );\n    counts = p.getPivot();\n  //  p.write(System.out, 5 );\n    assertEquals( 2, counts.size() );  // 2 trues and 1 false under features=AAAA,cat=a\n    assertEquals( \"inStock\",    counts.get(0).getField() );\n    assertEquals( Boolean.TRUE, counts.get(0).getValue() );\n    assertEquals(  2,           counts.get(0).getCount() );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"5012a22537f445d1736ab72a517c58a173734728":["251ec5b8ebb59d2b5458b97d6b8d7141b7ed8364"],"601c6168c1d70f05f7a6a2d8c7ad4ceb218f3541":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"c26f00b574427b55127e869b935845554afde1fa":["e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455","c903c3d15906a3da96b8c0c2fb704491005fdbdb"],"7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","251ec5b8ebb59d2b5458b97d6b8d7141b7ed8364"],"e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455":["5012a22537f445d1736ab72a517c58a173734728"],"251ec5b8ebb59d2b5458b97d6b8d7141b7ed8364":["601c6168c1d70f05f7a6a2d8c7ad4ceb218f3541"],"c903c3d15906a3da96b8c0c2fb704491005fdbdb":["e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455"],"29ef99d61cda9641b6250bf9567329a6e65f901d":["4ecea1664e8617d82eca3b8055a3c37cb4da8511","e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"a258fbb26824fd104ed795e5d9033d2d040049ee":["e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455"],"4ecea1664e8617d82eca3b8055a3c37cb4da8511":["601c6168c1d70f05f7a6a2d8c7ad4ceb218f3541","251ec5b8ebb59d2b5458b97d6b8d7141b7ed8364"],"bde51b089eb7f86171eb3406e38a274743f9b7ac":["7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a","e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["c26f00b574427b55127e869b935845554afde1fa"]},"commit2Childs":{"5012a22537f445d1736ab72a517c58a173734728":["e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455"],"601c6168c1d70f05f7a6a2d8c7ad4ceb218f3541":["251ec5b8ebb59d2b5458b97d6b8d7141b7ed8364","4ecea1664e8617d82eca3b8055a3c37cb4da8511"],"c26f00b574427b55127e869b935845554afde1fa":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a":["bde51b089eb7f86171eb3406e38a274743f9b7ac"],"e1c4ac0d284dc3281a4c3a576ee0d36ceabbc455":["c26f00b574427b55127e869b935845554afde1fa","c903c3d15906a3da96b8c0c2fb704491005fdbdb","29ef99d61cda9641b6250bf9567329a6e65f901d","a258fbb26824fd104ed795e5d9033d2d040049ee","bde51b089eb7f86171eb3406e38a274743f9b7ac"],"251ec5b8ebb59d2b5458b97d6b8d7141b7ed8364":["5012a22537f445d1736ab72a517c58a173734728","7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a","4ecea1664e8617d82eca3b8055a3c37cb4da8511"],"c903c3d15906a3da96b8c0c2fb704491005fdbdb":["c26f00b574427b55127e869b935845554afde1fa"],"29ef99d61cda9641b6250bf9567329a6e65f901d":[],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["601c6168c1d70f05f7a6a2d8c7ad4ceb218f3541","7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a"],"a258fbb26824fd104ed795e5d9033d2d040049ee":[],"4ecea1664e8617d82eca3b8055a3c37cb4da8511":["29ef99d61cda9641b6250bf9567329a6e65f901d"],"bde51b089eb7f86171eb3406e38a274743f9b7ac":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["29ef99d61cda9641b6250bf9567329a6e65f901d","a258fbb26824fd104ed795e5d9033d2d040049ee","bde51b089eb7f86171eb3406e38a274743f9b7ac","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}