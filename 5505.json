{"path":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","commits":[{"id":"3a119bbc8703c10faa329ec201c654b3a35a1e3e","date":1328644745,"type":1,"author":"Steven Rowe","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newField(r, \"content1\", \"aaa bbb ccc ddd\", TextField.TYPE_STORED));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newField(r, \"content4\", \"aaa bbb ccc ddd\", TextField.TYPE_UNSTORED));\n      doc.add(newField(r, \"content5\", \"aaa bbb ccc ddd\", StringField.TYPE_UNSTORED));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newField(r, \"content1\", \"aaa bbb ccc ddd\", TextField.TYPE_STORED));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newField(r, \"content4\", \"aaa bbb ccc ddd\", TextField.TYPE_UNSTORED));\n      doc.add(newField(r, \"content5\", \"aaa bbb ccc ddd\", StringField.TYPE_UNSTORED));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a78a90fc9701e511308346ea29f4f5e548bb39fe","date":1329489995,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newField(r, \"content1\", \"aaa bbb ccc ddd\", TextField.TYPE_STORED));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newField(r, \"content4\", \"aaa bbb ccc ddd\", TextField.TYPE_UNSTORED));\n      doc.add(newField(r, \"content5\", \"aaa bbb ccc ddd\", StringField.TYPE_UNSTORED));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newField(r, \"content1\", \"aaa bbb ccc ddd\", TextField.TYPE_STORED));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newField(r, \"content4\", \"aaa bbb ccc ddd\", TextField.TYPE_UNSTORED));\n      doc.add(newField(r, \"content5\", \"aaa bbb ccc ddd\", StringField.TYPE_UNSTORED));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":["5350389bf83287111f7760b9e3db3af8e3648474"],"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"04f07771a2a7dd3a395700665ed839c3dae2def2","date":1339350139,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newField(r, \"content1\", \"aaa bbb ccc ddd\", TextField.TYPE_STORED));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newField(r, \"content4\", \"aaa bbb ccc ddd\", TextField.TYPE_UNSTORED));\n      doc.add(newField(r, \"content5\", \"aaa bbb ccc ddd\", StringField.TYPE_UNSTORED));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":["1509f151d7692d84fae414b2b799ac06ba60fcb4"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d5d7e0270836b6e3c9bf8d1d8aa36a05b17391d8","date":1358784304,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new LongDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedBytesDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"423d89a2b3cc419b647c07c2b3fdbc54311d07f9","date":1358836612,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new LongDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedBytesDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d4d69c535930b5cce125cff868d40f6373dc27d4","date":1360270101,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"81d695ea56e846db8af5ac4e15826d341ef894e1","date":1361067281,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":["402ad3ddc9da7b70da1b167667a60ece6a1381fb"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"ddbb72a33557d2b5bc22ee95daf3281c43560502","date":1361334582,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"6613659748fe4411a7dcf85266e55db1f95f7315","date":1392773913,"type":3,"author":"Benson Margulies","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, _TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            _TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"d14ffaac9c4a4a2c750bf0cd956506802561e062","date":1402602036,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n      if (defaultCodecSupportsSortedNumeric()) {\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 10));\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 5));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":["402ad3ddc9da7b70da1b167667a60ece6a1381fb"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"c6f080a2ab37c464dd98db173f6cbf10dc74f211","date":1402946779,"type":3,"author":"Michael McCandless","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n      if (defaultCodecSupportsSortedNumeric()) {\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 10));\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 5));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ad2a673349939e48652bf304cccf673c3412198f","date":1409585169,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n      doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 10));\n      doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 5));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n      if (defaultCodecSupportsSortedNumeric()) {\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 10));\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 5));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"402ad3ddc9da7b70da1b167667a60ece6a1381fb","date":1409656478,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexWriterExceptions.IndexerThread#run().mjava","sourceNew":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n      doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 10));\n      doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 5));\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","sourceOld":"    @Override\n    public void run() {\n\n      final Document doc = new Document();\n\n      doc.add(newTextField(r, \"content1\", \"aaa bbb ccc ddd\", Field.Store.YES));\n      doc.add(newField(r, \"content6\", \"aaa bbb ccc ddd\", DocCopyIterator.custom1));\n      doc.add(newField(r, \"content2\", \"aaa bbb ccc ddd\", DocCopyIterator.custom2));\n      doc.add(newField(r, \"content3\", \"aaa bbb ccc ddd\", DocCopyIterator.custom3));\n\n      doc.add(newTextField(r, \"content4\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(newStringField(r, \"content5\", \"aaa bbb ccc ddd\", Field.Store.NO));\n      doc.add(new NumericDocValuesField(\"numericdv\", 5));\n      doc.add(new BinaryDocValuesField(\"binarydv\", new BytesRef(\"hello\")));\n      doc.add(new SortedDocValuesField(\"sorteddv\", new BytesRef(\"world\")));\n      if (defaultCodecSupportsSortedSet()) {\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"hellllo\")));\n        doc.add(new SortedSetDocValuesField(\"sortedsetdv\", new BytesRef(\"again\")));\n      }\n      if (defaultCodecSupportsSortedNumeric()) {\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 10));\n        doc.add(new SortedNumericDocValuesField(\"sortednumericdv\", 5));\n      }\n\n      doc.add(newField(r, \"content7\", \"aaa bbb ccc ddd\", DocCopyIterator.custom4));\n\n      final Field idField = newField(r, \"id\", \"\", DocCopyIterator.custom2);\n      doc.add(idField);\n\n      final long stopTime = System.currentTimeMillis() + 500;\n\n      do {\n        if (VERBOSE) {\n          System.out.println(Thread.currentThread().getName() + \": TEST: IndexerThread: cycle\");\n        }\n        doFail.set(this);\n        final String id = \"\"+r.nextInt(50);\n        idField.setStringValue(id);\n        Term idTerm = new Term(\"id\", id);\n        try {\n          if (r.nextBoolean()) {\n            writer.updateDocuments(idTerm, new DocCopyIterator(doc, TestUtil.nextInt(r, 1, 20)));\n          } else {\n            writer.updateDocument(idTerm, doc);\n          }\n        } catch (RuntimeException re) {\n          if (VERBOSE) {\n            System.out.println(Thread.currentThread().getName() + \": EXC: \");\n            re.printStackTrace(System.out);\n          }\n          try {\n            TestUtil.checkIndex(writer.getDirectory());\n          } catch (IOException ioe) {\n            System.out.println(Thread.currentThread().getName() + \": unexpected exception1\");\n            ioe.printStackTrace(System.out);\n            failure = ioe;\n            break;\n          }\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception2\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n\n        doFail.set(null);\n\n        // After a possible exception (above) I should be able\n        // to add a new document without hitting an\n        // exception:\n        try {\n          writer.updateDocument(idTerm, doc);\n        } catch (Throwable t) {\n          System.out.println(Thread.currentThread().getName() + \": unexpected exception3\");\n          t.printStackTrace(System.out);\n          failure = t;\n          break;\n        }\n      } while(System.currentTimeMillis() < stopTime);\n    }\n\n","bugFix":["81d695ea56e846db8af5ac4e15826d341ef894e1","d14ffaac9c4a4a2c750bf0cd956506802561e062"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"d5d7e0270836b6e3c9bf8d1d8aa36a05b17391d8":["04f07771a2a7dd3a395700665ed839c3dae2def2"],"6613659748fe4411a7dcf85266e55db1f95f7315":["ddbb72a33557d2b5bc22ee95daf3281c43560502"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"ddbb72a33557d2b5bc22ee95daf3281c43560502":["d4d69c535930b5cce125cff868d40f6373dc27d4","81d695ea56e846db8af5ac4e15826d341ef894e1"],"c6f080a2ab37c464dd98db173f6cbf10dc74f211":["6613659748fe4411a7dcf85266e55db1f95f7315","d14ffaac9c4a4a2c750bf0cd956506802561e062"],"402ad3ddc9da7b70da1b167667a60ece6a1381fb":["d14ffaac9c4a4a2c750bf0cd956506802561e062","ad2a673349939e48652bf304cccf673c3412198f"],"04f07771a2a7dd3a395700665ed839c3dae2def2":["a78a90fc9701e511308346ea29f4f5e548bb39fe"],"a78a90fc9701e511308346ea29f4f5e548bb39fe":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"81d695ea56e846db8af5ac4e15826d341ef894e1":["d4d69c535930b5cce125cff868d40f6373dc27d4"],"d4d69c535930b5cce125cff868d40f6373dc27d4":["04f07771a2a7dd3a395700665ed839c3dae2def2","423d89a2b3cc419b647c07c2b3fdbc54311d07f9"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"423d89a2b3cc419b647c07c2b3fdbc54311d07f9":["d5d7e0270836b6e3c9bf8d1d8aa36a05b17391d8"],"ad2a673349939e48652bf304cccf673c3412198f":["d14ffaac9c4a4a2c750bf0cd956506802561e062"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["402ad3ddc9da7b70da1b167667a60ece6a1381fb"],"d14ffaac9c4a4a2c750bf0cd956506802561e062":["6613659748fe4411a7dcf85266e55db1f95f7315"]},"commit2Childs":{"d5d7e0270836b6e3c9bf8d1d8aa36a05b17391d8":["423d89a2b3cc419b647c07c2b3fdbc54311d07f9"],"6613659748fe4411a7dcf85266e55db1f95f7315":["c6f080a2ab37c464dd98db173f6cbf10dc74f211","d14ffaac9c4a4a2c750bf0cd956506802561e062"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["a78a90fc9701e511308346ea29f4f5e548bb39fe"],"ddbb72a33557d2b5bc22ee95daf3281c43560502":["6613659748fe4411a7dcf85266e55db1f95f7315"],"c6f080a2ab37c464dd98db173f6cbf10dc74f211":[],"402ad3ddc9da7b70da1b167667a60ece6a1381fb":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"04f07771a2a7dd3a395700665ed839c3dae2def2":["d5d7e0270836b6e3c9bf8d1d8aa36a05b17391d8","d4d69c535930b5cce125cff868d40f6373dc27d4"],"81d695ea56e846db8af5ac4e15826d341ef894e1":["ddbb72a33557d2b5bc22ee95daf3281c43560502"],"a78a90fc9701e511308346ea29f4f5e548bb39fe":["04f07771a2a7dd3a395700665ed839c3dae2def2"],"d4d69c535930b5cce125cff868d40f6373dc27d4":["ddbb72a33557d2b5bc22ee95daf3281c43560502","81d695ea56e846db8af5ac4e15826d341ef894e1"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"ad2a673349939e48652bf304cccf673c3412198f":["402ad3ddc9da7b70da1b167667a60ece6a1381fb"],"423d89a2b3cc419b647c07c2b3fdbc54311d07f9":["d4d69c535930b5cce125cff868d40f6373dc27d4"],"d14ffaac9c4a4a2c750bf0cd956506802561e062":["c6f080a2ab37c464dd98db173f6cbf10dc74f211","402ad3ddc9da7b70da1b167667a60ece6a1381fb","ad2a673349939e48652bf304cccf673c3412198f"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["c6f080a2ab37c464dd98db173f6cbf10dc74f211","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}