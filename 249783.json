{"path":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","commits":[{"id":"511309ff970d3c2a68d1ac453cc187df1198f0d1","date":1410303604,"type":0,"author":"Chris M. Hostetter","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","pathOld":"/dev/null","sourceNew":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"283ff02f401ec3e7a2fad73643970f052383fb0c","date":1411407953,"type":3,"author":"Chris M. Hostetter","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","sourceNew":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    final String fpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+f+\"']/\";\n    final String key = \"key_key\";\n    final String kpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+key+\"']/\";\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n\n    // we should be able to compute exact same stats for a field even\n    // when we specify it using the \"field()\" function, or use other \n    // identify equivilent functions\n    for (String param : new String[] {\n        // bare\n        \"{!key=\"+key+\" ex=key_ex_tag}\" + f,\n        \"{!key=\"+key+\" ex=key_ex_tag v=\"+f+\"}\",\n        // field func\n        \"{!lucene key=\"+key+\" ex=key_ex_tag}_val_:\\\"field(\"+f+\")\\\"\",\n        \"{!func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v=field(\"+f+\")}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='field(\"+f+\")'}\",\n\n        // identity math functions don't work as expected due to LUCENE-5961\n        // \"{!type=func key=\"+key+\" ex=key_ex_tag v='sum(0,\"+f+\")'}\",\n        // \"{!type=func key=\"+key+\" ex=key_ex_tag v='product(1,\"+f+\")'}\",\n      }) {\n      \n      assertQ(\"test statistics over field specified as a function: \" + param,\n              // NOTE: baseParams aren't used, we're looking at the function\n              req(\"q\", \"*:*\", \"stats\", \"true\", \"stats.calcdistinct\", \"true\",\n                  \"fq\", \"{!tag=key_ex_tag}-id:4\", \n                  \"stats.field\", param)\n              \n              , kpre + \"double[@name='min'][.='-40.0']\"\n              , kpre + \"double[@name='max'][.='-10.0']\"\n              , kpre + \"double[@name='sum'][.='-70.0']\"\n              , kpre + \"long[@name='count'][.='3']\"\n              , kpre + \"long[@name='missing'][.='1']\"\n              , kpre + \"long[@name='countDistinct'][.='3']\"\n              , \"count(\" + kpre + \"arr[@name='distinctValues']/*)=3\"\n              , kpre + \"double[@name='sumOfSquares'][.='2100.0']\"\n              , kpre + \"double[@name='mean'][.='-23.333333333333332']\"\n              , kpre + \"double[@name='stddev'][.='15.275252316519467']\"\n              \n              );\n    }\n\n  }\n\n","sourceOld":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n  }\n\n","bugFix":null,"bugIntro":["9f4251f14d2db68330fc1e6f0495c053a905d560"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"a701a7aab388afa1412a3dc23b4115c321f478c4","date":1413486320,"type":3,"author":"Chris M. Hostetter","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","sourceNew":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    final String fpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+f+\"']/\";\n    final String key = \"key_key\";\n    final String kpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+key+\"']/\";\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n\n    // we should be able to compute exact same stats for a field even\n    // when we specify it using the \"field()\" function, or use other \n    // identify equivilent functions\n    for (String param : new String[] {\n        // bare\n        \"{!key=\"+key+\" ex=key_ex_tag}\" + f,\n        \"{!key=\"+key+\" ex=key_ex_tag v=\"+f+\"}\",\n        // field func\n        \"{!lucene key=\"+key+\" ex=key_ex_tag}_val_:\\\"field(\"+f+\")\\\"\",\n        \"{!func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v=field(\"+f+\")}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='field(\"+f+\")'}\",\n        // identity math functions\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='sum(0,\"+f+\")'}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='product(1,\"+f+\")'}\",\n      }) {\n      \n      assertQ(\"test statistics over field specified as a function: \" + param,\n              // NOTE: baseParams aren't used, we're looking at the function\n              req(\"q\", \"*:*\", \"stats\", \"true\", \"stats.calcdistinct\", \"true\",\n                  \"fq\", \"{!tag=key_ex_tag}-id:4\", \n                  \"stats.field\", param)\n              \n              , kpre + \"double[@name='min'][.='-40.0']\"\n              , kpre + \"double[@name='max'][.='-10.0']\"\n              , kpre + \"double[@name='sum'][.='-70.0']\"\n              , kpre + \"long[@name='count'][.='3']\"\n              , kpre + \"long[@name='missing'][.='1']\"\n              , kpre + \"long[@name='countDistinct'][.='3']\"\n              , \"count(\" + kpre + \"arr[@name='distinctValues']/*)=3\"\n              , kpre + \"double[@name='sumOfSquares'][.='2100.0']\"\n              , kpre + \"double[@name='mean'][.='-23.333333333333332']\"\n              , kpre + \"double[@name='stddev'][.='15.275252316519467']\"\n              \n              );\n    }\n\n  }\n\n","sourceOld":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    final String fpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+f+\"']/\";\n    final String key = \"key_key\";\n    final String kpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+key+\"']/\";\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n\n    // we should be able to compute exact same stats for a field even\n    // when we specify it using the \"field()\" function, or use other \n    // identify equivilent functions\n    for (String param : new String[] {\n        // bare\n        \"{!key=\"+key+\" ex=key_ex_tag}\" + f,\n        \"{!key=\"+key+\" ex=key_ex_tag v=\"+f+\"}\",\n        // field func\n        \"{!lucene key=\"+key+\" ex=key_ex_tag}_val_:\\\"field(\"+f+\")\\\"\",\n        \"{!func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v=field(\"+f+\")}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='field(\"+f+\")'}\",\n\n        // identity math functions don't work as expected due to LUCENE-5961\n        // \"{!type=func key=\"+key+\" ex=key_ex_tag v='sum(0,\"+f+\")'}\",\n        // \"{!type=func key=\"+key+\" ex=key_ex_tag v='product(1,\"+f+\")'}\",\n      }) {\n      \n      assertQ(\"test statistics over field specified as a function: \" + param,\n              // NOTE: baseParams aren't used, we're looking at the function\n              req(\"q\", \"*:*\", \"stats\", \"true\", \"stats.calcdistinct\", \"true\",\n                  \"fq\", \"{!tag=key_ex_tag}-id:4\", \n                  \"stats.field\", param)\n              \n              , kpre + \"double[@name='min'][.='-40.0']\"\n              , kpre + \"double[@name='max'][.='-10.0']\"\n              , kpre + \"double[@name='sum'][.='-70.0']\"\n              , kpre + \"long[@name='count'][.='3']\"\n              , kpre + \"long[@name='missing'][.='1']\"\n              , kpre + \"long[@name='countDistinct'][.='3']\"\n              , \"count(\" + kpre + \"arr[@name='distinctValues']/*)=3\"\n              , kpre + \"double[@name='sumOfSquares'][.='2100.0']\"\n              , kpre + \"double[@name='mean'][.='-23.333333333333332']\"\n              , kpre + \"double[@name='stddev'][.='15.275252316519467']\"\n              \n              );\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"0a22eafe3f72a4c2945eaad9547e6c78816978f4","date":1413956657,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","sourceNew":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    final String fpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+f+\"']/\";\n    final String key = \"key_key\";\n    final String kpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+key+\"']/\";\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n\n    // we should be able to compute exact same stats for a field even\n    // when we specify it using the \"field()\" function, or use other \n    // identify equivilent functions\n    for (String param : new String[] {\n        // bare\n        \"{!key=\"+key+\" ex=key_ex_tag}\" + f,\n        \"{!key=\"+key+\" ex=key_ex_tag v=\"+f+\"}\",\n        // field func\n        \"{!lucene key=\"+key+\" ex=key_ex_tag}_val_:\\\"field(\"+f+\")\\\"\",\n        \"{!func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v=field(\"+f+\")}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='field(\"+f+\")'}\",\n        // identity math functions\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='sum(0,\"+f+\")'}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='product(1,\"+f+\")'}\",\n      }) {\n      \n      assertQ(\"test statistics over field specified as a function: \" + param,\n              // NOTE: baseParams aren't used, we're looking at the function\n              req(\"q\", \"*:*\", \"stats\", \"true\", \"stats.calcdistinct\", \"true\",\n                  \"fq\", \"{!tag=key_ex_tag}-id:4\", \n                  \"stats.field\", param)\n              \n              , kpre + \"double[@name='min'][.='-40.0']\"\n              , kpre + \"double[@name='max'][.='-10.0']\"\n              , kpre + \"double[@name='sum'][.='-70.0']\"\n              , kpre + \"long[@name='count'][.='3']\"\n              , kpre + \"long[@name='missing'][.='1']\"\n              , kpre + \"long[@name='countDistinct'][.='3']\"\n              , \"count(\" + kpre + \"arr[@name='distinctValues']/*)=3\"\n              , kpre + \"double[@name='sumOfSquares'][.='2100.0']\"\n              , kpre + \"double[@name='mean'][.='-23.333333333333332']\"\n              , kpre + \"double[@name='stddev'][.='15.275252316519467']\"\n              \n              );\n    }\n\n  }\n\n","sourceOld":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    final String fpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+f+\"']/\";\n    final String key = \"key_key\";\n    final String kpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+key+\"']/\";\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n\n    // we should be able to compute exact same stats for a field even\n    // when we specify it using the \"field()\" function, or use other \n    // identify equivilent functions\n    for (String param : new String[] {\n        // bare\n        \"{!key=\"+key+\" ex=key_ex_tag}\" + f,\n        \"{!key=\"+key+\" ex=key_ex_tag v=\"+f+\"}\",\n        // field func\n        \"{!lucene key=\"+key+\" ex=key_ex_tag}_val_:\\\"field(\"+f+\")\\\"\",\n        \"{!func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v=field(\"+f+\")}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='field(\"+f+\")'}\",\n\n        // identity math functions don't work as expected due to LUCENE-5961\n        // \"{!type=func key=\"+key+\" ex=key_ex_tag v='sum(0,\"+f+\")'}\",\n        // \"{!type=func key=\"+key+\" ex=key_ex_tag v='product(1,\"+f+\")'}\",\n      }) {\n      \n      assertQ(\"test statistics over field specified as a function: \" + param,\n              // NOTE: baseParams aren't used, we're looking at the function\n              req(\"q\", \"*:*\", \"stats\", \"true\", \"stats.calcdistinct\", \"true\",\n                  \"fq\", \"{!tag=key_ex_tag}-id:4\", \n                  \"stats.field\", param)\n              \n              , kpre + \"double[@name='min'][.='-40.0']\"\n              , kpre + \"double[@name='max'][.='-10.0']\"\n              , kpre + \"double[@name='sum'][.='-70.0']\"\n              , kpre + \"long[@name='count'][.='3']\"\n              , kpre + \"long[@name='missing'][.='1']\"\n              , kpre + \"long[@name='countDistinct'][.='3']\"\n              , \"count(\" + kpre + \"arr[@name='distinctValues']/*)=3\"\n              , kpre + \"double[@name='sumOfSquares'][.='2100.0']\"\n              , kpre + \"double[@name='mean'][.='-23.333333333333332']\"\n              , kpre + \"double[@name='stddev'][.='15.275252316519467']\"\n              \n              );\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"9f4251f14d2db68330fc1e6f0495c053a905d560","date":1537116380,"type":3,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/StatsComponentTest#doTestFieldStatisticsMissingResult(String,SolrParams[]).mjava","sourceNew":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    final String fpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+f+\"']/\";\n    final String key = \"key_key\";\n    final String kpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+key+\"']/\";\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n\n    // we should be able to compute exact same stats for a field even\n    // when we specify it using the \"field()\" function, or use other \n    // identify equivalent functions\n    for (String param : new String[] {\n        // bare\n        \"{!key=\"+key+\" ex=key_ex_tag}\" + f,\n        \"{!key=\"+key+\" ex=key_ex_tag v=\"+f+\"}\",\n        // field func\n        \"{!lucene key=\"+key+\" ex=key_ex_tag}_val_:\\\"field(\"+f+\")\\\"\",\n        \"{!func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v=field(\"+f+\")}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='field(\"+f+\")'}\",\n        // identity math functions\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='sum(0,\"+f+\")'}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='product(1,\"+f+\")'}\",\n      }) {\n      \n      assertQ(\"test statistics over field specified as a function: \" + param,\n              // NOTE: baseParams aren't used, we're looking at the function\n              req(\"q\", \"*:*\", \"stats\", \"true\", \"stats.calcdistinct\", \"true\",\n                  \"fq\", \"{!tag=key_ex_tag}-id:4\", \n                  \"stats.field\", param)\n              \n              , kpre + \"double[@name='min'][.='-40.0']\"\n              , kpre + \"double[@name='max'][.='-10.0']\"\n              , kpre + \"double[@name='sum'][.='-70.0']\"\n              , kpre + \"long[@name='count'][.='3']\"\n              , kpre + \"long[@name='missing'][.='1']\"\n              , kpre + \"long[@name='countDistinct'][.='3']\"\n              , \"count(\" + kpre + \"arr[@name='distinctValues']/*)=3\"\n              , kpre + \"double[@name='sumOfSquares'][.='2100.0']\"\n              , kpre + \"double[@name='mean'][.='-23.333333333333332']\"\n              , kpre + \"double[@name='stddev'][.='15.275252316519467']\"\n              \n              );\n    }\n\n  }\n\n","sourceOld":"  public void doTestFieldStatisticsMissingResult(String f, SolrParams[] baseParamsSet) throws Exception {\n    assertU(adoc(\"id\", \"1\", f, \"-10\"));\n    assertU(adoc(\"id\", \"2\", f, \"-20\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"3\"));\n    assertU(adoc(\"id\", \"4\", f, \"-40\"));\n    assertU(commit());\n\n    final String fpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+f+\"']/\";\n    final String key = \"key_key\";\n    final String kpre = XPRE + \"lst[@name='stats_fields']/lst[@name='\"+key+\"']/\";\n\n    // status should be the same regardless of baseParams\n    for (SolrParams baseParams : baseParamsSet) {\n\n      SolrQueryRequest request = req(baseParams, \"q\", \"*:*\", \"stats.calcdistinct\", \"true\");\n\n      assertQ(\"test statistics values\", request\n              , \"//double[@name='min'][.='-40.0']\"\n              , \"//double[@name='max'][.='-10.0']\"\n              , \"//double[@name='sum'][.='-70.0']\"\n              , \"//long[@name='count'][.='3']\"\n              , \"//long[@name='missing'][.='1']\"\n              , \"//long[@name='countDistinct'][.='3']\"\n              , \"count(//arr[@name='distinctValues']/*)=3\"\n              , \"//double[@name='sumOfSquares'][.='2100.0']\"\n              , \"//double[@name='mean'][.='-23.333333333333332']\"\n              , \"//double[@name='stddev'][.='15.275252316519467']\"\n              );\n    }\n\n    // we should be able to compute exact same stats for a field even\n    // when we specify it using the \"field()\" function, or use other \n    // identify equivilent functions\n    for (String param : new String[] {\n        // bare\n        \"{!key=\"+key+\" ex=key_ex_tag}\" + f,\n        \"{!key=\"+key+\" ex=key_ex_tag v=\"+f+\"}\",\n        // field func\n        \"{!lucene key=\"+key+\" ex=key_ex_tag}_val_:\\\"field(\"+f+\")\\\"\",\n        \"{!func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag}field(\"+f+\")\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v=field(\"+f+\")}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='field(\"+f+\")'}\",\n        // identity math functions\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='sum(0,\"+f+\")'}\",\n        \"{!type=func key=\"+key+\" ex=key_ex_tag v='product(1,\"+f+\")'}\",\n      }) {\n      \n      assertQ(\"test statistics over field specified as a function: \" + param,\n              // NOTE: baseParams aren't used, we're looking at the function\n              req(\"q\", \"*:*\", \"stats\", \"true\", \"stats.calcdistinct\", \"true\",\n                  \"fq\", \"{!tag=key_ex_tag}-id:4\", \n                  \"stats.field\", param)\n              \n              , kpre + \"double[@name='min'][.='-40.0']\"\n              , kpre + \"double[@name='max'][.='-10.0']\"\n              , kpre + \"double[@name='sum'][.='-70.0']\"\n              , kpre + \"long[@name='count'][.='3']\"\n              , kpre + \"long[@name='missing'][.='1']\"\n              , kpre + \"long[@name='countDistinct'][.='3']\"\n              , \"count(\" + kpre + \"arr[@name='distinctValues']/*)=3\"\n              , kpre + \"double[@name='sumOfSquares'][.='2100.0']\"\n              , kpre + \"double[@name='mean'][.='-23.333333333333332']\"\n              , kpre + \"double[@name='stddev'][.='15.275252316519467']\"\n              \n              );\n    }\n\n  }\n\n","bugFix":["283ff02f401ec3e7a2fad73643970f052383fb0c"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"283ff02f401ec3e7a2fad73643970f052383fb0c":["511309ff970d3c2a68d1ac453cc187df1198f0d1"],"9f4251f14d2db68330fc1e6f0495c053a905d560":["a701a7aab388afa1412a3dc23b4115c321f478c4"],"511309ff970d3c2a68d1ac453cc187df1198f0d1":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"0a22eafe3f72a4c2945eaad9547e6c78816978f4":["283ff02f401ec3e7a2fad73643970f052383fb0c","a701a7aab388afa1412a3dc23b4115c321f478c4"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"a701a7aab388afa1412a3dc23b4115c321f478c4":["283ff02f401ec3e7a2fad73643970f052383fb0c"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["9f4251f14d2db68330fc1e6f0495c053a905d560"]},"commit2Childs":{"283ff02f401ec3e7a2fad73643970f052383fb0c":["0a22eafe3f72a4c2945eaad9547e6c78816978f4","a701a7aab388afa1412a3dc23b4115c321f478c4"],"511309ff970d3c2a68d1ac453cc187df1198f0d1":["283ff02f401ec3e7a2fad73643970f052383fb0c"],"9f4251f14d2db68330fc1e6f0495c053a905d560":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"0a22eafe3f72a4c2945eaad9547e6c78816978f4":[],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["511309ff970d3c2a68d1ac453cc187df1198f0d1"],"a701a7aab388afa1412a3dc23b4115c321f478c4":["9f4251f14d2db68330fc1e6f0495c053a905d560","0a22eafe3f72a4c2945eaad9547e6c78816978f4"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["0a22eafe3f72a4c2945eaad9547e6c78816978f4","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}