{"path":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","commits":[{"id":"f4abec28b874149a7223e32cc7a01704c27790de","date":1410644789,"type":1,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(File,boolean).mjava","sourceNew":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    IOException exc = null;\n    \n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      for (int retry = 0; retry < 5; retry++) {\n        try {\n          file.force(true);\n          return;\n        } catch (IOException ioe) {\n          if (exc == null) {\n            exc = ioe;\n          }\n          try {\n            // Pause 5 msec\n            Thread.sleep(5L);\n          } catch (InterruptedException ie) {\n            ThreadInterruptedException ex = new ThreadInterruptedException(ie);\n            ex.addSuppressed(exc);\n            throw ex;\n          }\n        }\n      }\n    } catch (IOException ioe) {\n      if (exc == null) {\n        exc = ioe;\n      }\n    }\n    \n    if (isDir) {\n      assert (Constants.LINUX || Constants.MAC_OS_X) == false :\n        \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n        \"we just don't want to rely on that in production (undocumented). Got: \" + exc;\n      // Ignore exception if it is a directory\n      return;\n    }\n    \n    // Throw original exception\n    throw exc;\n  }\n\n","sourceOld":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(File fileToSync, boolean isDir) throws IOException {\n    IOException exc = null;\n    \n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync.toPath(), isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      for (int retry = 0; retry < 5; retry++) {\n        try {\n          file.force(true);\n          return;\n        } catch (IOException ioe) {\n          if (exc == null) {\n            exc = ioe;\n          }\n          try {\n            // Pause 5 msec\n            Thread.sleep(5L);\n          } catch (InterruptedException ie) {\n            ThreadInterruptedException ex = new ThreadInterruptedException(ie);\n            ex.addSuppressed(exc);\n            throw ex;\n          }\n        }\n      }\n    } catch (IOException ioe) {\n      if (exc == null) {\n        exc = ioe;\n      }\n    }\n    \n    if (isDir) {\n      assert (Constants.LINUX || Constants.MAC_OS_X) == false :\n        \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n        \"we just don't want to rely on that in production (undocumented). Got: \" + exc;\n      // Ignore exception if it is a directory\n      return;\n    }\n    \n    // Throw original exception\n    throw exc;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"5283fbb5ea2e4ce12ab83ca403b3d7ac7b5381aa","date":1420754343,"type":3,"author":"Uwe Schindler","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","sourceNew":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    IOException exc = null;\n    \n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      for (int retry = 0; retry < 5; retry++) {\n        try {\n          file.force(true);\n          return;\n        } catch (IOException ioe) {\n          if (exc == null) {\n            exc = ioe;\n          }\n          try {\n            // Pause 5 msec\n            Thread.sleep(5L);\n          } catch (InterruptedException ie) {\n            ThreadInterruptedException ex = new ThreadInterruptedException(ie);\n            ex.addSuppressed(exc);\n            throw ex;\n          }\n        }\n      }\n    } catch (IOException ioe) {\n      if (exc == null) {\n        exc = ioe;\n      }\n    }\n    \n    if (isDir) {\n      // TODO: LUCENE-6169 - Fix this assert once Java 9 problems are solved!\n      assert (Constants.LINUX || Constants.MAC_OS_X) == false || Constants.JRE_IS_MINIMUM_JAVA9 :\n        \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n        \"we just don't want to rely on that in production (undocumented). Got: \" + exc;\n      // Ignore exception if it is a directory\n      return;\n    }\n    \n    // Throw original exception\n    throw exc;\n  }\n\n","sourceOld":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    IOException exc = null;\n    \n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      for (int retry = 0; retry < 5; retry++) {\n        try {\n          file.force(true);\n          return;\n        } catch (IOException ioe) {\n          if (exc == null) {\n            exc = ioe;\n          }\n          try {\n            // Pause 5 msec\n            Thread.sleep(5L);\n          } catch (InterruptedException ie) {\n            ThreadInterruptedException ex = new ThreadInterruptedException(ie);\n            ex.addSuppressed(exc);\n            throw ex;\n          }\n        }\n      }\n    } catch (IOException ioe) {\n      if (exc == null) {\n        exc = ioe;\n      }\n    }\n    \n    if (isDir) {\n      assert (Constants.LINUX || Constants.MAC_OS_X) == false :\n        \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n        \"we just don't want to rely on that in production (undocumented). Got: \" + exc;\n      // Ignore exception if it is a directory\n      return;\n    }\n    \n    // Throw original exception\n    throw exc;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4f5159625934e6e0ae0335133511ddfd5e8b72bb","date":1448188077,"type":3,"author":"Uwe Schindler","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","sourceNew":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      file.force(true);\n    } catch (IOException ioe) {\n      if (isDir) {\n        // TODO: LUCENE-6169 - Fix this assert once Java 9 problems are solved!\n        assert (Constants.LINUX || Constants.MAC_OS_X) == false || Constants.JRE_IS_MINIMUM_JAVA9 :\n            \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n                \"we just don't want to rely on that in production (undocumented). Got: \" + ioe;\n        // Ignore exception if it is a directory\n        return;\n      }\n      // Throw original exception\n      throw ioe;\n    }\n  }\n\n","sourceOld":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    IOException exc = null;\n    \n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      for (int retry = 0; retry < 5; retry++) {\n        try {\n          file.force(true);\n          return;\n        } catch (IOException ioe) {\n          if (exc == null) {\n            exc = ioe;\n          }\n          try {\n            // Pause 5 msec\n            Thread.sleep(5L);\n          } catch (InterruptedException ie) {\n            ThreadInterruptedException ex = new ThreadInterruptedException(ie);\n            ex.addSuppressed(exc);\n            throw ex;\n          }\n        }\n      }\n    } catch (IOException ioe) {\n      if (exc == null) {\n        exc = ioe;\n      }\n    }\n    \n    if (isDir) {\n      // TODO: LUCENE-6169 - Fix this assert once Java 9 problems are solved!\n      assert (Constants.LINUX || Constants.MAC_OS_X) == false || Constants.JRE_IS_MINIMUM_JAVA9 :\n        \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n        \"we just don't want to rely on that in production (undocumented). Got: \" + exc;\n      // Ignore exception if it is a directory\n      return;\n    }\n    \n    // Throw original exception\n    throw exc;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"38e44ce80990aa188cb4073813526426c74d9ea5","date":1448188436,"type":3,"author":"Uwe Schindler","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","sourceNew":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      file.force(true);\n    } catch (IOException ioe) {\n      if (isDir) {\n        assert (Constants.LINUX || Constants.MAC_OS_X) == false :\n            \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n                \"we just don't want to rely on that in production (undocumented). Got: \" + ioe;\n        // Ignore exception if it is a directory\n        return;\n      }\n      // Throw original exception\n      throw ioe;\n    }\n  }\n\n","sourceOld":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      file.force(true);\n    } catch (IOException ioe) {\n      if (isDir) {\n        // TODO: LUCENE-6169 - Fix this assert once Java 9 problems are solved!\n        assert (Constants.LINUX || Constants.MAC_OS_X) == false || Constants.JRE_IS_MINIMUM_JAVA9 :\n            \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n                \"we just don't want to rely on that in production (undocumented). Got: \" + ioe;\n        // Ignore exception if it is a directory\n        return;\n      }\n      // Throw original exception\n      throw ioe;\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a467d116bd4cee7714c1a800edf7575ae00074c5","date":1560241154,"type":3,"author":"Jason Tedor","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/util/IOUtils#fsync(Path,boolean).mjava","sourceNew":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    if (isDir && Constants.WINDOWS) {\n      // opening a directory on Windows fails, directories can not be fsynced there\n      if (Files.exists(fileToSync) == false) {\n        // yet do not suppress trying to fsync directories that do not exist\n        throw new NoSuchFileException(fileToSync.toString());\n      }\n      return;\n    }\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      try {\n        file.force(true);\n      } catch (final IOException e) {\n        if (isDir) {\n          assert (Constants.LINUX || Constants.MAC_OS_X) == false :\n              \"On Linux and MacOSX fsyncing a directory should not throw IOException, \" +\n                  \"we just don't want to rely on that in production (undocumented). Got: \" + e;\n          // Ignore exception if it is a directory\n          return;\n        }\n        // Throw original exception\n        throw e;\n      }\n    }\n  }\n\n","sourceOld":"  /**\n   * Ensure that any writes to the given file is written to the storage device that contains it.\n   * @param fileToSync the file to fsync\n   * @param isDir if true, the given file is a directory (we open for read and ignore IOExceptions,\n   *  because not all file systems and operating systems allow to fsync on a directory)\n   */\n  public static void fsync(Path fileToSync, boolean isDir) throws IOException {\n    // If the file is a directory we have to open read-only, for regular files we must open r/w for the fsync to have an effect.\n    // See http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/\n    try (final FileChannel file = FileChannel.open(fileToSync, isDir ? StandardOpenOption.READ : StandardOpenOption.WRITE)) {\n      file.force(true);\n    } catch (IOException ioe) {\n      if (isDir) {\n        assert (Constants.LINUX || Constants.MAC_OS_X) == false :\n            \"On Linux and MacOSX fsyncing a directory should not throw IOException, \"+\n                \"we just don't want to rely on that in production (undocumented). Got: \" + ioe;\n        // Ignore exception if it is a directory\n        return;\n      }\n      // Throw original exception\n      throw ioe;\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a467d116bd4cee7714c1a800edf7575ae00074c5":["38e44ce80990aa188cb4073813526426c74d9ea5"],"4f5159625934e6e0ae0335133511ddfd5e8b72bb":["5283fbb5ea2e4ce12ab83ca403b3d7ac7b5381aa"],"5283fbb5ea2e4ce12ab83ca403b3d7ac7b5381aa":["f4abec28b874149a7223e32cc7a01704c27790de"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"38e44ce80990aa188cb4073813526426c74d9ea5":["4f5159625934e6e0ae0335133511ddfd5e8b72bb"],"f4abec28b874149a7223e32cc7a01704c27790de":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["a467d116bd4cee7714c1a800edf7575ae00074c5"]},"commit2Childs":{"a467d116bd4cee7714c1a800edf7575ae00074c5":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"4f5159625934e6e0ae0335133511ddfd5e8b72bb":["38e44ce80990aa188cb4073813526426c74d9ea5"],"5283fbb5ea2e4ce12ab83ca403b3d7ac7b5381aa":["4f5159625934e6e0ae0335133511ddfd5e8b72bb"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["f4abec28b874149a7223e32cc7a01704c27790de"],"38e44ce80990aa188cb4073813526426c74d9ea5":["a467d116bd4cee7714c1a800edf7575ae00074c5"],"f4abec28b874149a7223e32cc7a01704c27790de":["5283fbb5ea2e4ce12ab83ca403b3d7ac7b5381aa"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}