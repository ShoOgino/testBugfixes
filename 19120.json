{"path":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","commits":[{"id":"b4804614e0358954d5d9f51128fcf3cd79e6e25b","date":1352831451,"type":0,"author":"James Dyer","isMerge":false,"pathNew":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","pathOld":"/dev/null","sourceNew":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"<dataConfig> \\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":["eeaccf8ed3c4b0b78b25b3d8c3e14fcd60a65531"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"9996c9e8eaf37a4104c98ae4e08f2d78514021c3","date":1354643140,"type":3,"author":"James Dyer","isMerge":false,"pathNew":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","pathOld":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","sourceNew":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.info(config);\n    return config;\n  }\n\n","sourceOld":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"<dataConfig> \\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"602d00a40b81360150f946906e46824f91cd3860","date":1354739380,"type":3,"author":"James Dyer","isMerge":false,"pathNew":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","pathOld":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","sourceNew":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","sourceOld":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.info(config);\n    return config;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"407687e67faf6e1f02a211ca078d8e3eed631027","date":1355157407,"type":0,"author":"Robert Muir","isMerge":true,"pathNew":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","pathOld":"/dev/null","sourceNew":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"eeaccf8ed3c4b0b78b25b3d8c3e14fcd60a65531","date":1406379970,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","pathOld":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","sourceNew":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;territory=en_US'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","sourceOld":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","bugFix":["b4804614e0358954d5d9f51128fcf3cd79e6e25b"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4ae7b4adfa274da5f5fdc865e127928b25e5e929","date":1417607786,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","pathOld":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","sourceNew":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;territory=en_US'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n  \n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' \"\n                    +((sportsZipper||countryZipper?\"ORDER BY ID\":\"\")\n                     +(wrongPeopleOrder? \" DESC\":\"\"))+\"'' \");\n\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          \n          if(countryZipper){// really odd join btw. it sends duped countries \n            sb.append(random().nextBoolean() ? \"cacheKey=''ID'' cacheLookup=''People.ID'' \"\n                : \"where=''ID=People.ID'' \");\n            sb.append(\"join=''zipper'' query=''SELECT PEOPLE.ID, CODE, COUNTRY_NAME FROM COUNTRIES\"\n                + \" JOIN PEOPLE ON COUNTRIES.CODE=PEOPLE.COUNTRY_CODE \"\n                + \"WHERE PEOPLE.DELETED != 'Y' ORDER BY PEOPLE.ID \"+\n                (wrongCountryOrder ? \" DESC\":\"\")\n                + \"'' \");\n          }else{\n            sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n                : \"where=''CODE=People.COUNTRY_CODE'' \");\n            sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          }\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          if(sportsZipper){\n              sb.append(\"join=''zipper'' query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY PERSON_ID\"\n                  + (wrongSportsOrder?\" DESC\" : \"\")+\n                  \"'' \");\n            }\n          else{\n            sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n          }\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","sourceOld":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;territory=en_US'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' '' \");\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n              : \"where=''CODE=People.COUNTRY_CODE'' \");\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"2fc9f4a33c8fefeb1260aea04273a36b0d32378e","date":1421852764,"type":3,"author":"Alan Woodward","isMerge":false,"pathNew":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","pathOld":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","sourceNew":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;territory=en_US'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n  \n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' \"\n                    +((sportsZipper||countryZipper?\"ORDER BY ID\":\"\")\n                     +(wrongPeopleOrder? \" DESC\":\"\"))+\"'' \");\n\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(\"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          \n          if(countryZipper){// really odd join btw. it sends duped countries \n            sb.append(random().nextBoolean() ? \"cacheKey=''ID'' cacheLookup=''People.ID'' \"\n                : \"where=''ID=People.ID'' \");\n            sb.append(\"join=''zipper'' query=''SELECT PEOPLE.ID, CODE, COUNTRY_NAME FROM COUNTRIES\"\n                + \" JOIN PEOPLE ON COUNTRIES.CODE=PEOPLE.COUNTRY_CODE \"\n                + \"WHERE PEOPLE.DELETED != 'Y' ORDER BY PEOPLE.ID \"+\n                (wrongCountryOrder ? \" DESC\":\"\")\n                + \"'' \");\n          }else{\n            sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n                : \"where=''CODE=People.COUNTRY_CODE'' \");\n            sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          }\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(\"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          if(sportsZipper){\n              sb.append(\"join=''zipper'' query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY PERSON_ID\"\n                  + (wrongSportsOrder?\" DESC\" : \"\")+\n                  \"'' \");\n            }\n          else{\n            sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n          }\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","sourceOld":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;territory=en_US'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n  \n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' \"\n                    +((sportsZipper||countryZipper?\"ORDER BY ID\":\"\")\n                     +(wrongPeopleOrder? \" DESC\":\"\"))+\"'' \");\n\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          \n          if(countryZipper){// really odd join btw. it sends duped countries \n            sb.append(random().nextBoolean() ? \"cacheKey=''ID'' cacheLookup=''People.ID'' \"\n                : \"where=''ID=People.ID'' \");\n            sb.append(\"join=''zipper'' query=''SELECT PEOPLE.ID, CODE, COUNTRY_NAME FROM COUNTRIES\"\n                + \" JOIN PEOPLE ON COUNTRIES.CODE=PEOPLE.COUNTRY_CODE \"\n                + \"WHERE PEOPLE.DELETED != 'Y' ORDER BY PEOPLE.ID \"+\n                (wrongCountryOrder ? \" DESC\":\"\")\n                + \"'' \");\n          }else{\n            sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n                : \"where=''CODE=People.COUNTRY_CODE'' \");\n            sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          }\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(random().nextBoolean() ? \"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \"\n            : \"processor=''CachedSqlEntityProcessor'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          if(sportsZipper){\n              sb.append(\"join=''zipper'' query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY PERSON_ID\"\n                  + (wrongSportsOrder?\" DESC\" : \"\")+\n                  \"'' \");\n            }\n          else{\n            sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n          }\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d2c8f5c46c2501b61e2f55eb7ee59e6c5372290b","date":1598712724,"type":4,"author":"Alexandre Rafalovitch","isMerge":false,"pathNew":"/dev/null","pathOld":"solr/contrib/dataimporthandler/src/test/org/apache/solr/handler/dataimport/AbstractSqlEntityProcessorTestCase#generateConfig().mjava","sourceNew":null,"sourceOld":"  @Override\n  protected String generateConfig() {\n    String ds = null;\n    if (dbToUse == Database.DERBY) {\n      ds = \"derby\";\n    } else if (dbToUse == Database.HSQLDB) {\n      ds = \"hsqldb\";\n    } else {\n      throw new AssertionError(\"Invalid database to use: \" + dbToUse);\n    }\n    StringBuilder sb = new StringBuilder();\n    sb.append(\"\\n<dataConfig> \\n\");\n    sb.append(\"<propertyWriter type=''SimplePropertiesWriter'' directory=''\" + fileLocation + \"'' filename=''\" + fileName + \"'' />\\n\");\n    sb.append(\"<dataSource name=''hsqldb'' driver=''org.hsqldb.jdbcDriver'' url=''jdbc:hsqldb:mem:.'' /> \\n\");\n    sb.append(\"<dataSource name=''derby'' driver=''org.apache.derby.jdbc.EmbeddedDriver'' url=''jdbc:derby:memory:derbyDB;territory=en_US'' /> \\n\");\n    sb.append(\"<document name=''TestSqlEntityProcessor''> \\n\");\n    sb.append(\"<entity name=''People'' \");\n    sb.append(\"pk=''\" + (random().nextBoolean() ? \"ID\" : \"People.ID\") + \"'' \");\n    sb.append(\"processor=''SqlEntityProcessor'' \");\n    sb.append(\"dataSource=''\" + ds + \"'' \");\n    sb.append(rootTransformerName != null ? \"transformer=''\"\n        + rootTransformerName + \"'' \" : \"\");\n  \n    sb.append(\"query=''SELECT ID, NAME, COUNTRY_CODE FROM PEOPLE WHERE DELETED != 'Y' \"\n                    +((sportsZipper||countryZipper?\"ORDER BY ID\":\"\")\n                     +(wrongPeopleOrder? \" DESC\":\"\"))+\"'' \");\n\n    sb.append(deltaQueriesPersonTable());\n    sb.append(\"> \\n\");\n    \n    sb.append(\"<field column=''NAME'' name=''NAME_mult_s'' /> \\n\");\n    sb.append(\"<field column=''COUNTRY_CODE'' name=''COUNTRY_CODES_mult_s'' /> \\n\");\n    \n    if (countryEntity) {\n      sb.append(\"<entity name=''Countries'' \");\n      sb.append(\"pk=''\" + (random().nextBoolean() ? \"CODE\" : \"Countries.CODE\")\n          + \"'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(countryTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''countryAdded_s'' newColumnValue=''country_added'' \"\n          : \"\");\n      if (countryCached) {\n        sb.append(\"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' ''>\\n\");\n        } else {\n          \n          if(countryZipper){// really odd join btw. it sends duped countries \n            sb.append(random().nextBoolean() ? \"cacheKey=''ID'' cacheLookup=''People.ID'' \"\n                : \"where=''ID=People.ID'' \");\n            sb.append(\"join=''zipper'' query=''SELECT PEOPLE.ID, CODE, COUNTRY_NAME FROM COUNTRIES\"\n                + \" JOIN PEOPLE ON COUNTRIES.CODE=PEOPLE.COUNTRY_CODE \"\n                + \"WHERE PEOPLE.DELETED != 'Y' ORDER BY PEOPLE.ID \"+\n                (wrongCountryOrder ? \" DESC\":\"\")\n                + \"'' \");\n          }else{\n            sb.append(random().nextBoolean() ? \"cacheKey=''CODE'' cacheLookup=''People.COUNTRY_CODE'' \"\n                : \"where=''CODE=People.COUNTRY_CODE'' \");\n            sb.append(\"query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES'' \");\n          }\n          sb.append(\"> \\n\");\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT CODE, COUNTRY_NAME FROM COUNTRIES WHERE DELETED != 'Y' AND CODE='${People.COUNTRY_CODE}' '' \");\n        sb.append(deltaQueriesCountryTable());\n        sb.append(\"> \\n\");\n      }\n      sb.append(\"<field column=''CODE'' name=''COUNTRY_CODE_s'' /> \\n\");\n      sb.append(\"<field column=''COUNTRY_NAME'' name=''COUNTRY_NAME_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    if (sportsEntity) {\n      sb.append(\"<entity name=''Sports'' \");\n      sb.append(\"dataSource=''\" + ds + \"'' \");\n      sb.append(sportsTransformer ? \"transformer=''AddAColumnTransformer'' \"\n          + \"newColumnName=''sportsAdded_s'' newColumnValue=''sport_added'' \"\n          : \"\");\n      if (sportsCached) {\n        sb.append(\"processor=''SqlEntityProcessor'' cacheImpl=''SortedMapBackedCache'' \");\n        if (useSimpleCaches) {\n          sb.append(\"query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n        } else {\n          sb.append(random().nextBoolean() ? \"cacheKey=''PERSON_ID'' cacheLookup=''People.ID'' \"\n              : \"where=''PERSON_ID=People.ID'' \");\n          if(sportsZipper){\n              sb.append(\"join=''zipper'' query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY PERSON_ID\"\n                  + (wrongSportsOrder?\" DESC\" : \"\")+\n                  \"'' \");\n            }\n          else{\n            sb.append(\"query=''SELECT ID, PERSON_ID, SPORT_NAME FROM PEOPLE_SPORTS ORDER BY ID'' \");\n          }\n        }\n      } else {\n        sb.append(\"processor=''SqlEntityProcessor'' query=''SELECT ID, SPORT_NAME FROM PEOPLE_SPORTS WHERE DELETED != 'Y' AND PERSON_ID=${People.ID} ORDER BY ID'' \");\n      }\n      sb.append(\"> \\n\");\n      sb.append(\"<field column=''SPORT_NAME'' name=''SPORT_NAME_mult_s'' /> \\n\");\n      sb.append(\"<field column=''id'' name=''SPORT_ID_mult_s'' /> \\n\");\n      sb.append(\"</entity> \\n\");\n    }\n    \n    sb.append(\"</entity> \\n\");\n    sb.append(\"</document> \\n\");\n    sb.append(\"</dataConfig> \\n\");\n    String config = sb.toString().replaceAll(\"[']{2}\", \"\\\"\");\n    log.debug(config);\n    return config;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"4ae7b4adfa274da5f5fdc865e127928b25e5e929":["eeaccf8ed3c4b0b78b25b3d8c3e14fcd60a65531"],"b4804614e0358954d5d9f51128fcf3cd79e6e25b":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"d2c8f5c46c2501b61e2f55eb7ee59e6c5372290b":["2fc9f4a33c8fefeb1260aea04273a36b0d32378e"],"2fc9f4a33c8fefeb1260aea04273a36b0d32378e":["4ae7b4adfa274da5f5fdc865e127928b25e5e929"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"407687e67faf6e1f02a211ca078d8e3eed631027":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","602d00a40b81360150f946906e46824f91cd3860"],"eeaccf8ed3c4b0b78b25b3d8c3e14fcd60a65531":["602d00a40b81360150f946906e46824f91cd3860"],"602d00a40b81360150f946906e46824f91cd3860":["9996c9e8eaf37a4104c98ae4e08f2d78514021c3"],"9996c9e8eaf37a4104c98ae4e08f2d78514021c3":["b4804614e0358954d5d9f51128fcf3cd79e6e25b"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["d2c8f5c46c2501b61e2f55eb7ee59e6c5372290b"]},"commit2Childs":{"4ae7b4adfa274da5f5fdc865e127928b25e5e929":["2fc9f4a33c8fefeb1260aea04273a36b0d32378e"],"b4804614e0358954d5d9f51128fcf3cd79e6e25b":["9996c9e8eaf37a4104c98ae4e08f2d78514021c3"],"d2c8f5c46c2501b61e2f55eb7ee59e6c5372290b":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"2fc9f4a33c8fefeb1260aea04273a36b0d32378e":["d2c8f5c46c2501b61e2f55eb7ee59e6c5372290b"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["b4804614e0358954d5d9f51128fcf3cd79e6e25b","407687e67faf6e1f02a211ca078d8e3eed631027"],"407687e67faf6e1f02a211ca078d8e3eed631027":[],"eeaccf8ed3c4b0b78b25b3d8c3e14fcd60a65531":["4ae7b4adfa274da5f5fdc865e127928b25e5e929"],"602d00a40b81360150f946906e46824f91cd3860":["407687e67faf6e1f02a211ca078d8e3eed631027","eeaccf8ed3c4b0b78b25b3d8c3e14fcd60a65531"],"9996c9e8eaf37a4104c98ae4e08f2d78514021c3":["602d00a40b81360150f946906e46824f91cd3860"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["407687e67faf6e1f02a211ca078d8e3eed631027","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}