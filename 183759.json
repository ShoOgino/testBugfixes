{"path":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","commits":[{"id":"9454a6510e2db155fb01faa5c049b06ece95fab9","date":1453508333,"type":1,"author":"Dawid Weiss","isMerge":false,"pathNew":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"60ba444201d2570214b6fcf1d15600dc1a01f548","date":1313868045,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-verbose\")) {\n        verbose = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d","8eaedf240fab95c428d5f496a274256d2053ad37"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"7b91922b55d15444d554721b352861d028eb8278","date":1320421415,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-codec\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        codec = Codec.forName(args[i+1]);\n        i+=2;\n      } else if (args[i].equals(\"-verbose\")) {\n        verbose = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-verbose\")) {\n        verbose = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["8eaedf240fab95c428d5f496a274256d2053ad37"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"768c48159710aa63efa67c049db149c35c4f423a","date":1323797698,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-codec\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        codec = Codec.forName(args[i+1]);\n        i+=2;\n      } else if (args[i].equals(\"-verbose\")) {\n        verbose = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d","8eaedf240fab95c428d5f496a274256d2053ad37"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"4ceb6a6c707ada1df8bde804e25c98668e699a18","date":1323800602,"type":3,"author":"Robert Muir","isMerge":true,"pathNew":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    int i = 0;\n    while(i < args.length) {\n      if (args[i].equals(\"-fix\")) {\n        doFix = true;\n        i++;\n      } else if (args[i].equals(\"-codec\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        codec = Codec.forName(args[i+1]);\n        i+=2;\n      } else if (args[i].equals(\"-verbose\")) {\n        verbose = true;\n        i++;\n      } else if (args[i].equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        onlySegments.add(args[i+1]);\n        i += 2;\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n        i++;\n      }\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"\\n\" + \n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      dir = FSDirectory.open(new File(indexPath));\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"31f025ae60076ae95274433f3fe8e6ace2857a87","date":1326669465,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":["f7523916a1350712e1ae710affd4e88ccd7c431d","8eaedf240fab95c428d5f496a274256d2053ad37"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"3a119bbc8703c10faa329ec201c654b3a35a1e3e","date":1328644745,"type":5,"author":"Steven Rowe","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","pathOld":"lucene/src/java/org/apache/lucene/index/CheckIndex#main(String[]).mjava","sourceNew":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","sourceOld":"  /** Command-line interface to check and fix an index.\n\n    <p>\n    Run it like this:\n    <pre>\n    java -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-verbose] [-segment X] [-segment Y]\n    </pre>\n    <ul>\n    <li><code>-fix</code>: actually write a new segments_N file, removing any problematic segments\n\n    <li><code>-segment X</code>: only check the specified\n    segment(s).  This can be specified multiple times,\n    to check more than one segment, eg <code>-segment _2\n    -segment _a</code>.  You can't use this with the -fix\n    option.\n    </ul>\n\n    <p><b>WARNING</b>: <code>-fix</code> should only be used on an emergency basis as it will cause\n                       documents (perhaps many) to be permanently removed from the index.  Always make\n                       a backup copy of your index before running this!  Do not run this tool on an index\n                       that is actively being written to.  You have been warned!\n\n    <p>                Run without -fix, this tool will open the index, report version information\n                       and report any exceptions it hits and what action it would take if -fix were\n                       specified.  With -fix, this tool will remove any segments that have issues and\n                       write a new segments_N file.  This means all documents contained in the affected\n                       segments will be removed.\n\n    <p>\n                       This tool exits with exit code 1 if the index cannot be opened or has any\n                       corruption, else 0.\n   */\n  public static void main(String[] args) throws IOException, InterruptedException {\n\n    boolean doFix = false;\n    boolean doCrossCheckTermVectors = false;\n    Codec codec = Codec.getDefault(); // only used when fixing\n    boolean verbose = false;\n    List<String> onlySegments = new ArrayList<String>();\n    String indexPath = null;\n    String dirImpl = null;\n    int i = 0;\n    while(i < args.length) {\n      String arg = args[i];\n      if (\"-fix\".equals(arg)) {\n        doFix = true;\n      } else if (\"-crossCheckTermVectors\".equals(arg)) {\n        doCrossCheckTermVectors = true;\n      } else if (\"-codec\".equals(arg)) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -codec option\");\n          System.exit(1);\n        }\n        i++;\n        codec = Codec.forName(args[i]);\n      } else if (arg.equals(\"-verbose\")) {\n        verbose = true;\n      } else if (arg.equals(\"-segment\")) {\n        if (i == args.length-1) {\n          System.out.println(\"ERROR: missing name for -segment option\");\n          System.exit(1);\n        }\n        i++;\n        onlySegments.add(args[i]);\n      } else if (\"-dir-impl\".equals(arg)) {\n        if (i == args.length - 1) {\n          System.out.println(\"ERROR: missing value for -dir-impl option\");\n          System.exit(1);\n        }\n        i++;\n        dirImpl = args[i];\n      } else {\n        if (indexPath != null) {\n          System.out.println(\"ERROR: unexpected extra argument '\" + args[i] + \"'\");\n          System.exit(1);\n        }\n        indexPath = args[i];\n      }\n      i++;\n    }\n\n    if (indexPath == null) {\n      System.out.println(\"\\nERROR: index path not specified\");\n      System.out.println(\"\\nUsage: java org.apache.lucene.index.CheckIndex pathToIndex [-fix] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X]\\n\" +\n                         \"\\n\" +\n                         \"  -fix: actually write a new segments_N file, removing any problematic segments\\n\" +\n                         \"  -crossCheckTermVectors: verifies that term vectors match postings; THIS IS VERY SLOW!\\n\" +\n                         \"  -codec X: when fixing, codec to write the new segments_N file with\\n\" +\n                         \"  -verbose: print additional details\\n\" +\n                         \"  -segment X: only check the specified segments.  This can be specified multiple\\n\" + \n                         \"              times, to check more than one segment, eg '-segment _2 -segment _a'.\\n\" +\n                         \"              You can't use this with the -fix option\\n\" +\n                         \"  -dir-impl X: use a specific \" + FSDirectory.class.getSimpleName() + \" implementation. \" +\n                         \t\t\"If no package is specified the \" + FSDirectory.class.getPackage().getName() + \" package will be used.\\n\" +\n                         \"**WARNING**: -fix should only be used on an emergency basis as it will cause\\n\" +\n                         \"documents (perhaps many) to be permanently removed from the index.  Always make\\n\" +\n                         \"a backup copy of your index before running this!  Do not run this tool on an index\\n\" +\n                         \"that is actively being written to.  You have been warned!\\n\" +\n                         \"\\n\" +\n                         \"Run without -fix, this tool will open the index, report version information\\n\" +\n                         \"and report any exceptions it hits and what action it would take if -fix were\\n\" +\n                         \"specified.  With -fix, this tool will remove any segments that have issues and\\n\" + \n                         \"write a new segments_N file.  This means all documents contained in the affected\\n\" +\n                         \"segments will be removed.\\n\" +\n                         \"\\n\" +\n                         \"This tool exits with exit code 1 if the index cannot be opened or has any\\n\" +\n                         \"corruption, else 0.\\n\");\n      System.exit(1);\n    }\n\n    if (!assertsOn())\n      System.out.println(\"\\nNOTE: testing will be more thorough if you run java with '-ea:org.apache.lucene...', so assertions are enabled\");\n\n    if (onlySegments.size() == 0)\n      onlySegments = null;\n    else if (doFix) {\n      System.out.println(\"ERROR: cannot specify both -fix and -segment\");\n      System.exit(1);\n    }\n\n    System.out.println(\"\\nOpening index @ \" + indexPath + \"\\n\");\n    Directory dir = null;\n    try {\n      if (dirImpl == null) {\n        dir = FSDirectory.open(new File(indexPath));\n      } else {\n        dir = CommandLineUtil.newFSDirectory(dirImpl, new File(indexPath));\n      }\n    } catch (Throwable t) {\n      System.out.println(\"ERROR: could not open directory \\\"\" + indexPath + \"\\\"; exiting\");\n      t.printStackTrace(System.out);\n      System.exit(1);\n    }\n\n    CheckIndex checker = new CheckIndex(dir);\n    checker.setCrossCheckTermVectors(doCrossCheckTermVectors);\n    checker.setInfoStream(System.out, verbose);\n\n    Status result = checker.checkIndex(onlySegments);\n    if (result.missingSegments) {\n      System.exit(1);\n    }\n\n    if (!result.clean) {\n      if (!doFix) {\n        System.out.println(\"WARNING: would write new segments file, and \" + result.totLoseDocCount + \" documents would be lost, if -fix were specified\\n\");\n      } else {\n        System.out.println(\"WARNING: \" + result.totLoseDocCount + \" documents will be lost\\n\");\n        System.out.println(\"NOTE: will write new segments file in 5 seconds; this will remove \" + result.totLoseDocCount + \" docs from the index. THIS IS YOUR LAST CHANCE TO CTRL+C!\");\n        for(int s=0;s<5;s++) {\n          Thread.sleep(1000);\n          System.out.println(\"  \" + (5-s) + \"...\");\n        }\n        System.out.println(\"Writing...\");\n        checker.fixIndex(result, codec);\n        System.out.println(\"OK\");\n        System.out.println(\"Wrote new segments file \\\"\" + result.newSegments.getCurrentSegmentFileName() + \"\\\"\");\n      }\n    }\n    System.out.println(\"\");\n\n    final int exitCode;\n    if (result.clean == true)\n      exitCode = 0;\n    else\n      exitCode = 1;\n    System.exit(exitCode);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null}],"commit2Parents":{"60ba444201d2570214b6fcf1d15600dc1a01f548":["9454a6510e2db155fb01faa5c049b06ece95fab9"],"7b91922b55d15444d554721b352861d028eb8278":["60ba444201d2570214b6fcf1d15600dc1a01f548"],"4ceb6a6c707ada1df8bde804e25c98668e699a18":["7b91922b55d15444d554721b352861d028eb8278","768c48159710aa63efa67c049db149c35c4f423a"],"768c48159710aa63efa67c049db149c35c4f423a":["7b91922b55d15444d554721b352861d028eb8278"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["31f025ae60076ae95274433f3fe8e6ace2857a87"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"31f025ae60076ae95274433f3fe8e6ace2857a87":["768c48159710aa63efa67c049db149c35c4f423a"],"9454a6510e2db155fb01faa5c049b06ece95fab9":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"]},"commit2Childs":{"60ba444201d2570214b6fcf1d15600dc1a01f548":["7b91922b55d15444d554721b352861d028eb8278"],"7b91922b55d15444d554721b352861d028eb8278":["4ceb6a6c707ada1df8bde804e25c98668e699a18","768c48159710aa63efa67c049db149c35c4f423a"],"4ceb6a6c707ada1df8bde804e25c98668e699a18":[],"768c48159710aa63efa67c049db149c35c4f423a":["4ceb6a6c707ada1df8bde804e25c98668e699a18","31f025ae60076ae95274433f3fe8e6ace2857a87"],"3a119bbc8703c10faa329ec201c654b3a35a1e3e":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["9454a6510e2db155fb01faa5c049b06ece95fab9"],"9454a6510e2db155fb01faa5c049b06ece95fab9":["60ba444201d2570214b6fcf1d15600dc1a01f548"],"31f025ae60076ae95274433f3fe8e6ace2857a87":["3a119bbc8703c10faa329ec201c654b3a35a1e3e"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["4ceb6a6c707ada1df8bde804e25c98668e699a18","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}