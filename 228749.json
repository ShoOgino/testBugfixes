{"path":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","commits":[{"id":"7455ee5c847b2ee7e44656e4218141f62dacb572","date":1386032125,"type":1,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","pathOld":"solr/core/src/java/org/apache/solr/handler/admin/ShowFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse,ContentStream).mjava","sourceNew":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    } finally {\n      if (home != null) {\n        try {\n          FileUtils.deleteDirectory(home);\n        } catch (IOException e) {\n          log.warn(\"Caught IO exception trying to delete temporary directory \" + home + e.getMessage());\n          return true; // Don't fail for this reason!\n        }\n      }\n    }\n  }\n\n","sourceOld":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp, ContentStream stream) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.copyInputStreamToFile(stream.getStream(),\n          new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)));\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    } finally {\n      if (home != null) {\n        try {\n          FileUtils.deleteDirectory(home);\n        } catch (IOException e) {\n          log.warn(\"Caught IO exception trying to delete temporary directory \" + home + e.getMessage());\n          return true; // Don't fail for this reason!\n        }\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"74f45af4339b0daf7a95c820ab88c1aea74fbce0","date":1387475327,"type":0,"author":"Michael McCandless","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","pathOld":"/dev/null","sourceNew":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    } finally {\n      if (home != null) {\n        try {\n          FileUtils.deleteDirectory(home);\n        } catch (IOException e) {\n          log.warn(\"Caught IO exception trying to delete temporary directory \" + home + e.getMessage());\n          return true; // Don't fail for this reason!\n        }\n      }\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"1e9ce820cd3ed9efb959c181daaafd22f0c70143","date":1396201051,"type":3,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","pathOld":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","sourceNew":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    }\n  }\n\n","sourceOld":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    } finally {\n      if (home != null) {\n        try {\n          FileUtils.deleteDirectory(home);\n        } catch (IOException e) {\n          log.warn(\"Caught IO exception trying to delete temporary directory \" + home + e.getMessage());\n          return true; // Don't fail for this reason!\n        }\n      }\n    }\n  }\n\n","bugFix":["8b51e04dc58a1002908e3caba8f5eb8ef59abe00"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"2a0f5bb79c600763ffe7b8141df59a3169d31e48","date":1396689440,"type":3,"author":"Dawid Weiss","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","pathOld":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","sourceNew":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    }\n  }\n\n","sourceOld":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    } finally {\n      if (home != null) {\n        try {\n          FileUtils.deleteDirectory(home);\n        } catch (IOException e) {\n          log.warn(\"Caught IO exception trying to delete temporary directory \" + home + e.getMessage());\n          return true; // Don't fail for this reason!\n        }\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"17778d9c1f3a8a67383edebf24754bf30a5120f8","date":1415342366,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","pathOld":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","sourceNew":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getConfigSetZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    }\n  }\n\n","sourceOld":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getCollectionZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"b20fb0ec13a714c528bd1ff701c977114e476c58","date":1420694146,"type":4,"author":"Erick Erickson","isMerge":false,"pathNew":"/dev/null","pathOld":"solr/core/src/java/org/apache/solr/handler/admin/EditFileRequestHandler#testReloadSuccess(SolrQueryRequest,SolrQueryResponse).mjava","sourceNew":null,"sourceOld":"  private boolean testReloadSuccess(SolrQueryRequest req, SolrQueryResponse rsp) {\n    // Try writing the config to a temporary core and reloading to see that we don't allow people to shoot themselves\n    // in the foot.\n    File home = null;\n    try {\n      home = new File(FileUtils.getTempDirectory(), \"SOLR_5459\"); // Unlikely to name a core or collection this!\n      FileUtils.writeStringToFile(new File(home, \"solr.xml\"), \"<solr></solr>\", \"UTF-8\"); // Use auto-discovery\n      File coll = new File(home, \"SOLR_5459\");\n\n      SolrCore core = req.getCore();\n      CoreDescriptor desc = core.getCoreDescriptor();\n      CoreContainer coreContainer = desc.getCoreContainer();\n\n      if (coreContainer.isZooKeeperAware()) {\n        try {\n          String confPath = ((ZkSolrResourceLoader) core.getResourceLoader()).getConfigSetZkPath();\n\n          ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(), confPath,\n              new File(coll, \"conf\"));\n        } catch (Exception ex) {\n          log.error(\"Error when attempting to download conf from ZooKeeper: \" + ex.getMessage());\n          rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,\n              \"Error when attempting to download conf from ZooKeeper\" + ex.getMessage()));\n          return false;\n        }\n      } else {\n        FileUtils.copyDirectory(new File(desc.getInstanceDir(), \"conf\"),\n            new File(coll, \"conf\"));\n      }\n\n      FileUtils.writeStringToFile(new File(coll, \"core.properties\"), \"name=SOLR_5459\", \"UTF-8\");\n\n      FileUtils.writeByteArrayToFile(new File(new File(coll, \"conf\"), req.getParams().get(\"file\", null)), data);\n\n      return tryReloading(rsp, home);\n\n    } catch (IOException ex) {\n      log.warn(\"Caught IO exception when trying to verify configs. \" + ex.getMessage());\n      rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,\n          \"Caught IO exception when trying to verify configs. \" + ex.getMessage()));\n      return false;\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"b20fb0ec13a714c528bd1ff701c977114e476c58":["17778d9c1f3a8a67383edebf24754bf30a5120f8"],"2a0f5bb79c600763ffe7b8141df59a3169d31e48":["7455ee5c847b2ee7e44656e4218141f62dacb572","1e9ce820cd3ed9efb959c181daaafd22f0c70143"],"17778d9c1f3a8a67383edebf24754bf30a5120f8":["2a0f5bb79c600763ffe7b8141df59a3169d31e48"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"7455ee5c847b2ee7e44656e4218141f62dacb572":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"74f45af4339b0daf7a95c820ab88c1aea74fbce0":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","7455ee5c847b2ee7e44656e4218141f62dacb572"],"1e9ce820cd3ed9efb959c181daaafd22f0c70143":["7455ee5c847b2ee7e44656e4218141f62dacb572"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["b20fb0ec13a714c528bd1ff701c977114e476c58"]},"commit2Childs":{"b20fb0ec13a714c528bd1ff701c977114e476c58":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"2a0f5bb79c600763ffe7b8141df59a3169d31e48":["17778d9c1f3a8a67383edebf24754bf30a5120f8"],"17778d9c1f3a8a67383edebf24754bf30a5120f8":["b20fb0ec13a714c528bd1ff701c977114e476c58"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["7455ee5c847b2ee7e44656e4218141f62dacb572","74f45af4339b0daf7a95c820ab88c1aea74fbce0"],"7455ee5c847b2ee7e44656e4218141f62dacb572":["2a0f5bb79c600763ffe7b8141df59a3169d31e48","74f45af4339b0daf7a95c820ab88c1aea74fbce0","1e9ce820cd3ed9efb959c181daaafd22f0c70143"],"74f45af4339b0daf7a95c820ab88c1aea74fbce0":[],"1e9ce820cd3ed9efb959c181daaafd22f0c70143":["2a0f5bb79c600763ffe7b8141df59a3169d31e48"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["74f45af4339b0daf7a95c820ab88c1aea74fbce0","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}