{"path":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacetRefinement#testRefinementMergingWithPrelimSort().mjava","commits":[{"id":"94ce69d020f939568b84a1dbbfbd11bfd9907b73","date":1543618146,"type":0,"author":"Chris Hostetter","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacetRefinement#testRefinementMergingWithPrelimSort().mjava","pathOld":"/dev/null","sourceNew":"  /** \n   * When <code>prelim_sort</code> is used, all 'top bucket' choices for refinement should still be based on\n   * it, not the <code>sort</code> param, so this test is just some sanity checks that the presence of the \n   * these params doesn't break anything in the refine / logic.\n   */\n  @Test\n  public void testRefinementMergingWithPrelimSort() throws Exception {\n\n    doTestRefine(\"{x : { type:terms, field:X, limit:2, refine:true, prelim_sort:'count desc', sort:'y asc',\" +\n                 \"       facet:{ y:'sum(y_i)' } } }\",\n                 // shard0 response\n                 \"{x: {buckets:[{val:x1, count:5, y:73}, {val:x2, count:3, y:13}], more:true } }\",\n                 // shard1 response\n                 \"{x: {buckets:[{val:x2, count:4, y:4}, {val:x3, count:2, y:22}], more:true } }\",\n                 // shard0 expected refinement info\n                 null,\n                 // shard1 expected refinement info\n                 \"=={x:{_l:[x1]}}\");\n\n    // same test as above, but shard1 indicates it doesn't have any more results,\n    // so there shouldn't be any refinement\n    doTestRefine(\"{x : { type:terms, field:X, limit:2, refine:true, prelim_sort:'count desc', sort:'y asc',\" +\n                 \"       facet:{ y:'sum(y_i)' } } }\",\n                 // shard0 response\n                 \"{x: {buckets:[{val:x1, count:5, y:73}, {val:x2, count:3, y:13}], more:true } }\",\n                 // shard1 response\n                 \"{x: {buckets:[{val:x2, count:4, y:4}, {val:x3, count:2, y:22}] } }\",\n                 // shard0 expected refinement info\n                 null,\n                 // shard1 expected refinement info\n                 null);\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"94ce69d020f939568b84a1dbbfbd11bfd9907b73":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["94ce69d020f939568b84a1dbbfbd11bfd9907b73"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["94ce69d020f939568b84a1dbbfbd11bfd9907b73"],"94ce69d020f939568b84a1dbbfbd11bfd9907b73":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}