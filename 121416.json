{"path":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","commits":[{"id":"6b3be660e210b4a5ce1e30fa69abb2d0dd0d8cc1","date":1426889883,"type":0,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","pathOld":"/dev/null","sourceNew":"  public void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a0d1e2aaf870d9d4f740ed0aaaf5824ccd9394ae","date":1427779360,"type":0,"author":"Ryan Ernst","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","pathOld":"/dev/null","sourceNew":"  public void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f6e0714179918847970d4daef77cf2d18dbd069f","date":1433864896,"type":3,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"be73df8ac65c8f1ebef4eed2c0bd3a3b8167e235","date":1435150219,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e2238da841c6da38e6ed909d35da8f4c0ea3147b","date":1499346175,"type":3,"author":"Jan Høydahl","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e73d8d559120669b47658108d818b637df5456ea","date":1499401413,"type":3,"author":"Shalin Shekhar Mangar","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(\"stream.body\", \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(\"stream.body\", \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"10eda272dbca4b0397f9b0c2aa6fadad3601db47","date":1504272103,"type":5,"author":"Cao Manh Dat","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client,boolean).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public static void doJsonRequest(Client client, boolean isDistrib) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n    // test query dsl\n    client.testJQ( params(\"json\", \"{'query':'{!lucene}id:1'}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        {'lucene' : {'query' : 'id:1'}},\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        'id:1',\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{   \" +\n            \" query : {\" +\n            \"  boost : {\" +\n            \"   query : {\" +\n            \"    lucene : {      \" +\n            \"     df : cat_s,      \" +\n            \"     query : A     \" +\n            \"    }\" +\n            \"   },   \" +\n            \"   b : 1.5 \" +\n            \"  }  \" +\n            \" } \" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : {lucene : {query:'id: 1'}}\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : [{lucene : {query:'id: 1'}}]\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : '{!lucene q.op=AND df=cat_s}A'\" +\n            \"   must_not : '{!lucene v=\\\\'id:1\\\\'}'\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : '*:*',\" +\n            \" filter : {\" +\n            \"  collapse : {\" +\n            \"   field : cat_s\" +\n            \"  } \" +\n            \" } \" +\n            \"}\")\n        , isDistrib ? \"\" : \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NJ'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NY'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'1'},{id:'4'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : 'cat_s^0.1 where_s^100'\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'5'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : ['cat_s^100', 'where_s^0.1']\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" :  \"response/docs==[{id:'4'},{id:'1'},{id:'5'}]\"\n    );\n\n    try {\n      client.testJQ(params(\"json\", \"{query:{'lucene':'id:1'}}\"));\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"id:1\"));\n    }\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":["664c02a9f8ee4f39f4731f071c69e1932178f381","664c02a9f8ee4f39f4731f071c69e1932178f381","664c02a9f8ee4f39f4731f071c69e1932178f381","664c02a9f8ee4f39f4731f071c69e1932178f381"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"3a7809d1d753b67f48b1a706e17034bf8b624ea3","date":1504366927,"type":5,"author":"Shalin Shekhar Mangar","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client,boolean).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public static void doJsonRequest(Client client, boolean isDistrib) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n    // test query dsl\n    client.testJQ( params(\"json\", \"{'query':'{!lucene}id:1'}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        {'lucene' : {'query' : 'id:1'}},\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        'id:1',\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{   \" +\n            \" query : {\" +\n            \"  boost : {\" +\n            \"   query : {\" +\n            \"    lucene : {      \" +\n            \"     df : cat_s,      \" +\n            \"     query : A     \" +\n            \"    }\" +\n            \"   },   \" +\n            \"   b : 1.5 \" +\n            \"  }  \" +\n            \" } \" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : {lucene : {query:'id: 1'}}\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : [{lucene : {query:'id: 1'}}]\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : '{!lucene q.op=AND df=cat_s}A'\" +\n            \"   must_not : '{!lucene v=\\\\'id:1\\\\'}'\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : '*:*',\" +\n            \" filter : {\" +\n            \"  collapse : {\" +\n            \"   field : cat_s\" +\n            \"  } \" +\n            \" } \" +\n            \"}\")\n        , isDistrib ? \"\" : \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NJ'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NY'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'1'},{id:'4'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : 'cat_s^0.1 where_s^100'\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'5'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : ['cat_s^100', 'where_s^0.1']\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" :  \"response/docs==[{id:'4'},{id:'1'},{id:'5'}]\"\n    );\n\n    try {\n      client.testJQ(params(\"json\", \"{query:{'lucene':'id:1'}}\"));\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"id:1\"));\n    }\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"b21283ed01203901a7257aa4b7f0a0899c86e56e","date":1504689720,"type":5,"author":"Noble Paul","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client,boolean).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public static void doJsonRequest(Client client, boolean isDistrib) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n    // test query dsl\n    client.testJQ( params(\"json\", \"{'query':'{!lucene}id:1'}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        {'lucene' : {'query' : 'id:1'}},\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        'id:1',\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{   \" +\n            \" query : {\" +\n            \"  boost : {\" +\n            \"   query : {\" +\n            \"    lucene : {      \" +\n            \"     df : cat_s,      \" +\n            \"     query : A     \" +\n            \"    }\" +\n            \"   },   \" +\n            \"   b : 1.5 \" +\n            \"  }  \" +\n            \" } \" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : {lucene : {query:'id: 1'}}\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : [{lucene : {query:'id: 1'}}]\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : '{!lucene q.op=AND df=cat_s}A'\" +\n            \"   must_not : '{!lucene v=\\\\'id:1\\\\'}'\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : '*:*',\" +\n            \" filter : {\" +\n            \"  collapse : {\" +\n            \"   field : cat_s\" +\n            \"  } \" +\n            \" } \" +\n            \"}\")\n        , isDistrib ? \"\" : \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NJ'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NY'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'1'},{id:'4'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : 'cat_s^0.1 where_s^100'\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'5'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : ['cat_s^100', 'where_s^0.1']\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" :  \"response/docs==[{id:'4'},{id:'1'},{id:'5'}]\"\n    );\n\n    try {\n      client.testJQ(params(\"json\", \"{query:{'lucene':'id:1'}}\"));\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"id:1\"));\n    }\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"104a3f62ee393d48b5596de76ed4d9a4e0ea6de7","date":1504848000,"type":5,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client,boolean).mjava","pathOld":"solr/core/src/test/org/apache/solr/search/json/TestJsonRequest#doJsonRequest(Client).mjava","sourceNew":"  public static void doJsonRequest(Client client, boolean isDistrib) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n    // test query dsl\n    client.testJQ( params(\"json\", \"{'query':'{!lucene}id:1'}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        {'lucene' : {'query' : 'id:1'}},\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{\" +\n            \"  'query': {\" +\n            \"    'bool' : {\" +\n            \"      'should' : [\" +\n            \"        'id:1',\" +\n            \"        'id:2'\" +\n            \"      ]\" +\n            \"    }\" +\n            \"  }\" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\", \"{   \" +\n            \" query : {\" +\n            \"  boost : {\" +\n            \"   query : {\" +\n            \"    lucene : {      \" +\n            \"     df : cat_s,      \" +\n            \"     query : A     \" +\n            \"    }\" +\n            \"   },   \" +\n            \"   b : 1.5 \" +\n            \"  }  \" +\n            \" } \" +\n            \"}\")\n        , \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : {lucene : {query:'id: 1'}}\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : {\" +\n            \"    lucene : {\" +\n            \"     q.op : AND,\" +\n            \"     df : cat_s,\" +\n            \"     query : A\" +\n            \"    }\" +\n            \"   }\" +\n            \"   must_not : [{lucene : {query:'id: 1'}}]\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n    client.testJQ( params(\"json\",\"{ \" +\n            \" query : {\" +\n            \"  bool : {\" +\n            \"   must : '{!lucene q.op=AND df=cat_s}A'\" +\n            \"   must_not : '{!lucene v=\\\\'id:1\\\\'}'\" +\n            \"  }\" +\n            \" }\" +\n            \"}\")\n        , \"response/numFound==1\"\n    );\n\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : '*:*',\" +\n            \" filter : {\" +\n            \"  collapse : {\" +\n            \"   field : cat_s\" +\n            \"  } \" +\n            \" } \" +\n            \"}\")\n        , isDistrib ? \"\" : \"response/numFound==2\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NJ'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  edismax : {\" +\n            \"   query : 'A',\" +\n            \"   qf : 'cat_s',\" +\n            \"   bq : {\" +\n            \"    edismax : {\" +\n            \"     query : 'NY'\" +\n            \"     qf : 'where_s'\" +\n            \"    }\" +\n            \"   }\" +\n            \"  }\" +\n            \" }, \" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==2\", isDistrib? \"\" : \"response/docs==[{id:'1'},{id:'4'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : 'cat_s^0.1 where_s^100'\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" : \"response/docs==[{id:'4'},{id:'5'},{id:'1'}]\"\n    );\n\n    client.testJQ( params(\"json\",\"{\" +\n            \" query : {\" +\n            \"  dismax : {\" +\n            \"   query : 'A NJ'\" +\n            \"   qf : ['cat_s^100', 'where_s^0.1']\" +\n            \"  } \" +\n            \" }, \" +\n            \" filter : '-id:2',\" +\n            \" fields : id\" +\n            \"}\")\n        , \"response/numFound==3\", isDistrib? \"\" :  \"response/docs==[{id:'4'},{id:'1'},{id:'5'}]\"\n    );\n\n    try {\n      client.testJQ(params(\"json\", \"{query:{'lucene':'id:1'}}\"));\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"id:1\"));\n    }\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","sourceOld":"  public static void doJsonRequest(Client client) throws Exception {\n    client.deleteByQuery(\"*:*\", null);\n    client.add(sdoc(\"id\", \"1\", \"cat_s\", \"A\", \"where_s\", \"NY\"), null);\n    client.add(sdoc(\"id\", \"2\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"3\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"4\", \"cat_s\", \"A\", \"where_s\", \"NJ\"), null);\n    client.add(sdoc(\"id\", \"5\", \"cat_s\", \"B\", \"where_s\", \"NJ\"), null);\n    client.commit();\n    client.add(sdoc(\"id\", \"6\", \"cat_s\", \"B\", \"where_s\", \"NY\"), null);\n    client.commit();\n\n\n    // test json param\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==2\"\n    );\n\n    // test multiple json params\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being zero length\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"\")\n        , \"response/numFound==1\"\n    );\n\n    // test multiple json params with one being a comment\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, second value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:'where_s:NY'}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, first value is already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test merging multi-valued params into list, both values are already list\n    client.testJQ( params(\"json\",\"{query:'*:*'}\", \"json\",\"{filter:['where_s:NY']}\", \"json\",\"{filter:['cat_s:A']}\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n    // test inserting and merging with paths with an empty string and a comment\n    client.testJQ( params(\"json.query\",\"'*:*'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.filter\",\"\", \"json.filter\",\"/* */\")\n        , \"response/numFound==1\"\n    );\n\n    // test overwriting of non-multivalued params\n    client.testJQ( params(\"json.query\",\"'foo_s:NONE'\", \"json.filter\",\"'where_s:NY'\", \"json.filter\",\"'cat_s:A'\", \"json.query\",\"'*:*'\")\n        , \"response/numFound==1\"\n    );\n\n    // normal parameter specified in the params block, including numeric params cast back to string\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:NY'], start:0, rows:5, fl:id}}\")\n        , \"response/docs==[{id:'1'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:id, sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4'}]\"\n    );\n    client.testJQ( params(\"json\",\"{params:{q:'*:*', fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5'], sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n    // test merge params\n    client.testJQ( params(\"json\",\"{params:{q:'*:*'}}\", \"json\",\"{params:{fq:['cat_s:A','where_s:(NY OR NJ)'], start:0, rows:1, fl:[id,'x:5.5']}}\", \"json\",\"{params:{sort:'where_s asc'}}\")\n        , \"response/numFound==2\"\n        , \"response/docs==[{id:'4', x:5.5}]\"\n    );\n\n\n    // test offset/limit/sort/fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\")\n        , \"response/docs==[{id:'5'},{id:'4'}]\"\n    );\n    // test offset/limit/sort/fields, multi-valued json.fields\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"1\", \"json.limit\",\"2\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n    // test offset/limit/sort/fields, overwriting non-multivalued params\n    client.testJQ( params(\"json.query\",\"'*:*'\",  \"json.offset\",\"17\", \"json.offset\",\"1\", \"json.limit\",\"42\", \"json.limit\",\"2\", \"json.sort\",\"'id asc'\", \"json.sort\",\"'id desc'\", \"json.fields\",\"'id'\", \"json.fields\",\"'x:5.5'\")\n        , \"response/docs==[{id:'5', x:5.5},{id:'4', x:5.5}]\"\n    );\n\n\n\n    // test templating before parsing JSON\n    client.testJQ( params(\"json\",\"${OPENBRACE} query:'cat_s:A' ${CLOSEBRACE}\", \"json\",\"${OPENBRACE} filter:'where_s:NY'${CLOSEBRACE}\",  \"OPENBRACE\",\"{\", \"CLOSEBRACE\",\"}\")\n        , \"response/numFound==1\"\n    );\n\n    // test templating with params defined in the JSON itself!  Do we want to keep this functionality?\n    client.testJQ( params(\"json\",\"{params:{V1:A,V2:NY}, query:'cat_s:${V1}'}\", \"json\",\"{filter:'where_s:${V2}'}\")\n        , \"response/numFound==1\"\n    );\n\n\n    //\n    // with body\n    //\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\")\n        , \"response/numFound==2\"\n    );\n\n    // test body in conjunction with query params\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'cat_s:A'}\", \"stream.contentType\", \"application/json\", \"json.filter\", \"'where_s:NY'\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json body in params come \"after\" (will overwrite)\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json\",\"{query:'cat_s:A'}\")\n        , \"response/numFound==1\"\n    );\n\n    // test that json.x params come after body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', filter:'where_s:NY'}\", \"stream.contentType\", \"application/json\", \"json.query\",\"'cat_s:A'\")\n        , \"response/numFound==1\"\n    );\n\n\n    // test facet with json body\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\")\n        , \"facets=={count:6,x:2}\"\n    );\n\n    // test facet with json body, insert additional facets via query parameter\n    client.testJQ(params(CommonParams.STREAM_BODY, \"{query:'*:*', facet:{x:'unique(where_s)'}}\", \"stream.contentType\", \"application/json\", \"json.facet.y\",\"{terms:{field:where_s}}\", \"json.facet.z\",\"'unique(where_s)'\")\n        , \"facets=={count:6,x:2, y:{buckets:[{val:NJ,count:3},{val:NY,count:2}]}, z:2}\"\n    );\n\n    // test debug\n    client.testJQ( params(\"json\",\"{query:'cat_s:A'}\", \"json.filter\",\"'where_s:NY'\", \"debug\",\"true\")\n        , \"debug/json=={query:'cat_s:A', filter:'where_s:NY'}\"\n    );\n\n\n    try {\n      // test failure on unknown parameter\n      client.testJQ(params(\"json\", \"{query:'cat_s:A', foobar_ignore_exception:5}\")\n          , \"response/numFound==2\"\n      );\n      fail();\n    } catch (Exception e) {\n      assertTrue(e.getMessage().contains(\"foobar\"));\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null}],"commit2Parents":{"f6e0714179918847970d4daef77cf2d18dbd069f":["6b3be660e210b4a5ce1e30fa69abb2d0dd0d8cc1"],"b21283ed01203901a7257aa4b7f0a0899c86e56e":["e2238da841c6da38e6ed909d35da8f4c0ea3147b","10eda272dbca4b0397f9b0c2aa6fadad3601db47"],"a0d1e2aaf870d9d4f740ed0aaaf5824ccd9394ae":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","6b3be660e210b4a5ce1e30fa69abb2d0dd0d8cc1"],"e2238da841c6da38e6ed909d35da8f4c0ea3147b":["be73df8ac65c8f1ebef4eed2c0bd3a3b8167e235"],"6b3be660e210b4a5ce1e30fa69abb2d0dd0d8cc1":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"104a3f62ee393d48b5596de76ed4d9a4e0ea6de7":["e2238da841c6da38e6ed909d35da8f4c0ea3147b","b21283ed01203901a7257aa4b7f0a0899c86e56e"],"10eda272dbca4b0397f9b0c2aa6fadad3601db47":["e2238da841c6da38e6ed909d35da8f4c0ea3147b"],"3a7809d1d753b67f48b1a706e17034bf8b624ea3":["e73d8d559120669b47658108d818b637df5456ea","10eda272dbca4b0397f9b0c2aa6fadad3601db47"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"e73d8d559120669b47658108d818b637df5456ea":["be73df8ac65c8f1ebef4eed2c0bd3a3b8167e235","e2238da841c6da38e6ed909d35da8f4c0ea3147b"],"be73df8ac65c8f1ebef4eed2c0bd3a3b8167e235":["f6e0714179918847970d4daef77cf2d18dbd069f"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["104a3f62ee393d48b5596de76ed4d9a4e0ea6de7"]},"commit2Childs":{"f6e0714179918847970d4daef77cf2d18dbd069f":["be73df8ac65c8f1ebef4eed2c0bd3a3b8167e235"],"b21283ed01203901a7257aa4b7f0a0899c86e56e":["104a3f62ee393d48b5596de76ed4d9a4e0ea6de7"],"a0d1e2aaf870d9d4f740ed0aaaf5824ccd9394ae":[],"e2238da841c6da38e6ed909d35da8f4c0ea3147b":["b21283ed01203901a7257aa4b7f0a0899c86e56e","104a3f62ee393d48b5596de76ed4d9a4e0ea6de7","10eda272dbca4b0397f9b0c2aa6fadad3601db47","e73d8d559120669b47658108d818b637df5456ea"],"6b3be660e210b4a5ce1e30fa69abb2d0dd0d8cc1":["f6e0714179918847970d4daef77cf2d18dbd069f","a0d1e2aaf870d9d4f740ed0aaaf5824ccd9394ae"],"10eda272dbca4b0397f9b0c2aa6fadad3601db47":["b21283ed01203901a7257aa4b7f0a0899c86e56e","3a7809d1d753b67f48b1a706e17034bf8b624ea3"],"104a3f62ee393d48b5596de76ed4d9a4e0ea6de7":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"3a7809d1d753b67f48b1a706e17034bf8b624ea3":[],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["a0d1e2aaf870d9d4f740ed0aaaf5824ccd9394ae","6b3be660e210b4a5ce1e30fa69abb2d0dd0d8cc1"],"e73d8d559120669b47658108d818b637df5456ea":["3a7809d1d753b67f48b1a706e17034bf8b624ea3"],"be73df8ac65c8f1ebef4eed2c0bd3a3b8167e235":["e2238da841c6da38e6ed909d35da8f4c0ea3147b","e73d8d559120669b47658108d818b637df5456ea"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["a0d1e2aaf870d9d4f740ed0aaaf5824ccd9394ae","3a7809d1d753b67f48b1a706e17034bf8b624ea3","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}