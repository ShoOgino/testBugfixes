{"path":"solr/core/src/test/org/apache/solr/cloud/NestedShardedAtomicUpdateTest#sendWrongRouteParam().mjava","commits":[{"id":"07749612bed4eb54dd05255c1434c301133310c1","date":1554879779,"type":0,"author":"Moshe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/cloud/NestedShardedAtomicUpdateTest#sendWrongRouteParam().mjava","pathOld":"/dev/null","sourceNew":"  public void sendWrongRouteParam() throws Exception {\n    assertEquals(4, cloudClient.getZkStateReader().getClusterState().getCollection(DEFAULT_COLLECTION).getSlices().size());\n    final String rootId = \"1\";\n\n    SolrInputDocument doc = sdoc(\"id\", rootId, \"level_s\", \"root\");\n\n    final SolrParams wrongRootParams = params(\"wt\", \"json\", \"_route_\", \"c\");\n    final SolrParams rightParams = params(\"wt\", \"json\", \"_route_\", rootId);\n\n    int which = (rootId.hashCode() & 0x7fffffff) % clients.size();\n    SolrClient aClient = clients.get(which);\n\n    indexDocAndRandomlyCommit(aClient, params(\"wt\", \"json\", \"_route_\", rootId), doc, false);\n\n    final SolrInputDocument childDoc = sdoc(\"id\", rootId, \"children\", map(\"add\", sdocs(sdoc(\"id\", \"2\", \"level_s\", \"child\"))));\n\n    indexDocAndRandomlyCommit(aClient, rightParams, childDoc, false);\n\n    final SolrInputDocument grandChildDoc = sdoc(\"id\", \"2\", \"grandChildren\",\n        map(\"add\", sdocs(\n            sdoc(\"id\", \"3\", \"level_s\", \"grandChild\")\n            )\n        )\n    );\n\n    SolrException e = expectThrows(SolrException.class,\n        \"wrong \\\"_route_\\\" param should throw an exception\",\n        () -> indexDocAndRandomlyCommit(aClient, wrongRootParams, grandChildDoc)\n    );\n\n    assertTrue(\"message should suggest the wrong \\\"_route_\\\" param was supplied\",\n        e.getMessage().contains(\"perhaps the wrong \\\"_route_\\\" param was supplied\"));\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"07749612bed4eb54dd05255c1434c301133310c1":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["07749612bed4eb54dd05255c1434c301133310c1"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["07749612bed4eb54dd05255c1434c301133310c1"],"07749612bed4eb54dd05255c1434c301133310c1":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}