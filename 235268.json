{"path":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","commits":[{"id":"17e844d4f9ba6804f10747d7e51e83a9a8868c94","date":1500054875,"type":0,"author":"Steve Rowe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"/dev/null","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    List<Double> values = getRandomDoubles(numVals, false);\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", String.valueOf(i), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d2c87d20f012bf841bca4751583c938a2828dc65","date":1500064819,"type":3,"author":"Steve Rowe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    List<Double> values = getRandomDoubles(numVals, false);\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","sourceOld":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    List<Double> values = getRandomDoubles(numVals, false);\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", String.valueOf(i), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"aaf90fc29510e72665ac7934f34c3d1c25efad64","date":1500354819,"type":0,"author":"Cao Manh Dat","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"/dev/null","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    List<Double> values = getRandomDoubles(numVals, false);\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"5e69085d4a7213ba5875b35b072ddb7a9e270cd3","date":1505138881,"type":3,"author":"Steve Rowe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    // Restrict values to float range; otherwise conversion to float will cause truncation -> undefined results\n    List<Double> values = getRandomList(10, false, () -> {\n      Float f = Float.NaN;\n      while (f.isNaN()) {\n        f = Float.intBitsToFloat(random().nextInt());\n      }\n      return f.doubleValue();\n    });\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","sourceOld":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    List<Double> values = getRandomDoubles(numVals, false);\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","bugFix":null,"bugIntro":["94d826c76506f30b5b9c0cead12ac4f84d547f67"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"1bb32ca7dd153900c525fc6f67f3437ae52b9eb7","date":1505141297,"type":3,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    // Restrict values to float range; otherwise conversion to float will cause truncation -> undefined results\n    List<Double> values = getRandomList(10, false, () -> {\n      Float f = Float.NaN;\n      while (f.isNaN()) {\n        f = Float.intBitsToFloat(random().nextInt());\n      }\n      return f.doubleValue();\n    });\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","sourceOld":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    List<Double> values = getRandomDoubles(numVals, false);\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"94d826c76506f30b5b9c0cead12ac4f84d547f67","date":1505147708,"type":3,"author":"Steve Rowe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    // Restrict values to float range; otherwise conversion to float will cause truncation -> undefined results\n    List<Double> values = getRandomList(numVals, false, () -> {\n      Float f = Float.NaN;\n      while (f.isNaN()) {\n        f = Float.intBitsToFloat(random().nextInt());\n      }\n      return f.doubleValue();\n    });\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","sourceOld":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    // Restrict values to float range; otherwise conversion to float will cause truncation -> undefined results\n    List<Double> values = getRandomList(10, false, () -> {\n      Float f = Float.NaN;\n      while (f.isNaN()) {\n        f = Float.intBitsToFloat(random().nextInt());\n      }\n      return f.doubleValue();\n    });\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","bugFix":["5e69085d4a7213ba5875b35b072ddb7a9e270cd3"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ffb85feece8645a035c02443a625f5af15e1106b","date":1505219692,"type":3,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    // Restrict values to float range; otherwise conversion to float will cause truncation -> undefined results\n    List<Double> values = getRandomList(numVals, false, () -> {\n      Float f = Float.NaN;\n      while (f.isNaN()) {\n        f = Float.intBitsToFloat(random().nextInt());\n      }\n      return f.doubleValue();\n    });\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","sourceOld":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    // Restrict values to float range; otherwise conversion to float will cause truncation -> undefined results\n    List<Double> values = getRandomList(10, false, () -> {\n      Float f = Float.NaN;\n      while (f.isNaN()) {\n        f = Float.intBitsToFloat(random().nextInt());\n      }\n      return f.doubleValue();\n    });\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"685bd38810c206c93e9058f3c2cfa9827c086c27","date":1505751821,"type":3,"author":"Shalin Shekhar Mangar","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","pathOld":"solr/core/src/test/org/apache/solr/schema/TestPointFields#doTestDoublePointFunctionQuery(String).mjava","sourceNew":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    // Restrict values to float range; otherwise conversion to float will cause truncation -> undefined results\n    List<Double> values = getRandomList(numVals, false, () -> {\n      Float f = Float.NaN;\n      while (f.isNaN()) {\n        f = Float.intBitsToFloat(random().nextInt());\n      }\n      return f.doubleValue();\n    });\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","sourceOld":"  private void doTestDoublePointFunctionQuery(String field) throws Exception {\n    assertTrue(h.getCore().getLatestSchema().getField(field).getType() instanceof PointField);\n    int numVals = 10 * RANDOM_MULTIPLIER;\n    List<Double> values = getRandomDoubles(numVals, false);\n    String assertNumFound = \"//*[@numFound='\" + numVals + \"']\";\n    String[] idAscXpathChecks = new String[numVals + 1];\n    String[] idAscNegXpathChecks = new String[numVals + 1];\n    idAscXpathChecks[0] = assertNumFound;\n    idAscNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < values.size() ; ++i) {\n      assertU(adoc(\"id\", Character.valueOf((char)('A' + i)).toString(), field, String.valueOf(values.get(i))));\n      // reminder: xpath array indexes start at 1\n      idAscXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/double[@name='field(\" + field + \")'][.='\" + values.get(i) + \"']\";\n      idAscNegXpathChecks[i + 1] = \"//result/doc[\" + (1 + i) + \"]/float[@name='product(-1,\" + field + \")'][.='\"\n          + (-1.0f * values.get(i).floatValue()) + \"']\";\n    }\n    assertU(commit());\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", field(\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscXpathChecks);\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field + \", product(-1,\" + field + \")\", \"rows\", String.valueOf(numVals), \"sort\", \"id asc\"),\n        idAscNegXpathChecks);\n\n    // Intentionally use floats here to mimic server-side function sorting\n    List<PosVal<Float>> ascNegPosVals\n        = toAscendingPosVals(values.stream().map(v -> -v.floatValue()).collect(Collectors.toList()), true);\n    String[] ascNegXpathChecks = new String[numVals + 1];\n    ascNegXpathChecks[0] = assertNumFound;\n    for (int i = 0 ; i < ascNegPosVals.size() ; ++i) {\n      PosVal<Float> posVal = ascNegPosVals.get(i);\n      ascNegXpathChecks[i + 1]\n          = \"//result/doc[\" + (1 + i) + \"]/double[@name='\" + field + \"'][.='\" + values.get(posVal.pos) + \"']\";\n    }\n    assertQ(req(\"q\", \"*:*\", \"fl\", \"id, \" + field, \"rows\", String.valueOf(numVals), \"sort\", \"product(-1,\" + field + \") asc\"),\n        ascNegXpathChecks);\n\n    clearIndex();\n    assertU(commit());\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"685bd38810c206c93e9058f3c2cfa9827c086c27":["aaf90fc29510e72665ac7934f34c3d1c25efad64","ffb85feece8645a035c02443a625f5af15e1106b"],"1bb32ca7dd153900c525fc6f67f3437ae52b9eb7":["d2c87d20f012bf841bca4751583c938a2828dc65","5e69085d4a7213ba5875b35b072ddb7a9e270cd3"],"ffb85feece8645a035c02443a625f5af15e1106b":["1bb32ca7dd153900c525fc6f67f3437ae52b9eb7","94d826c76506f30b5b9c0cead12ac4f84d547f67"],"94d826c76506f30b5b9c0cead12ac4f84d547f67":["1bb32ca7dd153900c525fc6f67f3437ae52b9eb7"],"d2c87d20f012bf841bca4751583c938a2828dc65":["17e844d4f9ba6804f10747d7e51e83a9a8868c94"],"aaf90fc29510e72665ac7934f34c3d1c25efad64":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","d2c87d20f012bf841bca4751583c938a2828dc65"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"17e844d4f9ba6804f10747d7e51e83a9a8868c94":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"5e69085d4a7213ba5875b35b072ddb7a9e270cd3":["d2c87d20f012bf841bca4751583c938a2828dc65"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["ffb85feece8645a035c02443a625f5af15e1106b"]},"commit2Childs":{"685bd38810c206c93e9058f3c2cfa9827c086c27":[],"ffb85feece8645a035c02443a625f5af15e1106b":["685bd38810c206c93e9058f3c2cfa9827c086c27","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"1bb32ca7dd153900c525fc6f67f3437ae52b9eb7":["ffb85feece8645a035c02443a625f5af15e1106b","94d826c76506f30b5b9c0cead12ac4f84d547f67"],"94d826c76506f30b5b9c0cead12ac4f84d547f67":["ffb85feece8645a035c02443a625f5af15e1106b"],"aaf90fc29510e72665ac7934f34c3d1c25efad64":["685bd38810c206c93e9058f3c2cfa9827c086c27"],"d2c87d20f012bf841bca4751583c938a2828dc65":["1bb32ca7dd153900c525fc6f67f3437ae52b9eb7","aaf90fc29510e72665ac7934f34c3d1c25efad64","5e69085d4a7213ba5875b35b072ddb7a9e270cd3"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["aaf90fc29510e72665ac7934f34c3d1c25efad64","17e844d4f9ba6804f10747d7e51e83a9a8868c94"],"17e844d4f9ba6804f10747d7e51e83a9a8868c94":["d2c87d20f012bf841bca4751583c938a2828dc65"],"5e69085d4a7213ba5875b35b072ddb7a9e270cd3":["1bb32ca7dd153900c525fc6f67f3437ae52b9eb7"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["685bd38810c206c93e9058f3c2cfa9827c086c27","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}