{"path":"solr/core/src/java/org/apache/solr/core/SolrConfig#initLibs(boolean).mjava","commits":[{"id":"ad8024a22d8bd3a09b7f618f41cdfe117ae6fe96","date":1576143009,"type":1,"author":"Ishan Chattopadhyaya","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/core/SolrConfig#initLibs(boolean).mjava","pathOld":"solr/core/src/java/org/apache/solr/core/SolrConfig#initLibs().mjava","sourceNew":"  private void initLibs(boolean isConfigsetTrusted) {\n    NodeList nodes = (NodeList) evaluate(\"lib\", XPathConstants.NODESET);\n    if (nodes == null || nodes.getLength() == 0) return;\n    if (!isConfigsetTrusted) {\n      throw new SolrException(ErrorCode.UNAUTHORIZED, \"The configset for this collection was uploaded without any authentication in place,\"\n          + \" and use of <lib> is not available for collections with untrusted configsets. To use this component, re-upload the configset\"\n          + \" after enabling authentication and authorization.\");\n    }\n\n    log.debug(\"Adding specified lib dirs to ClassLoader\");\n    SolrResourceLoader loader = getResourceLoader();\n    List<URL> urls = new ArrayList<>();\n\n    for (int i = 0; i < nodes.getLength(); i++) {\n      Node node = nodes.item(i);\n      String baseDir = DOMUtil.getAttr(node, \"dir\");\n      String path = DOMUtil.getAttr(node, PATH);\n      if (null != baseDir) {\n        // :TODO: add support for a simpler 'glob' mutually exclusive of regex\n        Path dir = loader.getInstancePath().resolve(baseDir);\n        String regex = DOMUtil.getAttr(node, \"regex\");\n        try {\n          if (regex == null)\n            urls.addAll(SolrResourceLoader.getURLs(dir));\n          else\n            urls.addAll(SolrResourceLoader.getFilteredURLs(dir, regex));\n        } catch (IOException e) {\n          log.warn(\"Couldn't add files from {} filtered by {} to classpath: {}\", dir, regex, e.getMessage());\n        }\n      } else if (null != path) {\n        final Path dir = loader.getInstancePath().resolve(path);\n        try {\n          urls.add(dir.toUri().toURL());\n        } catch (MalformedURLException e) {\n          log.warn(\"Couldn't add file {} to classpath: {}\", dir, e.getMessage());\n        }\n      } else {\n        throw new RuntimeException(\"lib: missing mandatory attributes: 'dir' or 'path'\");\n      }\n    }\n\n    if (urls.size() > 0) {\n      loader.addToClassLoader(urls);\n      loader.reloadLuceneSPI();\n    }\n  }\n\n","sourceOld":"  private void initLibs() {\n    NodeList nodes = (NodeList) evaluate(\"lib\", XPathConstants.NODESET);\n    if (nodes == null || nodes.getLength() == 0) return;\n\n    log.debug(\"Adding specified lib dirs to ClassLoader\");\n    SolrResourceLoader loader = getResourceLoader();\n    List<URL> urls = new ArrayList<>();\n\n    for (int i = 0; i < nodes.getLength(); i++) {\n      Node node = nodes.item(i);\n      String baseDir = DOMUtil.getAttr(node, \"dir\");\n      String path = DOMUtil.getAttr(node, PATH);\n      if (null != baseDir) {\n        // :TODO: add support for a simpler 'glob' mutually exclusive of regex\n        Path dir = loader.getInstancePath().resolve(baseDir);\n        String regex = DOMUtil.getAttr(node, \"regex\");\n        try {\n          if (regex == null)\n            urls.addAll(SolrResourceLoader.getURLs(dir));\n          else\n            urls.addAll(SolrResourceLoader.getFilteredURLs(dir, regex));\n        } catch (IOException e) {\n          log.warn(\"Couldn't add files from {} filtered by {} to classpath: {}\", dir, regex, e.getMessage());\n        }\n      } else if (null != path) {\n        final Path dir = loader.getInstancePath().resolve(path);\n        try {\n          urls.add(dir.toUri().toURL());\n        } catch (MalformedURLException e) {\n          log.warn(\"Couldn't add file {} to classpath: {}\", dir, e.getMessage());\n        }\n      } else {\n        throw new RuntimeException(\"lib: missing mandatory attributes: 'dir' or 'path'\");\n      }\n    }\n\n    if (urls.size() > 0) {\n      loader.addToClassLoader(urls);\n      loader.reloadLuceneSPI();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"df724d84dab24a0cc54bec95a8680867adc7f171","date":1576156608,"type":1,"author":"Dawid Weiss","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/core/SolrConfig#initLibs(boolean).mjava","pathOld":"solr/core/src/java/org/apache/solr/core/SolrConfig#initLibs().mjava","sourceNew":"  private void initLibs(boolean isConfigsetTrusted) {\n    NodeList nodes = (NodeList) evaluate(\"lib\", XPathConstants.NODESET);\n    if (nodes == null || nodes.getLength() == 0) return;\n    if (!isConfigsetTrusted) {\n      throw new SolrException(ErrorCode.UNAUTHORIZED, \"The configset for this collection was uploaded without any authentication in place,\"\n          + \" and use of <lib> is not available for collections with untrusted configsets. To use this component, re-upload the configset\"\n          + \" after enabling authentication and authorization.\");\n    }\n\n    log.debug(\"Adding specified lib dirs to ClassLoader\");\n    SolrResourceLoader loader = getResourceLoader();\n    List<URL> urls = new ArrayList<>();\n\n    for (int i = 0; i < nodes.getLength(); i++) {\n      Node node = nodes.item(i);\n      String baseDir = DOMUtil.getAttr(node, \"dir\");\n      String path = DOMUtil.getAttr(node, PATH);\n      if (null != baseDir) {\n        // :TODO: add support for a simpler 'glob' mutually exclusive of regex\n        Path dir = loader.getInstancePath().resolve(baseDir);\n        String regex = DOMUtil.getAttr(node, \"regex\");\n        try {\n          if (regex == null)\n            urls.addAll(SolrResourceLoader.getURLs(dir));\n          else\n            urls.addAll(SolrResourceLoader.getFilteredURLs(dir, regex));\n        } catch (IOException e) {\n          log.warn(\"Couldn't add files from {} filtered by {} to classpath: {}\", dir, regex, e.getMessage());\n        }\n      } else if (null != path) {\n        final Path dir = loader.getInstancePath().resolve(path);\n        try {\n          urls.add(dir.toUri().toURL());\n        } catch (MalformedURLException e) {\n          log.warn(\"Couldn't add file {} to classpath: {}\", dir, e.getMessage());\n        }\n      } else {\n        throw new RuntimeException(\"lib: missing mandatory attributes: 'dir' or 'path'\");\n      }\n    }\n\n    if (urls.size() > 0) {\n      loader.addToClassLoader(urls);\n      loader.reloadLuceneSPI();\n    }\n  }\n\n","sourceOld":"  private void initLibs() {\n    NodeList nodes = (NodeList) evaluate(\"lib\", XPathConstants.NODESET);\n    if (nodes == null || nodes.getLength() == 0) return;\n\n    log.debug(\"Adding specified lib dirs to ClassLoader\");\n    SolrResourceLoader loader = getResourceLoader();\n    List<URL> urls = new ArrayList<>();\n\n    for (int i = 0; i < nodes.getLength(); i++) {\n      Node node = nodes.item(i);\n      String baseDir = DOMUtil.getAttr(node, \"dir\");\n      String path = DOMUtil.getAttr(node, PATH);\n      if (null != baseDir) {\n        // :TODO: add support for a simpler 'glob' mutually exclusive of regex\n        Path dir = loader.getInstancePath().resolve(baseDir);\n        String regex = DOMUtil.getAttr(node, \"regex\");\n        try {\n          if (regex == null)\n            urls.addAll(SolrResourceLoader.getURLs(dir));\n          else\n            urls.addAll(SolrResourceLoader.getFilteredURLs(dir, regex));\n        } catch (IOException e) {\n          log.warn(\"Couldn't add files from {} filtered by {} to classpath: {}\", dir, regex, e.getMessage());\n        }\n      } else if (null != path) {\n        final Path dir = loader.getInstancePath().resolve(path);\n        try {\n          urls.add(dir.toUri().toURL());\n        } catch (MalformedURLException e) {\n          log.warn(\"Couldn't add file {} to classpath: {}\", dir, e.getMessage());\n        }\n      } else {\n        throw new RuntimeException(\"lib: missing mandatory attributes: 'dir' or 'path'\");\n      }\n    }\n\n    if (urls.size() > 0) {\n      loader.addToClassLoader(urls);\n      loader.reloadLuceneSPI();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ec5a4e4c455009870c1cb8d21cf6671b8b78d3e3","date":1583932828,"type":5,"author":"David Smiley","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/core/SolrConfig#initLibs(SolrResourceLoader,boolean).mjava","pathOld":"solr/core/src/java/org/apache/solr/core/SolrConfig#initLibs(boolean).mjava","sourceNew":"  private void initLibs(SolrResourceLoader loader, boolean isConfigsetTrusted) {\n    // TODO Want to remove SolrResourceLoader.getInstancePath; it can be on a Standalone subclass.\n    //  For Zk subclass, it's needed for the time being as well.  We could remove that one if we remove two things\n    //  in SolrCloud: (1) instancePath/lib  and (2) solrconfig lib directives with relative paths.  Can wait till 9.0.\n    Path instancePath = loader.getInstancePath();\n    List<URL> urls = new ArrayList<>();\n\n    Path libPath = instancePath.resolve(\"lib\");\n    if (Files.exists(libPath)) {\n      try {\n        urls.addAll(SolrResourceLoader.getURLs(libPath));\n      } catch (IOException e) {\n        log.warn(\"Couldn't add files from {} to classpath: {}\", libPath, e.getMessage());\n      }\n    }\n\n    NodeList nodes = (NodeList) evaluate(\"lib\", XPathConstants.NODESET);\n    if (nodes == null || nodes.getLength() == 0) return;\n    if (!isConfigsetTrusted) {\n      throw new SolrException(ErrorCode.UNAUTHORIZED, \"The configset for this collection was uploaded without any authentication in place,\"\n          + \" and use of <lib> is not available for collections with untrusted configsets. To use this component, re-upload the configset\"\n          + \" after enabling authentication and authorization.\");\n    }\n\n    for (int i = 0; i < nodes.getLength(); i++) {\n      Node node = nodes.item(i);\n      String baseDir = DOMUtil.getAttr(node, \"dir\");\n      String path = DOMUtil.getAttr(node, PATH);\n      if (null != baseDir) {\n        // :TODO: add support for a simpler 'glob' mutually exclusive of regex\n        Path dir = instancePath.resolve(baseDir);\n        String regex = DOMUtil.getAttr(node, \"regex\");\n        try {\n          if (regex == null)\n            urls.addAll(SolrResourceLoader.getURLs(dir));\n          else\n            urls.addAll(SolrResourceLoader.getFilteredURLs(dir, regex));\n        } catch (IOException e) {\n          log.warn(\"Couldn't add files from {} filtered by {} to classpath: {}\", dir, regex, e.getMessage());\n        }\n      } else if (null != path) {\n        final Path dir = instancePath.resolve(path);\n        try {\n          urls.add(dir.toUri().toURL());\n        } catch (MalformedURLException e) {\n          log.warn(\"Couldn't add file {} to classpath: {}\", dir, e.getMessage());\n        }\n      } else {\n        throw new RuntimeException(\"lib: missing mandatory attributes: 'dir' or 'path'\");\n      }\n    }\n\n    loader.addToClassLoader(urls);\n    loader.reloadLuceneSPI();\n  }\n\n","sourceOld":"  private void initLibs(boolean isConfigsetTrusted) {\n    NodeList nodes = (NodeList) evaluate(\"lib\", XPathConstants.NODESET);\n    if (nodes == null || nodes.getLength() == 0) return;\n    if (!isConfigsetTrusted) {\n      throw new SolrException(ErrorCode.UNAUTHORIZED, \"The configset for this collection was uploaded without any authentication in place,\"\n          + \" and use of <lib> is not available for collections with untrusted configsets. To use this component, re-upload the configset\"\n          + \" after enabling authentication and authorization.\");\n    }\n\n    log.debug(\"Adding specified lib dirs to ClassLoader\");\n    SolrResourceLoader loader = getResourceLoader();\n    List<URL> urls = new ArrayList<>();\n\n    for (int i = 0; i < nodes.getLength(); i++) {\n      Node node = nodes.item(i);\n      String baseDir = DOMUtil.getAttr(node, \"dir\");\n      String path = DOMUtil.getAttr(node, PATH);\n      if (null != baseDir) {\n        // :TODO: add support for a simpler 'glob' mutually exclusive of regex\n        Path dir = loader.getInstancePath().resolve(baseDir);\n        String regex = DOMUtil.getAttr(node, \"regex\");\n        try {\n          if (regex == null)\n            urls.addAll(SolrResourceLoader.getURLs(dir));\n          else\n            urls.addAll(SolrResourceLoader.getFilteredURLs(dir, regex));\n        } catch (IOException e) {\n          log.warn(\"Couldn't add files from {} filtered by {} to classpath: {}\", dir, regex, e.getMessage());\n        }\n      } else if (null != path) {\n        final Path dir = loader.getInstancePath().resolve(path);\n        try {\n          urls.add(dir.toUri().toURL());\n        } catch (MalformedURLException e) {\n          log.warn(\"Couldn't add file {} to classpath: {}\", dir, e.getMessage());\n        }\n      } else {\n        throw new RuntimeException(\"lib: missing mandatory attributes: 'dir' or 'path'\");\n      }\n    }\n\n    if (urls.size() > 0) {\n      loader.addToClassLoader(urls);\n      loader.reloadLuceneSPI();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"df724d84dab24a0cc54bec95a8680867adc7f171":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","ad8024a22d8bd3a09b7f618f41cdfe117ae6fe96"],"ec5a4e4c455009870c1cb8d21cf6671b8b78d3e3":["ad8024a22d8bd3a09b7f618f41cdfe117ae6fe96"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"ad8024a22d8bd3a09b7f618f41cdfe117ae6fe96":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["ec5a4e4c455009870c1cb8d21cf6671b8b78d3e3"]},"commit2Childs":{"df724d84dab24a0cc54bec95a8680867adc7f171":[],"ec5a4e4c455009870c1cb8d21cf6671b8b78d3e3":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["df724d84dab24a0cc54bec95a8680867adc7f171","ad8024a22d8bd3a09b7f618f41cdfe117ae6fe96"],"ad8024a22d8bd3a09b7f618f41cdfe117ae6fe96":["df724d84dab24a0cc54bec95a8680867adc7f171","ec5a4e4c455009870c1cb8d21cf6671b8b78d3e3"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["df724d84dab24a0cc54bec95a8680867adc7f171","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}