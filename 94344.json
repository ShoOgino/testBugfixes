{"path":"solr/core/src/test/org/apache/solr/handler/admin/ZookeeperStatusHandlerTest#testMntrBugZk36Solr14463().mjava","commits":[{"id":"e593401f7b75b207ee04c2f8381fc5df0251b1d4","date":1589273853,"type":0,"author":"Jan HÃ¸ydahl","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/admin/ZookeeperStatusHandlerTest#testMntrBugZk36Solr14463().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testMntrBugZk36Solr14463() {\n    assumeWorkingMockito();\n    ZookeeperStatusHandler zkStatusHandler = mock(ZookeeperStatusHandler.class);\n    when(zkStatusHandler.getZkRawResponse(\"zoo1:2181\", \"ruok\")).thenReturn(Arrays.asList(\"imok\"));\n    when(zkStatusHandler.getZkRawResponse(\"zoo1:2181\", \"mntr\")).thenReturn(\n        Arrays.asList(\"zk_version\\t3.5.5-390fe37ea45dee01bf87dc1c042b5e3dcce88653, built on 05/03/2019 12:07 GMT\",\n            \"zk_avg_latency\\t1\",\n            \"zk_server_state\\tleader\",\n            \"zk_synced_followers\\t2\"));\n    when(zkStatusHandler.getZkRawResponse(\"zoo1:2181\", \"conf\")).thenReturn(\n        Arrays.asList(\"clientPort=2181\"));\n    when(zkStatusHandler.getZkStatus(anyString(), any())).thenCallRealMethod();\n    when(zkStatusHandler.monitorZookeeper(anyString())).thenCallRealMethod();\n    when(zkStatusHandler.validateZkRawResponse(ArgumentMatchers.any(), any(), any())).thenAnswer(Answers.CALLS_REAL_METHODS);\n\n    Map<String, Object> mockStatus = zkStatusHandler.getZkStatus(\"zoo1:2181\", ZkDynamicConfig.fromZkConnectString(\"zoo1:2181\"));\n    String expected = \"{\\n\" +\n        \"  \\\"mode\\\":\\\"ensemble\\\",\\n\" +\n        \"  \\\"dynamicReconfig\\\":true,\\n\" +\n        \"  \\\"ensembleSize\\\":1,\\n\" +\n        \"  \\\"details\\\":[{\\n\" +\n        \"      \\\"zk_synced_followers\\\":\\\"2\\\",\\n\" +\n        \"      \\\"zk_version\\\":\\\"3.5.5-390fe37ea45dee01bf87dc1c042b5e3dcce88653, built on 05/03/2019 12:07 GMT\\\",\\n\" +\n        \"      \\\"zk_avg_latency\\\":\\\"1\\\",\\n\" +\n        \"      \\\"host\\\":\\\"zoo1:2181\\\",\\n\" +\n        \"      \\\"clientPort\\\":\\\"2181\\\",\\n\" +\n        \"      \\\"ok\\\":true,\\n\" +\n        \"      \\\"zk_server_state\\\":\\\"leader\\\"}],\\n\" +\n        \"  \\\"zkHost\\\":\\\"zoo1:2181\\\",\\n\" +\n        \"  \\\"errors\\\":[\\\"Leader reports 2 followers, but we only found 0. Please check zkHost configuration\\\"],\\n\" +\n        \"  \\\"status\\\":\\\"red\\\"}\";\n    assertEquals(expected, JSONUtil.toJSON(mockStatus));\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["e593401f7b75b207ee04c2f8381fc5df0251b1d4"],"e593401f7b75b207ee04c2f8381fc5df0251b1d4":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["e593401f7b75b207ee04c2f8381fc5df0251b1d4"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[],"e593401f7b75b207ee04c2f8381fc5df0251b1d4":["cd5edd1f2b162a5cfa08efd17851a07373a96817"]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}