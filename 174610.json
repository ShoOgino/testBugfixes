{"path":"lucene/core/src/test/org/apache/lucene/index/TestDocumentsWriterPerThreadPool#testLockReleaseAndClose().mjava","commits":[{"id":"bd3903df1f9f4cfe074c9e72c60e31a9bed0ff72","date":1597413898,"type":0,"author":"Simon Willnauer","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDocumentsWriterPerThreadPool#testLockReleaseAndClose().mjava","pathOld":"/dev/null","sourceNew":"  public void testLockReleaseAndClose() throws IOException {\n    try (Directory directory = newDirectory()) {\n      DocumentsWriterPerThreadPool pool = new DocumentsWriterPerThreadPool(() ->\n          new DocumentsWriterPerThread(Version.LATEST.major, \"\", directory, directory,\n              newIndexWriterConfig(), new DocumentsWriterDeleteQueue(null), null, new AtomicLong(), false));\n\n      DocumentsWriterPerThread first = pool.getAndLock();\n      assertEquals(1, pool.size());\n      DocumentsWriterPerThread second = pool.getAndLock();\n      assertEquals(2, pool.size());\n      pool.marksAsFreeAndUnlock(first);\n      assertEquals(2, pool.size());\n      DocumentsWriterPerThread third = pool.getAndLock();\n      assertSame(first, third);\n      assertEquals(2, pool.size());\n      pool.checkout(third);\n      assertEquals(1, pool.size());\n\n      pool.close();\n      assertEquals(1, pool.size());\n      pool.marksAsFreeAndUnlock(second);\n      assertEquals(1, pool.size());\n      for (DocumentsWriterPerThread lastPerThead : pool.filterAndLock(x -> true)) {\n        pool.checkout(lastPerThead);\n        lastPerThead.unlock();\n      }\n      assertEquals(0, pool.size());\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"bd3903df1f9f4cfe074c9e72c60e31a9bed0ff72":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["bd3903df1f9f4cfe074c9e72c60e31a9bed0ff72"]},"commit2Childs":{"bd3903df1f9f4cfe074c9e72c60e31a9bed0ff72":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["bd3903df1f9f4cfe074c9e72c60e31a9bed0ff72"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}