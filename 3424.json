{"path":"solr/core/src/java/org/apache/solr/search/SolrDocumentFetcher.RetrieveFieldsOptimizer#calcDocValueFieldsForReturn(ReturnFields).mjava","commits":[{"id":"96ecd141e96e7a7a65822d7fada5ddc585b21149","date":1534786652,"type":0,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/search/SolrDocumentFetcher.RetrieveFieldsOptimizer#calcDocValueFieldsForReturn(ReturnFields).mjava","pathOld":"/dev/null","sourceNew":"    private Set<String> calcDocValueFieldsForReturn(ReturnFields returnFields) {\n      // always return not null\n      final Set<String> result = new HashSet<>();\n      if (returnFields.wantsAllFields()) {\n        result.addAll(getNonStoredDVs(true));\n        // check whether there are no additional fields\n        Set<String> fieldNames = returnFields.getLuceneFieldNames(true);\n        if (fieldNames != null) {\n          // add all requested fields that may be useDocValuesAsStored=false\n          for (String fl : fieldNames) {\n            if (getNonStoredDVs(false).contains(fl)) {\n              result.add(fl);\n            }\n          }\n        }\n      } else if (returnFields.hasPatternMatching()) {\n        for (String s : getNonStoredDVs(true)) {\n          if (returnFields.wantsField(s)) {\n            result.add(s);\n          }\n        }\n      } else {\n        Set<String> fnames = returnFields.getLuceneFieldNames();\n        if (fnames != null) {\n          result.addAll(fnames);\n          // here we get all non-stored dv fields because even if a user has set\n          // useDocValuesAsStored=false in schema, he may have requested a field\n          // explicitly using the fl parameter\n          result.retainAll(getNonStoredDVs(false));\n        }\n      }\n      return result;\n    }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"96ecd141e96e7a7a65822d7fada5ddc585b21149":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["96ecd141e96e7a7a65822d7fada5ddc585b21149"]},"commit2Childs":{"96ecd141e96e7a7a65822d7fada5ddc585b21149":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["96ecd141e96e7a7a65822d7fada5ddc585b21149"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}