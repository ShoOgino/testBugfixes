{"path":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginGlobalLoader().mjava","commits":[{"id":"d52ea0bca71d3b5f5fd37c12585ccd9309f8ea74","date":1563736916,"type":0,"author":"Noble Paul","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginGlobalLoader().mjava","pathOld":"/dev/null","sourceNew":"  public void testPluginGlobalLoader() throws Exception {\n    String COLLECTION_NAME = \"globalLoaderColl\";\n    Map<String, Object> jars = Utils.makeMap(\n        \"/jar1.jar\", getFileContent(\"runtimecode/runtimelibs.jar.bin\"),\n        \"/jar2.jar\", getFileContent(\"runtimecode/runtimelibs_v2.jar.bin\"),\n        \"/jar3.jar\", getFileContent(\"runtimecode/runtimelibs_v3.jar.bin\"));\n\n    Pair<Server, Integer> server = runHttpServer(jars);\n    int port = server.second();\n    System.setProperty(\"enable.runtime.lib\", \"true\");\n    MiniSolrCloudCluster cluster = configureCluster(4)\n        .addConfig(\"conf\", configset(\"cloud-minimal\"))\n        .configure();\n    try {\n      CollectionAdminRequest\n          .createCollection(COLLECTION_NAME, \"conf\", 2, 1)\n          .setMaxShardsPerNode(100)\n          .process(cluster.getSolrClient());\n\n\n      cluster.waitForActiveCollection(COLLECTION_NAME, 2, 2);\n      String payload = \"{add-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar1.jar', \" +\n          \"sha512 : 'd01b51de67ae1680a84a813983b1de3b592fc32f1a22b662fc9057da5953abd1b72476388ba342cad21671cd0b805503c78ab9075ff2f3951fdf75fa16981420'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"add-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n\n      payload = \"{\\n\" +\n          \"'create-requesthandler' : { 'name' : '/runtime', 'class': 'org.apache.solr.core.RuntimeLibReqHandler' , 'runtimeLib':global },\" +\n          \"'create-searchcomponent' : { 'name' : 'get', 'class': 'org.apache.solr.core.RuntimeLibSearchComponent' , 'runtimeLib':global },\" +\n          \"'create-queryResponseWriter' : { 'name' : 'json1', 'class': 'org.apache.solr.core.RuntimeLibResponseWriter' , 'runtimeLib':global }\" +\n          \"}\";\n      cluster.getSolrClient().request(new ConfigRequest(payload) {\n        @Override\n        public String getCollection() {\n          return COLLECTION_NAME;\n        }\n      });\n\n\n      SolrParams params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, JAVABIN));\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/overlay\", params),\n          Utils.makeMap(\n              \"overlay/queryResponseWriter/json1/class\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"overlay/searchComponent/get/class\", \"org.apache.solr.core.RuntimeLibSearchComponent\"\n          ));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\", params),\n          Utils.makeMap(\"class\", \"org.apache.solr.core.RuntimeLibReqHandler\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      GenericSolrRequest req = new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\",\n          new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, \"json1\")));\n      req.setResponseParser(new ResponseParser() {\n        @Override\n        public String getWriterType() {\n          return \"json1\";\n        }\n\n        @Override\n        public NamedList<Object> processResponse(InputStream body, String encoding) {\n          return new NamedList<>((Map) Utils.fromJSON(body));\n        }\n\n        @Override\n        public NamedList<Object> processResponse(Reader reader) {\n          return new NamedList<>((Map) Utils.fromJSON(reader));\n\n        }\n\n      });\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          req,\n          Utils.makeMap(\"wt\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"loader\", MemClassLoader.class.getName()));\n\n\n\n      payload = \"{update-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar2.jar', \" +\n          \"sha512 : 'bc5ce45ad281b6a08fb7e529b1eb475040076834816570902acb6ebdd809410e31006efdeaa7f78a6c35574f3504963f5f7e4d92247d0eb4db3fc9abdda5d417'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"update-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n          \"loader\", MemClassLoader.class.getName(),\n          \"Version\",\"2\"));\n    } finally {\n      cluster.deleteAllCollections();\n      cluster.shutdown();\n      server.first().stop();\n    }\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"3af1fabf087b825fa8daffd0b3594f1e019afa23","date":1563827024,"type":3,"author":"noble","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginGlobalLoader().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginGlobalLoader().mjava","sourceNew":"  public void testPluginGlobalLoader() throws Exception {\n    String COLLECTION_NAME = \"globalLoaderColl\";\n    Map<String, Object> jars = Utils.makeMap(\n        \"/jar1.jar\", getFileContent(\"runtimecode/runtimelibs.jar.bin\"),\n        \"/jar2.jar\", getFileContent(\"runtimecode/runtimelibs_v2.jar.bin\"),\n        \"/jar3.jar\", getFileContent(\"runtimecode/runtimelibs_v3.jar.bin\"));\n\n    Pair<Server, Integer> server = runHttpServer(jars);\n    int port = server.second();\n    System.setProperty(\"enable.runtime.lib\", \"true\");\n    MiniSolrCloudCluster cluster = configureCluster(4)\n        .addConfig(\"conf\", configset(\"cloud-minimal\"))\n        .configure();\n    try {\n      CollectionAdminRequest\n          .createCollection(COLLECTION_NAME, \"conf\", 2, 1)\n          .setMaxShardsPerNode(100)\n          .process(cluster.getSolrClient());\n\n\n      cluster.waitForActiveCollection(COLLECTION_NAME, 2, 2);\n      String payload = \"{add-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar1.jar', \" +\n          \"sha512 : 'd01b51de67ae1680a84a813983b1de3b592fc32f1a22b662fc9057da5953abd1b72476388ba342cad21671cd0b805503c78ab9075ff2f3951fdf75fa16981420'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"add-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n\n      payload = \"{\\n\" +\n          \"'create-requesthandler' : { 'name' : '/runtime', 'class': 'org.apache.solr.core.RuntimeLibReqHandler' , 'runtimeLib':global },\" +\n          \"'create-searchcomponent' : { 'name' : 'get', 'class': 'org.apache.solr.core.RuntimeLibSearchComponent' , 'runtimeLib':global },\" +\n          \"'create-queryResponseWriter' : { 'name' : 'json1', 'class': 'org.apache.solr.core.RuntimeLibResponseWriter' , 'runtimeLib':global }\" +\n          \"}\";\n      cluster.getSolrClient().request(new ConfigRequest(payload) {\n        @Override\n        public String getCollection() {\n          return COLLECTION_NAME;\n        }\n      });\n\n\n      SolrParams params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, JAVABIN));\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/overlay\", params),\n          Utils.makeMap(\n              \"overlay/queryResponseWriter/json1/class\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"overlay/searchComponent/get/class\", \"org.apache.solr.core.RuntimeLibSearchComponent\"\n          ));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\", params),\n          Utils.makeMap(\"class\", \"org.apache.solr.core.RuntimeLibReqHandler\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      GenericSolrRequest req = new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\",\n          new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, \"json1\")));\n      req.setResponseParser(new ResponseParser() {\n        @Override\n        public String getWriterType() {\n          return \"json1\";\n        }\n\n        @Override\n        public NamedList<Object> processResponse(InputStream body, String encoding) {\n          return new NamedList<>((Map) Utils.fromJSON(body));\n        }\n\n        @Override\n        public NamedList<Object> processResponse(Reader reader) {\n          return new NamedList<>((Map) Utils.fromJSON(reader));\n\n        }\n\n      });\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          req,\n          Utils.makeMap(\"wt\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"loader\", MemClassLoader.class.getName()));\n\n\n      payload = \"{update-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar2.jar', \" +\n          \"sha512 : 'bc5ce45ad281b6a08fb7e529b1eb475040076834816570902acb6ebdd809410e31006efdeaa7f78a6c35574f3504963f5f7e4d92247d0eb4db3fc9abdda5d417'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"update-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n      try {\n        new V2Request.Builder(\"/cluster\")\n            .withPayload(payload)\n            .withMethod(SolrRequest.METHOD.POST)\n            .build().process(cluster.getSolrClient());\n        fail(\"should have failed\");\n      } catch (BaseHttpSolrClient.RemoteExecutionException e) {\n        assertTrue(\"actual output : \" + Utils.toJSONString(e.getMetaData()), e.getMetaData()._getStr(\"error/details[0]/errorMessages[0]\", \"\").contains(\"Trying to update a jar with the same sha512\"));\n      }\n\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName(),\n              \"Version\", \"2\"));\n    } finally {\n      cluster.deleteAllCollections();\n      cluster.shutdown();\n      server.first().stop();\n    }\n\n  }\n\n","sourceOld":"  public void testPluginGlobalLoader() throws Exception {\n    String COLLECTION_NAME = \"globalLoaderColl\";\n    Map<String, Object> jars = Utils.makeMap(\n        \"/jar1.jar\", getFileContent(\"runtimecode/runtimelibs.jar.bin\"),\n        \"/jar2.jar\", getFileContent(\"runtimecode/runtimelibs_v2.jar.bin\"),\n        \"/jar3.jar\", getFileContent(\"runtimecode/runtimelibs_v3.jar.bin\"));\n\n    Pair<Server, Integer> server = runHttpServer(jars);\n    int port = server.second();\n    System.setProperty(\"enable.runtime.lib\", \"true\");\n    MiniSolrCloudCluster cluster = configureCluster(4)\n        .addConfig(\"conf\", configset(\"cloud-minimal\"))\n        .configure();\n    try {\n      CollectionAdminRequest\n          .createCollection(COLLECTION_NAME, \"conf\", 2, 1)\n          .setMaxShardsPerNode(100)\n          .process(cluster.getSolrClient());\n\n\n      cluster.waitForActiveCollection(COLLECTION_NAME, 2, 2);\n      String payload = \"{add-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar1.jar', \" +\n          \"sha512 : 'd01b51de67ae1680a84a813983b1de3b592fc32f1a22b662fc9057da5953abd1b72476388ba342cad21671cd0b805503c78ab9075ff2f3951fdf75fa16981420'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"add-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n\n      payload = \"{\\n\" +\n          \"'create-requesthandler' : { 'name' : '/runtime', 'class': 'org.apache.solr.core.RuntimeLibReqHandler' , 'runtimeLib':global },\" +\n          \"'create-searchcomponent' : { 'name' : 'get', 'class': 'org.apache.solr.core.RuntimeLibSearchComponent' , 'runtimeLib':global },\" +\n          \"'create-queryResponseWriter' : { 'name' : 'json1', 'class': 'org.apache.solr.core.RuntimeLibResponseWriter' , 'runtimeLib':global }\" +\n          \"}\";\n      cluster.getSolrClient().request(new ConfigRequest(payload) {\n        @Override\n        public String getCollection() {\n          return COLLECTION_NAME;\n        }\n      });\n\n\n      SolrParams params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, JAVABIN));\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/overlay\", params),\n          Utils.makeMap(\n              \"overlay/queryResponseWriter/json1/class\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"overlay/searchComponent/get/class\", \"org.apache.solr.core.RuntimeLibSearchComponent\"\n          ));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\", params),\n          Utils.makeMap(\"class\", \"org.apache.solr.core.RuntimeLibReqHandler\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      GenericSolrRequest req = new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\",\n          new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, \"json1\")));\n      req.setResponseParser(new ResponseParser() {\n        @Override\n        public String getWriterType() {\n          return \"json1\";\n        }\n\n        @Override\n        public NamedList<Object> processResponse(InputStream body, String encoding) {\n          return new NamedList<>((Map) Utils.fromJSON(body));\n        }\n\n        @Override\n        public NamedList<Object> processResponse(Reader reader) {\n          return new NamedList<>((Map) Utils.fromJSON(reader));\n\n        }\n\n      });\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          req,\n          Utils.makeMap(\"wt\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"loader\", MemClassLoader.class.getName()));\n\n\n\n      payload = \"{update-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar2.jar', \" +\n          \"sha512 : 'bc5ce45ad281b6a08fb7e529b1eb475040076834816570902acb6ebdd809410e31006efdeaa7f78a6c35574f3504963f5f7e4d92247d0eb4db3fc9abdda5d417'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"update-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n          \"loader\", MemClassLoader.class.getName(),\n          \"Version\",\"2\"));\n    } finally {\n      cluster.deleteAllCollections();\n      cluster.shutdown();\n      server.first().stop();\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"39dabfd19b49b248d63cedbb01ea144ee5ad071c","date":1566241238,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginGlobalLoader().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginGlobalLoader().mjava","sourceNew":"  public void testPluginGlobalLoader() throws Exception {\n    String COLLECTION_NAME = \"globalLoaderColl\";\n    Map<String, Object> jars = Utils.makeMap(\n        \"/jar1.jar\", getFileContent(\"runtimecode/runtimelibs.jar.bin\"),\n        \"/jar2.jar\", getFileContent(\"runtimecode/runtimelibs_v2.jar.bin\"),\n        \"/jar3.jar\", getFileContent(\"runtimecode/runtimelibs_v3.jar.bin\"));\n\n    Pair<Server, Integer> server = runHttpServer(jars);\n    int port = server.second();\n    System.setProperty(\"enable.runtime.lib\", \"true\");\n    MiniSolrCloudCluster cluster = configureCluster(4)\n        .addConfig(\"conf\", configset(\"cloud-minimal\"))\n        .configure();\n    try {\n      CollectionAdminRequest\n          .createCollection(COLLECTION_NAME, \"conf\", 2, 1)\n          .setMaxShardsPerNode(100)\n          .process(cluster.getSolrClient());\n\n\n      cluster.waitForActiveCollection(COLLECTION_NAME, 2, 2);\n      String payload = \"{add-package:{name : 'global', url: 'http://localhost:\" + port + \"/jar1.jar', \" +\n          \"sha512 : 'd01b51de67ae1680a84a813983b1de3b592fc32f1a22b662fc9057da5953abd1b72476388ba342cad21671cd0b805503c78ab9075ff2f3951fdf75fa16981420'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"add-package/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"package/global/sha512\"));\n\n\n      payload = \"{\\n\" +\n          \"'create-requesthandler' : { 'name' : '/runtime', 'class': 'org.apache.solr.core.RuntimeLibReqHandler' , 'package':global },\" +\n          \"'create-searchcomponent' : { 'name' : 'get', 'class': 'org.apache.solr.core.RuntimeLibSearchComponent' , 'package':global },\" +\n          \"'create-queryResponseWriter' : { 'name' : 'json1', 'class': 'org.apache.solr.core.RuntimeLibResponseWriter' , 'package':global }\" +\n          \"}\";\n      cluster.getSolrClient().request(new ConfigRequest(payload) {\n        @Override\n        public String getCollection() {\n          return COLLECTION_NAME;\n        }\n      });\n\n\n      SolrParams params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, JAVABIN));\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/overlay\", params),\n          Utils.makeMap(\n              \"overlay/queryResponseWriter/json1/class\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"overlay/searchComponent/get/class\", \"org.apache.solr.core.RuntimeLibSearchComponent\"\n          ));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\", params),\n          Utils.makeMap(\"class\", \"org.apache.solr.core.RuntimeLibReqHandler\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      GenericSolrRequest req = new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\",\n          new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, \"json1\")));\n      req.setResponseParser(new ResponseParser() {\n        @Override\n        public String getWriterType() {\n          return \"json1\";\n        }\n\n        @Override\n        public NamedList<Object> processResponse(InputStream body, String encoding) {\n          return new NamedList<>((Map) Utils.fromJSON(body));\n        }\n\n        @Override\n        public NamedList<Object> processResponse(Reader reader) {\n          return new NamedList<>((Map) Utils.fromJSON(reader));\n\n        }\n\n      });\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          req,\n          Utils.makeMap(\"wt\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"loader\", MemClassLoader.class.getName()));\n\n\n      payload = \"{update-package:{name : 'global', url: 'http://localhost:\" + port + \"/jar2.jar', \" +\n          \"sha512 : 'bc5ce45ad281b6a08fb7e529b1eb475040076834816570902acb6ebdd809410e31006efdeaa7f78a6c35574f3504963f5f7e4d92247d0eb4db3fc9abdda5d417'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"update-package/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"package/global/sha512\"));\n\n      try {\n        new V2Request.Builder(\"/cluster\")\n            .withPayload(payload)\n            .withMethod(SolrRequest.METHOD.POST)\n            .build().process(cluster.getSolrClient());\n        fail(\"should have failed\");\n      } catch (BaseHttpSolrClient.RemoteExecutionException e) {\n        assertTrue(\"actual output : \" + Utils.toJSONString(e.getMetaData()), e.getMetaData()._getStr(\"error/details[0]/errorMessages[0]\", \"\").contains(\"Trying to update a jar with the same sha512\"));\n      }\n\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName(),\n              \"Version\", \"2\"));\n    } finally {\n      cluster.deleteAllCollections();\n      cluster.shutdown();\n      server.first().stop();\n    }\n\n  }\n\n","sourceOld":"  public void testPluginGlobalLoader() throws Exception {\n    String COLLECTION_NAME = \"globalLoaderColl\";\n    Map<String, Object> jars = Utils.makeMap(\n        \"/jar1.jar\", getFileContent(\"runtimecode/runtimelibs.jar.bin\"),\n        \"/jar2.jar\", getFileContent(\"runtimecode/runtimelibs_v2.jar.bin\"),\n        \"/jar3.jar\", getFileContent(\"runtimecode/runtimelibs_v3.jar.bin\"));\n\n    Pair<Server, Integer> server = runHttpServer(jars);\n    int port = server.second();\n    System.setProperty(\"enable.runtime.lib\", \"true\");\n    MiniSolrCloudCluster cluster = configureCluster(4)\n        .addConfig(\"conf\", configset(\"cloud-minimal\"))\n        .configure();\n    try {\n      CollectionAdminRequest\n          .createCollection(COLLECTION_NAME, \"conf\", 2, 1)\n          .setMaxShardsPerNode(100)\n          .process(cluster.getSolrClient());\n\n\n      cluster.waitForActiveCollection(COLLECTION_NAME, 2, 2);\n      String payload = \"{add-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar1.jar', \" +\n          \"sha512 : 'd01b51de67ae1680a84a813983b1de3b592fc32f1a22b662fc9057da5953abd1b72476388ba342cad21671cd0b805503c78ab9075ff2f3951fdf75fa16981420'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"add-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n\n      payload = \"{\\n\" +\n          \"'create-requesthandler' : { 'name' : '/runtime', 'class': 'org.apache.solr.core.RuntimeLibReqHandler' , 'runtimeLib':global },\" +\n          \"'create-searchcomponent' : { 'name' : 'get', 'class': 'org.apache.solr.core.RuntimeLibSearchComponent' , 'runtimeLib':global },\" +\n          \"'create-queryResponseWriter' : { 'name' : 'json1', 'class': 'org.apache.solr.core.RuntimeLibResponseWriter' , 'runtimeLib':global }\" +\n          \"}\";\n      cluster.getSolrClient().request(new ConfigRequest(payload) {\n        @Override\n        public String getCollection() {\n          return COLLECTION_NAME;\n        }\n      });\n\n\n      SolrParams params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, JAVABIN));\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/overlay\", params),\n          Utils.makeMap(\n              \"overlay/queryResponseWriter/json1/class\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"overlay/searchComponent/get/class\", \"org.apache.solr.core.RuntimeLibSearchComponent\"\n          ));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\", params),\n          Utils.makeMap(\"class\", \"org.apache.solr.core.RuntimeLibReqHandler\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      GenericSolrRequest req = new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\",\n          new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, \"json1\")));\n      req.setResponseParser(new ResponseParser() {\n        @Override\n        public String getWriterType() {\n          return \"json1\";\n        }\n\n        @Override\n        public NamedList<Object> processResponse(InputStream body, String encoding) {\n          return new NamedList<>((Map) Utils.fromJSON(body));\n        }\n\n        @Override\n        public NamedList<Object> processResponse(Reader reader) {\n          return new NamedList<>((Map) Utils.fromJSON(reader));\n\n        }\n\n      });\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          req,\n          Utils.makeMap(\"wt\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"loader\", MemClassLoader.class.getName()));\n\n\n      payload = \"{update-runtimelib:{name : 'foo', url: 'http://localhost:\" + port + \"/jar2.jar', \" +\n          \"sha512 : 'bc5ce45ad281b6a08fb7e529b1eb475040076834816570902acb6ebdd809410e31006efdeaa7f78a6c35574f3504963f5f7e4d92247d0eb4db3fc9abdda5d417'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"update-runtimelib/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"runtimeLib/foo/sha512\"));\n\n      try {\n        new V2Request.Builder(\"/cluster\")\n            .withPayload(payload)\n            .withMethod(SolrRequest.METHOD.POST)\n            .build().process(cluster.getSolrClient());\n        fail(\"should have failed\");\n      } catch (BaseHttpSolrClient.RemoteExecutionException e) {\n        assertTrue(\"actual output : \" + Utils.toJSONString(e.getMetaData()), e.getMetaData()._getStr(\"error/details[0]/errorMessages[0]\", \"\").contains(\"Trying to update a jar with the same sha512\"));\n      }\n\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName(),\n              \"Version\", \"2\"));\n    } finally {\n      cluster.deleteAllCollections();\n      cluster.shutdown();\n      server.first().stop();\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6e360143e9d6f677ecfe06b0c5204ee70bdb2a3c","date":1566455239,"type":5,"author":"Noble Paul","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginFrompackage().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/TestContainerReqHandler#testPluginGlobalLoader().mjava","sourceNew":"  public void testPluginFrompackage() throws Exception {\n    String COLLECTION_NAME = \"globalLoaderColl\";\n    Map<String, Object> jars = Utils.makeMap(\n        \"/jar1.jar\", getFileContent(\"runtimecode/runtimelibs.jar.bin\"),\n        \"/jar2.jar\", getFileContent(\"runtimecode/runtimelibs_v2.jar.bin\"),\n        \"/jar3.jar\", getFileContent(\"runtimecode/runtimelibs_v3.jar.bin\"));\n\n    Pair<Server, Integer> server = runHttpServer(jars);\n    int port = server.second();\n    System.setProperty(\"enable.runtime.lib\", \"true\");\n    MiniSolrCloudCluster cluster = configureCluster(4)\n        .addConfig(\"conf\", configset(\"cloud-minimal\"))\n        .configure();\n    try {\n      CollectionAdminRequest\n          .createCollection(COLLECTION_NAME, \"conf\", 2, 1)\n          .setMaxShardsPerNode(100)\n          .process(cluster.getSolrClient());\n\n\n      cluster.waitForActiveCollection(COLLECTION_NAME, 2, 2);\n      String payload = \"{add-package:{name : 'global', url: 'http://localhost:\" + port + \"/jar1.jar', \" +\n          \"sha512 : 'd01b51de67ae1680a84a813983b1de3b592fc32f1a22b662fc9057da5953abd1b72476388ba342cad21671cd0b805503c78ab9075ff2f3951fdf75fa16981420'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      String sha512 = (String) getObjectByPath(Utils.fromJSONString(payload), true, \"add-package/sha512\");\n      String url = (String) getObjectByPath(Utils.fromJSONString(payload), true, \"add-package/url\");\n\n      assertEquals(sha512,\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"package/global/sha512\"));\n\n\n      payload = \"{\\n\" +\n          \"'create-requesthandler' : { 'name' : '/runtime', 'class': 'org.apache.solr.core.RuntimeLibReqHandler' , 'package':global },\" +\n          \"'create-searchcomponent' : { 'name' : 'get', 'class': 'org.apache.solr.core.RuntimeLibSearchComponent' , 'package':global },\" +\n          \"'create-queryResponseWriter' : { 'name' : 'json1', 'class': 'org.apache.solr.core.RuntimeLibResponseWriter' , 'package':global }\" +\n          \"}\";\n      cluster.getSolrClient().request(new ConfigRequest(payload) {\n        @Override\n        public String getCollection() {\n          return COLLECTION_NAME;\n        }\n      });\n\n      SolrParams params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME,\n          WT, JAVABIN,\n          \"meta\",\"true\"));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/queryResponseWriter/json1\", params),\n          Utils.makeMap(\n              \"/config/queryResponseWriter/json1/_packageinfo_/url\", url,\n              \"/config/queryResponseWriter/json1/_meta_/sha512\", sha512\n          ));\n\n      params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME,\n          WT, JAVABIN,\n          \"meta\",\"true\"));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/searchComponent/get\", params),\n          Utils.makeMap(\n              \"config/searchComponent/get/_packageinfo_/url\", url,\n              \"config/searchComponent/get/_packageinfo_/sha512\", sha512\n          ));\n\n      params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME,\n          WT, JAVABIN,\n          \"meta\",\"true\"));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/requestHandler/runtime\", params),\n          Utils.makeMap(\n              \":config:requestHandler:/runtime:_packageinfo_:url\", url,\n              \":config:requestHandler:/runtime:_packageinfo_:sha512\", sha512\n          ));\n\n\n      params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, JAVABIN));\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/overlay\", params),\n          Utils.makeMap(\n              \"overlay/queryResponseWriter/json1/class\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"overlay/searchComponent/get/class\", \"org.apache.solr.core.RuntimeLibSearchComponent\"\n          ));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\", params),\n          Utils.makeMap(\"class\", \"org.apache.solr.core.RuntimeLibReqHandler\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      GenericSolrRequest req = new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\",\n          new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, \"json1\")));\n      req.setResponseParser(new ResponseParser() {\n        @Override\n        public String getWriterType() {\n          return \"json1\";\n        }\n\n        @Override\n        public NamedList<Object> processResponse(InputStream body, String encoding) {\n          return new NamedList<>((Map) Utils.fromJSON(body));\n        }\n\n        @Override\n        public NamedList<Object> processResponse(Reader reader) {\n          return new NamedList<>((Map) Utils.fromJSON(reader));\n\n        }\n\n      });\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          req,\n          Utils.makeMap(\"wt\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"loader\", MemClassLoader.class.getName()));\n\n\n      payload = \"{update-package:{name : 'global', url: 'http://localhost:\" + port + \"/jar2.jar', \" +\n          \"sha512 : 'bc5ce45ad281b6a08fb7e529b1eb475040076834816570902acb6ebdd809410e31006efdeaa7f78a6c35574f3504963f5f7e4d92247d0eb4db3fc9abdda5d417'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      sha512 = (String) getObjectByPath(Utils.fromJSONString(payload), true, \"update-package/sha512\");\n      url = (String) getObjectByPath(Utils.fromJSONString(payload), true, \"update-package/url\");\n\n      assertEquals(sha512,\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"package/global/sha512\"));\n\n      params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME,\n          WT, JAVABIN,\n          \"meta\",\"true\"));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/queryResponseWriter/json1\", params),\n          Utils.makeMap(\n              \"/config/queryResponseWriter/json1/_packageinfo_/url\", url,\n              \"/config/queryResponseWriter/json1/_packageinfo_/sha512\", sha512\n          ));\n\n      params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME,\n          WT, JAVABIN,\n          \"meta\",\"true\"));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/searchComponent/get\", params),\n          Utils.makeMap(\n              \"/config/searchComponent/get/_packageinfo_/url\", url,\n              \"/config/searchComponent/get/_packageinfo_/sha512\", sha512\n          ));\n\n      params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME,\n          WT, JAVABIN,\n          \"meta\",\"true\"));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/requestHandler/runtime\", params),\n          Utils.makeMap(\n              \":config:requestHandler:/runtime:_packageinfo_:url\", url,\n              \":config:requestHandler:/runtime:_packageinfo_:sha512\", sha512\n          ));\n\n\n\n      try {\n        new V2Request.Builder(\"/cluster\")\n            .withPayload(payload)\n            .withMethod(SolrRequest.METHOD.POST)\n            .build().process(cluster.getSolrClient());\n        fail(\"should have failed\");\n      } catch (BaseHttpSolrClient.RemoteExecutionException e) {\n        assertTrue(\"actual output : \" + Utils.toJSONString(e.getMetaData()), e.getMetaData()._getStr(\"error/details[0]/errorMessages[0]\", \"\").contains(\"Trying to update a jar with the same sha512\"));\n      }\n\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName(),\n              \"Version\", \"2\"));\n    } finally {\n      cluster.deleteAllCollections();\n      cluster.shutdown();\n      server.first().stop();\n    }\n\n  }\n\n","sourceOld":"  public void testPluginGlobalLoader() throws Exception {\n    String COLLECTION_NAME = \"globalLoaderColl\";\n    Map<String, Object> jars = Utils.makeMap(\n        \"/jar1.jar\", getFileContent(\"runtimecode/runtimelibs.jar.bin\"),\n        \"/jar2.jar\", getFileContent(\"runtimecode/runtimelibs_v2.jar.bin\"),\n        \"/jar3.jar\", getFileContent(\"runtimecode/runtimelibs_v3.jar.bin\"));\n\n    Pair<Server, Integer> server = runHttpServer(jars);\n    int port = server.second();\n    System.setProperty(\"enable.runtime.lib\", \"true\");\n    MiniSolrCloudCluster cluster = configureCluster(4)\n        .addConfig(\"conf\", configset(\"cloud-minimal\"))\n        .configure();\n    try {\n      CollectionAdminRequest\n          .createCollection(COLLECTION_NAME, \"conf\", 2, 1)\n          .setMaxShardsPerNode(100)\n          .process(cluster.getSolrClient());\n\n\n      cluster.waitForActiveCollection(COLLECTION_NAME, 2, 2);\n      String payload = \"{add-package:{name : 'global', url: 'http://localhost:\" + port + \"/jar1.jar', \" +\n          \"sha512 : 'd01b51de67ae1680a84a813983b1de3b592fc32f1a22b662fc9057da5953abd1b72476388ba342cad21671cd0b805503c78ab9075ff2f3951fdf75fa16981420'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"add-package/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"package/global/sha512\"));\n\n\n      payload = \"{\\n\" +\n          \"'create-requesthandler' : { 'name' : '/runtime', 'class': 'org.apache.solr.core.RuntimeLibReqHandler' , 'package':global },\" +\n          \"'create-searchcomponent' : { 'name' : 'get', 'class': 'org.apache.solr.core.RuntimeLibSearchComponent' , 'package':global },\" +\n          \"'create-queryResponseWriter' : { 'name' : 'json1', 'class': 'org.apache.solr.core.RuntimeLibResponseWriter' , 'package':global }\" +\n          \"}\";\n      cluster.getSolrClient().request(new ConfigRequest(payload) {\n        @Override\n        public String getCollection() {\n          return COLLECTION_NAME;\n        }\n      });\n\n\n      SolrParams params = new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, JAVABIN));\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/config/overlay\", params),\n          Utils.makeMap(\n              \"overlay/queryResponseWriter/json1/class\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"overlay/searchComponent/get/class\", \"org.apache.solr.core.RuntimeLibSearchComponent\"\n          ));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\", params),\n          Utils.makeMap(\"class\", \"org.apache.solr.core.RuntimeLibReqHandler\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName()));\n\n      GenericSolrRequest req = new GenericSolrRequest(SolrRequest.METHOD.GET, \"/runtime\",\n          new MapSolrParams((Map) Utils.makeMap(\"collection\", COLLECTION_NAME, WT, \"json1\")));\n      req.setResponseParser(new ResponseParser() {\n        @Override\n        public String getWriterType() {\n          return \"json1\";\n        }\n\n        @Override\n        public NamedList<Object> processResponse(InputStream body, String encoding) {\n          return new NamedList<>((Map) Utils.fromJSON(body));\n        }\n\n        @Override\n        public NamedList<Object> processResponse(Reader reader) {\n          return new NamedList<>((Map) Utils.fromJSON(reader));\n\n        }\n\n      });\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          req,\n          Utils.makeMap(\"wt\", \"org.apache.solr.core.RuntimeLibResponseWriter\",\n              \"loader\", MemClassLoader.class.getName()));\n\n\n      payload = \"{update-package:{name : 'global', url: 'http://localhost:\" + port + \"/jar2.jar', \" +\n          \"sha512 : 'bc5ce45ad281b6a08fb7e529b1eb475040076834816570902acb6ebdd809410e31006efdeaa7f78a6c35574f3504963f5f7e4d92247d0eb4db3fc9abdda5d417'}}\";\n      new V2Request.Builder(\"/cluster\")\n          .withPayload(payload)\n          .withMethod(SolrRequest.METHOD.POST)\n          .build().process(cluster.getSolrClient());\n      assertEquals(getObjectByPath(Utils.fromJSONString(payload), true, \"update-package/sha512\"),\n          getObjectByPath(new ClusterProperties(cluster.getZkClient()).getClusterProperties(), true, \"package/global/sha512\"));\n\n      try {\n        new V2Request.Builder(\"/cluster\")\n            .withPayload(payload)\n            .withMethod(SolrRequest.METHOD.POST)\n            .build().process(cluster.getSolrClient());\n        fail(\"should have failed\");\n      } catch (BaseHttpSolrClient.RemoteExecutionException e) {\n        assertTrue(\"actual output : \" + Utils.toJSONString(e.getMetaData()), e.getMetaData()._getStr(\"error/details[0]/errorMessages[0]\", \"\").contains(\"Trying to update a jar with the same sha512\"));\n      }\n\n\n      assertResponseValues(10,\n          cluster.getSolrClient(),\n          new GenericSolrRequest(SolrRequest.METHOD.GET, \"/get?abc=xyz\", params),\n          Utils.makeMap(\"get\", \"org.apache.solr.core.RuntimeLibSearchComponent\",\n              \"loader\", MemClassLoader.class.getName(),\n              \"Version\", \"2\"));\n    } finally {\n      cluster.deleteAllCollections();\n      cluster.shutdown();\n      server.first().stop();\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"39dabfd19b49b248d63cedbb01ea144ee5ad071c":["3af1fabf087b825fa8daffd0b3594f1e019afa23"],"3af1fabf087b825fa8daffd0b3594f1e019afa23":["d52ea0bca71d3b5f5fd37c12585ccd9309f8ea74"],"d52ea0bca71d3b5f5fd37c12585ccd9309f8ea74":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"6e360143e9d6f677ecfe06b0c5204ee70bdb2a3c":["39dabfd19b49b248d63cedbb01ea144ee5ad071c"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["6e360143e9d6f677ecfe06b0c5204ee70bdb2a3c"]},"commit2Childs":{"39dabfd19b49b248d63cedbb01ea144ee5ad071c":["6e360143e9d6f677ecfe06b0c5204ee70bdb2a3c"],"3af1fabf087b825fa8daffd0b3594f1e019afa23":["39dabfd19b49b248d63cedbb01ea144ee5ad071c"],"d52ea0bca71d3b5f5fd37c12585ccd9309f8ea74":["3af1fabf087b825fa8daffd0b3594f1e019afa23"],"6e360143e9d6f677ecfe06b0c5204ee70bdb2a3c":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["d52ea0bca71d3b5f5fd37c12585ccd9309f8ea74"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}