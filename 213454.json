{"path":"lucene/highlighter/src/java/org/apache/lucene/search/matchhighlight/MatchHighlighter#highlight(TopDocs,Query...).mjava","commits":[{"id":"930e5c340e08514a7f57a54cf65e2f8f1f90c8f0","date":1599736633,"type":0,"author":"Dawid Weiss","isMerge":false,"pathNew":"lucene/highlighter/src/java/org/apache/lucene/search/matchhighlight/MatchHighlighter#highlight(TopDocs,Query...).mjava","pathOld":"/dev/null","sourceNew":"  public Stream<DocHighlights> highlight(TopDocs topDocs, Query... queries) throws IOException {\n    // We want to preserve topDocs document ordering and MatchRegionRetriever is optimized\n    // for streaming, so we'll just prepopulate the map in proper order.\n    LinkedHashMap<Integer, DocHit> docHits = new LinkedHashMap<>();\n    for (ScoreDoc scoreDoc : topDocs.scoreDocs) {\n      docHits.put(scoreDoc.doc, null);\n    }\n\n    // Collect match ranges for each query and associate each range to the origin query.\n    for (Query q : queries) {\n      MatchRegionRetriever highlighter =\n          new MatchRegionRetriever(searcher, searcher.rewrite(q), offsetsRetrievalStrategies);\n      highlighter.highlightDocuments(topDocs,\n          (int docId, LeafReader leafReader, int leafDocId, Map<String, List<OffsetRange>> hits) -> {\n            DocHit docHit = docHits.get(docId);\n            if (docHit == null) {\n              docHit = new DocHit(docId, leafReader, leafDocId);\n              docHits.put(docId, docHit);\n            }\n            docHit.addMatches(q, hits);\n          });\n    }\n\n    return docHits.values().stream()\n        .filter(Objects::nonNull) // This should always the case?\n        .map(this::computeDocFieldValues);\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"930e5c340e08514a7f57a54cf65e2f8f1f90c8f0":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["930e5c340e08514a7f57a54cf65e2f8f1f90c8f0"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["930e5c340e08514a7f57a54cf65e2f8f1f90c8f0"],"930e5c340e08514a7f57a54cf65e2f8f1f90c8f0":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}