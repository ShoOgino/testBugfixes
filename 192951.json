{"path":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","commits":[{"id":"469904587e47b677b125b4bb303304e1ef04e961","date":1393861559,"type":0,"author":"Joel Bernstein","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n\n\n\n\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":["4cd5fb664641d53f375acae565b2358e6cd309a2"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"0c92f8a8bfce9513f91cce0590834ca5333c64e6","date":1396388225,"type":3,"author":"Joel Bernstein","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\", \"type_s\", \"child\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Basic test case page 2\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"rows\", \"1\");\n    params.add(\"start\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test overide expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n\n    //Test overide expand.fq\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.fq\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test overide expand.fq and expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.fq\", \"*:*\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n\n\n\n\n\n  }\n\n","bugFix":null,"bugIntro":["4cd5fb664641d53f375acae565b2358e6cd309a2"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"5eb2511ababf862ea11e10761c70ee560cd84510","date":1396607225,"type":3,"author":"Dawid Weiss","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\", \"type_s\", \"child\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Basic test case page 2\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"rows\", \"1\");\n    params.add(\"start\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test overide expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n\n    //Test overide expand.fq\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.fq\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test overide expand.fq and expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.fq\", \"*:*\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n\n\n\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"eb518e3b5dddd136bbd532fe2e2890ac3f48e682","date":1401310344,"type":3,"author":"David Wayne Smiley","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\", \"type_s\", \"child\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Basic test case page 2\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"rows\", \"1\");\n    params.add(\"start\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc, sub(1,1) asc\");//the \"sub()\" just testing function queries\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test overide expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n\n    //Test overide expand.fq\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.fq\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test overide expand.fq and expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.fq\", \"*:*\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\", \"type_s\", \"child\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Basic test case page 2\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"rows\", \"1\");\n    params.add(\"start\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test overide expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n\n    //Test overide expand.fq\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.fq\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test overide expand.fq and expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.fq\", \"*:*\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"4cd5fb664641d53f375acae565b2358e6cd309a2","date":1418429100,"type":3,"author":"Shalin Shekhar Mangar","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    final String group = (random().nextBoolean() ? \"group_s\" : \"group_s_dv\");\n    \n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", group, \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", group, \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", group, \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", group, \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", group, \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\", \"type_s\", \"child\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", group, \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Basic test case page 2\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"rows\", \"1\");\n    params.add(\"start\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc, sub(1,1) asc\");//the \"sub()\" just testing function queries\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\" nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test overide expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.field\", group);\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n\n    //Test overide expand.fq\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.fq\", \"type_s:child\");\n    params.add(\"expand.field\", group);\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test overide expand.fq and expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.fq\", \"*:*\");\n    params.add(\"expand.field\", group);\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test key-only fl\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"fl\", \"id\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", \"group_s\", \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\", \"type_s\", \"child\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", \"group_s\", \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Basic test case page 2\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"rows\", \"1\");\n    params.add(\"start\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc, sub(1,1) asc\");//the \"sub()\" just testing function queries\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test overide expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n\n    //Test overide expand.fq\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.fq\", \"type_s:child\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test overide expand.fq and expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.fq\", \"*:*\");\n    params.add(\"expand.field\", \"group_s\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=group_s}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n  }\n\n","bugFix":["469904587e47b677b125b4bb303304e1ef04e961","0c92f8a8bfce9513f91cce0590834ca5333c64e6"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"8ced52befdc8d88d90766aadbaac496f3fd0e4ee","date":1421070034,"type":3,"author":"Joel Bernstein","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    List<String> groups = new ArrayList();\n    groups.add(\"group_s\");\n    groups.add(\"group_s_dv\");\n\n    Collections.shuffle(groups, random());\n    String floatAppend = \"\";\n\n    String hint = (random().nextBoolean() ? \" hint=\"+ CollapsingQParserPlugin.HINT_TOP_FC : \"\");\n\n     _testExpand(groups.get(0), floatAppend, hint);\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    final String group = (random().nextBoolean() ? \"group_s\" : \"group_s_dv\");\n    \n    String[] doc = {\"id\",\"1\", \"term_s\", \"YYYY\", group, \"group1\", \"test_ti\", \"5\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc));\n    assertU(commit());\n    String[] doc1 = {\"id\",\"2\", \"term_s\",\"YYYY\", group, \"group1\", \"test_ti\", \"50\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc1));\n\n    String[] doc2 = {\"id\",\"3\", \"term_s\", \"YYYY\", \"test_ti\", \"5000\", \"test_tl\", \"100\", \"test_tf\", \"200\"};\n    assertU(adoc(doc2));\n    assertU(commit());\n    String[] doc3 = {\"id\",\"4\", \"term_s\", \"YYYY\", \"test_ti\", \"500\", \"test_tl\", \"1000\", \"test_tf\", \"2000\"};\n    assertU(adoc(doc3));\n\n\n    String[] doc4 = {\"id\",\"5\", \"term_s\", \"YYYY\", group, \"group2\", \"test_ti\", \"4\", \"test_tl\", \"10\", \"test_tf\", \"2000\", \"type_s\", \"parent\"};\n    assertU(adoc(doc4));\n    assertU(commit());\n    String[] doc5 = {\"id\",\"6\", \"term_s\",\"YYYY\", group, \"group2\", \"test_ti\", \"10\", \"test_tl\", \"100\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc5));\n    assertU(commit());\n\n    String[] doc6 = {\"id\",\"7\", \"term_s\", \"YYYY\", group, \"group1\", \"test_ti\", \"1\", \"test_tl\", \"100000\", \"test_tf\", \"2000\", \"type_s\", \"child\"};\n    assertU(adoc(doc6));\n    assertU(commit());\n    String[] doc7 = {\"id\",\"8\", \"term_s\",\"YYYY\", group, \"group2\", \"test_ti\", \"2\", \"test_tl\", \"100000\", \"test_tf\", \"200\", \"type_s\", \"child\"};\n    assertU(adoc(doc7));\n\n    assertU(commit());\n\n    //First basic test case.\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Basic test case page 2\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"rows\", \"1\");\n    params.add(\"start\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n\n    //Test expand.sort\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc, sub(1,1) asc\");//the \"sub()\" just testing function queries\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n    //Test with nullPolicy, ExpandComponent should ignore docs with null values in the collapse fields.\n    //Main result set should include the doc with null value in the collapse field.\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\" nullPolicy=collapse}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=3]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='3.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[3]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='5.0']\"\n    );\n\n\n    //Test overide expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.field\", group);\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n\n    //Test overide expand.fq\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.fq\", \"type_s:child\");\n    params.add(\"expand.field\", group);\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test overide expand.fq and expand.q\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"type_s:parent\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.q\", \"type_s:child\");\n    params.add(\"expand.fq\", \"*:*\");\n    params.add(\"expand.field\", group);\n    params.add(\"expand.sort\", \"test_tl desc\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='2.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='6.0']\"\n    );\n\n    //Test expand.rows\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group1']/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result[@name='group2']/doc)=1]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='8.0']\"\n    );\n\n\n    //Test no group results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=1]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test zero results\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"test_ti:5532535\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"expand.sort\", \"test_tl desc\");\n    params.add(\"expand.rows\", \"1\");\n    assertQ(req(params), \"*[count(/response/result/doc)=0]\",\n        \"*[count(/response/lst[@name='expanded']/result)=0]\"\n    );\n\n    //Test key-only fl\n\n    params = new ModifiableSolrParams();\n    params.add(\"q\", \"*:*\");\n    params.add(\"fq\", \"{!collapse field=\"+group+\"}\");\n    params.add(\"defType\", \"edismax\");\n    params.add(\"bf\", \"field(test_ti)\");\n    params.add(\"expand\", \"true\");\n    params.add(\"fl\", \"id\");\n    assertQ(req(params), \"*[count(/response/result/doc)=2]\",\n        \"*[count(/response/lst[@name='expanded']/result)=2]\",\n        \"/response/result/doc[1]/float[@name='id'][.='2.0']\",\n        \"/response/result/doc[2]/float[@name='id'][.='6.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[1]/float[@name='id'][.='1.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group1']/doc[2]/float[@name='id'][.='7.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[1]/float[@name='id'][.='5.0']\",\n        \"/response/lst[@name='expanded']/result[@name='group2']/doc[2]/float[@name='id'][.='8.0']\"\n    );\n  }\n\n","bugFix":null,"bugIntro":["97473b7232d88686879e8d72210e5e2ad71bfcd1"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"4d048016075a0b8589fcfc77fdf8e2a29fc80964","date":1494631326,"type":3,"author":"Steve Rowe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    List<String> groups = new ArrayList<>();\n    groups.add(\"group_s\");\n    groups.add(\"group_s_dv\");\n\n    Collections.shuffle(groups, random());\n    String floatAppend = \"\";\n\n    String hint = (random().nextBoolean() ? \" hint=\"+ CollapsingQParserPlugin.HINT_TOP_FC : \"\");\n\n     _testExpand(groups.get(0), floatAppend, hint);\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    List<String> groups = new ArrayList();\n    groups.add(\"group_s\");\n    groups.add(\"group_s_dv\");\n\n    Collections.shuffle(groups, random());\n    String floatAppend = \"\";\n\n    String hint = (random().nextBoolean() ? \" hint=\"+ CollapsingQParserPlugin.HINT_TOP_FC : \"\");\n\n     _testExpand(groups.get(0), floatAppend, hint);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"e9017cf144952056066919f1ebc7897ff9bd71b1","date":1496757600,"type":3,"author":"Shalin Shekhar Mangar","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    List<String> groups = new ArrayList<>();\n    groups.add(\"group_s\");\n    groups.add(\"group_s_dv\");\n\n    Collections.shuffle(groups, random());\n    String floatAppend = \"\";\n\n    String hint = (random().nextBoolean() ? \" hint=\"+ CollapsingQParserPlugin.HINT_TOP_FC : \"\");\n\n     _testExpand(groups.get(0), floatAppend, hint);\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    List<String> groups = new ArrayList();\n    groups.add(\"group_s\");\n    groups.add(\"group_s_dv\");\n\n    Collections.shuffle(groups, random());\n    String floatAppend = \"\";\n\n    String hint = (random().nextBoolean() ? \" hint=\"+ CollapsingQParserPlugin.HINT_TOP_FC : \"\");\n\n     _testExpand(groups.get(0), floatAppend, hint);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"97473b7232d88686879e8d72210e5e2ad71bfcd1","date":1566274445,"type":3,"author":"Munendra S N","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","pathOld":"solr/core/src/test/org/apache/solr/handler/component/TestExpandComponent#testExpand().mjava","sourceNew":"  @Test\n  public void testExpand() throws Exception {\n    List<String> groups = new ArrayList<>();\n    groups.add(\"group_s\");\n    groups.add(\"group_s_dv\");\n\n    Collections.shuffle(groups, random());\n    String floatAppend = \"\";\n\n    String hint = (random().nextBoolean() ? \" hint=\"+ CollapsingQParserPlugin.HINT_TOP_FC : \"\");\n\n    _testExpand(groups.get(0), floatAppend, hint);\n  }\n\n","sourceOld":"  @Test\n  public void testExpand() throws Exception {\n    List<String> groups = new ArrayList<>();\n    groups.add(\"group_s\");\n    groups.add(\"group_s_dv\");\n\n    Collections.shuffle(groups, random());\n    String floatAppend = \"\";\n\n    String hint = (random().nextBoolean() ? \" hint=\"+ CollapsingQParserPlugin.HINT_TOP_FC : \"\");\n\n     _testExpand(groups.get(0), floatAppend, hint);\n  }\n\n","bugFix":["8ced52befdc8d88d90766aadbaac496f3fd0e4ee"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"5eb2511ababf862ea11e10761c70ee560cd84510":["469904587e47b677b125b4bb303304e1ef04e961","0c92f8a8bfce9513f91cce0590834ca5333c64e6"],"4cd5fb664641d53f375acae565b2358e6cd309a2":["eb518e3b5dddd136bbd532fe2e2890ac3f48e682"],"eb518e3b5dddd136bbd532fe2e2890ac3f48e682":["0c92f8a8bfce9513f91cce0590834ca5333c64e6"],"e9017cf144952056066919f1ebc7897ff9bd71b1":["8ced52befdc8d88d90766aadbaac496f3fd0e4ee","4d048016075a0b8589fcfc77fdf8e2a29fc80964"],"97473b7232d88686879e8d72210e5e2ad71bfcd1":["4d048016075a0b8589fcfc77fdf8e2a29fc80964"],"0c92f8a8bfce9513f91cce0590834ca5333c64e6":["469904587e47b677b125b4bb303304e1ef04e961"],"8ced52befdc8d88d90766aadbaac496f3fd0e4ee":["4cd5fb664641d53f375acae565b2358e6cd309a2"],"4d048016075a0b8589fcfc77fdf8e2a29fc80964":["8ced52befdc8d88d90766aadbaac496f3fd0e4ee"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["97473b7232d88686879e8d72210e5e2ad71bfcd1"],"469904587e47b677b125b4bb303304e1ef04e961":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"]},"commit2Childs":{"5eb2511ababf862ea11e10761c70ee560cd84510":[],"4cd5fb664641d53f375acae565b2358e6cd309a2":["8ced52befdc8d88d90766aadbaac496f3fd0e4ee"],"eb518e3b5dddd136bbd532fe2e2890ac3f48e682":["4cd5fb664641d53f375acae565b2358e6cd309a2"],"e9017cf144952056066919f1ebc7897ff9bd71b1":[],"97473b7232d88686879e8d72210e5e2ad71bfcd1":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"0c92f8a8bfce9513f91cce0590834ca5333c64e6":["5eb2511ababf862ea11e10761c70ee560cd84510","eb518e3b5dddd136bbd532fe2e2890ac3f48e682"],"8ced52befdc8d88d90766aadbaac496f3fd0e4ee":["e9017cf144952056066919f1ebc7897ff9bd71b1","4d048016075a0b8589fcfc77fdf8e2a29fc80964"],"4d048016075a0b8589fcfc77fdf8e2a29fc80964":["e9017cf144952056066919f1ebc7897ff9bd71b1","97473b7232d88686879e8d72210e5e2ad71bfcd1"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["469904587e47b677b125b4bb303304e1ef04e961"],"469904587e47b677b125b4bb303304e1ef04e961":["5eb2511ababf862ea11e10761c70ee560cd84510","0c92f8a8bfce9513f91cce0590834ca5333c64e6"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["5eb2511ababf862ea11e10761c70ee560cd84510","e9017cf144952056066919f1ebc7897ff9bd71b1","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}