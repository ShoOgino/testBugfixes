{"path":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","commits":[{"id":"ab5548b8f3ccb00ab6a8702dfc85a949d2a05a11","date":1367321736,"type":0,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"/dev/null","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<Document>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new CachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":["05fe562aa248790944d43cdd478f512572835ba0"],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"49a8cbd66bc94e18d7b9087e42dbc6cc0ee0c161","date":1378462032,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<Document>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<Document>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new CachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"634f330c54fd3f9f491d52036dc3f40b4f4d8934","date":1394635157,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<Document>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"ae14298f4eec6d5faee6a149f88ba57d14a6f21a","date":1396971290,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.shutdown();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"d0ef034a4f10871667ae75181537775ddcf8ade4","date":1407610475,"type":3,"author":"Ryan Ernst","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.shutdown();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"b012914a8110b2ff1d075ed1ef72aa57084d4897","date":1414685177,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitDocIdSetFilter parentsFilter = new BitDocIdSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    Filter parentsFilter = new FixedBitSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"3f68d01cf19df971dcdcb05e30247f4ad7ec9747","date":1434611645,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitDocIdSetFilter parentsFilter = new BitDocIdSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery.build(), c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitDocIdSetFilter parentsFilter = new BitDocIdSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery parentQuery = new BooleanQuery();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery, c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"4b3915945926c0bf7def01b0c504977709d3aed3","date":1436197708,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery.build(), c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitDocIdSetFilter parentsFilter = new BitDocIdSetCachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term(\"isParent\", \"yes\"))));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery.build(), c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"a67f37df79147ed4dd608300c2336c2979db98be","date":1436271524,"type":3,"author":"Adrien Grand","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery.build(), c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery.build(), c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"05fe562aa248790944d43cdd478f512572835ba0","date":1455901667,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    expectThrows(IllegalStateException.class, () -> {\n      newSearcher(r).search(parentQuery.build(), c);\n    });\n\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    try {\n      newSearcher(r).search(parentQuery.build(), c);\n      fail(\"should have hit exception\");\n    } catch (IllegalStateException ise) {\n      // expected\n    }\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":["ab5548b8f3ccb00ab6a8702dfc85a949d2a05a11"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"0e7bc21595222ae4f75509300fbb7726691f387f","date":1464078795,"type":3,"author":"Dawid Weiss","isMerge":false,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    expectThrows(IllegalStateException.class, () -> {\n      newSearcher(r).search(parentQuery.build(), c);\n    });\n\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    expectThrows(IllegalStateException.class, () -> {\n      newSearcher(r).search(parentQuery.build(), c);\n    });\n\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4cce5816ef15a48a0bc11e5d400497ee4301dd3b","date":1476991456,"type":3,"author":"Kevin Risden","isMerge":true,"pathNew":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    expectThrows(IllegalStateException.class, () -> {\n      newSearcher(r).search(parentQuery.build(), c);\n    });\n\n\n    r.close();\n    d.close();\n  }\n\n","sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n    \n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    expectThrows(IllegalStateException.class, () -> {\n      newSearcher(r).search(parentQuery.build(), c);\n    });\n\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"9d9452e13e015fa1187b0b1bed1a1d08b9c96241","date":1485723373,"type":4,"author":"Martijn van Groningen","isMerge":false,"pathNew":"/dev/null","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":null,"sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    expectThrows(IllegalStateException.class, () -> {\n      newSearcher(r).search(parentQuery.build(), c);\n    });\n\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"7c3523a0ab04c3002eee3896c75ea5f10f388bcc","date":1485968422,"type":4,"author":"Kevin Risden","isMerge":true,"pathNew":"/dev/null","pathOld":"lucene/join/src/test/org/apache/lucene/search/join/TestBlockJoin#testChildQueryMatchesParent().mjava","sourceNew":null,"sourceOld":"  // LUCENE-4968\n  public void testChildQueryMatchesParent() throws Exception {\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document parent = new Document();\n    parent.add(new StoredField(\"parentID\", \"0\"));\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n\n    List<Document> docs = new ArrayList<>();\n\n    Document child = new Document();\n    docs.add(child);\n    child.add(new StoredField(\"childID\", \"0\"));\n    child.add(newTextField(\"childText\", \"text\", Field.Store.NO));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    docs.clear();\n\n    parent = new Document();\n    parent.add(newTextField(\"parentText\", \"text\", Field.Store.NO));\n    parent.add(newStringField(\"isParent\", \"yes\", Field.Store.NO));\n    parent.add(new StoredField(\"parentID\", \"1\"));\n\n    // parent last:\n    docs.add(parent);\n    w.addDocuments(docs);\n\n    IndexReader r = w.getReader();\n    w.close();\n\n    // illegally matches parent:\n    Query childQuery = new TermQuery(new Term(\"parentText\", \"text\"));\n    BitSetProducer parentsFilter = new QueryBitSetProducer(new TermQuery(new Term(\"isParent\", \"yes\")));\n    CheckJoinIndex.check(r, parentsFilter);\n    ToParentBlockJoinQuery childJoinQuery = new ToParentBlockJoinQuery(childQuery, parentsFilter, ScoreMode.Avg);\n    BooleanQuery.Builder parentQuery = new BooleanQuery.Builder();\n    parentQuery.add(childJoinQuery, Occur.SHOULD);\n    parentQuery.add(new TermQuery(new Term(\"parentText\", \"text\")), Occur.SHOULD);\n\n    ToParentBlockJoinCollector c = new ToParentBlockJoinCollector(new Sort(new SortField(\"parentID\", SortField.Type.STRING)),\n                                                                  10, true, true);\n\n    expectThrows(IllegalStateException.class, () -> {\n      newSearcher(r).search(parentQuery.build(), c);\n    });\n\n\n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["49a8cbd66bc94e18d7b9087e42dbc6cc0ee0c161"],"b012914a8110b2ff1d075ed1ef72aa57084d4897":["d0ef034a4f10871667ae75181537775ddcf8ade4"],"a67f37df79147ed4dd608300c2336c2979db98be":["4b3915945926c0bf7def01b0c504977709d3aed3"],"7c3523a0ab04c3002eee3896c75ea5f10f388bcc":["4cce5816ef15a48a0bc11e5d400497ee4301dd3b","9d9452e13e015fa1187b0b1bed1a1d08b9c96241"],"05fe562aa248790944d43cdd478f512572835ba0":["a67f37df79147ed4dd608300c2336c2979db98be"],"4b3915945926c0bf7def01b0c504977709d3aed3":["3f68d01cf19df971dcdcb05e30247f4ad7ec9747"],"4cce5816ef15a48a0bc11e5d400497ee4301dd3b":["05fe562aa248790944d43cdd478f512572835ba0","0e7bc21595222ae4f75509300fbb7726691f387f"],"3f68d01cf19df971dcdcb05e30247f4ad7ec9747":["b012914a8110b2ff1d075ed1ef72aa57084d4897"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"0e7bc21595222ae4f75509300fbb7726691f387f":["05fe562aa248790944d43cdd478f512572835ba0"],"d0ef034a4f10871667ae75181537775ddcf8ade4":["ae14298f4eec6d5faee6a149f88ba57d14a6f21a"],"49a8cbd66bc94e18d7b9087e42dbc6cc0ee0c161":["ab5548b8f3ccb00ab6a8702dfc85a949d2a05a11"],"ae14298f4eec6d5faee6a149f88ba57d14a6f21a":["634f330c54fd3f9f491d52036dc3f40b4f4d8934"],"ab5548b8f3ccb00ab6a8702dfc85a949d2a05a11":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"9d9452e13e015fa1187b0b1bed1a1d08b9c96241":["0e7bc21595222ae4f75509300fbb7726691f387f"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["9d9452e13e015fa1187b0b1bed1a1d08b9c96241"]},"commit2Childs":{"634f330c54fd3f9f491d52036dc3f40b4f4d8934":["ae14298f4eec6d5faee6a149f88ba57d14a6f21a"],"b012914a8110b2ff1d075ed1ef72aa57084d4897":["3f68d01cf19df971dcdcb05e30247f4ad7ec9747"],"a67f37df79147ed4dd608300c2336c2979db98be":["05fe562aa248790944d43cdd478f512572835ba0"],"7c3523a0ab04c3002eee3896c75ea5f10f388bcc":[],"05fe562aa248790944d43cdd478f512572835ba0":["4cce5816ef15a48a0bc11e5d400497ee4301dd3b","0e7bc21595222ae4f75509300fbb7726691f387f"],"4b3915945926c0bf7def01b0c504977709d3aed3":["a67f37df79147ed4dd608300c2336c2979db98be"],"4cce5816ef15a48a0bc11e5d400497ee4301dd3b":["7c3523a0ab04c3002eee3896c75ea5f10f388bcc"],"3f68d01cf19df971dcdcb05e30247f4ad7ec9747":["4b3915945926c0bf7def01b0c504977709d3aed3"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["ab5548b8f3ccb00ab6a8702dfc85a949d2a05a11"],"49a8cbd66bc94e18d7b9087e42dbc6cc0ee0c161":["634f330c54fd3f9f491d52036dc3f40b4f4d8934"],"d0ef034a4f10871667ae75181537775ddcf8ade4":["b012914a8110b2ff1d075ed1ef72aa57084d4897"],"0e7bc21595222ae4f75509300fbb7726691f387f":["4cce5816ef15a48a0bc11e5d400497ee4301dd3b","9d9452e13e015fa1187b0b1bed1a1d08b9c96241"],"ae14298f4eec6d5faee6a149f88ba57d14a6f21a":["d0ef034a4f10871667ae75181537775ddcf8ade4"],"ab5548b8f3ccb00ab6a8702dfc85a949d2a05a11":["49a8cbd66bc94e18d7b9087e42dbc6cc0ee0c161"],"9d9452e13e015fa1187b0b1bed1a1d08b9c96241":["7c3523a0ab04c3002eee3896c75ea5f10f388bcc","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["7c3523a0ab04c3002eee3896c75ea5f10f388bcc","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}