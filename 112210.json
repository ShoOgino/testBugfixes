{"path":"lucene/test-framework/src/java/org/apache/lucene/util/LuceneTestCase#ensureSaneIWCOnNightly(IndexWriterConfig).mjava","commits":[{"id":"e84628e1e00d06556b67af150a13dbfb1849a818","date":1588191102,"type":1,"author":"Simon Willnauer","isMerge":false,"pathNew":"lucene/test-framework/src/java/org/apache/lucene/util/LuceneTestCase#ensureSaneIWCOnNightly(IndexWriterConfig).mjava","pathOld":"lucene/test-framework/src/java/org/apache/lucene/index/ThreadedIndexingAndSearchingTestCase#ensureSaneIWCOnNigtly(IndexWriterConfig).mjava","sourceNew":"  /**\n   * Ensures that the MergePolicy has sane values for tests that test with lots of documents.\n   */\n  protected static IndexWriterConfig ensureSaneIWCOnNightly(IndexWriterConfig conf) {\n    if (LuceneTestCase.TEST_NIGHTLY) {\n      // newIWConfig makes smallish max seg size, which\n      // results in tons and tons of segments for this test\n      // when run nightly:\n      MergePolicy mp = conf.getMergePolicy();\n      if (mp instanceof TieredMergePolicy) {\n        ((TieredMergePolicy) mp).setMaxMergedSegmentMB(5000.);\n      } else if (mp instanceof LogByteSizeMergePolicy) {\n        ((LogByteSizeMergePolicy) mp).setMaxMergeMB(1000.);\n      } else if (mp instanceof LogMergePolicy) {\n        ((LogMergePolicy) mp).setMaxMergeDocs(100000);\n      }\n      // when running nightly, merging can still have crazy parameters,\n      // and might use many per-field codecs. turn on CFS for IW flushes\n      // and ensure CFS ratio is reasonable to keep it contained.\n      conf.setUseCompoundFile(true);\n      mp.setNoCFSRatio(Math.max(0.25d, mp.getNoCFSRatio()));\n    }\n    return conf;\n  }\n\n","sourceOld":"  protected static IndexWriterConfig ensureSaneIWCOnNigtly(IndexWriterConfig conf) {\n    if (LuceneTestCase.TEST_NIGHTLY) {\n      // newIWConfig makes smallish max seg size, which\n      // results in tons and tons of segments for this test\n      // when run nightly:\n      MergePolicy mp = conf.getMergePolicy();\n      if (mp instanceof TieredMergePolicy) {\n        ((TieredMergePolicy) mp).setMaxMergedSegmentMB(5000.);\n      } else if (mp instanceof LogByteSizeMergePolicy) {\n        ((LogByteSizeMergePolicy) mp).setMaxMergeMB(1000.);\n      } else if (mp instanceof LogMergePolicy) {\n        ((LogMergePolicy) mp).setMaxMergeDocs(100000);\n      }\n      // when running nightly, merging can still have crazy parameters,\n      // and might use many per-field codecs. turn on CFS for IW flushes\n      // and ensure CFS ratio is reasonable to keep it contained.\n      conf.setUseCompoundFile(true);\n      mp.setNoCFSRatio(Math.max(0.25d, mp.getNoCFSRatio()));\n    }\n    return conf;\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"e84628e1e00d06556b67af150a13dbfb1849a818":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["e84628e1e00d06556b67af150a13dbfb1849a818"]},"commit2Childs":{"e84628e1e00d06556b67af150a13dbfb1849a818":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["e84628e1e00d06556b67af150a13dbfb1849a818"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}