{"path":"solr/solrj/src/test/org/apache/solr/client/solrj/embedded/SolrExampleStreamingBinaryTest#testQueryAndStreamResponse().mjava","commits":[{"id":"1e6dffeb9665eb433bf45523ed358afef21c7f83","date":1540558771,"type":0,"author":"Marvin Bredal Lillehaug","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/embedded/SolrExampleStreamingBinaryTest#testQueryAndStreamResponse().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testQueryAndStreamResponse() throws Exception {\n    // index a simple document with one child\n    SolrClient client = getSolrClient();\n    client.deleteByQuery(\"*:*\");\n\n    SolrInputDocument child = new SolrInputDocument();\n    child.addField(\"id\", \"child\");\n    child.addField(\"type_s\", \"child\");\n    child.addField(\"text_s\", \"text\");\n\n    SolrInputDocument parent = new SolrInputDocument();\n    parent.addField(\"id\", \"parent\");\n    parent.addField(\"type_s\", \"parent\");\n    parent.addChildDocument(child);\n\n    client.add(parent);\n    client.commit();\n\n    // create a query with child doc transformer\n    SolrQuery query = new SolrQuery(\"{!parent which='type_s:parent'}text_s:text\");\n    query.addField(\"*,[child parentFilter='type_s:parent']\");\n\n    // test regular query\n    QueryResponse response = client.query(query);\n    assertEquals(1, response.getResults().size());\n    SolrDocument parentDoc = response.getResults().get(0);\n    assertEquals(1, parentDoc.getChildDocumentCount());\n\n    // test streaming\n    final List<SolrDocument> docs = new ArrayList<>();\n    client.queryAndStreamResponse(query, new StreamingResponseCallback() {\n      @Override\n      public void streamSolrDocument(SolrDocument doc) {\n        docs.add(doc);\n      }\n\n      @Override\n      public void streamDocListInfo(long numFound, long start, Float maxScore) {\n      }\n    });\n\n    assertEquals(1, docs.size());\n    parentDoc = docs.get(0);\n    assertEquals(1, parentDoc.getChildDocumentCount());\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"1e6dffeb9665eb433bf45523ed358afef21c7f83":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["1e6dffeb9665eb433bf45523ed358afef21c7f83"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["1e6dffeb9665eb433bf45523ed358afef21c7f83"],"1e6dffeb9665eb433bf45523ed358afef21c7f83":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}