{"path":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testUniquesForMethod().mjava","commits":[{"id":"1209e20f8fc2fbb1cd77a6ed68204b2eb6a77b9d","date":1540886194,"type":0,"author":"Mikhail Khludnev","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testUniquesForMethod().mjava","pathOld":"/dev/null","sourceNew":"  /**\n   * An explicit test for unique*(_root_) across all methods\n   */\n  public void testUniquesForMethod() throws Exception {\n    final Client client = Client.localClient();\n\n    final SolrParams p = params(\"rows\",\"0\");\n\n    client.deleteByQuery(\"*:*\", null);\n\n    SolrInputDocument parent;\n    parent = sdoc(\"id\", \"1\", \"type_s\",\"book\", \"book_s\",\"A\", \"v_t\",\"q\");\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"2\", \"type_s\",\"book\", \"book_s\",\"B\", \"v_t\",\"q w\");\n    parent.addChildDocument( sdoc(\"id\",\"2.1\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x y z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.2\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"2.3\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"  y z\" )  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"3\", \"type_s\",\"book\", \"book_s\",\"C\", \"v_t\",\"q w e\");\n    parent.addChildDocument( sdoc(\"id\",\"3.1\", \"type_s\",\"page\", \"page_s\",\"d\", \"v_t\",\"x    \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.2\", \"type_s\",\"page\", \"page_s\",\"e\", \"v_t\",\"  y  \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.3\", \"type_s\",\"page\", \"page_s\",\"f\", \"v_t\",\"    z\")  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"4\", \"type_s\",\"book\", \"book_s\",\"D\", \"v_t\",\"e\");\n    client.add(parent, null);\n\n    client.commit();\n\n    client.testJQ(params(p, \"q\", \"type_s:page\"\n        , \"json.facet\", \"{\" +\n            \"  types: {\" +\n            \"    type:terms,\" +\n            \"    field:type_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }\"+\n            \"  },\" +\n            \"  pages: {\" +\n            \"    type:terms,\" +\n            \"    field:page_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"uniqueBlock(_root_)\\\" }\"+\n            \"  }\" +\n            \"}\" )\n\n        , \"response=={numFound:6,start:0,docs:[]}\"\n        , \"facets=={ count:6,\" +\n            \"types:{\" +\n            \"    buckets:[ {val:page, count:6, in_books:2} ]}\" +\n            \"pages:{\" +\n            \"    buckets:[ \" +\n            \"     {val:a, count:1, in_books:1},\" +\n            \"     {val:b, count:1, in_books:1},\" +\n            \"     {val:c, count:1, in_books:1},\" +\n            \"     {val:d, count:1, in_books:1},\" +\n            \"     {val:e, count:1, in_books:1},\" +\n            \"     {val:f, count:1, in_books:1}\" +\n            \"    ]}\" +\n            \"}\"\n    );\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"952363820b4b19866405197065083f25808fa7bb","date":1580645735,"type":3,"author":"Mikhail Khludnev","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testUniquesForMethod().mjava","pathOld":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testUniquesForMethod().mjava","sourceNew":"  /**\n   * An explicit test for unique*(_root_) across all methods\n   */\n  public void testUniquesForMethod() throws Exception {\n    final Client client = Client.localClient();\n\n    final SolrParams p = params(\"rows\",\"0\");\n\n    client.deleteByQuery(\"*:*\", null);\n\n    SolrInputDocument parent;\n    parent = sdoc(\"id\", \"1\", \"type_s\",\"book\", \"book_s\",\"A\", \"v_t\",\"q\");\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"2\", \"type_s\",\"book\", \"book_s\",\"B\", \"v_t\",\"q w\");\n    parent.addChildDocument( sdoc(\"id\",\"2.1\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x y z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.2\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x1   z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.3\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x2   z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.4\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"2.5\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"  y z\" )  );\n    parent.addChildDocument( sdoc(\"id\",\"2.6\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"    z\" )  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"3\", \"type_s\",\"book\", \"book_s\",\"C\", \"v_t\",\"q w e\");\n    parent.addChildDocument( sdoc(\"id\",\"3.1\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"3.2\", \"type_s\",\"page\", \"page_s\",\"d\", \"v_t\",\"x    \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.3\", \"type_s\",\"page\", \"page_s\",\"e\", \"v_t\",\"  y  \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.4\", \"type_s\",\"page\", \"page_s\",\"f\", \"v_t\",\"    z\")  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"4\", \"type_s\",\"book\", \"book_s\",\"D\", \"v_t\",\"e\");\n    client.add(parent, null);\n\n    client.commit();\n\n    client.testJQ(params(p, \"q\", \"type_s:page\"\n        , \"json.facet\", \"{\" +\n            \"  types: {\" +\n            \"    type:terms,\" +\n            \"    field:type_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\",\" +\n            \"           via_field:\\\"uniqueBlock(_root_)\\\",\"+\n            \"           via_query:\\\"uniqueBlock({!v=type_s:book})\\\" }\"+\n            \"  },\" +\n            \"  pages: {\" +\n            \"    type:terms,\" +\n            \"    field:page_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\",\" +\n            \"           via_field:\\\"uniqueBlock(_root_)\\\",\"+\n            \"           via_query:\\\"uniqueBlock({!v=type_s:book})\\\" }\"+\n            \"  }\" +\n            \"}\" )\n\n        , \"response=={numFound:10,start:0,docs:[]}\"\n        , \"facets=={ count:10,\" +\n            \"types:{\" +\n            \"    buckets:[ {val:page, count:10, in_books:2, via_field:2, via_query:2 } ]}\" +\n            \"pages:{\" +\n            \"    buckets:[ \" +\n            \"     {val:a, count:3, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:b, count:2, in_books:2, via_field:2, via_query:2},\" +\n            \"     {val:c, count:2, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:d, count:1, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:e, count:1, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:f, count:1, in_books:1, via_field:1, via_query:1}\" +\n            \"    ]}\" +\n            \"}\"\n    );\n  }\n\n","sourceOld":"  /**\n   * An explicit test for unique*(_root_) across all methods\n   */\n  public void testUniquesForMethod() throws Exception {\n    final Client client = Client.localClient();\n\n    final SolrParams p = params(\"rows\",\"0\");\n\n    client.deleteByQuery(\"*:*\", null);\n\n    SolrInputDocument parent;\n    parent = sdoc(\"id\", \"1\", \"type_s\",\"book\", \"book_s\",\"A\", \"v_t\",\"q\");\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"2\", \"type_s\",\"book\", \"book_s\",\"B\", \"v_t\",\"q w\");\n    parent.addChildDocument( sdoc(\"id\",\"2.1\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x y z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.2\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"2.3\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"  y z\" )  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"3\", \"type_s\",\"book\", \"book_s\",\"C\", \"v_t\",\"q w e\");\n    parent.addChildDocument( sdoc(\"id\",\"3.1\", \"type_s\",\"page\", \"page_s\",\"d\", \"v_t\",\"x    \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.2\", \"type_s\",\"page\", \"page_s\",\"e\", \"v_t\",\"  y  \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.3\", \"type_s\",\"page\", \"page_s\",\"f\", \"v_t\",\"    z\")  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"4\", \"type_s\",\"book\", \"book_s\",\"D\", \"v_t\",\"e\");\n    client.add(parent, null);\n\n    client.commit();\n\n    client.testJQ(params(p, \"q\", \"type_s:page\"\n        , \"json.facet\", \"{\" +\n            \"  types: {\" +\n            \"    type:terms,\" +\n            \"    field:type_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\" }\"+\n            \"  },\" +\n            \"  pages: {\" +\n            \"    type:terms,\" +\n            \"    field:page_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"uniqueBlock(_root_)\\\" }\"+\n            \"  }\" +\n            \"}\" )\n\n        , \"response=={numFound:6,start:0,docs:[]}\"\n        , \"facets=={ count:6,\" +\n            \"types:{\" +\n            \"    buckets:[ {val:page, count:6, in_books:2} ]}\" +\n            \"pages:{\" +\n            \"    buckets:[ \" +\n            \"     {val:a, count:1, in_books:1},\" +\n            \"     {val:b, count:1, in_books:1},\" +\n            \"     {val:c, count:1, in_books:1},\" +\n            \"     {val:d, count:1, in_books:1},\" +\n            \"     {val:e, count:1, in_books:1},\" +\n            \"     {val:f, count:1, in_books:1}\" +\n            \"    ]}\" +\n            \"}\"\n    );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"640ded7811e1b7d29236a5e2934ec3cd266a8199","date":1588973147,"type":3,"author":"Tomas Fernandez Lobbe","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testUniquesForMethod().mjava","pathOld":"solr/core/src/test/org/apache/solr/search/facet/TestJsonFacets#testUniquesForMethod().mjava","sourceNew":"  /**\n   * An explicit test for unique*(_root_) across all methods\n   */\n  public void testUniquesForMethod() throws Exception {\n    final Client client = Client.localClient();\n\n    final SolrParams p = params(\"rows\",\"0\");\n\n    client.deleteByQuery(\"*:*\", null);\n\n    SolrInputDocument parent;\n    parent = sdoc(\"id\", \"1\", \"type_s\",\"book\", \"book_s\",\"A\", \"v_t\",\"q\");\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"2\", \"type_s\",\"book\", \"book_s\",\"B\", \"v_t\",\"q w\");\n    parent.addChildDocument( sdoc(\"id\",\"2.1\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x y z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.2\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x1   z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.3\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x2   z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.4\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"2.5\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"  y z\" )  );\n    parent.addChildDocument( sdoc(\"id\",\"2.6\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"    z\" )  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"3\", \"type_s\",\"book\", \"book_s\",\"C\", \"v_t\",\"q w e\");\n    parent.addChildDocument( sdoc(\"id\",\"3.1\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"3.2\", \"type_s\",\"page\", \"page_s\",\"d\", \"v_t\",\"x    \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.3\", \"type_s\",\"page\", \"page_s\",\"e\", \"v_t\",\"  y  \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.4\", \"type_s\",\"page\", \"page_s\",\"f\", \"v_t\",\"    z\")  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"4\", \"type_s\",\"book\", \"book_s\",\"D\", \"v_t\",\"e\");\n    client.add(parent, null);\n\n    client.commit();\n\n    client.testJQ(params(p, \"q\", \"type_s:page\"\n        , \"json.facet\", \"{\" +\n            \"  types: {\" +\n            \"    type:terms,\" +\n            \"    field:type_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\",\" +\n            \"           via_field:\\\"uniqueBlock(_root_)\\\",\"+\n            \"           via_query:\\\"uniqueBlock({!v=type_s:book})\\\" }\"+\n            \"  },\" +\n            \"  pages: {\" +\n            \"    type:terms,\" +\n            \"    field:page_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\",\" +\n            \"           via_field:\\\"uniqueBlock(_root_)\\\",\"+\n            \"           via_query:\\\"uniqueBlock({!v=type_s:book})\\\" }\"+\n            \"  }\" +\n            \"}\" )\n\n        , \"response=={numFound:10,start:0,numFoundExact:true,docs:[]}\"\n        , \"facets=={ count:10,\" +\n            \"types:{\" +\n            \"    buckets:[ {val:page, count:10, in_books:2, via_field:2, via_query:2 } ]}\" +\n            \"pages:{\" +\n            \"    buckets:[ \" +\n            \"     {val:a, count:3, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:b, count:2, in_books:2, via_field:2, via_query:2},\" +\n            \"     {val:c, count:2, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:d, count:1, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:e, count:1, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:f, count:1, in_books:1, via_field:1, via_query:1}\" +\n            \"    ]}\" +\n            \"}\"\n    );\n  }\n\n","sourceOld":"  /**\n   * An explicit test for unique*(_root_) across all methods\n   */\n  public void testUniquesForMethod() throws Exception {\n    final Client client = Client.localClient();\n\n    final SolrParams p = params(\"rows\",\"0\");\n\n    client.deleteByQuery(\"*:*\", null);\n\n    SolrInputDocument parent;\n    parent = sdoc(\"id\", \"1\", \"type_s\",\"book\", \"book_s\",\"A\", \"v_t\",\"q\");\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"2\", \"type_s\",\"book\", \"book_s\",\"B\", \"v_t\",\"q w\");\n    parent.addChildDocument( sdoc(\"id\",\"2.1\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x y z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.2\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x1   z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.3\", \"type_s\",\"page\", \"page_s\",\"a\", \"v_t\",\"x2   z\")  );\n    parent.addChildDocument( sdoc(\"id\",\"2.4\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"2.5\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"  y z\" )  );\n    parent.addChildDocument( sdoc(\"id\",\"2.6\", \"type_s\",\"page\", \"page_s\",\"c\", \"v_t\",\"    z\" )  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"3\", \"type_s\",\"book\", \"book_s\",\"C\", \"v_t\",\"q w e\");\n    parent.addChildDocument( sdoc(\"id\",\"3.1\", \"type_s\",\"page\", \"page_s\",\"b\", \"v_t\",\"x y  \") );\n    parent.addChildDocument( sdoc(\"id\",\"3.2\", \"type_s\",\"page\", \"page_s\",\"d\", \"v_t\",\"x    \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.3\", \"type_s\",\"page\", \"page_s\",\"e\", \"v_t\",\"  y  \")  );\n    parent.addChildDocument( sdoc(\"id\",\"3.4\", \"type_s\",\"page\", \"page_s\",\"f\", \"v_t\",\"    z\")  );\n    client.add(parent, null);\n\n    parent = sdoc(\"id\", \"4\", \"type_s\",\"book\", \"book_s\",\"D\", \"v_t\",\"e\");\n    client.add(parent, null);\n\n    client.commit();\n\n    client.testJQ(params(p, \"q\", \"type_s:page\"\n        , \"json.facet\", \"{\" +\n            \"  types: {\" +\n            \"    type:terms,\" +\n            \"    field:type_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\",\" +\n            \"           via_field:\\\"uniqueBlock(_root_)\\\",\"+\n            \"           via_query:\\\"uniqueBlock({!v=type_s:book})\\\" }\"+\n            \"  },\" +\n            \"  pages: {\" +\n            \"    type:terms,\" +\n            \"    field:page_s,\" +\n            \"    limit:-1,\" +\n            \"    facet: {\" +\n            \"           in_books: \\\"unique(_root_)\\\",\" +\n            \"           via_field:\\\"uniqueBlock(_root_)\\\",\"+\n            \"           via_query:\\\"uniqueBlock({!v=type_s:book})\\\" }\"+\n            \"  }\" +\n            \"}\" )\n\n        , \"response=={numFound:10,start:0,docs:[]}\"\n        , \"facets=={ count:10,\" +\n            \"types:{\" +\n            \"    buckets:[ {val:page, count:10, in_books:2, via_field:2, via_query:2 } ]}\" +\n            \"pages:{\" +\n            \"    buckets:[ \" +\n            \"     {val:a, count:3, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:b, count:2, in_books:2, via_field:2, via_query:2},\" +\n            \"     {val:c, count:2, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:d, count:1, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:e, count:1, in_books:1, via_field:1, via_query:1},\" +\n            \"     {val:f, count:1, in_books:1, via_field:1, via_query:1}\" +\n            \"    ]}\" +\n            \"}\"\n    );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"640ded7811e1b7d29236a5e2934ec3cd266a8199":["952363820b4b19866405197065083f25808fa7bb"],"952363820b4b19866405197065083f25808fa7bb":["1209e20f8fc2fbb1cd77a6ed68204b2eb6a77b9d"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"1209e20f8fc2fbb1cd77a6ed68204b2eb6a77b9d":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["640ded7811e1b7d29236a5e2934ec3cd266a8199"]},"commit2Childs":{"640ded7811e1b7d29236a5e2934ec3cd266a8199":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"952363820b4b19866405197065083f25808fa7bb":["640ded7811e1b7d29236a5e2934ec3cd266a8199"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["1209e20f8fc2fbb1cd77a6ed68204b2eb6a77b9d"],"1209e20f8fc2fbb1cd77a6ed68204b2eb6a77b9d":["952363820b4b19866405197065083f25808fa7bb"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}