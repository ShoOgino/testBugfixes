{"path":"lucene/facet/src/test/org/apache/lucene/facet/simple/TestRangeFacets#testMissingValues().mjava","commits":[{"id":"ce7aff7772c162c15d520e31af46c555f60d5c3b","date":1385135519,"type":1,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/facet/src/test/org/apache/lucene/facet/simple/TestRangeFacets#testMissingValues().mjava","pathOld":"lucene/facet/src/test/org/apache/lucene/facet/range/TestRangeAccumulator#testMissingValues().mjava","sourceNew":"  // LUCENE-5178\n  public void testMissingValues() throws Exception {\n    assumeTrue(\"codec does not support docsWithField\", defaultCodecSupportsDocsWithField());\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document doc = new Document();\n    NumericDocValuesField field = new NumericDocValuesField(\"field\", 0L);\n    doc.add(field);\n    for(long l=0;l<100;l++) {\n      if (l % 5 == 0) {\n        // Every 5th doc is missing the value:\n        w.addDocument(new Document());\n        continue;\n      }\n      field.setLongValue(l);\n      w.addDocument(doc);\n    }\n\n    IndexReader r = w.getReader();\n\n    SimpleFacetsCollector sfc = new SimpleFacetsCollector();\n\n    IndexSearcher s = newSearcher(r);\n    s.search(new MatchAllDocsQuery(), sfc);\n    Facets facets = new RangeFacetCounts(\"field\", sfc,\n        new LongRange(\"less than 10\", 0L, true, 10L, false),\n        new LongRange(\"less than or equal to 10\", 0L, true, 10L, true),\n        new LongRange(\"over 90\", 90L, false, 100L, false),\n        new LongRange(\"90 or above\", 90L, true, 100L, false),\n        new LongRange(\"over 1000\", 1000L, false, Long.MAX_VALUE, false));\n    \n    assertEquals(\"field (100)\\n  less than 10 (8)\\n  less than or equal to 10 (8)\\n  over 90 (8)\\n  90 or above (8)\\n  over 1000 (0)\\n\",\n                 facets.getTopChildren(10, \"field\").toString());\n\n    IOUtils.close(w, r, d);\n  }\n\n","sourceOld":"  // LUCENE-5178\n  public void testMissingValues() throws Exception {\n    assumeTrue(\"codec does not support docsWithField\", defaultCodecSupportsDocsWithField());\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document doc = new Document();\n    NumericDocValuesField field = new NumericDocValuesField(\"field\", 0L);\n    doc.add(field);\n    for(long l=0;l<100;l++) {\n      if (l % 5 == 0) {\n        // Every 5th doc is missing the value:\n        w.addDocument(new Document());\n        continue;\n      }\n      field.setLongValue(l);\n      w.addDocument(doc);\n    }\n\n    IndexReader r = w.getReader();\n    w.close();\n\n    RangeAccumulator a = new RangeAccumulator(new RangeFacetRequest<LongRange>(\"field\",\n        new LongRange(\"less than 10\", 0L, true, 10L, false),\n        new LongRange(\"less than or equal to 10\", 0L, true, 10L, true),\n        new LongRange(\"over 90\", 90L, false, 100L, false),\n        new LongRange(\"90 or above\", 90L, true, 100L, false),\n        new LongRange(\"over 1000\", 1000L, false, Long.MAX_VALUE, false)));\n    \n    FacetsCollector fc = FacetsCollector.create(a);\n\n    IndexSearcher s = newSearcher(r);\n    s.search(new MatchAllDocsQuery(), fc);\n    List<FacetResult> result = fc.getFacetResults();\n    assertEquals(1, result.size());\n    assertEquals(\"field (0)\\n  less than 10 (8)\\n  less than or equal to 10 (8)\\n  over 90 (8)\\n  90 or above (8)\\n  over 1000 (0)\\n\", FacetTestUtils.toSimpleString(result.get(0)));\n    \n    r.close();\n    d.close();\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f01616d06510fc630b6ef0ec324bdebc2fc49b3c","date":1385331328,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/facet/src/test/org/apache/lucene/facet/simple/TestRangeFacets#testMissingValues().mjava","pathOld":"lucene/facet/src/test/org/apache/lucene/facet/simple/TestRangeFacets#testMissingValues().mjava","sourceNew":"  // LUCENE-5178\n  public void testMissingValues() throws Exception {\n    assumeTrue(\"codec does not support docsWithField\", defaultCodecSupportsDocsWithField());\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document doc = new Document();\n    NumericDocValuesField field = new NumericDocValuesField(\"field\", 0L);\n    doc.add(field);\n    for(long l=0;l<100;l++) {\n      if (l % 5 == 0) {\n        // Every 5th doc is missing the value:\n        w.addDocument(new Document());\n        continue;\n      }\n      field.setLongValue(l);\n      w.addDocument(doc);\n    }\n\n    IndexReader r = w.getReader();\n\n    SimpleFacetsCollector sfc = new SimpleFacetsCollector();\n\n    IndexSearcher s = newSearcher(r);\n    s.search(new MatchAllDocsQuery(), sfc);\n    Facets facets = new RangeFacetCounts(\"field\", sfc,\n        new LongRange(\"less than 10\", 0L, true, 10L, false),\n        new LongRange(\"less than or equal to 10\", 0L, true, 10L, true),\n        new LongRange(\"over 90\", 90L, false, 100L, false),\n        new LongRange(\"90 or above\", 90L, true, 100L, false),\n        new LongRange(\"over 1000\", 1000L, false, Long.MAX_VALUE, false));\n    \n    assertEquals(\"value=100 childCount=5\\n  less than 10 (8)\\n  less than or equal to 10 (8)\\n  over 90 (8)\\n  90 or above (8)\\n  over 1000 (0)\\n\",\n                 facets.getTopChildren(10, \"field\").toString());\n\n    IOUtils.close(w, r, d);\n  }\n\n","sourceOld":"  // LUCENE-5178\n  public void testMissingValues() throws Exception {\n    assumeTrue(\"codec does not support docsWithField\", defaultCodecSupportsDocsWithField());\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document doc = new Document();\n    NumericDocValuesField field = new NumericDocValuesField(\"field\", 0L);\n    doc.add(field);\n    for(long l=0;l<100;l++) {\n      if (l % 5 == 0) {\n        // Every 5th doc is missing the value:\n        w.addDocument(new Document());\n        continue;\n      }\n      field.setLongValue(l);\n      w.addDocument(doc);\n    }\n\n    IndexReader r = w.getReader();\n\n    SimpleFacetsCollector sfc = new SimpleFacetsCollector();\n\n    IndexSearcher s = newSearcher(r);\n    s.search(new MatchAllDocsQuery(), sfc);\n    Facets facets = new RangeFacetCounts(\"field\", sfc,\n        new LongRange(\"less than 10\", 0L, true, 10L, false),\n        new LongRange(\"less than or equal to 10\", 0L, true, 10L, true),\n        new LongRange(\"over 90\", 90L, false, 100L, false),\n        new LongRange(\"90 or above\", 90L, true, 100L, false),\n        new LongRange(\"over 1000\", 1000L, false, Long.MAX_VALUE, false));\n    \n    assertEquals(\"field (100)\\n  less than 10 (8)\\n  less than or equal to 10 (8)\\n  over 90 (8)\\n  90 or above (8)\\n  over 1000 (0)\\n\",\n                 facets.getTopChildren(10, \"field\").toString());\n\n    IOUtils.close(w, r, d);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"21d36d0db865f7b84026b447bec653469a6e66df","date":1385495602,"type":5,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/facet/src/test/org/apache/lucene/facet/TestRangeFacets#testMissingValues().mjava","pathOld":"lucene/facet/src/test/org/apache/lucene/facet/simple/TestRangeFacets#testMissingValues().mjava","sourceNew":"  // LUCENE-5178\n  public void testMissingValues() throws Exception {\n    assumeTrue(\"codec does not support docsWithField\", defaultCodecSupportsDocsWithField());\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document doc = new Document();\n    NumericDocValuesField field = new NumericDocValuesField(\"field\", 0L);\n    doc.add(field);\n    for(long l=0;l<100;l++) {\n      if (l % 5 == 0) {\n        // Every 5th doc is missing the value:\n        w.addDocument(new Document());\n        continue;\n      }\n      field.setLongValue(l);\n      w.addDocument(doc);\n    }\n\n    IndexReader r = w.getReader();\n\n    FacetsCollector sfc = new FacetsCollector();\n\n    IndexSearcher s = newSearcher(r);\n    s.search(new MatchAllDocsQuery(), sfc);\n    Facets facets = new RangeFacetCounts(\"field\", sfc,\n        new LongRange(\"less than 10\", 0L, true, 10L, false),\n        new LongRange(\"less than or equal to 10\", 0L, true, 10L, true),\n        new LongRange(\"over 90\", 90L, false, 100L, false),\n        new LongRange(\"90 or above\", 90L, true, 100L, false),\n        new LongRange(\"over 1000\", 1000L, false, Long.MAX_VALUE, false));\n    \n    assertEquals(\"value=100 childCount=5\\n  less than 10 (8)\\n  less than or equal to 10 (8)\\n  over 90 (8)\\n  90 or above (8)\\n  over 1000 (0)\\n\",\n                 facets.getTopChildren(10, \"field\").toString());\n\n    IOUtils.close(w, r, d);\n  }\n\n","sourceOld":"  // LUCENE-5178\n  public void testMissingValues() throws Exception {\n    assumeTrue(\"codec does not support docsWithField\", defaultCodecSupportsDocsWithField());\n    Directory d = newDirectory();\n    RandomIndexWriter w = new RandomIndexWriter(random(), d);\n    Document doc = new Document();\n    NumericDocValuesField field = new NumericDocValuesField(\"field\", 0L);\n    doc.add(field);\n    for(long l=0;l<100;l++) {\n      if (l % 5 == 0) {\n        // Every 5th doc is missing the value:\n        w.addDocument(new Document());\n        continue;\n      }\n      field.setLongValue(l);\n      w.addDocument(doc);\n    }\n\n    IndexReader r = w.getReader();\n\n    SimpleFacetsCollector sfc = new SimpleFacetsCollector();\n\n    IndexSearcher s = newSearcher(r);\n    s.search(new MatchAllDocsQuery(), sfc);\n    Facets facets = new RangeFacetCounts(\"field\", sfc,\n        new LongRange(\"less than 10\", 0L, true, 10L, false),\n        new LongRange(\"less than or equal to 10\", 0L, true, 10L, true),\n        new LongRange(\"over 90\", 90L, false, 100L, false),\n        new LongRange(\"90 or above\", 90L, true, 100L, false),\n        new LongRange(\"over 1000\", 1000L, false, Long.MAX_VALUE, false));\n    \n    assertEquals(\"value=100 childCount=5\\n  less than 10 (8)\\n  less than or equal to 10 (8)\\n  over 90 (8)\\n  90 or above (8)\\n  over 1000 (0)\\n\",\n                 facets.getTopChildren(10, \"field\").toString());\n\n    IOUtils.close(w, r, d);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"21d36d0db865f7b84026b447bec653469a6e66df":["f01616d06510fc630b6ef0ec324bdebc2fc49b3c"],"ce7aff7772c162c15d520e31af46c555f60d5c3b":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"f01616d06510fc630b6ef0ec324bdebc2fc49b3c":["ce7aff7772c162c15d520e31af46c555f60d5c3b"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["ce7aff7772c162c15d520e31af46c555f60d5c3b","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"21d36d0db865f7b84026b447bec653469a6e66df":[],"ce7aff7772c162c15d520e31af46c555f60d5c3b":["f01616d06510fc630b6ef0ec324bdebc2fc49b3c"],"f01616d06510fc630b6ef0ec324bdebc2fc49b3c":["21d36d0db865f7b84026b447bec653469a6e66df"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["21d36d0db865f7b84026b447bec653469a6e66df","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}