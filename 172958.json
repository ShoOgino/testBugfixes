{"path":"solr/core/src/java/org/apache/solr/handler/admin/IndexSizeEstimator#estimateDocValues(Map[String,Object]).mjava","commits":[{"id":"e4583dbd381e291c87e23144564c59ba3391b188","date":1560187306,"type":0,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/handler/admin/IndexSizeEstimator#estimateDocValues(Map[String,Object]).mjava","pathOld":"/dev/null","sourceNew":"  private void estimateDocValues(Map<String, Object> result) throws IOException {\n    log.info(\"- estimating docValues...\");\n    Map<String, Map<String, Object>> stats = new HashMap<>();\n    for (LeafReaderContext context : reader.leaves()) {\n      LeafReader leafReader = context.reader();\n      FieldInfos fieldInfos = leafReader.getFieldInfos();\n      for (FieldInfo info : fieldInfos) {\n        // binary\n        countDocValues(stats, info.name, \"binary\", leafReader.getBinaryDocValues(info.name), values -> {\n          try {\n            BytesRef value = ((BinaryDocValues) values).binaryValue();\n            return value.length;\n          } catch (IOException e) {\n            // ignore\n          }\n          return 0;\n        });\n        // numeric\n        countDocValues(stats, info.name, \"numeric\", leafReader.getNumericDocValues(info.name), values -> 8);\n        countDocValues(stats, info.name, \"sorted\", leafReader.getSortedDocValues(info.name), values -> {\n          try {\n            TermsEnum termsEnum = ((SortedDocValues) values).termsEnum();\n            BytesRef term;\n            while ((term = termsEnum.next()) != null) {\n              return term.length;\n            }\n          } catch (IOException e) {\n            // ignore\n          }\n          return 0;\n        });\n        countDocValues(stats, info.name, \"sortedNumeric\", leafReader.getSortedNumericDocValues(info.name),\n            values -> ((SortedNumericDocValues) values).docValueCount() * 8);\n        countDocValues(stats, info.name, \"sortedSet\", leafReader.getSortedSetDocValues(info.name), values -> {\n          try {\n            TermsEnum termsEnum = ((SortedSetDocValues) values).termsEnum();\n            BytesRef term;\n            while ((term = termsEnum.next()) != null) {\n              return term.length;\n            }\n          } catch (IOException e) {\n            // ignore\n          }\n          return 0;\n        });\n      }\n    }\n    result.put(DOC_VALUES, stats);\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"e4583dbd381e291c87e23144564c59ba3391b188":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["e4583dbd381e291c87e23144564c59ba3391b188"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["e4583dbd381e291c87e23144564c59ba3391b188"],"e4583dbd381e291c87e23144564c59ba3391b188":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}