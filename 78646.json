{"path":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","commits":[{"id":"6e764e9a107f93be9fa3c922bc6a197b3eec387e","date":1373560501,"type":1,"author":"Alan Woodward","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestCoreContainer#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    final CoreContainer cores = init(ConfigSolrXmlOld.DEF_SOLR_XML, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n    final File workDir = new File(TEMP_DIR, this.getClass().getName()\n        + \"_persist\");\n    if (workDir.exists()) {\n      FileUtils.deleteDirectory(workDir);\n    }\n    assertTrue(\"Failed to mkdirs workDir\", workDir.mkdirs());\n    \n    final CoreContainer cores = h.getCoreContainer();\n\n    cores.setPersistent(true); // is this needed since we make explicit calls?\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n    \n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n    \n    // sanity check the basic persistence of the default init\n    \n    final File oneXml = new File(workDir, \"1.solr.xml\");\n    cores.persistFile(oneXml);\n\n    assertXmlFile(oneXml, \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n        \"' and @transient='false' and @loadOnStartup='true' ]\", \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n    \n    final File dataXfile = new File(workDir, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n    \n    final File instYfile = new File(workDir, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n    \n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n    \n    final CoreDescriptor xd = new CoreDescriptor(cores, \"X\", instDir);\n    xd.setDataDir(dataX);\n    \n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n    \n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n      \n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n      \n      final File twoXml = new File(workDir, \"2.solr.xml\");\n\n      cores.persistFile(twoXml);\n\n      assertXmlFile(twoXml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      assertXmlFile(twoXml, \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n      \n      final File threeXml = new File(workDir, \"3.solr.xml\");\n      cores.persistFile(threeXml);\n      \n      assertXmlFile(threeXml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n      \n      // sanity check that persisting w/o changes has no changes\n      \n      final File fourXml = new File(workDir, \"4.solr.xml\");\n      cores.persistFile(fourXml);\n      \n      assertTrue(\"3 and 4 should be identical files\",\n          FileUtils.contentEquals(threeXml, fourXml));\n      \n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"37a0f60745e53927c4c876cfe5b5a58170f0646c","date":1373994005,"type":0,"author":"Han Jiang","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"/dev/null","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    final CoreContainer cores = init(ConfigSolrXmlOld.DEF_SOLR_XML, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":true,"nexts":[],"revCommit":null},{"id":"e0571cb12a71d379cc6bd0d3b70fe1d8867a109d","date":1377475564,"type":3,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        Charsets.UTF_8.toString());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    final CoreContainer cores = init(ConfigSolrXmlOld.DEF_SOLR_XML, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","bugFix":["6e764e9a107f93be9fa3c922bc6a197b3eec387e"],"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"3dffec77fb8f7d0e9ca4869dddd6af94528b4576","date":1377875202,"type":3,"author":"Han Jiang","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        Charsets.UTF_8.toString());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    final CoreContainer cores = init(ConfigSolrXmlOld.DEF_SOLR_XML, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e332392bbbdd01cb69ad6a89051f483cda38e15e","date":1395758779,"type":3,"author":"Alan Woodward","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        Charsets.UTF_8.toString());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        Charsets.UTF_8.toString());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir = null;\n    {\n      SolrCore template = null;\n      try {\n        template = cores.getCore(\"collection1\");\n        instDir = template.getCoreDescriptor().getRawInstanceDir();\n      } finally {\n        if (null != template) template.close();\n      }\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6e1c1455e91339e72d6cdc7518defd3e05a43957","date":1396304204,"type":3,"author":"Uwe Schindler","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        StandardCharsets.UTF_8.name());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        Charsets.UTF_8.toString());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"5eb2511ababf862ea11e10761c70ee560cd84510","date":1396607225,"type":3,"author":"Dawid Weiss","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        StandardCharsets.UTF_8.name());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        Charsets.UTF_8.toString());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"85032ab568b3f50eabd577aaa994ba197db93758","date":1404157267,"type":3,"author":"Alan Woodward","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        StandardCharsets.UTF_8.name());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        StandardCharsets.UTF_8.name());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n      cores.register(x, false);\n      cores.register(y, false);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"2d629ca62e3b8ab6e29a127aebe213163d490413","date":1405524223,"type":3,"author":"Alan Woodward","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        StandardCharsets.UTF_8.name());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      cores.unload(\"X\");\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      cores.shutdown();\n    }\n  }\n\n","sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        StandardCharsets.UTF_8.name());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      // delete a core, check persistence again\n      assertNotNull(\"removing X returned null\", cores.remove(\"X\"));\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      // y is closed by the container, but\n      // x has been removed from the container\n      if (x != null) {\n        try {\n          x.close();\n        } catch (Exception e) {\n          log.error(\"\", e);\n        }\n      }\n      cores.shutdown();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"fd44bec977a26a118d9e809e2de6f7edb5ca0f39","date":1421673929,"type":4,"author":"Alan Woodward","isMerge":false,"pathNew":"/dev/null","pathOld":"solr/core/src/test/org/apache/solr/core/TestSolrXmlPersistence#testPersist().mjava","sourceNew":null,"sourceOld":"  @Test\n  public void testPersist() throws Exception {\n\n    String defXml = FileUtils.readFileToString(\n        new File(SolrTestCaseJ4.TEST_HOME(), \"solr.xml\"),\n        StandardCharsets.UTF_8.name());\n    final CoreContainer cores = init(defXml, \"collection1\");\n    SolrXMLCoresLocator.NonPersistingLocator locator\n        = (SolrXMLCoresLocator.NonPersistingLocator) cores.getCoresLocator();\n\n    String instDir;\n    try (SolrCore template = cores.getCore(\"collection1\")) {\n      assertNotNull(template);\n      instDir = template.getCoreDescriptor().getRawInstanceDir();\n    }\n\n    final File instDirFile = new File(cores.getSolrHome(), instDir);\n    assertTrue(\"instDir doesn't exist: \" + instDir, instDirFile.exists());\n\n    // sanity check the basic persistence of the default init\n    TestHarness.validateXPath(locator.xml,\n        \"/solr[@persistent='true']\",\n        \"/solr/cores[@defaultCoreName='collection1' and not(@transientCacheSize)]\",\n        \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir +\n            \"' and @transient='false' and @loadOnStartup='true' ]\",\n        \"1=count(/solr/cores/core)\");\n\n    // create some new cores and sanity check the persistence\n\n    final File dataXfile = new File(solrHomeDirectory, \"dataX\");\n    final String dataX = dataXfile.getAbsolutePath();\n    assertTrue(\"dataXfile mkdirs failed: \" + dataX, dataXfile.mkdirs());\n\n    final File instYfile = new File(solrHomeDirectory, \"instY\");\n    FileUtils.copyDirectory(instDirFile, instYfile);\n\n    // :HACK: dataDir leaves off trailing \"/\", but instanceDir uses it\n    final String instY = instYfile.getAbsolutePath() + \"/\";\n\n    final CoreDescriptor xd = buildCoreDescriptor(cores, \"X\", instDir)\n        .withDataDir(dataX).build();\n\n    final CoreDescriptor yd = new CoreDescriptor(cores, \"Y\", instY);\n\n    SolrCore x = null;\n    SolrCore y = null;\n    try {\n      x = cores.create(xd);\n      y = cores.create(yd);\n\n      assertEquals(\"cores not added?\", 3, cores.getCoreNames().size());\n\n      TestHarness.validateXPath(locator.xml,\n          \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir\n              + \"']\", \"/solr/cores/core[@name='X' and @instanceDir='\" + instDir\n              + \"' and @dataDir='\" + dataX + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"3=count(/solr/cores/core)\");\n\n      // Test for saving implicit properties, we should not do this.\n      TestHarness.validateXPath(locator.xml,\n          \"/solr/cores/core[@name='X' and not(@solr.core.instanceDir) and not (@solr.core.configName)]\");\n\n      cores.unload(\"X\");\n\n      TestHarness.validateXPath(locator.xml, \"/solr[@persistent='true']\",\n          \"/solr/cores[@defaultCoreName='collection1']\",\n          \"/solr/cores/core[@name='collection1' and @instanceDir='\" + instDir + \"']\",\n          \"/solr/cores/core[@name='Y' and @instanceDir='\" + instY + \"']\",\n          \"2=count(/solr/cores/core)\");\n\n    } finally {\n      cores.shutdown();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"5eb2511ababf862ea11e10761c70ee560cd84510":["e332392bbbdd01cb69ad6a89051f483cda38e15e","6e1c1455e91339e72d6cdc7518defd3e05a43957"],"e0571cb12a71d379cc6bd0d3b70fe1d8867a109d":["6e764e9a107f93be9fa3c922bc6a197b3eec387e"],"37a0f60745e53927c4c876cfe5b5a58170f0646c":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","6e764e9a107f93be9fa3c922bc6a197b3eec387e"],"3dffec77fb8f7d0e9ca4869dddd6af94528b4576":["37a0f60745e53927c4c876cfe5b5a58170f0646c","e0571cb12a71d379cc6bd0d3b70fe1d8867a109d"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"2d629ca62e3b8ab6e29a127aebe213163d490413":["85032ab568b3f50eabd577aaa994ba197db93758"],"fd44bec977a26a118d9e809e2de6f7edb5ca0f39":["2d629ca62e3b8ab6e29a127aebe213163d490413"],"6e1c1455e91339e72d6cdc7518defd3e05a43957":["e332392bbbdd01cb69ad6a89051f483cda38e15e"],"e332392bbbdd01cb69ad6a89051f483cda38e15e":["e0571cb12a71d379cc6bd0d3b70fe1d8867a109d"],"6e764e9a107f93be9fa3c922bc6a197b3eec387e":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"85032ab568b3f50eabd577aaa994ba197db93758":["6e1c1455e91339e72d6cdc7518defd3e05a43957"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["fd44bec977a26a118d9e809e2de6f7edb5ca0f39"]},"commit2Childs":{"5eb2511ababf862ea11e10761c70ee560cd84510":[],"e0571cb12a71d379cc6bd0d3b70fe1d8867a109d":["3dffec77fb8f7d0e9ca4869dddd6af94528b4576","e332392bbbdd01cb69ad6a89051f483cda38e15e"],"37a0f60745e53927c4c876cfe5b5a58170f0646c":["3dffec77fb8f7d0e9ca4869dddd6af94528b4576"],"3dffec77fb8f7d0e9ca4869dddd6af94528b4576":[],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["37a0f60745e53927c4c876cfe5b5a58170f0646c","6e764e9a107f93be9fa3c922bc6a197b3eec387e"],"2d629ca62e3b8ab6e29a127aebe213163d490413":["fd44bec977a26a118d9e809e2de6f7edb5ca0f39"],"e332392bbbdd01cb69ad6a89051f483cda38e15e":["5eb2511ababf862ea11e10761c70ee560cd84510","6e1c1455e91339e72d6cdc7518defd3e05a43957"],"6e1c1455e91339e72d6cdc7518defd3e05a43957":["5eb2511ababf862ea11e10761c70ee560cd84510","85032ab568b3f50eabd577aaa994ba197db93758"],"fd44bec977a26a118d9e809e2de6f7edb5ca0f39":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"6e764e9a107f93be9fa3c922bc6a197b3eec387e":["e0571cb12a71d379cc6bd0d3b70fe1d8867a109d","37a0f60745e53927c4c876cfe5b5a58170f0646c"],"85032ab568b3f50eabd577aaa994ba197db93758":["2d629ca62e3b8ab6e29a127aebe213163d490413"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["5eb2511ababf862ea11e10761c70ee560cd84510","3dffec77fb8f7d0e9ca4869dddd6af94528b4576","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}