{"path":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","commits":[{"id":"893269407f5c988a4b2ee13c7ffc01ec43136c1d","date":1268598046,"type":0,"author":"Mark Robert Miller","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"/dev/null","sourceNew":"  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a89acb2b4321b599bbfa1e802c00c4dbbc8ee6b8","date":1268599006,"type":4,"author":"Mark Robert Miller","isMerge":false,"pathNew":"/dev/null","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":null,"sourceOld":"  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ad94625fb8d088209f46650c8097196fec67f00c","date":1453508319,"type":1,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","sourceOld":"  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"1da8d55113b689b06716246649de6f62430f15c0","date":1453508340,"type":0,"author":"Dawid Weiss","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"/dev/null","sourceNew":"  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"20065f48f840771dec27aa4ef3931a927025cbfb","date":1269013387,"type":3,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","sourceOld":"  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"98a8a68e6714cb8742c790308b9f5180d63417d4","date":1272554039,"type":3,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n    assertU(adoc(\"id\", \"42\", \"trait_s\", \"Tool\", \"trait_s\", \"Obnoxious\",\n                 \"name\", \"Zapp Brannigan\"));\n    assertU(adoc(\"id\", \"43\" ,\n                 \"title\", \"Democratic Order of Planets\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"44\", \"trait_s\", \"Tool\",\n                 \"name\", \"The Zapper\"));\n    assertU(adoc(\"id\", \"45\", \"trait_s\", \"Chauvinist\",\n                 \"title\", \"25 star General\"));\n    assertU(adoc(\"id\", \"46\", \"trait_s\", \"Obnoxious\",\n                 \"subject\", \"Defeated the pacifists of the Gandhi nebula\"));\n    assertU(commit());\n    assertU(adoc(\"id\", \"47\", \"trait_s\", \"Pig\",\n                 \"text\", \"line up and fly directly at the enemy death cannons, clogging them with wreckage!\"));\n    assertU(commit());\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ba1ed9f3f70e34de5dd5d526f0316ec3d3ce8bc1","date":1282858367,"type":3,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"b9115dee0e2516f31fa3653a4c69588d1bdf6731","date":1287171668,"type":3,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4ecea1664e8617d82eca3b8055a3c37cb4da8511","date":1287578668,"type":3,"author":"Simon Willnauer","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a","date":1292920096,"type":3,"author":"Michael Busch","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            );\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d51babee7caaf2812d53ab9c523438b2afaea1e3","date":1295546303,"type":3,"author":"Yonik Seeley","isMerge":false,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e79a6d080bdd5b2a8f56342cf571b5476de04180","date":1295638686,"type":3,"author":"Michael Busch","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"29ef99d61cda9641b6250bf9567329a6e65f901d","date":1297244127,"type":3,"author":"Simon Willnauer","isMerge":true,"pathNew":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"c903c3d15906a3da96b8c0c2fb704491005fdbdb","date":1453508227,"type":5,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"a258fbb26824fd104ed795e5d9033d2d040049ee","date":1453508252,"type":5,"author":"Dawid Weiss","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"c26f00b574427b55127e869b935845554afde1fa","date":1310252513,"type":5,"author":"Steven Rowe","isMerge":true,"pathNew":"solr/core/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","pathOld":"solr/src/test/org/apache/solr/request/SimpleFacetsTest#testSimpleFacetCounts().mjava","sourceNew":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","sourceOld":"  @Test\n  public void testSimpleFacetCounts() {\n \n    assertQ(\"standard request handler returns all matches\",\n            req(\"id:[42 TO 47]\"),\n            \"*[count(//doc)=6]\"\n            );\n \n    assertQ(\"filter results using fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=4]\"\n            );\n    \n    assertQ(\"don't filter results using blank fq\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \" \"),\n            \"*[count(//doc)=5]\"\n            );\n     \n    assertQ(\"filter results using multiple fq params\",\n            req(\"q\",\"id:[42 TO 46]\",\n                \"fq\", \"trait_s:Obnoxious\",\n                \"fq\", \"id:[43 TO 47]\"),\n            \"*[count(//doc)=1]\"\n            );\n \n    assertQ(\"check counts for facet queries\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"trait_s:Obnoxious\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=6]\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='5']\"\n \n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    assertQ(\"check multi-select facets with naming\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.query\", \"{!ex=1}trait_s:Obnoxious\"\n                ,\"facet.query\", \"{!ex=2 key=foo}id:[42 TO 45]\"    // tag=2 same as 1\n                ,\"facet.query\", \"{!ex=3,4 key=bar}id:[43 TO 47]\"  // tag=3,4 don't exist\n                ,\"facet.field\", \"{!ex=3,1}trait_s\"                // 3,1 same as 1\n                ,\"fq\", \"{!tag=1,2}id:47\"                          // tagged as 1 and 2\n                )\n            ,\"*[count(//doc)=1]\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='{!ex=1}trait_s:Obnoxious'][.='2']\"\n            ,\"//lst[@name='facet_queries']/int[@name='foo'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_fields']\"\n            ,\"//lst[@name='facet_fields']/lst[@name='trait_s']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='1']\"\n            );\n\n    // test excluding main query\n    assertQ(req(\"q\", \"{!tag=main}id:43\"\n                 ,\"facet\", \"true\"\n                 ,\"facet.query\", \"{!key=foo}id:42\"\n                 ,\"facet.query\", \"{!ex=main key=bar}id:42\"    // only matches when we exclude main query\n                 )\n             ,\"//lst[@name='facet_queries']/int[@name='foo'][.='0']\"\n             ,\"//lst[@name='facet_queries']/int[@name='bar'][.='1']\"\n             );\n\n    assertQ(\"check counts for applied facet queries using filtering (fq)\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.query\", \"id:[42 TO 45]\"\n                ,\"facet.query\", \"id:[43 TO 47]\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"//lst[@name='facet_counts']/lst[@name='facet_queries']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[42 TO 45]'][.='4']\"\n            ,\"//lst[@name='facet_queries']/int[@name='id:[43 TO 47]'][.='3']\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n \n    assertQ(\"check counts with facet.zero=false&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.zeros\", \"false\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=1&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"1\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"\n            );\n\n    assertQ(\"check counts with facet.mincount=2&facet.missing=true using fq\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.mincount\", \"2\"\n                ,\"f.trait_s.facet.missing\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                )\n            ,\"*[count(//doc)=4]\"\n            ,\"*[count(//lst[@name='trait_s']/int)=2]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[not(@name)][.='1']\"               \n            );\n\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"4\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=4]\"\n            ,\"//lst[@name='trait_s']/int[@name='Tool'][.='2']\"\n            ,\"//lst[@name='trait_s']/int[@name='Obnoxious'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Chauvinist'][.='1']\"\n            ,\"//lst[@name='trait_s']/int[@name='Pig'][.='0']\"\n            );\n\n    // check that the default sort is by count\n    assertQ(\"check sorted paging\",\n            req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n    //\n    // check that legacy facet.sort=true/false works\n    //\n    assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"0\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"true\"  // true means sort-by-count\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Tool'][.='2']\"\n            ,\"//int[2][@name='Chauvinist'][.='1']\"\n            ,\"//int[3][@name='Obnoxious'][.='1']\"\n            );\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"trait_s\"\n                ,\"facet.mincount\",\"1\"\n                ,\"facet.offset\",\"0\"\n                ,\"facet.limit\",\"3\"\n                ,\"facet.sort\",\"false\"  // false means sort by index order\n                )\n            ,\"*[count(//lst[@name='trait_s']/int)=3]\"\n            ,\"//int[1][@name='Chauvinist'][.='1']\"\n            ,\"//int[2][@name='Obnoxious'][.='1']\"\n            ,\"//int[3][@name='Tool'][.='2']\"\n            );\n\n\n     assertQ(req(\"q\", \"id:[42 TO 47]\"\n                ,\"facet\", \"true\"\n                ,\"facet.method\",\"fc\"\n                ,\"fq\", \"id:[42 TO 45]\"\n                ,\"facet.field\", \"zerolen_s\"\n                )\n            ,\"*[count(//lst[@name='zerolen_s']/int)=1]\"\n     );\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"20065f48f840771dec27aa4ef3931a927025cbfb":["1da8d55113b689b06716246649de6f62430f15c0"],"893269407f5c988a4b2ee13c7ffc01ec43136c1d":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a89acb2b4321b599bbfa1e802c00c4dbbc8ee6b8":["893269407f5c988a4b2ee13c7ffc01ec43136c1d"],"c26f00b574427b55127e869b935845554afde1fa":["d51babee7caaf2812d53ab9c523438b2afaea1e3","c903c3d15906a3da96b8c0c2fb704491005fdbdb"],"3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b":[],"d51babee7caaf2812d53ab9c523438b2afaea1e3":["b9115dee0e2516f31fa3653a4c69588d1bdf6731"],"7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a":["98a8a68e6714cb8742c790308b9f5180d63417d4","b9115dee0e2516f31fa3653a4c69588d1bdf6731"],"e79a6d080bdd5b2a8f56342cf571b5476de04180":["7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a","d51babee7caaf2812d53ab9c523438b2afaea1e3"],"1da8d55113b689b06716246649de6f62430f15c0":["a89acb2b4321b599bbfa1e802c00c4dbbc8ee6b8","ad94625fb8d088209f46650c8097196fec67f00c"],"c903c3d15906a3da96b8c0c2fb704491005fdbdb":["d51babee7caaf2812d53ab9c523438b2afaea1e3"],"29ef99d61cda9641b6250bf9567329a6e65f901d":["4ecea1664e8617d82eca3b8055a3c37cb4da8511","d51babee7caaf2812d53ab9c523438b2afaea1e3"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"98a8a68e6714cb8742c790308b9f5180d63417d4":["20065f48f840771dec27aa4ef3931a927025cbfb"],"a258fbb26824fd104ed795e5d9033d2d040049ee":["d51babee7caaf2812d53ab9c523438b2afaea1e3"],"ad94625fb8d088209f46650c8097196fec67f00c":["3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b"],"4ecea1664e8617d82eca3b8055a3c37cb4da8511":["ba1ed9f3f70e34de5dd5d526f0316ec3d3ce8bc1","b9115dee0e2516f31fa3653a4c69588d1bdf6731"],"b9115dee0e2516f31fa3653a4c69588d1bdf6731":["ba1ed9f3f70e34de5dd5d526f0316ec3d3ce8bc1"],"ba1ed9f3f70e34de5dd5d526f0316ec3d3ce8bc1":["98a8a68e6714cb8742c790308b9f5180d63417d4"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["c26f00b574427b55127e869b935845554afde1fa"]},"commit2Childs":{"20065f48f840771dec27aa4ef3931a927025cbfb":["98a8a68e6714cb8742c790308b9f5180d63417d4"],"893269407f5c988a4b2ee13c7ffc01ec43136c1d":["a89acb2b4321b599bbfa1e802c00c4dbbc8ee6b8"],"a89acb2b4321b599bbfa1e802c00c4dbbc8ee6b8":["1da8d55113b689b06716246649de6f62430f15c0"],"c26f00b574427b55127e869b935845554afde1fa":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b":["ad94625fb8d088209f46650c8097196fec67f00c"],"d51babee7caaf2812d53ab9c523438b2afaea1e3":["c26f00b574427b55127e869b935845554afde1fa","e79a6d080bdd5b2a8f56342cf571b5476de04180","c903c3d15906a3da96b8c0c2fb704491005fdbdb","29ef99d61cda9641b6250bf9567329a6e65f901d","a258fbb26824fd104ed795e5d9033d2d040049ee"],"7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a":["e79a6d080bdd5b2a8f56342cf571b5476de04180"],"e79a6d080bdd5b2a8f56342cf571b5476de04180":[],"1da8d55113b689b06716246649de6f62430f15c0":["20065f48f840771dec27aa4ef3931a927025cbfb"],"c903c3d15906a3da96b8c0c2fb704491005fdbdb":["c26f00b574427b55127e869b935845554afde1fa"],"29ef99d61cda9641b6250bf9567329a6e65f901d":[],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["893269407f5c988a4b2ee13c7ffc01ec43136c1d"],"98a8a68e6714cb8742c790308b9f5180d63417d4":["7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a","ba1ed9f3f70e34de5dd5d526f0316ec3d3ce8bc1"],"a258fbb26824fd104ed795e5d9033d2d040049ee":[],"ad94625fb8d088209f46650c8097196fec67f00c":["1da8d55113b689b06716246649de6f62430f15c0"],"4ecea1664e8617d82eca3b8055a3c37cb4da8511":["29ef99d61cda9641b6250bf9567329a6e65f901d"],"b9115dee0e2516f31fa3653a4c69588d1bdf6731":["d51babee7caaf2812d53ab9c523438b2afaea1e3","7c65bc241a96282ca59ae736b4ffb5b7e5eeb23a","4ecea1664e8617d82eca3b8055a3c37cb4da8511"],"ba1ed9f3f70e34de5dd5d526f0316ec3d3ce8bc1":["4ecea1664e8617d82eca3b8055a3c37cb4da8511","b9115dee0e2516f31fa3653a4c69588d1bdf6731"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["e79a6d080bdd5b2a8f56342cf571b5476de04180","29ef99d61cda9641b6250bf9567329a6e65f901d","a258fbb26824fd104ed795e5d9033d2d040049ee","cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["3cdb369a6112bacd5f5fc1d4e022bed2f8bffb9b","a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}