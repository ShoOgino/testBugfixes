{"path":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","commits":[{"id":"6146c07c0dee1ae1e42926167acd127fed5ef59d","date":1516129420,"type":1,"author":"Varun Thacker","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","sourceNew":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          // TODO: if collection.configName isn't set, and there isn't already a conf in zk, just use that?\n          String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","sourceOld":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          // TODO: if collection.configName isn't set, and there isn't already a conf in zk, just use that?\n          String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"b94236357aaa22b76c10629851fe4e376e0cea82","date":1516710914,"type":1,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","sourceNew":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          // TODO: if collection.configName isn't set, and there isn't already a conf in zk, just use that?\n          String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","sourceOld":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          // TODO: if collection.configName isn't set, and there isn't already a conf in zk, just use that?\n          String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6857f8205f8c5b4ff39a54d8aebb4fdfb7cfb691","date":1516909549,"type":3,"author":"David Smiley","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","sourceNew":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          //TODO shouldn't the stateManager ensure this does not happen; should throw AlreadyExistsException\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","sourceOld":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          // TODO: if collection.configName isn't set, and there isn't already a conf in zk, just use that?\n          String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"84f20f331d8001864545c7021812d8c6509c7593","date":1517216128,"type":3,"author":"Cao Manh Dat","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","sourceNew":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n    // clean up old terms node\n    String termsPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection + \"/terms\";\n    try {\n      if (stateManager.hasData(termsPath)) {\n        List<String> paths = stateManager.listData(termsPath);\n        for (String path : paths) {\n          stateManager.removeData(termsPath + \"/\" + path, -1);\n        }\n        stateManager.removeData(termsPath, -1);\n      }\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    } catch (KeeperException | IOException | BadVersionException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    }\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          //TODO shouldn't the stateManager ensure this does not happen; should throw AlreadyExistsException\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","sourceOld":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          //TODO shouldn't the stateManager ensure this does not happen; should throw AlreadyExistsException\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"01e3e55745c6667006f67aaa604466b9974425f4","date":1518776937,"type":3,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","sourceNew":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n    // clean up old terms node\n    String termsPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection + \"/terms\";\n    try {\n      stateManager.removeRecursively(termsPath, true, true);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    } catch (KeeperException | IOException | NotEmptyException | BadVersionException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    }\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          //TODO shouldn't the stateManager ensure this does not happen; should throw AlreadyExistsException\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","sourceOld":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n    // clean up old terms node\n    String termsPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection + \"/terms\";\n    try {\n      if (stateManager.hasData(termsPath)) {\n        List<String> paths = stateManager.listData(termsPath);\n        for (String path : paths) {\n          stateManager.removeData(termsPath + \"/\" + path, -1);\n        }\n        stateManager.removeData(termsPath, -1);\n      }\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    } catch (KeeperException | IOException | BadVersionException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    }\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          //TODO shouldn't the stateManager ensure this does not happen; should throw AlreadyExistsException\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"4abf821a41a2fdca2a1dea148999931d22e20529","date":1587749643,"type":3,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#createCollectionZkNode(DistribStateManager,String,Map[String,String]).mjava","sourceNew":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode: {}\", collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n    // clean up old terms node\n    String termsPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection + \"/terms\";\n    try {\n      stateManager.removeRecursively(termsPath, true, true);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    } catch (KeeperException | IOException | NotEmptyException | BadVersionException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    }\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper: {}\", collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection: {} to {}\", collection, defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          //TODO shouldn't the stateManager ensure this does not happen; should throw AlreadyExistsException\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","sourceOld":"  public static void createCollectionZkNode(DistribStateManager stateManager, String collection, Map<String,String> params) {\n    log.debug(\"Check for collection zkNode:\" + collection);\n    String collectionPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection;\n    // clean up old terms node\n    String termsPath = ZkStateReader.COLLECTIONS_ZKNODE + \"/\" + collection + \"/terms\";\n    try {\n      stateManager.removeRecursively(termsPath, true, true);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    } catch (KeeperException | IOException | NotEmptyException | BadVersionException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error deleting old term nodes for collection from Zookeeper\", e);\n    }\n    try {\n      if (!stateManager.hasData(collectionPath)) {\n        log.debug(\"Creating collection in ZooKeeper:\" + collection);\n\n        try {\n          Map<String,Object> collectionProps = new HashMap<>();\n\n          if (params.size() > 0) {\n            collectionProps.putAll(params);\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n              // users can create the collection node and conf link ahead of time, or this may return another option\n              getConfName(stateManager, collection, collectionPath, collectionProps);\n            }\n\n          } else if (System.getProperty(\"bootstrap_confdir\") != null) {\n            String defaultConfigName = System.getProperty(ZkController.COLLECTION_PARAM_PREFIX + ZkController.CONFIGNAME_PROP, collection);\n\n            // if we are bootstrapping a collection, default the config for\n            // a new collection to the collection we are bootstrapping\n            log.info(\"Setting config for collection:\" + collection + \" to \" + defaultConfigName);\n\n            Properties sysProps = System.getProperties();\n            for (String sprop : System.getProperties().stringPropertyNames()) {\n              if (sprop.startsWith(ZkController.COLLECTION_PARAM_PREFIX)) {\n                collectionProps.put(sprop.substring(ZkController.COLLECTION_PARAM_PREFIX.length()), sysProps.getProperty(sprop));\n              }\n            }\n\n            // if the config name wasn't passed in, use the default\n            if (!collectionProps.containsKey(ZkController.CONFIGNAME_PROP))\n              collectionProps.put(ZkController.CONFIGNAME_PROP, defaultConfigName);\n\n          } else if (Boolean.getBoolean(\"bootstrap_conf\")) {\n            // the conf name should should be the collection name of this core\n            collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n          } else {\n            getConfName(stateManager, collection, collectionPath, collectionProps);\n          }\n\n          collectionProps.remove(ZkStateReader.NUM_SHARDS_PROP);  // we don't put numShards in the collections properties\n\n          ZkNodeProps zkProps = new ZkNodeProps(collectionProps);\n          stateManager.makePath(collectionPath, Utils.toJSON(zkProps), CreateMode.PERSISTENT, false);\n\n        } catch (KeeperException e) {\n          //TODO shouldn't the stateManager ensure this does not happen; should throw AlreadyExistsException\n          // it's okay if the node already exists\n          if (e.code() != KeeperException.Code.NODEEXISTS) {\n            throw e;\n          }\n        } catch (AlreadyExistsException e) {\n          // it's okay if the node already exists\n        }\n      } else {\n        log.debug(\"Collection zkNode exists\");\n      }\n\n    } catch (KeeperException e) {\n      // it's okay if another beats us creating the node\n      if (e.code() == KeeperException.Code.NODEEXISTS) {\n        return;\n      }\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (IOException e) {\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    } catch (InterruptedException e) {\n      Thread.interrupted();\n      throw new SolrException(ErrorCode.SERVER_ERROR, \"Error creating collection node in Zookeeper\", e);\n    }\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"b94236357aaa22b76c10629851fe4e376e0cea82":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85","6146c07c0dee1ae1e42926167acd127fed5ef59d"],"4abf821a41a2fdca2a1dea148999931d22e20529":["01e3e55745c6667006f67aaa604466b9974425f4"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"6146c07c0dee1ae1e42926167acd127fed5ef59d":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"84f20f331d8001864545c7021812d8c6509c7593":["6857f8205f8c5b4ff39a54d8aebb4fdfb7cfb691"],"01e3e55745c6667006f67aaa604466b9974425f4":["84f20f331d8001864545c7021812d8c6509c7593"],"6857f8205f8c5b4ff39a54d8aebb4fdfb7cfb691":["b94236357aaa22b76c10629851fe4e376e0cea82"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["4abf821a41a2fdca2a1dea148999931d22e20529"]},"commit2Childs":{"b94236357aaa22b76c10629851fe4e376e0cea82":["6857f8205f8c5b4ff39a54d8aebb4fdfb7cfb691"],"4abf821a41a2fdca2a1dea148999931d22e20529":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["b94236357aaa22b76c10629851fe4e376e0cea82","6146c07c0dee1ae1e42926167acd127fed5ef59d"],"6146c07c0dee1ae1e42926167acd127fed5ef59d":["b94236357aaa22b76c10629851fe4e376e0cea82"],"84f20f331d8001864545c7021812d8c6509c7593":["01e3e55745c6667006f67aaa604466b9974425f4"],"01e3e55745c6667006f67aaa604466b9974425f4":["4abf821a41a2fdca2a1dea148999931d22e20529"],"6857f8205f8c5b4ff39a54d8aebb4fdfb7cfb691":["84f20f331d8001864545c7021812d8c6509c7593"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}