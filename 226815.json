{"path":"solr/core/src/java/org/apache/solr/store/blockcache/Metrics#initializeMetrics(SolrMetricsContext,String).mjava","commits":[{"id":"c959a64c5b52cc12eb8daa17f4f0ed9cf2dfcaaa","date":1571411704,"type":1,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/store/blockcache/Metrics#initializeMetrics(SolrMetricsContext,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/store/blockcache/Metrics#initializeMetrics(SolrMetricManager,String,String,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricsContext parentContext, String scope) {\n    solrMetricsContext = parentContext.getChildContext(this);\n    metricsMap = new MetricsMap((detailed, map) -> {\n      long now = System.nanoTime();\n      long delta = Math.max(now - previous, 1);\n      double seconds = delta / 1000000000.0;\n\n      long hits_total = blockCacheHit.get();\n      long hits_delta = hits_total - blockCacheHit_last.get();\n      blockCacheHit_last.set(hits_total);\n\n      long miss_total = blockCacheMiss.get();\n      long miss_delta = miss_total - blockCacheMiss_last.get();\n      blockCacheMiss_last.set(miss_total);\n\n      long evict_total = blockCacheEviction.get();\n      long evict_delta = evict_total - blockCacheEviction_last.get();\n      blockCacheEviction_last.set(evict_total);\n\n      long storeFail_total = blockCacheStoreFail.get();\n      long storeFail_delta = storeFail_total - blockCacheStoreFail_last.get();\n      blockCacheStoreFail_last.set(storeFail_total);\n\n      long lookups_delta = hits_delta + miss_delta;\n      long lookups_total = hits_total + miss_total;\n\n      map.put(\"size\", blockCacheSize.get());\n      map.put(\"lookups\", lookups_total);\n      map.put(\"hits\", hits_total);\n      map.put(\"evictions\", evict_total);\n      map.put(\"storeFails\", storeFail_total);\n      map.put(\"hitratio_current\", calcHitRatio(lookups_delta, hits_delta));  // hit ratio since the last call\n      map.put(\"lookups_persec\", getPerSecond(lookups_delta, seconds)); // lookups per second since the last call\n      map.put(\"hits_persec\", getPerSecond(hits_delta, seconds));       // hits per second since the last call\n      map.put(\"evictions_persec\", getPerSecond(evict_delta, seconds));  // evictions per second since the last call\n      map.put(\"storeFails_persec\", getPerSecond(storeFail_delta, seconds));  // evictions per second since the last call\n      map.put(\"time_delta\", seconds);  // seconds since last call\n\n      // TODO: these aren't really related to the BlockCache\n      map.put(\"buffercache.allocations\", getPerSecond(shardBuffercacheAllocate.getAndSet(0), seconds));\n      map.put(\"buffercache.lost\", getPerSecond(shardBuffercacheLost.getAndSet(0), seconds));\n\n      previous = now;\n\n    });\n    solrMetricsContext.gauge(this, metricsMap, true, getName(), getCategory().toString(), scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricManager manager, String registryName, String tag, String scope) {\n    this.metricManager = manager;\n    this.registryName = registryName;\n    registry = manager.registry(registryName);\n    metricsMap = new MetricsMap((detailed, map) -> {\n      long now = System.nanoTime();\n      long delta = Math.max(now - previous, 1);\n      double seconds = delta / 1000000000.0;\n\n      long hits_total = blockCacheHit.get();\n      long hits_delta = hits_total - blockCacheHit_last.get();\n      blockCacheHit_last.set(hits_total);\n\n      long miss_total = blockCacheMiss.get();\n      long miss_delta = miss_total - blockCacheMiss_last.get();\n      blockCacheMiss_last.set(miss_total);\n\n      long evict_total = blockCacheEviction.get();\n      long evict_delta = evict_total - blockCacheEviction_last.get();\n      blockCacheEviction_last.set(evict_total);\n\n      long storeFail_total = blockCacheStoreFail.get();\n      long storeFail_delta = storeFail_total - blockCacheStoreFail_last.get();\n      blockCacheStoreFail_last.set(storeFail_total);\n\n      long lookups_delta = hits_delta + miss_delta;\n      long lookups_total = hits_total + miss_total;\n\n      map.put(\"size\", blockCacheSize.get());\n      map.put(\"lookups\", lookups_total);\n      map.put(\"hits\", hits_total);\n      map.put(\"evictions\", evict_total);\n      map.put(\"storeFails\", storeFail_total);\n      map.put(\"hitratio_current\", calcHitRatio(lookups_delta, hits_delta));  // hit ratio since the last call\n      map.put(\"lookups_persec\", getPerSecond(lookups_delta, seconds)); // lookups per second since the last call\n      map.put(\"hits_persec\", getPerSecond(hits_delta, seconds));       // hits per second since the last call\n      map.put(\"evictions_persec\", getPerSecond(evict_delta, seconds));  // evictions per second since the last call\n      map.put(\"storeFails_persec\", getPerSecond(storeFail_delta, seconds));  // evictions per second since the last call\n      map.put(\"time_delta\", seconds);  // seconds since last call\n\n      // TODO: these aren't really related to the BlockCache\n      map.put(\"buffercache.allocations\", getPerSecond(shardBuffercacheAllocate.getAndSet(0), seconds));\n      map.put(\"buffercache.lost\", getPerSecond(shardBuffercacheLost.getAndSet(0), seconds));\n\n      previous = now;\n\n    });\n    manager.registerGauge(this, registryName, metricsMap, tag, true, getName(), getCategory().toString(), scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"7c2af5a711bd6e2d33e0221ced0f47ac596ed275","date":1572877903,"type":3,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/store/blockcache/Metrics#initializeMetrics(SolrMetricsContext,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/store/blockcache/Metrics#initializeMetrics(SolrMetricsContext,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricsContext parentContext, String scope) {\n    solrMetricsContext = parentContext.getChildContext(this);\n    metricsMap = new MetricsMap((detailed, map) -> {\n      long now = System.nanoTime();\n      long delta = Math.max(now - previous, 1);\n      double seconds = delta / 1000000000.0;\n\n      long hits_total = blockCacheHit.get();\n      long hits_delta = hits_total - blockCacheHit_last.get();\n      blockCacheHit_last.set(hits_total);\n\n      long miss_total = blockCacheMiss.get();\n      long miss_delta = miss_total - blockCacheMiss_last.get();\n      blockCacheMiss_last.set(miss_total);\n\n      long evict_total = blockCacheEviction.get();\n      long evict_delta = evict_total - blockCacheEviction_last.get();\n      blockCacheEviction_last.set(evict_total);\n\n      long storeFail_total = blockCacheStoreFail.get();\n      long storeFail_delta = storeFail_total - blockCacheStoreFail_last.get();\n      blockCacheStoreFail_last.set(storeFail_total);\n\n      long lookups_delta = hits_delta + miss_delta;\n      long lookups_total = hits_total + miss_total;\n\n      map.put(\"size\", blockCacheSize.get());\n      map.put(\"lookups\", lookups_total);\n      map.put(\"hits\", hits_total);\n      map.put(\"evictions\", evict_total);\n      map.put(\"storeFails\", storeFail_total);\n      map.put(\"hitratio_current\", calcHitRatio(lookups_delta, hits_delta));  // hit ratio since the last call\n      map.put(\"lookups_persec\", getPerSecond(lookups_delta, seconds)); // lookups per second since the last call\n      map.put(\"hits_persec\", getPerSecond(hits_delta, seconds));       // hits per second since the last call\n      map.put(\"evictions_persec\", getPerSecond(evict_delta, seconds));  // evictions per second since the last call\n      map.put(\"storeFails_persec\", getPerSecond(storeFail_delta, seconds));  // evictions per second since the last call\n      map.put(\"time_delta\", seconds);  // seconds since last call\n\n      // TODO: these aren't really related to the BlockCache\n      map.put(\"buffercache.allocations\", getPerSecond(shardBuffercacheAllocate.getAndSet(0), seconds));\n      map.put(\"buffercache.lost\", getPerSecond(shardBuffercacheLost.getAndSet(0), seconds));\n\n      previous = now;\n\n    });\n    solrMetricsContext.gauge(metricsMap, true, getName(), getCategory().toString(), scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricsContext parentContext, String scope) {\n    solrMetricsContext = parentContext.getChildContext(this);\n    metricsMap = new MetricsMap((detailed, map) -> {\n      long now = System.nanoTime();\n      long delta = Math.max(now - previous, 1);\n      double seconds = delta / 1000000000.0;\n\n      long hits_total = blockCacheHit.get();\n      long hits_delta = hits_total - blockCacheHit_last.get();\n      blockCacheHit_last.set(hits_total);\n\n      long miss_total = blockCacheMiss.get();\n      long miss_delta = miss_total - blockCacheMiss_last.get();\n      blockCacheMiss_last.set(miss_total);\n\n      long evict_total = blockCacheEviction.get();\n      long evict_delta = evict_total - blockCacheEviction_last.get();\n      blockCacheEviction_last.set(evict_total);\n\n      long storeFail_total = blockCacheStoreFail.get();\n      long storeFail_delta = storeFail_total - blockCacheStoreFail_last.get();\n      blockCacheStoreFail_last.set(storeFail_total);\n\n      long lookups_delta = hits_delta + miss_delta;\n      long lookups_total = hits_total + miss_total;\n\n      map.put(\"size\", blockCacheSize.get());\n      map.put(\"lookups\", lookups_total);\n      map.put(\"hits\", hits_total);\n      map.put(\"evictions\", evict_total);\n      map.put(\"storeFails\", storeFail_total);\n      map.put(\"hitratio_current\", calcHitRatio(lookups_delta, hits_delta));  // hit ratio since the last call\n      map.put(\"lookups_persec\", getPerSecond(lookups_delta, seconds)); // lookups per second since the last call\n      map.put(\"hits_persec\", getPerSecond(hits_delta, seconds));       // hits per second since the last call\n      map.put(\"evictions_persec\", getPerSecond(evict_delta, seconds));  // evictions per second since the last call\n      map.put(\"storeFails_persec\", getPerSecond(storeFail_delta, seconds));  // evictions per second since the last call\n      map.put(\"time_delta\", seconds);  // seconds since last call\n\n      // TODO: these aren't really related to the BlockCache\n      map.put(\"buffercache.allocations\", getPerSecond(shardBuffercacheAllocate.getAndSet(0), seconds));\n      map.put(\"buffercache.lost\", getPerSecond(shardBuffercacheLost.getAndSet(0), seconds));\n\n      previous = now;\n\n    });\n    solrMetricsContext.gauge(this, metricsMap, true, getName(), getCategory().toString(), scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"233211c3dbff6f367588be5bbb4ac77f72eae193","date":1602085975,"type":3,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/store/blockcache/Metrics#initializeMetrics(SolrMetricsContext,String).mjava","pathOld":"solr/core/src/java/org/apache/solr/store/blockcache/Metrics#initializeMetrics(SolrMetricsContext,String).mjava","sourceNew":"  @Override\n  public void initializeMetrics(SolrMetricsContext parentContext, String scope) {\n    solrMetricsContext = parentContext.getChildContext(this);\n    metricsMap = new MetricsMap(map -> {\n      long now = System.nanoTime();\n      long delta = Math.max(now - previous, 1);\n      double seconds = delta / 1000000000.0;\n\n      long hits_total = blockCacheHit.get();\n      long hits_delta = hits_total - blockCacheHit_last.get();\n      blockCacheHit_last.set(hits_total);\n\n      long miss_total = blockCacheMiss.get();\n      long miss_delta = miss_total - blockCacheMiss_last.get();\n      blockCacheMiss_last.set(miss_total);\n\n      long evict_total = blockCacheEviction.get();\n      long evict_delta = evict_total - blockCacheEviction_last.get();\n      blockCacheEviction_last.set(evict_total);\n\n      long storeFail_total = blockCacheStoreFail.get();\n      long storeFail_delta = storeFail_total - blockCacheStoreFail_last.get();\n      blockCacheStoreFail_last.set(storeFail_total);\n\n      long lookups_delta = hits_delta + miss_delta;\n      long lookups_total = hits_total + miss_total;\n\n      map.put(\"size\", blockCacheSize.get());\n      map.put(\"lookups\", lookups_total);\n      map.put(\"hits\", hits_total);\n      map.put(\"evictions\", evict_total);\n      map.put(\"storeFails\", storeFail_total);\n      map.put(\"hitratio_current\", calcHitRatio(lookups_delta, hits_delta));  // hit ratio since the last call\n      map.put(\"lookups_persec\", getPerSecond(lookups_delta, seconds)); // lookups per second since the last call\n      map.put(\"hits_persec\", getPerSecond(hits_delta, seconds));       // hits per second since the last call\n      map.put(\"evictions_persec\", getPerSecond(evict_delta, seconds));  // evictions per second since the last call\n      map.put(\"storeFails_persec\", getPerSecond(storeFail_delta, seconds));  // evictions per second since the last call\n      map.put(\"time_delta\", seconds);  // seconds since last call\n\n      // TODO: these aren't really related to the BlockCache\n      map.put(\"buffercache.allocations\", getPerSecond(shardBuffercacheAllocate.getAndSet(0), seconds));\n      map.put(\"buffercache.lost\", getPerSecond(shardBuffercacheLost.getAndSet(0), seconds));\n\n      previous = now;\n\n    });\n    solrMetricsContext.gauge(metricsMap, true, getName(), getCategory().toString(), scope);\n  }\n\n","sourceOld":"  @Override\n  public void initializeMetrics(SolrMetricsContext parentContext, String scope) {\n    solrMetricsContext = parentContext.getChildContext(this);\n    metricsMap = new MetricsMap((detailed, map) -> {\n      long now = System.nanoTime();\n      long delta = Math.max(now - previous, 1);\n      double seconds = delta / 1000000000.0;\n\n      long hits_total = blockCacheHit.get();\n      long hits_delta = hits_total - blockCacheHit_last.get();\n      blockCacheHit_last.set(hits_total);\n\n      long miss_total = blockCacheMiss.get();\n      long miss_delta = miss_total - blockCacheMiss_last.get();\n      blockCacheMiss_last.set(miss_total);\n\n      long evict_total = blockCacheEviction.get();\n      long evict_delta = evict_total - blockCacheEviction_last.get();\n      blockCacheEviction_last.set(evict_total);\n\n      long storeFail_total = blockCacheStoreFail.get();\n      long storeFail_delta = storeFail_total - blockCacheStoreFail_last.get();\n      blockCacheStoreFail_last.set(storeFail_total);\n\n      long lookups_delta = hits_delta + miss_delta;\n      long lookups_total = hits_total + miss_total;\n\n      map.put(\"size\", blockCacheSize.get());\n      map.put(\"lookups\", lookups_total);\n      map.put(\"hits\", hits_total);\n      map.put(\"evictions\", evict_total);\n      map.put(\"storeFails\", storeFail_total);\n      map.put(\"hitratio_current\", calcHitRatio(lookups_delta, hits_delta));  // hit ratio since the last call\n      map.put(\"lookups_persec\", getPerSecond(lookups_delta, seconds)); // lookups per second since the last call\n      map.put(\"hits_persec\", getPerSecond(hits_delta, seconds));       // hits per second since the last call\n      map.put(\"evictions_persec\", getPerSecond(evict_delta, seconds));  // evictions per second since the last call\n      map.put(\"storeFails_persec\", getPerSecond(storeFail_delta, seconds));  // evictions per second since the last call\n      map.put(\"time_delta\", seconds);  // seconds since last call\n\n      // TODO: these aren't really related to the BlockCache\n      map.put(\"buffercache.allocations\", getPerSecond(shardBuffercacheAllocate.getAndSet(0), seconds));\n      map.put(\"buffercache.lost\", getPerSecond(shardBuffercacheLost.getAndSet(0), seconds));\n\n      previous = now;\n\n    });\n    solrMetricsContext.gauge(metricsMap, true, getName(), getCategory().toString(), scope);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"7c2af5a711bd6e2d33e0221ced0f47ac596ed275":["c959a64c5b52cc12eb8daa17f4f0ed9cf2dfcaaa"],"c959a64c5b52cc12eb8daa17f4f0ed9cf2dfcaaa":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"233211c3dbff6f367588be5bbb4ac77f72eae193":["7c2af5a711bd6e2d33e0221ced0f47ac596ed275"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["233211c3dbff6f367588be5bbb4ac77f72eae193"]},"commit2Childs":{"7c2af5a711bd6e2d33e0221ced0f47ac596ed275":["233211c3dbff6f367588be5bbb4ac77f72eae193"],"c959a64c5b52cc12eb8daa17f4f0ed9cf2dfcaaa":["7c2af5a711bd6e2d33e0221ced0f47ac596ed275"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["c959a64c5b52cc12eb8daa17f4f0ed9cf2dfcaaa"],"233211c3dbff6f367588be5bbb4ac77f72eae193":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}