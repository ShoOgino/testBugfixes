{"path":"lucene/core/src/java/org/apache/lucene/index/IndexWriter#closeSegmentStates(BufferedUpdatesStream.SegmentState[],boolean).mjava","commits":[{"id":"9f21f1920c232db2352489eed260fe5c1f39e5a0","date":1587748041,"type":1,"author":"Simon Willnauer","isMerge":false,"pathNew":"lucene/core/src/java/org/apache/lucene/index/IndexWriter#closeSegmentStates(BufferedUpdatesStream.SegmentState[],boolean).mjava","pathOld":"lucene/core/src/java/org/apache/lucene/index/FrozenBufferedUpdates#closeSegmentStates(IndexWriter,BufferedUpdatesStream.SegmentState[],boolean).mjava","sourceNew":"  /** Close segment states previously opened with openSegmentStates. */\n  private BufferedUpdatesStream.ApplyDeletesResult closeSegmentStates(BufferedUpdatesStream.SegmentState[] segStates, boolean success) throws IOException {\n    List<SegmentCommitInfo> allDeleted = null;\n    long totDelCount = 0;\n    try {\n      for (BufferedUpdatesStream.SegmentState segState : segStates) {\n        if (success) {\n          totDelCount += segState.rld.getDelCount() - segState.startDelCount;\n          int fullDelCount = segState.rld.getDelCount();\n          assert fullDelCount <= segState.rld.info.info.maxDoc() : fullDelCount + \" > \" + segState.rld.info.info.maxDoc();\n          if (segState.rld.isFullyDeleted() && getConfig().getMergePolicy().keepFullyDeletedSegment(() -> segState.reader) == false) {\n            if (allDeleted == null) {\n              allDeleted = new ArrayList<>();\n            }\n            allDeleted.add(segState.reader.getOriginalSegmentInfo());\n          }\n        }\n      }\n    } finally {\n      IOUtils.close(segStates);\n    }\n    if (infoStream.isEnabled(\"BD\")) {\n      infoStream.message(\"BD\", \"closeSegmentStates: \" + totDelCount + \" new deleted documents; pool \" + bufferedUpdatesStream.getPendingUpdatesCount() +  \" packets; bytesUsed=\" + readerPool.ramBytesUsed());\n    }\n\n    return new BufferedUpdatesStream.ApplyDeletesResult(totDelCount > 0, allDeleted);\n  }\n\n","sourceOld":"  /** Close segment states previously opened with openSegmentStates. */\n  public static BufferedUpdatesStream.ApplyDeletesResult closeSegmentStates(IndexWriter writer, BufferedUpdatesStream.SegmentState[] segStates, boolean success) throws IOException {\n    List<SegmentCommitInfo> allDeleted = null;\n    long totDelCount = 0;\n    try {\n      for (BufferedUpdatesStream.SegmentState segState : segStates) {\n        if (success) {\n          totDelCount += segState.rld.getDelCount() - segState.startDelCount;\n          int fullDelCount = segState.rld.getDelCount();\n          assert fullDelCount <= segState.rld.info.info.maxDoc() : fullDelCount + \" > \" + segState.rld.info.info.maxDoc();\n          if (segState.rld.isFullyDeleted() && writer.getConfig().getMergePolicy().keepFullyDeletedSegment(() -> segState.reader) == false) {\n            if (allDeleted == null) {\n              allDeleted = new ArrayList<>();\n            }\n            allDeleted.add(segState.reader.getOriginalSegmentInfo());\n          }\n        }\n      }\n    } finally {\n      IOUtils.close(segStates);\n    }\n    if (writer.infoStream.isEnabled(\"BD\")) {\n      writer.infoStream.message(\"BD\", \"closeSegmentStates: \" + totDelCount + \" new deleted documents; pool \" + writer.getPendingUpdatesCount()+ \" packets; bytesUsed=\" + writer.getReaderPoolRamBytesUsed());\n    }\n\n    return new BufferedUpdatesStream.ApplyDeletesResult(totDelCount > 0, allDeleted);\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"9f21f1920c232db2352489eed260fe5c1f39e5a0":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["9f21f1920c232db2352489eed260fe5c1f39e5a0"]},"commit2Childs":{"9f21f1920c232db2352489eed260fe5c1f39e5a0":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["9f21f1920c232db2352489eed260fe5c1f39e5a0"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}