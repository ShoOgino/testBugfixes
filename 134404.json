{"path":"solr/solrj/src/java/org/apache/solr/client/solrj/io/stream/expr/InjectionDefense#buildExpression().mjava","commits":[{"id":"a0370d6fb5289875090a50a9d0887ee584fed440","date":1552401990,"type":0,"author":"Gus Heck","isMerge":false,"pathNew":"solr/solrj/src/java/org/apache/solr/client/solrj/io/stream/expr/InjectionDefense#buildExpression().mjava","pathOld":"/dev/null","sourceNew":"  String buildExpression() {\n    Matcher anyParam = ANY_PARAM.matcher(exprString);\n    StringBuffer buff = new StringBuffer();\n    int pIdx = 0;\n    while (anyParam.find()) {\n      String found = anyParam.group();\n      String p = params.get(pIdx++);\n      if (found.contains(\"#\")) {\n        if (!INT_OR_FLOAT.matcher(p).matches()) {\n          throw new NumberFormatException(\"Argument \" + pIdx + \" (\" + p + \") is not numeric!\");\n        }\n      }\n      anyParam.appendReplacement(buff, p);\n    }\n    anyParam.appendTail(buff);\n\n    // strip comments may add '\\n' at the end so trim()\n    String result = buff.toString().trim();\n    String noComments = stripComments(result).trim();\n    if (!result.equals(noComments)) {\n      throw new IllegalStateException(\"Comments are not allowed in prepared expressions for security reasons \" +\n          \"please pre-process stripComments() first. If there were no comments, then they have been injected by \" +\n          \"a parameter value.\");\n    }\n    return buff.toString().trim();\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0370d6fb5289875090a50a9d0887ee584fed440":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["a0370d6fb5289875090a50a9d0887ee584fed440"]},"commit2Childs":{"a0370d6fb5289875090a50a9d0887ee584fed440":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["a0370d6fb5289875090a50a9d0887ee584fed440"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}