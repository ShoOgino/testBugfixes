{"path":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","commits":[{"id":"34dd1818ff2313f17cf59834695ab7ee0c7853d7","date":1527089210,"type":0,"author":"Noble Paul","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"/dev/null","sourceNew":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n    String rowsData = \"{'sortedNodes':[\" +\n        \"    {\" +\n        \"      'node':'solr-01:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1734.5261459350586},\" +\n        \"        {'sysLoadAvg':35.0},\" +\n        \"        {'node':'solr-01:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-07:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1721.5669250488281},\" +\n        \"        {'sysLoadAvg':10.0},\" +\n        \"        {'node':'solr-07:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-08:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.9518203735352},\" +\n        \"        {'sysLoadAvg':330.0},\" +\n        \"        {'node':'solr-08:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-25:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1779.7792778015137},\" +\n        \"        {'sysLoadAvg':304.0},\" +\n        \"        {'node':'solr-25:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-15:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1697.5930519104004},\" +\n        \"        {'sysLoadAvg':277.0},\" +\n        \"        {'node':'solr-15:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-13:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1755.1909484863281},\" +\n        \"        {'sysLoadAvg':265.0},\" +\n        \"        {'node':'solr-13:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-14:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1757.6035423278809},\" +\n        \"        {'sysLoadAvg':61.0},\" +\n        \"        {'node':'solr-14:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-16:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.081386566162},\" +\n        \"        {'sysLoadAvg':260.0},\" +\n        \"        {'node':'solr-16:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-04:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1708.7230529785156},\" +\n        \"        {'sysLoadAvg':216.0},\" +\n        \"        {'node':'solr-04:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-06:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1688.3182678222656},\" +\n        \"        {'sysLoadAvg':385.0},\" +\n        \"        {'node':'solr-06:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-02:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':6},\" +\n        \"        {'freedisk':1778.226963043213},\" +\n        \"        {'sysLoadAvg':369.0},\" +\n        \"        {'node':'solr-02:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-05:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1741.9401931762695},\" +\n        \"        {'sysLoadAvg':354.0},\" +\n        \"        {'node':'solr-05:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-23:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1718.854579925537},\" +\n        \"        {'sysLoadAvg':329.0},\" +\n        \"        {'node':'solr-23:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-24:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1733.6669311523438},\" +\n        \"        {'sysLoadAvg':327.0},\" +\n        \"        {'node':'solr-24:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-09:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1714.6191711425781},\" +\n        \"        {'sysLoadAvg':278.0},\" +\n        \"        {'node':'solr-09:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-10:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1755.3038482666016},\" +\n        \"        {'sysLoadAvg':266.0},\" +\n        \"        {'node':'solr-10:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-28:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1691.3830909729004},\" +\n        \"        {'sysLoadAvg':261.0},\" +\n        \"        {'node':'solr-28:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-29:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1706.797966003418},\" +\n        \"        {'sysLoadAvg':252.99999999999997},\" +\n        \"        {'node':'solr-29:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-32:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1762.432300567627},\" +\n        \"        {'sysLoadAvg':221.0},\" +\n        \"        {'node':'solr-32:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-21:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1760.9801979064941},\" +\n        \"        {'sysLoadAvg':213.0},\" +\n        \"        {'node':'solr-21:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-22:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1780.5297241210938},\" +\n        \"        {'sysLoadAvg':209.0},\" +\n        \"        {'node':'solr-22:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-31:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1700.1481628417969},\" +\n        \"        {'sysLoadAvg':211.0},\" +\n        \"        {'node':'solr-31:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-33:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1748.1132926940918},\" +\n        \"        {'sysLoadAvg':199.0},\" +\n        \"        {'node':'solr-33:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-36:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1776.197639465332},\" +\n        \"        {'sysLoadAvg':193.0},\" +\n        \"        {'node':'solr-36:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.7729606628418},\" +\n        \"        {'sysLoadAvg':191.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-12:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1713.287540435791},\" +\n        \"        {'sysLoadAvg':175.0},\" +\n        \"        {'node':'solr-12:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-11:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1736.784511566162},\" +\n        \"        {'sysLoadAvg':169.0},\" +\n        \"        {'node':'solr-11:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1766.9416885375977},\" +\n        \"        {'sysLoadAvg':155.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-17:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.3425407409668},\" +\n        \"        {'sysLoadAvg':139.0},\" +\n        \"        {'node':'solr-17:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-18:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1757.0613975524902},\" +\n        \"        {'sysLoadAvg':132.0},\" +\n        \"        {'node':'solr-18:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-20:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1747.4205322265625},\" +\n        \"        {'sysLoadAvg':126.0},\" +\n        \"        {'node':'solr-20:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-27:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':4},\" +\n        \"        {'freedisk':1721.0442085266113},\" +\n        \"        {'sysLoadAvg':118.0},\" +\n        \"        {'node':'solr-27:8983_solr'}]}]}\";\n\n    List l = (List) ((Map) Utils.fromJSONString(rowsData)).get(\"sortedNodes\");\n    List<Suggestion.ConditionType> params = new ArrayList<>();\n    params.add(Suggestion.ConditionType.CORES);\n    params.add(Suggestion.ConditionType.FREEDISK);\n    params.add(Suggestion.ConditionType.SYSLOADAVG);\n    params.add(Suggestion.ConditionType.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Suggestion.ConditionType param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"7b9f478d4eb5c08e4b0a9717fe37bd99f09ea733","date":1532604765,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n    String rowsData = \"{'sortedNodes':[\" +\n        \"    {\" +\n        \"      'node':'solr-01:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1734.5261459350586},\" +\n        \"        {'sysLoadAvg':35.0},\" +\n        \"        {'node':'solr-01:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-07:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1721.5669250488281},\" +\n        \"        {'sysLoadAvg':10.0},\" +\n        \"        {'node':'solr-07:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-08:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.9518203735352},\" +\n        \"        {'sysLoadAvg':330.0},\" +\n        \"        {'node':'solr-08:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-25:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1779.7792778015137},\" +\n        \"        {'sysLoadAvg':304.0},\" +\n        \"        {'node':'solr-25:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-15:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1697.5930519104004},\" +\n        \"        {'sysLoadAvg':277.0},\" +\n        \"        {'node':'solr-15:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-13:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1755.1909484863281},\" +\n        \"        {'sysLoadAvg':265.0},\" +\n        \"        {'node':'solr-13:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-14:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1757.6035423278809},\" +\n        \"        {'sysLoadAvg':61.0},\" +\n        \"        {'node':'solr-14:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-16:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.081386566162},\" +\n        \"        {'sysLoadAvg':260.0},\" +\n        \"        {'node':'solr-16:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-04:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1708.7230529785156},\" +\n        \"        {'sysLoadAvg':216.0},\" +\n        \"        {'node':'solr-04:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-06:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1688.3182678222656},\" +\n        \"        {'sysLoadAvg':385.0},\" +\n        \"        {'node':'solr-06:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-02:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':6},\" +\n        \"        {'freedisk':1778.226963043213},\" +\n        \"        {'sysLoadAvg':369.0},\" +\n        \"        {'node':'solr-02:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-05:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1741.9401931762695},\" +\n        \"        {'sysLoadAvg':354.0},\" +\n        \"        {'node':'solr-05:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-23:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1718.854579925537},\" +\n        \"        {'sysLoadAvg':329.0},\" +\n        \"        {'node':'solr-23:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-24:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1733.6669311523438},\" +\n        \"        {'sysLoadAvg':327.0},\" +\n        \"        {'node':'solr-24:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-09:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1714.6191711425781},\" +\n        \"        {'sysLoadAvg':278.0},\" +\n        \"        {'node':'solr-09:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-10:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1755.3038482666016},\" +\n        \"        {'sysLoadAvg':266.0},\" +\n        \"        {'node':'solr-10:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-28:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1691.3830909729004},\" +\n        \"        {'sysLoadAvg':261.0},\" +\n        \"        {'node':'solr-28:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-29:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1706.797966003418},\" +\n        \"        {'sysLoadAvg':252.99999999999997},\" +\n        \"        {'node':'solr-29:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-32:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1762.432300567627},\" +\n        \"        {'sysLoadAvg':221.0},\" +\n        \"        {'node':'solr-32:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-21:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1760.9801979064941},\" +\n        \"        {'sysLoadAvg':213.0},\" +\n        \"        {'node':'solr-21:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-22:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1780.5297241210938},\" +\n        \"        {'sysLoadAvg':209.0},\" +\n        \"        {'node':'solr-22:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-31:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1700.1481628417969},\" +\n        \"        {'sysLoadAvg':211.0},\" +\n        \"        {'node':'solr-31:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-33:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1748.1132926940918},\" +\n        \"        {'sysLoadAvg':199.0},\" +\n        \"        {'node':'solr-33:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-36:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1776.197639465332},\" +\n        \"        {'sysLoadAvg':193.0},\" +\n        \"        {'node':'solr-36:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.7729606628418},\" +\n        \"        {'sysLoadAvg':191.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-12:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1713.287540435791},\" +\n        \"        {'sysLoadAvg':175.0},\" +\n        \"        {'node':'solr-12:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-11:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1736.784511566162},\" +\n        \"        {'sysLoadAvg':169.0},\" +\n        \"        {'node':'solr-11:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1766.9416885375977},\" +\n        \"        {'sysLoadAvg':155.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-17:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.3425407409668},\" +\n        \"        {'sysLoadAvg':139.0},\" +\n        \"        {'node':'solr-17:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-18:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1757.0613975524902},\" +\n        \"        {'sysLoadAvg':132.0},\" +\n        \"        {'node':'solr-18:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-20:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1747.4205322265625},\" +\n        \"        {'sysLoadAvg':126.0},\" +\n        \"        {'node':'solr-20:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-27:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':4},\" +\n        \"        {'freedisk':1721.0442085266113},\" +\n        \"        {'sysLoadAvg':118.0},\" +\n        \"        {'node':'solr-27:8983_solr'}]}]}\";\n\n    List l = (List) ((Map) Utils.fromJSONString(rowsData)).get(\"sortedNodes\");\n    List<Suggestion.ConditionType> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Suggestion.ConditionType.FREEDISK);\n    params.add(Suggestion.ConditionType.SYSLOADAVG);\n    params.add(Suggestion.ConditionType.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Suggestion.ConditionType param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n    String rowsData = \"{'sortedNodes':[\" +\n        \"    {\" +\n        \"      'node':'solr-01:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1734.5261459350586},\" +\n        \"        {'sysLoadAvg':35.0},\" +\n        \"        {'node':'solr-01:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-07:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1721.5669250488281},\" +\n        \"        {'sysLoadAvg':10.0},\" +\n        \"        {'node':'solr-07:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-08:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.9518203735352},\" +\n        \"        {'sysLoadAvg':330.0},\" +\n        \"        {'node':'solr-08:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-25:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1779.7792778015137},\" +\n        \"        {'sysLoadAvg':304.0},\" +\n        \"        {'node':'solr-25:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-15:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1697.5930519104004},\" +\n        \"        {'sysLoadAvg':277.0},\" +\n        \"        {'node':'solr-15:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-13:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1755.1909484863281},\" +\n        \"        {'sysLoadAvg':265.0},\" +\n        \"        {'node':'solr-13:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-14:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1757.6035423278809},\" +\n        \"        {'sysLoadAvg':61.0},\" +\n        \"        {'node':'solr-14:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-16:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.081386566162},\" +\n        \"        {'sysLoadAvg':260.0},\" +\n        \"        {'node':'solr-16:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-04:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1708.7230529785156},\" +\n        \"        {'sysLoadAvg':216.0},\" +\n        \"        {'node':'solr-04:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-06:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1688.3182678222656},\" +\n        \"        {'sysLoadAvg':385.0},\" +\n        \"        {'node':'solr-06:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-02:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':6},\" +\n        \"        {'freedisk':1778.226963043213},\" +\n        \"        {'sysLoadAvg':369.0},\" +\n        \"        {'node':'solr-02:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-05:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1741.9401931762695},\" +\n        \"        {'sysLoadAvg':354.0},\" +\n        \"        {'node':'solr-05:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-23:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1718.854579925537},\" +\n        \"        {'sysLoadAvg':329.0},\" +\n        \"        {'node':'solr-23:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-24:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1733.6669311523438},\" +\n        \"        {'sysLoadAvg':327.0},\" +\n        \"        {'node':'solr-24:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-09:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1714.6191711425781},\" +\n        \"        {'sysLoadAvg':278.0},\" +\n        \"        {'node':'solr-09:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-10:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1755.3038482666016},\" +\n        \"        {'sysLoadAvg':266.0},\" +\n        \"        {'node':'solr-10:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-28:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1691.3830909729004},\" +\n        \"        {'sysLoadAvg':261.0},\" +\n        \"        {'node':'solr-28:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-29:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1706.797966003418},\" +\n        \"        {'sysLoadAvg':252.99999999999997},\" +\n        \"        {'node':'solr-29:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-32:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1762.432300567627},\" +\n        \"        {'sysLoadAvg':221.0},\" +\n        \"        {'node':'solr-32:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-21:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1760.9801979064941},\" +\n        \"        {'sysLoadAvg':213.0},\" +\n        \"        {'node':'solr-21:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-22:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1780.5297241210938},\" +\n        \"        {'sysLoadAvg':209.0},\" +\n        \"        {'node':'solr-22:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-31:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1700.1481628417969},\" +\n        \"        {'sysLoadAvg':211.0},\" +\n        \"        {'node':'solr-31:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-33:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1748.1132926940918},\" +\n        \"        {'sysLoadAvg':199.0},\" +\n        \"        {'node':'solr-33:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-36:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1776.197639465332},\" +\n        \"        {'sysLoadAvg':193.0},\" +\n        \"        {'node':'solr-36:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.7729606628418},\" +\n        \"        {'sysLoadAvg':191.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-12:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1713.287540435791},\" +\n        \"        {'sysLoadAvg':175.0},\" +\n        \"        {'node':'solr-12:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-11:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1736.784511566162},\" +\n        \"        {'sysLoadAvg':169.0},\" +\n        \"        {'node':'solr-11:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1766.9416885375977},\" +\n        \"        {'sysLoadAvg':155.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-17:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.3425407409668},\" +\n        \"        {'sysLoadAvg':139.0},\" +\n        \"        {'node':'solr-17:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-18:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1757.0613975524902},\" +\n        \"        {'sysLoadAvg':132.0},\" +\n        \"        {'node':'solr-18:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-20:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1747.4205322265625},\" +\n        \"        {'sysLoadAvg':126.0},\" +\n        \"        {'node':'solr-20:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-27:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':4},\" +\n        \"        {'freedisk':1721.0442085266113},\" +\n        \"        {'sysLoadAvg':118.0},\" +\n        \"        {'node':'solr-27:8983_solr'}]}]}\";\n\n    List l = (List) ((Map) Utils.fromJSONString(rowsData)).get(\"sortedNodes\");\n    List<Suggestion.ConditionType> params = new ArrayList<>();\n    params.add(Suggestion.ConditionType.CORES);\n    params.add(Suggestion.ConditionType.FREEDISK);\n    params.add(Suggestion.ConditionType.SYSLOADAVG);\n    params.add(Suggestion.ConditionType.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Suggestion.ConditionType param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"427edb17549d4bb82462a16eec4ee0533d12d5b7","date":1533006754,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n    String rowsData = \"{'sortedNodes':[\" +\n        \"    {\" +\n        \"      'node':'solr-01:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1734.5261459350586},\" +\n        \"        {'sysLoadAvg':35.0},\" +\n        \"        {'node':'solr-01:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-07:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1721.5669250488281},\" +\n        \"        {'sysLoadAvg':10.0},\" +\n        \"        {'node':'solr-07:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-08:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.9518203735352},\" +\n        \"        {'sysLoadAvg':330.0},\" +\n        \"        {'node':'solr-08:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-25:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1779.7792778015137},\" +\n        \"        {'sysLoadAvg':304.0},\" +\n        \"        {'node':'solr-25:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-15:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1697.5930519104004},\" +\n        \"        {'sysLoadAvg':277.0},\" +\n        \"        {'node':'solr-15:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-13:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1755.1909484863281},\" +\n        \"        {'sysLoadAvg':265.0},\" +\n        \"        {'node':'solr-13:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-14:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1757.6035423278809},\" +\n        \"        {'sysLoadAvg':61.0},\" +\n        \"        {'node':'solr-14:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-16:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.081386566162},\" +\n        \"        {'sysLoadAvg':260.0},\" +\n        \"        {'node':'solr-16:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-04:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1708.7230529785156},\" +\n        \"        {'sysLoadAvg':216.0},\" +\n        \"        {'node':'solr-04:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-06:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1688.3182678222656},\" +\n        \"        {'sysLoadAvg':385.0},\" +\n        \"        {'node':'solr-06:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-02:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':6},\" +\n        \"        {'freedisk':1778.226963043213},\" +\n        \"        {'sysLoadAvg':369.0},\" +\n        \"        {'node':'solr-02:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-05:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1741.9401931762695},\" +\n        \"        {'sysLoadAvg':354.0},\" +\n        \"        {'node':'solr-05:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-23:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1718.854579925537},\" +\n        \"        {'sysLoadAvg':329.0},\" +\n        \"        {'node':'solr-23:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-24:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1733.6669311523438},\" +\n        \"        {'sysLoadAvg':327.0},\" +\n        \"        {'node':'solr-24:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-09:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1714.6191711425781},\" +\n        \"        {'sysLoadAvg':278.0},\" +\n        \"        {'node':'solr-09:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-10:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1755.3038482666016},\" +\n        \"        {'sysLoadAvg':266.0},\" +\n        \"        {'node':'solr-10:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-28:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1691.3830909729004},\" +\n        \"        {'sysLoadAvg':261.0},\" +\n        \"        {'node':'solr-28:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-29:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1706.797966003418},\" +\n        \"        {'sysLoadAvg':252.99999999999997},\" +\n        \"        {'node':'solr-29:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-32:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1762.432300567627},\" +\n        \"        {'sysLoadAvg':221.0},\" +\n        \"        {'node':'solr-32:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-21:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1760.9801979064941},\" +\n        \"        {'sysLoadAvg':213.0},\" +\n        \"        {'node':'solr-21:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-22:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1780.5297241210938},\" +\n        \"        {'sysLoadAvg':209.0},\" +\n        \"        {'node':'solr-22:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-31:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1700.1481628417969},\" +\n        \"        {'sysLoadAvg':211.0},\" +\n        \"        {'node':'solr-31:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-33:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1748.1132926940918},\" +\n        \"        {'sysLoadAvg':199.0},\" +\n        \"        {'node':'solr-33:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-36:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1776.197639465332},\" +\n        \"        {'sysLoadAvg':193.0},\" +\n        \"        {'node':'solr-36:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.7729606628418},\" +\n        \"        {'sysLoadAvg':191.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-12:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1713.287540435791},\" +\n        \"        {'sysLoadAvg':175.0},\" +\n        \"        {'node':'solr-12:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-11:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1736.784511566162},\" +\n        \"        {'sysLoadAvg':169.0},\" +\n        \"        {'node':'solr-11:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1766.9416885375977},\" +\n        \"        {'sysLoadAvg':155.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-17:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.3425407409668},\" +\n        \"        {'sysLoadAvg':139.0},\" +\n        \"        {'node':'solr-17:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-18:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1757.0613975524902},\" +\n        \"        {'sysLoadAvg':132.0},\" +\n        \"        {'node':'solr-18:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-20:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1747.4205322265625},\" +\n        \"        {'sysLoadAvg':126.0},\" +\n        \"        {'node':'solr-20:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-27:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':4},\" +\n        \"        {'freedisk':1721.0442085266113},\" +\n        \"        {'sysLoadAvg':118.0},\" +\n        \"        {'node':'solr-27:8983_solr'}]}]}\";\n\n    List l = (List) ((Map) Utils.fromJSONString(rowsData)).get(\"sortedNodes\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n    String rowsData = \"{'sortedNodes':[\" +\n        \"    {\" +\n        \"      'node':'solr-01:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1734.5261459350586},\" +\n        \"        {'sysLoadAvg':35.0},\" +\n        \"        {'node':'solr-01:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-07:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1721.5669250488281},\" +\n        \"        {'sysLoadAvg':10.0},\" +\n        \"        {'node':'solr-07:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-08:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.9518203735352},\" +\n        \"        {'sysLoadAvg':330.0},\" +\n        \"        {'node':'solr-08:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-25:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1779.7792778015137},\" +\n        \"        {'sysLoadAvg':304.0},\" +\n        \"        {'node':'solr-25:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-15:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1697.5930519104004},\" +\n        \"        {'sysLoadAvg':277.0},\" +\n        \"        {'node':'solr-15:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-13:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1755.1909484863281},\" +\n        \"        {'sysLoadAvg':265.0},\" +\n        \"        {'node':'solr-13:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-14:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1757.6035423278809},\" +\n        \"        {'sysLoadAvg':61.0},\" +\n        \"        {'node':'solr-14:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-16:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.081386566162},\" +\n        \"        {'sysLoadAvg':260.0},\" +\n        \"        {'node':'solr-16:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-04:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1708.7230529785156},\" +\n        \"        {'sysLoadAvg':216.0},\" +\n        \"        {'node':'solr-04:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-06:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1688.3182678222656},\" +\n        \"        {'sysLoadAvg':385.0},\" +\n        \"        {'node':'solr-06:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-02:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':6},\" +\n        \"        {'freedisk':1778.226963043213},\" +\n        \"        {'sysLoadAvg':369.0},\" +\n        \"        {'node':'solr-02:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-05:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1741.9401931762695},\" +\n        \"        {'sysLoadAvg':354.0},\" +\n        \"        {'node':'solr-05:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-23:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1718.854579925537},\" +\n        \"        {'sysLoadAvg':329.0},\" +\n        \"        {'node':'solr-23:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-24:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1733.6669311523438},\" +\n        \"        {'sysLoadAvg':327.0},\" +\n        \"        {'node':'solr-24:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-09:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1714.6191711425781},\" +\n        \"        {'sysLoadAvg':278.0},\" +\n        \"        {'node':'solr-09:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-10:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1755.3038482666016},\" +\n        \"        {'sysLoadAvg':266.0},\" +\n        \"        {'node':'solr-10:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-28:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1691.3830909729004},\" +\n        \"        {'sysLoadAvg':261.0},\" +\n        \"        {'node':'solr-28:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-29:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1706.797966003418},\" +\n        \"        {'sysLoadAvg':252.99999999999997},\" +\n        \"        {'node':'solr-29:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-32:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1762.432300567627},\" +\n        \"        {'sysLoadAvg':221.0},\" +\n        \"        {'node':'solr-32:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-21:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1760.9801979064941},\" +\n        \"        {'sysLoadAvg':213.0},\" +\n        \"        {'node':'solr-21:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-22:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1780.5297241210938},\" +\n        \"        {'sysLoadAvg':209.0},\" +\n        \"        {'node':'solr-22:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-31:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1700.1481628417969},\" +\n        \"        {'sysLoadAvg':211.0},\" +\n        \"        {'node':'solr-31:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-33:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1748.1132926940918},\" +\n        \"        {'sysLoadAvg':199.0},\" +\n        \"        {'node':'solr-33:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-36:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1776.197639465332},\" +\n        \"        {'sysLoadAvg':193.0},\" +\n        \"        {'node':'solr-36:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.7729606628418},\" +\n        \"        {'sysLoadAvg':191.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-12:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1713.287540435791},\" +\n        \"        {'sysLoadAvg':175.0},\" +\n        \"        {'node':'solr-12:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-11:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1736.784511566162},\" +\n        \"        {'sysLoadAvg':169.0},\" +\n        \"        {'node':'solr-11:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1766.9416885375977},\" +\n        \"        {'sysLoadAvg':155.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-17:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.3425407409668},\" +\n        \"        {'sysLoadAvg':139.0},\" +\n        \"        {'node':'solr-17:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-18:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1757.0613975524902},\" +\n        \"        {'sysLoadAvg':132.0},\" +\n        \"        {'node':'solr-18:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-20:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1747.4205322265625},\" +\n        \"        {'sysLoadAvg':126.0},\" +\n        \"        {'node':'solr-20:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-27:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':4},\" +\n        \"        {'freedisk':1721.0442085266113},\" +\n        \"        {'sysLoadAvg':118.0},\" +\n        \"        {'node':'solr-27:8983_solr'}]}]}\";\n\n    List l = (List) ((Map) Utils.fromJSONString(rowsData)).get(\"sortedNodes\");\n    List<Suggestion.ConditionType> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Suggestion.ConditionType.FREEDISK);\n    params.add(Suggestion.ConditionType.SYSLOADAVG);\n    params.add(Suggestion.ConditionType.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Suggestion.ConditionType param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e9fe59d880401d7b6a9bd963ae45c19b2e6798c1","date":1537498541,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":"  //SOLR-12358\n  public void testSortError() throws IOException {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) TestPolicy2.loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n    String rowsData = \"{'sortedNodes':[\" +\n        \"    {\" +\n        \"      'node':'solr-01:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1734.5261459350586},\" +\n        \"        {'sysLoadAvg':35.0},\" +\n        \"        {'node':'solr-01:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-07:8983_solr',\" +\n        \"      'replicas':{},\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1721.5669250488281},\" +\n        \"        {'sysLoadAvg':10.0},\" +\n        \"        {'node':'solr-07:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-08:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.9518203735352},\" +\n        \"        {'sysLoadAvg':330.0},\" +\n        \"        {'node':'solr-08:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-25:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1779.7792778015137},\" +\n        \"        {'sysLoadAvg':304.0},\" +\n        \"        {'node':'solr-25:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-15:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1697.5930519104004},\" +\n        \"        {'sysLoadAvg':277.0},\" +\n        \"        {'node':'solr-15:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-13:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1755.1909484863281},\" +\n        \"        {'sysLoadAvg':265.0},\" +\n        \"        {'node':'solr-13:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-14:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1757.6035423278809},\" +\n        \"        {'sysLoadAvg':61.0},\" +\n        \"        {'node':'solr-14:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-16:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.081386566162},\" +\n        \"        {'sysLoadAvg':260.0},\" +\n        \"        {'node':'solr-16:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-04:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1708.7230529785156},\" +\n        \"        {'sysLoadAvg':216.0},\" +\n        \"        {'node':'solr-04:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-06:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1688.3182678222656},\" +\n        \"        {'sysLoadAvg':385.0},\" +\n        \"        {'node':'solr-06:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-02:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':6},\" +\n        \"        {'freedisk':1778.226963043213},\" +\n        \"        {'sysLoadAvg':369.0},\" +\n        \"        {'node':'solr-02:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-05:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1741.9401931762695},\" +\n        \"        {'sysLoadAvg':354.0},\" +\n        \"        {'node':'solr-05:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-23:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1718.854579925537},\" +\n        \"        {'sysLoadAvg':329.0},\" +\n        \"        {'node':'solr-23:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-24:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1733.6669311523438},\" +\n        \"        {'sysLoadAvg':327.0},\" +\n        \"        {'node':'solr-24:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-09:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1714.6191711425781},\" +\n        \"        {'sysLoadAvg':278.0},\" +\n        \"        {'node':'solr-09:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-10:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1755.3038482666016},\" +\n        \"        {'sysLoadAvg':266.0},\" +\n        \"        {'node':'solr-10:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-28:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1691.3830909729004},\" +\n        \"        {'sysLoadAvg':261.0},\" +\n        \"        {'node':'solr-28:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-29:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1706.797966003418},\" +\n        \"        {'sysLoadAvg':252.99999999999997},\" +\n        \"        {'node':'solr-29:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-32:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1762.432300567627},\" +\n        \"        {'sysLoadAvg':221.0},\" +\n        \"        {'node':'solr-32:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-21:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1760.9801979064941},\" +\n        \"        {'sysLoadAvg':213.0},\" +\n        \"        {'node':'solr-21:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-22:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1780.5297241210938},\" +\n        \"        {'sysLoadAvg':209.0},\" +\n        \"        {'node':'solr-22:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-31:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1700.1481628417969},\" +\n        \"        {'sysLoadAvg':211.0},\" +\n        \"        {'node':'solr-31:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-33:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1748.1132926940918},\" +\n        \"        {'sysLoadAvg':199.0},\" +\n        \"        {'node':'solr-33:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-36:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1776.197639465332},\" +\n        \"        {'sysLoadAvg':193.0},\" +\n        \"        {'node':'solr-36:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1746.7729606628418},\" +\n        \"        {'sysLoadAvg':191.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-12:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1713.287540435791},\" +\n        \"        {'sysLoadAvg':175.0},\" +\n        \"        {'node':'solr-12:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-11:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1736.784511566162},\" +\n        \"        {'sysLoadAvg':169.0},\" +\n        \"        {'node':'solr-11:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-35:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1766.9416885375977},\" +\n        \"        {'sysLoadAvg':155.0},\" +\n        \"        {'node':'solr-35:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-17:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1764.3425407409668},\" +\n        \"        {'sysLoadAvg':139.0},\" +\n        \"        {'node':'solr-17:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-18:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':2},\" +\n        \"        {'freedisk':1757.0613975524902},\" +\n        \"        {'sysLoadAvg':132.0},\" +\n        \"        {'node':'solr-18:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-20:8983_solr',\" +\n        \"      'isLive':false,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':3},\" +\n        \"        {'freedisk':1747.4205322265625},\" +\n        \"        {'sysLoadAvg':126.0},\" +\n        \"        {'node':'solr-20:8983_solr'}]},\" +\n        \"    {\" +\n        \"      'node':'solr-27:8983_solr',\" +\n        \"      'isLive':true,\" +\n        \"      'attributes':[\" +\n        \"        {'cores':4},\" +\n        \"        {'freedisk':1721.0442085266113},\" +\n        \"        {'sysLoadAvg':118.0},\" +\n        \"        {'node':'solr-27:8983_solr'}]}]}\";\n\n    List l = (List) ((Map) Utils.fromJSONString(rowsData)).get(\"sortedNodes\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"f5a27e78e3d29dee02bab19ded25336471e96882","date":1539677468,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":"  //SOLR-12358\n  public void testSortError() throws IOException {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) TestPolicy2.loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"58e890cd5653ae8550bc6088d739f4eaaf950aff","date":1547036285,"type":3,"author":"Noble Paul","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null, new HashMap(), new HashMap()));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"e5028c6838e2e49cb9da1cf70269851c049f107a","date":1584984100,"type":3,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null, new HashMap(), new HashMap()));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.getClusterPreferences(), rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null, new HashMap(), new HashMap()));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.clusterPreferences, rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"9ba1b632c041956c93c41aa1143d16a567014891","date":1592328473,"type":3,"author":"Erick Erickson","isMerge":false,"pathNew":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":"  //SOLR-12358\n  @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null, new HashMap(), new HashMap()));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.getClusterPreferences(), rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","sourceOld":"  //SOLR-12358\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null, new HashMap(), new HashMap()));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.getClusterPreferences(), rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"3f504512a03d978990cbff30db0522b354e846db","date":1595247421,"type":4,"author":"Ishan Chattopadhyaya","isMerge":false,"pathNew":"/dev/null","pathOld":"solr/solrj/src/test/org/apache/solr/client/solrj/cloud/autoscaling/TestPolicy#testSortError().mjava","sourceNew":null,"sourceOld":"  //SOLR-12358\n  @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n  public void testSortError() {\n    Policy policy = new Policy((Map<String, Object>) Utils.fromJSONString(\"{cluster-preferences: [{minimize : cores, precision:1}, \" +\n        \"{maximize : freedisk, precision: 50}, \" +\n        \"{minimize: sysLoadAvg}]}\"));\n\n    List l = (List) loadFromResource(\"testSortError.json\");\n    List<Variable.Type> params = new ArrayList<>();\n    params.add(CORES);\n    params.add(Variable.Type.FREEDISK);\n    params.add(Variable.Type.SYSLOADAVG);\n    params.add(Variable.Type.NODE);\n    List<Row> rows = new ArrayList<>();\n    for (Object o : l) {\n      Map m = (Map) o;\n      Cell[] c = new Cell[params.size()];\n      List attrs = (List) m.get(\"attributes\");\n      for (int i = 0; i < params.size(); i++) {\n        Variable.Type param = params.get(i);\n        for (Object attr : attrs) {\n          Object o1 = ((Map) attr).get(param.tagName);\n          if (o1 != null) {\n            o1 = param.validate(param.tagName, o1, false);\n            c[i] = new Cell(i, param.tagName, o1, o1, param, null);\n          }\n        }\n      }\n      rows.add(new Row((String) m.get(\"node\"), c, false,\n          new HashMap<>(),\n          (Boolean) m.get(\"isLive\"), null, new HashMap(), new HashMap()));\n    }\n    int deadNodes = 0;\n    for (Row row : rows) {\n      if (!row.isLive) deadNodes++;\n    }\n\n    Policy.setApproxValuesAndSortNodes(policy.getClusterPreferences(), rows);\n\n    for (int i = 0; i < deadNodes; i++) {\n      assertFalse(rows.get(i).isLive);\n    }\n\n    for (int i = deadNodes; i < rows.size(); i++) {\n      assertTrue(rows.get(i).isLive);\n    }\n\n\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"9ba1b632c041956c93c41aa1143d16a567014891":["e5028c6838e2e49cb9da1cf70269851c049f107a"],"58e890cd5653ae8550bc6088d739f4eaaf950aff":["f5a27e78e3d29dee02bab19ded25336471e96882"],"e9fe59d880401d7b6a9bd963ae45c19b2e6798c1":["427edb17549d4bb82462a16eec4ee0533d12d5b7"],"3f504512a03d978990cbff30db0522b354e846db":["9ba1b632c041956c93c41aa1143d16a567014891"],"427edb17549d4bb82462a16eec4ee0533d12d5b7":["7b9f478d4eb5c08e4b0a9717fe37bd99f09ea733"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"7b9f478d4eb5c08e4b0a9717fe37bd99f09ea733":["34dd1818ff2313f17cf59834695ab7ee0c7853d7"],"f5a27e78e3d29dee02bab19ded25336471e96882":["e9fe59d880401d7b6a9bd963ae45c19b2e6798c1"],"e5028c6838e2e49cb9da1cf70269851c049f107a":["58e890cd5653ae8550bc6088d739f4eaaf950aff"],"34dd1818ff2313f17cf59834695ab7ee0c7853d7":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["3f504512a03d978990cbff30db0522b354e846db"]},"commit2Childs":{"9ba1b632c041956c93c41aa1143d16a567014891":["3f504512a03d978990cbff30db0522b354e846db"],"58e890cd5653ae8550bc6088d739f4eaaf950aff":["e5028c6838e2e49cb9da1cf70269851c049f107a"],"e9fe59d880401d7b6a9bd963ae45c19b2e6798c1":["f5a27e78e3d29dee02bab19ded25336471e96882"],"3f504512a03d978990cbff30db0522b354e846db":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"427edb17549d4bb82462a16eec4ee0533d12d5b7":["e9fe59d880401d7b6a9bd963ae45c19b2e6798c1"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["34dd1818ff2313f17cf59834695ab7ee0c7853d7"],"7b9f478d4eb5c08e4b0a9717fe37bd99f09ea733":["427edb17549d4bb82462a16eec4ee0533d12d5b7"],"f5a27e78e3d29dee02bab19ded25336471e96882":["58e890cd5653ae8550bc6088d739f4eaaf950aff"],"e5028c6838e2e49cb9da1cf70269851c049f107a":["9ba1b632c041956c93c41aa1143d16a567014891"],"34dd1818ff2313f17cf59834695ab7ee0c7853d7":["7b9f478d4eb5c08e4b0a9717fe37bd99f09ea733"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}