{"path":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","commits":[{"id":"83e99d44c4a660a48c0fcc7a0108ad0a56dc2f87","date":1328967626,"type":1,"author":"Uwe Schindler","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestIndexReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","sourceNew":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            Document prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","sourceOld":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            Document prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"8f0e28f2a7f0f3f0fca1a2ffedaa10c7ac9536c4","date":1341839195,"type":3,"author":"Uwe Schindler","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","sourceNew":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","sourceOld":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            Document prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"1d028314cced5858683a1bb4741423d0f934257b","date":1346596535,"type":3,"author":"Uwe Schindler","isMerge":true,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","sourceNew":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","sourceOld":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            Document prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"ae14298f4eec6d5faee6a149f88ba57d14a6f21a","date":1396971290,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","sourceNew":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.shutdown();\n      reader.close();\n    }\n  }\n\n","sourceOld":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"54a6bea0b991120a99ad0e2f72ae853fd5ecae0e","date":1406737224,"type":3,"author":"Robert Muir","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","sourceNew":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(new MockAnalyzer(random))\n                                                 .setOpenMode(OpenMode.CREATE)\n                                                 .setMergeScheduler(new SerialMergeScheduler())\n                                                 .setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.shutdown();\n      reader.close();\n    }\n  }\n\n","sourceOld":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(\n        TEST_VERSION_CURRENT, new MockAnalyzer(random)).setOpenMode(\n                                                              OpenMode.CREATE).setMergeScheduler(new SerialMergeScheduler()).setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.shutdown();\n      reader.close();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"d0ef034a4f10871667ae75181537775ddcf8ade4","date":1407610475,"type":3,"author":"Ryan Ernst","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","sourceNew":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(new MockAnalyzer(random))\n                                                 .setOpenMode(OpenMode.CREATE)\n                                                 .setMergeScheduler(new SerialMergeScheduler())\n                                                 .setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","sourceOld":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(new MockAnalyzer(random))\n                                                 .setOpenMode(OpenMode.CREATE)\n                                                 .setMergeScheduler(new SerialMergeScheduler())\n                                                 .setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.shutdown();\n      reader.close();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6654c5f3ec2e4a84ef867c82d4eec872c2372c8c","date":1453060490,"type":3,"author":"Michael McCandless","isMerge":false,"pathNew":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","pathOld":"lucene/core/src/test/org/apache/lucene/index/TestDirectoryReaderReopen#doTestReopenWithCommit(Random,Directory,boolean).mjava","sourceNew":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(new MockAnalyzer(random))\n                                                 .setOpenMode(OpenMode.CREATE)\n                                                 .setMergeScheduler(new SerialMergeScheduler())\n                                                 .setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            Document prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","sourceOld":"  private void doTestReopenWithCommit (Random random, Directory dir, boolean withReopen) throws IOException {\n    IndexWriter iwriter = new IndexWriter(dir, newIndexWriterConfig(new MockAnalyzer(random))\n                                                 .setOpenMode(OpenMode.CREATE)\n                                                 .setMergeScheduler(new SerialMergeScheduler())\n                                                 .setMergePolicy(newLogMergePolicy()));\n    iwriter.commit();\n    DirectoryReader reader = DirectoryReader.open(dir);\n    try {\n      int M = 3;\n      FieldType customType = new FieldType(TextField.TYPE_STORED);\n      customType.setTokenized(false);\n      FieldType customType2 = new FieldType(TextField.TYPE_STORED);\n      customType2.setTokenized(false);\n      customType2.setOmitNorms(true);\n      FieldType customType3 = new FieldType();\n      customType3.setStored(true);\n      for (int i=0; i<4; i++) {\n        for (int j=0; j<M; j++) {\n          Document doc = new Document();\n          doc.add(newField(\"id\", i+\"_\"+j, customType));\n          doc.add(newField(\"id2\", i+\"_\"+j, customType2));\n          doc.add(newField(\"id3\", i+\"_\"+j, customType3));\n          iwriter.addDocument(doc);\n          if (i>0) {\n            int k = i-1;\n            int n = j + k*M;\n            StoredDocument prevItereationDoc = reader.document(n);\n            assertNotNull(prevItereationDoc);\n            String id = prevItereationDoc.get(\"id\");\n            assertEquals(k+\"_\"+j, id);\n          }\n        }\n        iwriter.commit();\n        if (withReopen) {\n          // reopen\n          DirectoryReader r2 = DirectoryReader.openIfChanged(reader);\n          if (r2 != null) {\n            reader.close();\n            reader = r2;\n          }\n        } else {\n          // recreate\n          reader.close();\n          reader = DirectoryReader.open(dir);\n        }\n      }\n    } finally {\n      iwriter.close();\n      reader.close();\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"8f0e28f2a7f0f3f0fca1a2ffedaa10c7ac9536c4":["83e99d44c4a660a48c0fcc7a0108ad0a56dc2f87"],"1d028314cced5858683a1bb4741423d0f934257b":["83e99d44c4a660a48c0fcc7a0108ad0a56dc2f87","8f0e28f2a7f0f3f0fca1a2ffedaa10c7ac9536c4"],"54a6bea0b991120a99ad0e2f72ae853fd5ecae0e":["ae14298f4eec6d5faee6a149f88ba57d14a6f21a"],"83e99d44c4a660a48c0fcc7a0108ad0a56dc2f87":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"d0ef034a4f10871667ae75181537775ddcf8ade4":["54a6bea0b991120a99ad0e2f72ae853fd5ecae0e"],"ae14298f4eec6d5faee6a149f88ba57d14a6f21a":["1d028314cced5858683a1bb4741423d0f934257b"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["6654c5f3ec2e4a84ef867c82d4eec872c2372c8c"],"6654c5f3ec2e4a84ef867c82d4eec872c2372c8c":["d0ef034a4f10871667ae75181537775ddcf8ade4"]},"commit2Childs":{"8f0e28f2a7f0f3f0fca1a2ffedaa10c7ac9536c4":["1d028314cced5858683a1bb4741423d0f934257b"],"1d028314cced5858683a1bb4741423d0f934257b":["ae14298f4eec6d5faee6a149f88ba57d14a6f21a"],"54a6bea0b991120a99ad0e2f72ae853fd5ecae0e":["d0ef034a4f10871667ae75181537775ddcf8ade4"],"83e99d44c4a660a48c0fcc7a0108ad0a56dc2f87":["8f0e28f2a7f0f3f0fca1a2ffedaa10c7ac9536c4","1d028314cced5858683a1bb4741423d0f934257b"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["83e99d44c4a660a48c0fcc7a0108ad0a56dc2f87"],"d0ef034a4f10871667ae75181537775ddcf8ade4":["6654c5f3ec2e4a84ef867c82d4eec872c2372c8c"],"ae14298f4eec6d5faee6a149f88ba57d14a6f21a":["54a6bea0b991120a99ad0e2f72ae853fd5ecae0e"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[],"6654c5f3ec2e4a84ef867c82d4eec872c2372c8c":["cd5edd1f2b162a5cfa08efd17851a07373a96817"]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}