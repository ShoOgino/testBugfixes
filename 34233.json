{"path":"solr/core/src/test/org/apache/solr/update/TestInPlaceUpdatesStandalone#testFailOnVersionConflicts().mjava","commits":[{"id":"09c68c39b2c63d90387c861e51185c9568c50611","date":1557206402,"type":0,"author":"noble","isMerge":false,"pathNew":"solr/core/src/test/org/apache/solr/update/TestInPlaceUpdatesStandalone#testFailOnVersionConflicts().mjava","pathOld":"/dev/null","sourceNew":"  public void testFailOnVersionConflicts() throws Exception {\n\n    assertU(add(doc(\"id\", \"1\", \"title_s\", \"first\")));\n    assertU(commit());\n    assertQ(req(\"q\", \"title_s:first\"), \"//*[@numFound='1']\");\n    assertU(add(doc(\"id\", \"1\", \"title_s\", \"first1\")));\n    assertU(commit());\n    assertQ(req(\"q\", \"title_s:first1\"), \"//*[@numFound='1']\");\n    assertFailedU(add(doc(\"id\", \"1\", \"title_s\", \"first2\", \"_version_\", \"-1\")));\n    ModifiableSolrParams params = new ModifiableSolrParams();\n    params.add(\"_version_\", \"-1\");\n    SolrInputDocument doc = new SolrInputDocument(\"id\", \"1\", \"title_s\", \"first2\");\n    SolrInputDocument doc2 = new SolrInputDocument(\"id\", \"2\", \"title_s\", \"second\");\n    SolrException ex = expectThrows(SolrException.class, \"This should have failed\", () -> updateJ(jsonAdd(doc, doc2), params));\n\n    assertTrue(ex.getMessage().contains(\"version conflict for\"));\n    params.add(CommonParams.FAIL_ON_VERSION_CONFLICTS, \"false\");\n    updateJ(jsonAdd(doc, doc2), params);//this should not throw any error\n    assertU(commit());\n    assertQ(req(\"q\", \"title_s:second\"), \"//*[@numFound='1']\");\n    assertQ(req(\"q\", \"title_s:first1\"), \"//*[@numFound='1']\");// but the old value exists\n    assertQ(req(\"q\", \"title_s:first2\"), \"//*[@numFound='0']\");// and the new value does not reflect\n  }\n\n","sourceOld":null,"bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"09c68c39b2c63d90387c861e51185c9568c50611":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["09c68c39b2c63d90387c861e51185c9568c50611"]},"commit2Childs":{"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["09c68c39b2c63d90387c861e51185c9568c50611"],"09c68c39b2c63d90387c861e51185c9568c50611":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}