{"path":"solr/core/src/java/org/apache/solr/cloud/CreateCollectionCmd#getConfName(DistribStateManager,String,String,Map[String,Object]).mjava","commits":[{"id":"1d4bf9d5308dfef350829c28f2b3b2648df1e9b1","date":1513252583,"type":1,"author":"Andrzej Bialecki","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/cloud/CreateCollectionCmd#getConfName(DistribStateManager,String,String,Map[String,Object]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/CreateCollectionCmd#getConfName(SolrZkClient,String,String,Map[String,Object]).mjava","sourceNew":"  private static void getConfName(DistribStateManager stateManager, String collection, String collectionPath, Map<String,Object> collectionProps) throws IOException,\n      KeeperException, InterruptedException {\n    // check for configName\n    log.debug(\"Looking for collection configName\");\n    if (collectionProps.containsKey(\"configName\")) {\n      log.info(\"configName was passed as a param {}\", collectionProps.get(\"configName\"));\n      return;\n    }\n\n    List<String> configNames = null;\n    int retry = 1;\n    int retryLimt = 6;\n    for (; retry < retryLimt; retry++) {\n      if (stateManager.hasData(collectionPath)) {\n        VersionedData data = stateManager.getData(collectionPath);\n        ZkNodeProps cProps = ZkNodeProps.load(data.getData());\n        if (cProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n          break;\n        }\n      }\n\n      try {\n        configNames = stateManager.listData(ZkConfigManager.CONFIGS_ZKNODE);\n      } catch (NoSuchElementException | NoNodeException e) {\n        // just keep trying\n      }\n\n      // check if there's a config set with the same name as the collection\n      if (configNames != null && configNames.contains(collection)) {\n        log.info(\n            \"Could not find explicit collection configName, but found config name matching collection name - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n        break;\n      }\n      // if _default exists, use that\n      if (configNames != null && configNames.contains(ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME)) {\n        log.info(\n            \"Could not find explicit collection configName, but found _default config set - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME);\n        break;\n      }\n      // if there is only one conf, use that\n      if (configNames != null && configNames.size() == 1) {\n        // no config set named, but there is only 1 - use it\n        log.info(\"Only one config set found in zk - using it:\" + configNames.get(0));\n        collectionProps.put(ZkController.CONFIGNAME_PROP, configNames.get(0));\n        break;\n      }\n\n      log.info(\"Could not find collection configName - pausing for 3 seconds and trying again - try: \" + retry);\n      Thread.sleep(3000);\n    }\n    if (retry == retryLimt) {\n      log.error(\"Could not find configName for collection \" + collection);\n      throw new ZooKeeperException(\n          SolrException.ErrorCode.SERVER_ERROR,\n          \"Could not find configName for collection \" + collection + \" found:\" + configNames);\n    }\n  }\n\n","sourceOld":"  private static void getConfName(SolrZkClient zkClient, String collection, String collectionPath, Map<String,Object> collectionProps) throws KeeperException,\n  InterruptedException {\n    // check for configName\n    log.debug(\"Looking for collection configName\");\n    if (collectionProps.containsKey(\"configName\")) {\n      log.info(\"configName was passed as a param {}\", collectionProps.get(\"configName\"));\n      return;\n    }\n\n    List<String> configNames = null;\n    int retry = 1;\n    int retryLimt = 6;\n    for (; retry < retryLimt; retry++) {\n      if (zkClient.exists(collectionPath, true)) {\n        ZkNodeProps cProps = ZkNodeProps.load(zkClient.getData(collectionPath, null, null, true));\n        if (cProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n          break;\n        }\n      }\n\n      try {\n        configNames = zkClient.getChildren(ZkConfigManager.CONFIGS_ZKNODE, null,\n            true);\n      } catch (NoNodeException e) {\n        // just keep trying\n      }\n\n      // check if there's a config set with the same name as the collection\n      if (configNames != null && configNames.contains(collection)) {\n        log.info(\n            \"Could not find explicit collection configName, but found config name matching collection name - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n        break;\n      }\n      // if _default exists, use that\n      if (configNames != null && configNames.contains(ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME)) {\n        log.info(\n            \"Could not find explicit collection configName, but found _default config set - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME);\n        break;\n      }\n      // if there is only one conf, use that\n      if (configNames != null && configNames.size() == 1) {\n        // no config set named, but there is only 1 - use it\n        log.info(\"Only one config set found in zk - using it:\" + configNames.get(0));\n        collectionProps.put(ZkController.CONFIGNAME_PROP, configNames.get(0));\n        break;\n      }\n\n      log.info(\"Could not find collection configName - pausing for 3 seconds and trying again - try: \" + retry);\n      Thread.sleep(3000);\n    }\n    if (retry == retryLimt) {\n      log.error(\"Could not find configName for collection \" + collection);\n      throw new ZooKeeperException(\n          SolrException.ErrorCode.SERVER_ERROR,\n          \"Could not find configName for collection \" + collection + \" found:\" + configNames);\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"6146c07c0dee1ae1e42926167acd127fed5ef59d","date":1516129420,"type":5,"author":"Varun Thacker","isMerge":false,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#getConfName(DistribStateManager,String,String,Map[String,Object]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/CreateCollectionCmd#getConfName(DistribStateManager,String,String,Map[String,Object]).mjava","sourceNew":"  private static void getConfName(DistribStateManager stateManager, String collection, String collectionPath, Map<String,Object> collectionProps) throws IOException,\n      KeeperException, InterruptedException {\n    // check for configName\n    log.debug(\"Looking for collection configName\");\n    if (collectionProps.containsKey(\"configName\")) {\n      log.info(\"configName was passed as a param {}\", collectionProps.get(\"configName\"));\n      return;\n    }\n\n    List<String> configNames = null;\n    int retry = 1;\n    int retryLimt = 6;\n    for (; retry < retryLimt; retry++) {\n      if (stateManager.hasData(collectionPath)) {\n        VersionedData data = stateManager.getData(collectionPath);\n        ZkNodeProps cProps = ZkNodeProps.load(data.getData());\n        if (cProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n          break;\n        }\n      }\n\n      try {\n        configNames = stateManager.listData(ZkConfigManager.CONFIGS_ZKNODE);\n      } catch (NoSuchElementException | NoNodeException e) {\n        // just keep trying\n      }\n\n      // check if there's a config set with the same name as the collection\n      if (configNames != null && configNames.contains(collection)) {\n        log.info(\n            \"Could not find explicit collection configName, but found config name matching collection name - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n        break;\n      }\n      // if _default exists, use that\n      if (configNames != null && configNames.contains(ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME)) {\n        log.info(\n            \"Could not find explicit collection configName, but found _default config set - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME);\n        break;\n      }\n      // if there is only one conf, use that\n      if (configNames != null && configNames.size() == 1) {\n        // no config set named, but there is only 1 - use it\n        log.info(\"Only one config set found in zk - using it:\" + configNames.get(0));\n        collectionProps.put(ZkController.CONFIGNAME_PROP, configNames.get(0));\n        break;\n      }\n\n      log.info(\"Could not find collection configName - pausing for 3 seconds and trying again - try: \" + retry);\n      Thread.sleep(3000);\n    }\n    if (retry == retryLimt) {\n      log.error(\"Could not find configName for collection \" + collection);\n      throw new ZooKeeperException(\n          SolrException.ErrorCode.SERVER_ERROR,\n          \"Could not find configName for collection \" + collection + \" found:\" + configNames);\n    }\n  }\n\n","sourceOld":"  private static void getConfName(DistribStateManager stateManager, String collection, String collectionPath, Map<String,Object> collectionProps) throws IOException,\n      KeeperException, InterruptedException {\n    // check for configName\n    log.debug(\"Looking for collection configName\");\n    if (collectionProps.containsKey(\"configName\")) {\n      log.info(\"configName was passed as a param {}\", collectionProps.get(\"configName\"));\n      return;\n    }\n\n    List<String> configNames = null;\n    int retry = 1;\n    int retryLimt = 6;\n    for (; retry < retryLimt; retry++) {\n      if (stateManager.hasData(collectionPath)) {\n        VersionedData data = stateManager.getData(collectionPath);\n        ZkNodeProps cProps = ZkNodeProps.load(data.getData());\n        if (cProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n          break;\n        }\n      }\n\n      try {\n        configNames = stateManager.listData(ZkConfigManager.CONFIGS_ZKNODE);\n      } catch (NoSuchElementException | NoNodeException e) {\n        // just keep trying\n      }\n\n      // check if there's a config set with the same name as the collection\n      if (configNames != null && configNames.contains(collection)) {\n        log.info(\n            \"Could not find explicit collection configName, but found config name matching collection name - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n        break;\n      }\n      // if _default exists, use that\n      if (configNames != null && configNames.contains(ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME)) {\n        log.info(\n            \"Could not find explicit collection configName, but found _default config set - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME);\n        break;\n      }\n      // if there is only one conf, use that\n      if (configNames != null && configNames.size() == 1) {\n        // no config set named, but there is only 1 - use it\n        log.info(\"Only one config set found in zk - using it:\" + configNames.get(0));\n        collectionProps.put(ZkController.CONFIGNAME_PROP, configNames.get(0));\n        break;\n      }\n\n      log.info(\"Could not find collection configName - pausing for 3 seconds and trying again - try: \" + retry);\n      Thread.sleep(3000);\n    }\n    if (retry == retryLimt) {\n      log.error(\"Could not find configName for collection \" + collection);\n      throw new ZooKeeperException(\n          SolrException.ErrorCode.SERVER_ERROR,\n          \"Could not find configName for collection \" + collection + \" found:\" + configNames);\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null},{"id":"b94236357aaa22b76c10629851fe4e376e0cea82","date":1516710914,"type":5,"author":"Karl Wright","isMerge":true,"pathNew":"solr/core/src/java/org/apache/solr/cloud/api/collections/CreateCollectionCmd#getConfName(DistribStateManager,String,String,Map[String,Object]).mjava","pathOld":"solr/core/src/java/org/apache/solr/cloud/CreateCollectionCmd#getConfName(DistribStateManager,String,String,Map[String,Object]).mjava","sourceNew":"  private static void getConfName(DistribStateManager stateManager, String collection, String collectionPath, Map<String,Object> collectionProps) throws IOException,\n      KeeperException, InterruptedException {\n    // check for configName\n    log.debug(\"Looking for collection configName\");\n    if (collectionProps.containsKey(\"configName\")) {\n      log.info(\"configName was passed as a param {}\", collectionProps.get(\"configName\"));\n      return;\n    }\n\n    List<String> configNames = null;\n    int retry = 1;\n    int retryLimt = 6;\n    for (; retry < retryLimt; retry++) {\n      if (stateManager.hasData(collectionPath)) {\n        VersionedData data = stateManager.getData(collectionPath);\n        ZkNodeProps cProps = ZkNodeProps.load(data.getData());\n        if (cProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n          break;\n        }\n      }\n\n      try {\n        configNames = stateManager.listData(ZkConfigManager.CONFIGS_ZKNODE);\n      } catch (NoSuchElementException | NoNodeException e) {\n        // just keep trying\n      }\n\n      // check if there's a config set with the same name as the collection\n      if (configNames != null && configNames.contains(collection)) {\n        log.info(\n            \"Could not find explicit collection configName, but found config name matching collection name - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n        break;\n      }\n      // if _default exists, use that\n      if (configNames != null && configNames.contains(ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME)) {\n        log.info(\n            \"Could not find explicit collection configName, but found _default config set - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME);\n        break;\n      }\n      // if there is only one conf, use that\n      if (configNames != null && configNames.size() == 1) {\n        // no config set named, but there is only 1 - use it\n        log.info(\"Only one config set found in zk - using it:\" + configNames.get(0));\n        collectionProps.put(ZkController.CONFIGNAME_PROP, configNames.get(0));\n        break;\n      }\n\n      log.info(\"Could not find collection configName - pausing for 3 seconds and trying again - try: \" + retry);\n      Thread.sleep(3000);\n    }\n    if (retry == retryLimt) {\n      log.error(\"Could not find configName for collection \" + collection);\n      throw new ZooKeeperException(\n          SolrException.ErrorCode.SERVER_ERROR,\n          \"Could not find configName for collection \" + collection + \" found:\" + configNames);\n    }\n  }\n\n","sourceOld":"  private static void getConfName(DistribStateManager stateManager, String collection, String collectionPath, Map<String,Object> collectionProps) throws IOException,\n      KeeperException, InterruptedException {\n    // check for configName\n    log.debug(\"Looking for collection configName\");\n    if (collectionProps.containsKey(\"configName\")) {\n      log.info(\"configName was passed as a param {}\", collectionProps.get(\"configName\"));\n      return;\n    }\n\n    List<String> configNames = null;\n    int retry = 1;\n    int retryLimt = 6;\n    for (; retry < retryLimt; retry++) {\n      if (stateManager.hasData(collectionPath)) {\n        VersionedData data = stateManager.getData(collectionPath);\n        ZkNodeProps cProps = ZkNodeProps.load(data.getData());\n        if (cProps.containsKey(ZkController.CONFIGNAME_PROP)) {\n          break;\n        }\n      }\n\n      try {\n        configNames = stateManager.listData(ZkConfigManager.CONFIGS_ZKNODE);\n      } catch (NoSuchElementException | NoNodeException e) {\n        // just keep trying\n      }\n\n      // check if there's a config set with the same name as the collection\n      if (configNames != null && configNames.contains(collection)) {\n        log.info(\n            \"Could not find explicit collection configName, but found config name matching collection name - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, collection);\n        break;\n      }\n      // if _default exists, use that\n      if (configNames != null && configNames.contains(ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME)) {\n        log.info(\n            \"Could not find explicit collection configName, but found _default config set - using that set.\");\n        collectionProps.put(ZkController.CONFIGNAME_PROP, ConfigSetsHandlerApi.DEFAULT_CONFIGSET_NAME);\n        break;\n      }\n      // if there is only one conf, use that\n      if (configNames != null && configNames.size() == 1) {\n        // no config set named, but there is only 1 - use it\n        log.info(\"Only one config set found in zk - using it:\" + configNames.get(0));\n        collectionProps.put(ZkController.CONFIGNAME_PROP, configNames.get(0));\n        break;\n      }\n\n      log.info(\"Could not find collection configName - pausing for 3 seconds and trying again - try: \" + retry);\n      Thread.sleep(3000);\n    }\n    if (retry == retryLimt) {\n      log.error(\"Could not find configName for collection \" + collection);\n      throw new ZooKeeperException(\n          SolrException.ErrorCode.SERVER_ERROR,\n          \"Could not find configName for collection \" + collection + \" found:\" + configNames);\n    }\n  }\n\n","bugFix":null,"bugIntro":[],"isBuggy":false,"nexts":[],"revCommit":null}],"commit2Parents":{"b94236357aaa22b76c10629851fe4e376e0cea82":["1d4bf9d5308dfef350829c28f2b3b2648df1e9b1","6146c07c0dee1ae1e42926167acd127fed5ef59d"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":[],"6146c07c0dee1ae1e42926167acd127fed5ef59d":["1d4bf9d5308dfef350829c28f2b3b2648df1e9b1"],"1d4bf9d5308dfef350829c28f2b3b2648df1e9b1":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":["b94236357aaa22b76c10629851fe4e376e0cea82"]},"commit2Childs":{"b94236357aaa22b76c10629851fe4e376e0cea82":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85":["1d4bf9d5308dfef350829c28f2b3b2648df1e9b1"],"6146c07c0dee1ae1e42926167acd127fed5ef59d":["b94236357aaa22b76c10629851fe4e376e0cea82"],"1d4bf9d5308dfef350829c28f2b3b2648df1e9b1":["b94236357aaa22b76c10629851fe4e376e0cea82","6146c07c0dee1ae1e42926167acd127fed5ef59d"],"cd5edd1f2b162a5cfa08efd17851a07373a96817":[]},"heads":["cd5edd1f2b162a5cfa08efd17851a07373a96817"],"roots":["a0e7ee9d0d12370e8d2b5ae0a23b6e687e018d85"],"pathCommit":null}